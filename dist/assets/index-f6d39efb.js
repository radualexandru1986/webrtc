(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const qv={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const E=function(n,e){if(!n)throw Ss(e)},Ss=function(n){return new Error("Firebase Database ("+qv.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const jv=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},B0=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=n[t++],o=n[t++],a=n[t++],c=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{const s=n[t++],o=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Rl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const s=n[r],o=r+1<n.length,a=o?n[r+1]:0,c=r+2<n.length,l=c?n[r+2]:0,u=s>>2,h=(s&3)<<4|a>>4;let d=(a&15)<<2|l>>6,f=l&63;c||(f=64,o||(d=64)),i.push(t[u],t[h],t[d],t[f])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(jv(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):B0(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const l=r<n.length?t[n.charAt(r)]:64;++r;const h=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||a==null||l==null||h==null)throw Error();const d=s<<2|a>>4;if(i.push(d),l!==64){const f=a<<4&240|l>>2;if(i.push(f),h!==64){const p=l<<6&192|h;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Wv=function(n){const e=jv(n);return Rl.encodeByteArray(e,!0)},Rc=function(n){return Wv(n).replace(/\./g,"")},Nc=function(n){try{return Rl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function q0(n){return Ro(void 0,n)}function Ro(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!j0(t)||(n[t]=Ro(n[t],e[t]));return n}function j0(n){return n!=="__proto__"}function de(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _f(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(de())}function Nl(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function W0(){return typeof self=="object"&&self.self===self}function Dl(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Pl(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Kv(){const n=de();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Gv(){return qv.NODE_ADMIN===!0}function K0(){return!Nl()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function bt(){try{return typeof indexedDB=="object"}catch{return!1}}function ga(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}function xl(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}function Hv(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const G0=()=>Hv().__FIREBASE_DEFAULTS__,H0=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},z0=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Nc(n[1]);return e&&JSON.parse(e)},zv=()=>{try{return G0()||H0()||z0()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Q0=()=>{var n;return(n=zv())===null||n===void 0?void 0:n.config},Y0=n=>{var e;return(e=zv())===null||e===void 0?void 0:e[`_${n}`]};class Ce{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}function yf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Rc(JSON.stringify(t)),Rc(JSON.stringify(o)),a].join(".")}const X0="FirebaseError";class he extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=X0,Object.setPrototypeOf(this,he.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,pt.prototype.create)}}class pt{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?J0(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new he(r,a,i)}}function J0(n,e){return n.replace(Z0,(t,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const Z0=/\{\$([^}]+)}/g;function No(n){return JSON.parse(n)}function ke(n){return JSON.stringify(n)}const vf=function(n){let e={},t={},i={},r="";try{const s=n.split(".");e=No(Nc(s[0])||""),t=No(Nc(s[1])||""),r=s[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:r}},ek=function(n){const e=vf(n).claims;return typeof e=="object"&&e.hasOwnProperty("iat")?e.iat:null},tk=function(n){const e=vf(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},nk=function(n){const e=vf(n).claims;return typeof e=="object"&&e.admin===!0};function Dt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function tr(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Dc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Pc(n,e,t){const i={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=e.call(t,n[r],r,n));return i}function Zh(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const s=n[r],o=e[r];if(mm(s)&&mm(o)){if(!Zh(s,o))return!1}else if(s!==o)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function mm(n){return n!==null&&typeof n=="object"}function Er(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function jr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function ao(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}class ik{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)i[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)i[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const d=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=(d<<1|d>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,u;for(let h=0;h<80;h++){h<40?h<20?(l=a^s&(o^a),u=1518500249):(l=s^o^a,u=1859775393):h<60?(l=s&o|a&(s|o),u=2400959708):(l=s^o^a,u=3395469782);const d=(r<<5|r>>>27)+l+c+u+i[h]&4294967295;c=a,a=o,o=(s<<30|s>>>2)&4294967295,s=r,r=d}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let r=0;const s=this.buf_;let o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<t;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}}function Qv(n,e){const t=new rk(n,e);return t.subscribe.bind(t)}class rk{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");sk(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=ih),r.error===void 0&&(r.error=ih),r.complete===void 0&&(r.complete=ih);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function sk(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ih(){}const P=function(n,e,t,i){let r;if(i<e?r="at least "+e:i>t&&(r=t===0?"none":"no more than "+t),r){const s=n+" failed: Was called with "+i+(i===1?" argument.":" arguments.")+" Expects "+r+".";throw new Error(s)}};function It(n,e){return`${n} failed: ${e} argument `}function Pe(n,e,t,i){if(!(i&&!t)&&typeof t!="function")throw new Error(It(n,e)+"must be a valid function.")}function _m(n,e,t,i){if(!(i&&!t)&&(typeof t!="object"||t===null))throw new Error(It(n,e)+"must be a valid context object.")}const ok=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);if(r>=55296&&r<=56319){const s=r-55296;i++,E(i<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(i)-56320;r=65536+(s<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Ol=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};const ak=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})};const ck=1e3,lk=2,uk=4*60*60*1e3,hk=.5;function xc(n,e=ck,t=lk){const i=e*Math.pow(t,n),r=Math.round(hk*i*(Math.random()-.5)*2);return Math.min(uk,i+r)}function v(n){return n&&n._delegate?n._delegate:n}class H{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Pi="[DEFAULT]";class Yv{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new Ce;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(fk(e))try{this.getOrInitializeService({instanceIdentifier:Pi})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=Pi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Pi){return this.instances.has(e)}getOptions(e=Pi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,t){var i;const r=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:dk(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Pi){return this.component?this.component.multipleInstances?e:Pi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function dk(n){return n===Pi?void 0:n}function fk(n){return n.instantiationMode==="EAGER"}class Xv{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Yv(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const wf=[];var $;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})($||($={}));const Jv={debug:$.DEBUG,verbose:$.VERBOSE,info:$.INFO,warn:$.WARN,error:$.ERROR,silent:$.SILENT},pk=$.INFO,gk={[$.DEBUG]:"log",[$.VERBOSE]:"log",[$.INFO]:"info",[$.WARN]:"warn",[$.ERROR]:"error"},mk=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),r=gk[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class vn{constructor(e){this.name=e,this._logLevel=pk,this._logHandler=mk,this._userLogHandler=null,wf.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Jv[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$.DEBUG,...e),this._logHandler(this,$.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$.VERBOSE,...e),this._logHandler(this,$.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$.INFO,...e),this._logHandler(this,$.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$.WARN,...e),this._logHandler(this,$.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$.ERROR,...e),this._logHandler(this,$.ERROR,...e)}}function _k(n){wf.forEach(e=>{e.setLogLevel(n)})}function yk(n,e){for(const t of wf){let i=null;e&&e.level&&(i=Jv[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(r,s,...o)=>{const a=o.map(c=>{if(c==null)return null;if(typeof c=="string")return c;if(typeof c=="number"||typeof c=="boolean")return c.toString();if(c instanceof Error)return c.message;try{return JSON.stringify(c)}catch{return null}}).filter(c=>c).join(" ");s>=(i??r.logLevel)&&n({level:$[s].toLowerCase(),message:a,args:o,type:r.name})}}}const vk=(n,e)=>e.some(t=>n instanceof t);let ym,vm;function wk(){return ym||(ym=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ik(){return vm||(vm=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Zv=new WeakMap,ed=new WeakMap,ew=new WeakMap,rh=new WeakMap,If=new WeakMap;function bk(n){const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(An(n.result)),r()},o=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Zv.set(t,n)}).catch(()=>{}),If.set(e,n),e}function Ek(n){if(ed.has(n))return;const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),r()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});ed.set(n,e)}let td={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ed.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ew.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return An(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Tk(n){td=n(td)}function Sk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(sh(this),e,...t);return ew.set(i,e.sort?e.sort():[e]),An(i)}:Ik().includes(n)?function(...e){return n.apply(sh(this),e),An(Zv.get(this))}:function(...e){return An(n.apply(sh(this),e))}}function Ck(n){return typeof n=="function"?Sk(n):(n instanceof IDBTransaction&&Ek(n),vk(n,wk())?new Proxy(n,td):n)}function An(n){if(n instanceof IDBRequest)return bk(n);if(rh.has(n))return rh.get(n);const e=Ck(n);return e!==n&&(rh.set(n,e),If.set(e,n)),e}const sh=n=>If.get(n);function Cs(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(n,e),a=An(o);return i&&o.addEventListener("upgradeneeded",c=>{i(An(o.result),c.oldVersion,c.newVersion,An(o.transaction))}),t&&o.addEventListener("blocked",()=>t()),a.then(c=>{s&&c.addEventListener("close",()=>s()),r&&c.addEventListener("versionchange",()=>r())}).catch(()=>{}),a}function Gr(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",()=>e()),An(t).then(()=>{})}const kk=["get","getKey","getAll","getAllKeys","count"],Ak=["put","add","delete","clear"],oh=new Map;function wm(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(oh.get(e))return oh.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,r=Ak.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||kk.includes(t)))return;const s=async function(o,...a){const c=this.transaction(o,r?"readwrite":"readonly");let l=c.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[t](...a),r&&c.done]))[0]};return oh.set(e,s),s}Tk(n=>({...n,get:(e,t,i)=>wm(e,t)||n.get(e,t,i),has:(e,t)=>!!wm(e,t)||n.has(e,t)}));class Rk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Nk(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function Nk(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const nd="@firebase/app",Im="0.9.0";const nr=new vn("@firebase/app"),Dk="@firebase/app-compat",Pk="@firebase/analytics-compat",xk="@firebase/analytics",Ok="@firebase/app-check-compat",Mk="@firebase/app-check",Lk="@firebase/auth",Fk="@firebase/auth-compat",Uk="@firebase/database",$k="@firebase/database-compat",Vk="@firebase/functions",Bk="@firebase/functions-compat",qk="@firebase/installations",jk="@firebase/installations-compat",Wk="@firebase/messaging",Kk="@firebase/messaging-compat",Gk="@firebase/performance",Hk="@firebase/performance-compat",zk="@firebase/remote-config",Qk="@firebase/remote-config-compat",Yk="@firebase/storage",Xk="@firebase/storage-compat",Jk="@firebase/firestore",Zk="@firebase/firestore-compat",eA="firebase",tA="9.15.0";const oi="[DEFAULT]",nA={[nd]:"fire-core",[Dk]:"fire-core-compat",[xk]:"fire-analytics",[Pk]:"fire-analytics-compat",[Mk]:"fire-app-check",[Ok]:"fire-app-check-compat",[Lk]:"fire-auth",[Fk]:"fire-auth-compat",[Uk]:"fire-rtdb",[$k]:"fire-rtdb-compat",[Vk]:"fire-fn",[Bk]:"fire-fn-compat",[qk]:"fire-iid",[jk]:"fire-iid-compat",[Wk]:"fire-fcm",[Kk]:"fire-fcm-compat",[Gk]:"fire-perf",[Hk]:"fire-perf-compat",[zk]:"fire-rc",[Qk]:"fire-rc-compat",[Yk]:"fire-gcs",[Xk]:"fire-gcs-compat",[Jk]:"fire-fst",[Zk]:"fire-fst-compat","fire-js":"fire-js",[eA]:"fire-js-all"};const ai=new Map,Do=new Map;function Oc(n,e){try{n.container.addComponent(e)}catch(t){nr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function tw(n,e){n.container.addOrOverwriteComponent(e)}function ge(n){const e=n.name;if(Do.has(e))return nr.debug(`There were multiple attempts to register component ${e}.`),!1;Do.set(e,n);for(const t of ai.values())Oc(t,n);return!0}function Tr(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function iA(n,e,t=oi){Tr(n,e).clearInstance(t)}function rA(){Do.clear()}const sA={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Rn=new pt("app","Firebase",sA);let oA=class{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new H("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Rn.create("app-deleted",{appName:this._name})}};const wn=tA;function bf(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:oi,automaticDataCollectionEnabled:!1},e),r=i.name;if(typeof r!="string"||!r)throw Rn.create("bad-app-name",{appName:String(r)});if(t||(t=Q0()),!t)throw Rn.create("no-options");const s=ai.get(r);if(s){if(Zh(t,s.options)&&Zh(i,s.config))return s;throw Rn.create("duplicate-app",{appName:r})}const o=new Xv(r);for(const c of Do.values())o.addComponent(c);const a=new oA(t,i,o);return ai.set(r,a),a}function nw(n=oi){const e=ai.get(n);if(!e&&n===oi)return bf();if(!e)throw Rn.create("no-app",{appName:n});return e}function aA(){return Array.from(ai.values())}async function iw(n){const e=n.name;ai.has(e)&&(ai.delete(e),await Promise.all(n.container.getProviders().map(t=>t.delete())),n.isDeleted=!0)}function Z(n,e,t){var i;let r=(i=nA[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),nr.warn(a.join(" "));return}ge(new H(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}function rw(n,e){if(n!==null&&typeof n!="function")throw Rn.create("invalid-log-argument");yk(n,e)}function sw(n){_k(n)}const cA="firebase-heartbeat-database",lA=1,Po="firebase-heartbeat-store";let ah=null;function ow(){return ah||(ah=Cs(cA,lA,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Po)}}}).catch(n=>{throw Rn.create("idb-open",{originalErrorMessage:n.message})})),ah}async function uA(n){try{return(await ow()).transaction(Po).objectStore(Po).get(aw(n))}catch(e){if(e instanceof he)nr.warn(e.message);else{const t=Rn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});nr.warn(t.message)}}}async function bm(n,e){try{const i=(await ow()).transaction(Po,"readwrite");return await i.objectStore(Po).put(e,aw(n)),i.done}catch(t){if(t instanceof he)nr.warn(t.message);else{const i=Rn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});nr.warn(i.message)}}}function aw(n){return`${n.name}!${n.options.appId}`}const hA=1024,dA=30*24*60*60*1e3;class fA{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new gA(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Em();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(r=>r.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const s=new Date(r.date).valueOf();return Date.now()-s<=dA}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Em(),{heartbeatsToSend:t,unsentEntries:i}=pA(this._heartbeatsCache.heartbeats),r=Rc(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Em(){return new Date().toISOString().substring(0,10)}function pA(n,e=hA){const t=[];let i=n.slice();for(const r of n){const s=t.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),Tm(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Tm(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class gA{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return bt()?ga().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await uA(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return bm(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return bm(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Tm(n){return Rc(JSON.stringify({version:2,heartbeats:n})).length}function mA(n){ge(new H("platform-logger",e=>new Rk(e),"PRIVATE")),ge(new H("heartbeat",e=>new fA(e),"PRIVATE")),Z(nd,Im,n),Z(nd,Im,"esm2017"),Z("fire-js","")}mA("");const _A=Object.freeze(Object.defineProperty({__proto__:null,SDK_VERSION:wn,_DEFAULT_ENTRY_NAME:oi,_addComponent:Oc,_addOrOverwriteComponent:tw,_apps:ai,_clearComponents:rA,_components:Do,_getProvider:Tr,_registerComponent:ge,_removeServiceInstance:iA,deleteApp:iw,getApp:nw,getApps:aA,initializeApp:bf,onLog:rw,registerVersion:Z,setLogLevel:sw,FirebaseError:he},Symbol.toStringTag,{value:"Module"}));var yA="firebase",vA="9.15.0";Z(yA,vA,"app");class wA{constructor(e,t){this._delegate=e,this.firebase=t,Oc(e,new H("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),iw(this._delegate)))}_getService(e,t=oi){var i;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return!r.isInitialized()&&((i=r.getComponent())===null||i===void 0?void 0:i.instantiationMode)==="EXPLICIT"&&r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=oi){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Oc(this._delegate,e)}_addOrOverwriteComponent(e){tw(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const IA={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance."},Sm=new pt("app-compat","Firebase",IA);function bA(n){const e={},t={__esModule:!0,initializeApp:s,app:r,registerVersion:Z,setLogLevel:sw,onLog:rw,apps:null,SDK_VERSION:wn,INTERNAL:{registerComponent:a,removeApp:i,useAsService:c,modularAPIs:_A}};t.default=t,Object.defineProperty(t,"apps",{get:o});function i(l){delete e[l]}function r(l){if(l=l||oi,!Dt(e,l))throw Sm.create("no-app",{appName:l});return e[l]}r.App=n;function s(l,u={}){const h=bf(l,u);if(Dt(e,h.name))return e[h.name];const d=new n(h,t);return e[h.name]=d,d}function o(){return Object.keys(e).map(l=>e[l])}function a(l){const u=l.name,h=u.replace("-compat","");if(ge(l)&&l.type==="PUBLIC"){const d=(f=r())=>{if(typeof f[h]!="function")throw Sm.create("invalid-app-argument",{appName:u});return f[h]()};l.serviceProps!==void 0&&Ro(d,l.serviceProps),t[h]=d,n.prototype[h]=function(...f){return this._getService.bind(this,u).apply(this,l.multipleInstances?f:[])}}return l.type==="PUBLIC"?t[h]:null}function c(l,u){return u==="serverAuth"?null:u}return t}function cw(){const n=bA(wA);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:cw,extendNamespace:e,createSubscribe:Qv,ErrorFactory:pt,deepExtend:Ro});function e(t){Ro(n,t)}return n}const EA=cw();const Cm=new vn("@firebase/app-compat"),TA="@firebase/app-compat",SA="0.2.0";function CA(n){Z(TA,SA,n)}if(W0()&&self.firebase!==void 0){Cm.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const n=self.firebase.SDK_VERSION;n&&n.indexOf("LITE")>=0&&Cm.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Te=EA;CA();const lw="@firebase/installations",Ef="0.6.0";const uw=1e4,hw=`w:${Ef}`,dw="FIS_v2",kA="https://firebaseinstallations.googleapis.com/v1",AA=60*60*1e3,RA="installations",NA="Installations";const DA={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},ir=new pt(RA,NA,DA);function fw(n){return n instanceof he&&n.code.includes("request-failed")}function pw({projectId:n}){return`${kA}/projects/${n}/installations`}function gw(n){return{token:n.token,requestStatus:2,expiresIn:xA(n.expiresIn),creationTime:Date.now()}}async function mw(n,e){const i=(await e.json()).error;return ir.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function _w({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function PA(n,{refreshToken:e}){const t=_w(n);return t.append("Authorization",OA(e)),t}async function yw(n){const e=await n();return e.status>=500&&e.status<600?n():e}function xA(n){return Number(n.replace("s","000"))}function OA(n){return`${dw} ${n}`}async function MA({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const i=pw(n),r=_w(n),s=e.getImmediate({optional:!0});if(s){const l=await s.getHeartbeatsHeader();l&&r.append("x-firebase-client",l)}const o={fid:t,authVersion:dw,appId:n.appId,sdkVersion:hw},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await yw(()=>fetch(i,a));if(c.ok){const l=await c.json();return{fid:l.fid||t,registrationStatus:2,refreshToken:l.refreshToken,authToken:gw(l.authToken)}}else throw await mw("Create Installation",c)}function vw(n){return new Promise(e=>{setTimeout(e,n)})}function LA(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}const FA=/^[cdef][\w-]{21}$/,id="";function UA(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=$A(n);return FA.test(t)?t:id}catch{return id}}function $A(n){return LA(n).substr(0,22)}function Ml(n){return`${n.appName}!${n.appId}`}const ww=new Map;function Iw(n,e){const t=Ml(n);bw(t,e),VA(t,e)}function bw(n,e){const t=ww.get(n);if(t)for(const i of t)i(e)}function VA(n,e){const t=BA();t&&t.postMessage({key:n,fid:e}),qA()}let Bi=null;function BA(){return!Bi&&"BroadcastChannel"in self&&(Bi=new BroadcastChannel("[Firebase] FID Change"),Bi.onmessage=n=>{bw(n.data.key,n.data.fid)}),Bi}function qA(){ww.size===0&&Bi&&(Bi.close(),Bi=null)}const jA="firebase-installations-database",WA=1,rr="firebase-installations-store";let ch=null;function Tf(){return ch||(ch=Cs(jA,WA,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(rr)}}})),ch}async function Mc(n,e){const t=Ml(n),r=(await Tf()).transaction(rr,"readwrite"),s=r.objectStore(rr),o=await s.get(t);return await s.put(e,t),await r.done,(!o||o.fid!==e.fid)&&Iw(n,e.fid),e}async function Ew(n){const e=Ml(n),i=(await Tf()).transaction(rr,"readwrite");await i.objectStore(rr).delete(e),await i.done}async function Ll(n,e){const t=Ml(n),r=(await Tf()).transaction(rr,"readwrite"),s=r.objectStore(rr),o=await s.get(t),a=e(o);return a===void 0?await s.delete(t):await s.put(a,t),await r.done,a&&(!o||o.fid!==a.fid)&&Iw(n,a.fid),a}async function Sf(n){let e;const t=await Ll(n.appConfig,i=>{const r=KA(i),s=GA(n,r);return e=s.registrationPromise,s.installationEntry});return t.fid===id?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function KA(n){const e=n||{fid:UA(),registrationStatus:0};return Tw(e)}function GA(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject(ir.create("app-offline"));return{installationEntry:e,registrationPromise:r}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=HA(n,t);return{installationEntry:t,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:zA(n)}:{installationEntry:e}}async function HA(n,e){try{const t=await MA(n,e);return Mc(n.appConfig,t)}catch(t){throw fw(t)&&t.customData.serverCode===409?await Ew(n.appConfig):await Mc(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function zA(n){let e=await km(n.appConfig);for(;e.registrationStatus===1;)await vw(100),e=await km(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:i}=await Sf(n);return i||t}return e}function km(n){return Ll(n,e=>{if(!e)throw ir.create("installation-not-found");return Tw(e)})}function Tw(n){return QA(n)?{fid:n.fid,registrationStatus:0}:n}function QA(n){return n.registrationStatus===1&&n.registrationTime+uw<Date.now()}async function YA({appConfig:n,heartbeatServiceProvider:e},t){const i=XA(n,t),r=PA(n,t),s=e.getImmediate({optional:!0});if(s){const l=await s.getHeartbeatsHeader();l&&r.append("x-firebase-client",l)}const o={installation:{sdkVersion:hw,appId:n.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await yw(()=>fetch(i,a));if(c.ok){const l=await c.json();return gw(l)}else throw await mw("Generate Auth Token",c)}function XA(n,{fid:e}){return`${pw(n)}/${e}/authTokens:generate`}async function Cf(n,e=!1){let t;const i=await Ll(n.appConfig,s=>{if(!Sw(s))throw ir.create("not-registered");const o=s.authToken;if(!e&&eR(o))return s;if(o.requestStatus===1)return t=JA(n,e),s;{if(!navigator.onLine)throw ir.create("app-offline");const a=nR(s);return t=ZA(n,a),a}});return t?await t:i.authToken}async function JA(n,e){let t=await Am(n.appConfig);for(;t.authToken.requestStatus===1;)await vw(100),t=await Am(n.appConfig);const i=t.authToken;return i.requestStatus===0?Cf(n,e):i}function Am(n){return Ll(n,e=>{if(!Sw(e))throw ir.create("not-registered");const t=e.authToken;return iR(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function ZA(n,e){try{const t=await YA(n,e),i=Object.assign(Object.assign({},e),{authToken:t});return await Mc(n.appConfig,i),t}catch(t){if(fw(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Ew(n.appConfig);else{const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Mc(n.appConfig,i)}throw t}}function Sw(n){return n!==void 0&&n.registrationStatus===2}function eR(n){return n.requestStatus===2&&!tR(n)}function tR(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+AA}function nR(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function iR(n){return n.requestStatus===1&&n.requestTime+uw<Date.now()}async function rR(n){const e=n,{installationEntry:t,registrationPromise:i}=await Sf(e);return i?i.catch(console.error):Cf(e).catch(console.error),t.fid}async function sR(n,e=!1){const t=n;return await oR(t),(await Cf(t,e)).token}async function oR(n){const{registrationPromise:e}=await Sf(n);e&&await e}function aR(n){if(!n||!n.options)throw lh("App Configuration");if(!n.name)throw lh("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw lh(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function lh(n){return ir.create("missing-app-config-values",{valueName:n})}const Cw="installations",cR="installations-internal",lR=n=>{const e=n.getProvider("app").getImmediate(),t=aR(e),i=Tr(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},uR=n=>{const e=n.getProvider("app").getImmediate(),t=Tr(e,Cw).getImmediate();return{getId:()=>rR(t),getToken:r=>sR(t,r)}};function hR(){ge(new H(Cw,lR,"PUBLIC")),ge(new H(cR,uR,"PRIVATE"))}hR();Z(lw,Ef);Z(lw,Ef,"esm2017");const Rm="analytics",dR="firebase_id",fR="origin",pR=60*1e3,gR="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",kw="https://www.googletagmanager.com/gtag/js";const Ge=new vn("@firebase/analytics");function Aw(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function mR(n,e){const t=document.createElement("script");t.src=`${kw}?l=${n}&id=${e}`,t.async=!0,document.head.appendChild(t)}function _R(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function yR(n,e,t,i,r,s){const o=i[r];try{if(o)await e[o];else{const c=(await Aw(t)).find(l=>l.measurementId===r);c&&await e[c.appId]}}catch(a){Ge.error(a)}n("config",r,s)}async function vR(n,e,t,i,r){try{let s=[];if(r&&r.send_to){let o=r.send_to;Array.isArray(o)||(o=[o]);const a=await Aw(t);for(const c of o){const l=a.find(h=>h.measurementId===c),u=l&&e[l.appId];if(u)s.push(u);else{s=[];break}}}s.length===0&&(s=Object.values(e)),await Promise.all(s),n("event",i,r||{})}catch(s){Ge.error(s)}}function wR(n,e,t,i){async function r(s,o,a){try{s==="event"?await vR(n,e,t,o,a):s==="config"?await yR(n,e,t,i,o,a):s==="consent"?n("consent","update",a):n("set",o)}catch(c){Ge.error(c)}}return r}function IR(n,e,t,i,r){let s=function(...o){window[i].push(arguments)};return window[r]&&typeof window[r]=="function"&&(s=window[r]),window[r]=wR(s,n,e,t),{gtagCore:s,wrappedGtag:window[r]}}function bR(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(kw)&&t.src.includes(n))return t;return null}const ER={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},Bt=new pt("analytics","Analytics",ER);const TR=30,SR=1e3;class CR{constructor(e={},t=SR){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Rw=new CR;function kR(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function AR(n){var e;const{appId:t,apiKey:i}=n,r={method:"GET",headers:kR(i)},s=gR.replace("{app-id}",t),o=await fetch(s,r);if(o.status!==200&&o.status!==304){let a="";try{const c=await o.json();!((e=c.error)===null||e===void 0)&&e.message&&(a=c.error.message)}catch{}throw Bt.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function RR(n,e=Rw,t){const{appId:i,apiKey:r,measurementId:s}=n.options;if(!i)throw Bt.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw Bt.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new PR;return setTimeout(async()=>{a.abort()},t!==void 0?t:pR),Nw({appId:i,apiKey:r,measurementId:s},o,a,e)}async function Nw(n,{throttleEndTimeMillis:e,backoffCount:t},i,r=Rw){var s;const{appId:o,measurementId:a}=n;try{await NR(i,e)}catch(c){if(a)return Ge.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:o,measurementId:a};throw c}try{const c=await AR(n);return r.deleteThrottleMetadata(o),c}catch(c){const l=c;if(!DR(l)){if(r.deleteThrottleMetadata(o),a)return Ge.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw c}const u=Number((s=l==null?void 0:l.customData)===null||s===void 0?void 0:s.httpStatus)===503?xc(t,r.intervalMillis,TR):xc(t,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:t+1};return r.setThrottleMetadata(o,h),Ge.debug(`Calling attemptFetch again in ${u} millis`),Nw(n,h,i,r)}}function NR(n,e){return new Promise((t,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(t,r);n.addEventListener(()=>{clearTimeout(s),i(Bt.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function DR(n){if(!(n instanceof he)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class PR{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function xR(n,e,t,i,r){if(r&&r.global){n("event",t,i);return}else{const s=await e,o=Object.assign(Object.assign({},i),{send_to:s});n("event",t,o)}}async function OR(n,e,t,i){if(i&&i.global)return n("set",{screen_name:t}),Promise.resolve();{const r=await e;n("config",r,{update:!0,screen_name:t})}}async function MR(n,e,t,i){if(i&&i.global)return n("set",{user_id:t}),Promise.resolve();{const r=await e;n("config",r,{update:!0,user_id:t})}}async function LR(n,e,t,i){if(i&&i.global){const r={};for(const s of Object.keys(t))r[`user_properties.${s}`]=t[s];return n("set",r),Promise.resolve()}else{const r=await e;n("config",r,{update:!0,user_properties:t})}}async function FR(n,e){const t=await n;window[`ga-disable-${t}`]=!e}async function UR(){if(bt())try{await ga()}catch(n){return Ge.warn(Bt.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Ge.warn(Bt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function $R(n,e,t,i,r,s,o){var a;const c=RR(n);c.then(f=>{t[f.measurementId]=f.appId,n.options.measurementId&&f.measurementId!==n.options.measurementId&&Ge.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>Ge.error(f)),e.push(c);const l=UR().then(f=>{if(f)return i.getId()}),[u,h]=await Promise.all([c,l]);bR(s)||mR(s,u.measurementId),r("js",new Date);const d=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return d[fR]="firebase",d.update=!0,h!=null&&(d[dR]=h),r("config",u.measurementId,d),u.measurementId}let VR=class{constructor(e){this.app=e}_delete(){return delete Nn[this.app.options.appId],Promise.resolve()}},Nn={},Nm=[];const Dm={};let yc="dataLayer",Dw="gtag",Pm,ma,rd=!1;function BR(n){if(rd)throw Bt.create("already-initialized");n.dataLayerName&&(yc=n.dataLayerName),n.gtagName&&(Dw=n.gtagName)}function qR(){const n=[];if(Dl()&&n.push("This is a browser extension environment."),xl()||n.push("Cookies are not available."),n.length>0){const e=n.map((i,r)=>`(${r+1}) ${i}`).join(" "),t=Bt.create("invalid-analytics-context",{errorInfo:e});Ge.warn(t.message)}}function jR(n,e,t){qR();const i=n.options.appId;if(!i)throw Bt.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Ge.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Bt.create("no-api-key");if(Nn[i]!=null)throw Bt.create("already-exists",{id:i});if(!rd){_R(yc);const{wrappedGtag:s,gtagCore:o}=IR(Nn,Nm,Dm,yc,Dw);ma=s,Pm=o,rd=!0}return Nn[i]=$R(n,Nm,Dm,e,Pm,yc,t),new VR(n)}async function WR(){if(Dl()||!xl()||!bt())return!1;try{return await ga()}catch{return!1}}function KR(n,e,t){n=v(n),OR(ma,Nn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function GR(n,e,t){n=v(n),MR(ma,Nn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function HR(n,e,t){n=v(n),LR(ma,Nn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function zR(n,e){n=v(n),FR(Nn[n.app.options.appId],e).catch(t=>Ge.error(t))}function Pw(n,e,t,i){n=v(n),xR(ma,Nn[n.app.options.appId],e,t,i).catch(r=>Ge.error(r))}const xm="@firebase/analytics",Om="0.9.0";function QR(){ge(new H(Rm,(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();return jR(i,r,t)},"PUBLIC")),ge(new H("analytics-internal",n,"PRIVATE")),Z(xm,Om),Z(xm,Om,"esm2017");function n(e){try{const t=e.getProvider(Rm).getImmediate();return{logEvent:(i,r,s)=>Pw(t,i,r,s)}}catch(t){throw Bt.create("interop-component-reg-failed",{reason:t})}}}QR();const YR="@firebase/analytics-compat",XR="0.2.0";class xw{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,i){Pw(this._delegate,e,t,i)}setCurrentScreen(e,t){KR(this._delegate,e,t)}setUserId(e,t){GR(this._delegate,e,t)}setUserProperties(e,t){HR(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){zR(this._delegate,e)}}var sd;(function(n){n.ADD_SHIPPING_INFO="add_shipping_info",n.ADD_PAYMENT_INFO="add_payment_info",n.ADD_TO_CART="add_to_cart",n.ADD_TO_WISHLIST="add_to_wishlist",n.BEGIN_CHECKOUT="begin_checkout",n.CHECKOUT_PROGRESS="checkout_progress",n.EXCEPTION="exception",n.GENERATE_LEAD="generate_lead",n.LOGIN="login",n.PAGE_VIEW="page_view",n.PURCHASE="purchase",n.REFUND="refund",n.REMOVE_FROM_CART="remove_from_cart",n.SCREEN_VIEW="screen_view",n.SEARCH="search",n.SELECT_CONTENT="select_content",n.SELECT_ITEM="select_item",n.SELECT_PROMOTION="select_promotion",n.SET_CHECKOUT_OPTION="set_checkout_option",n.SHARE="share",n.SIGN_UP="sign_up",n.TIMING_COMPLETE="timing_complete",n.VIEW_CART="view_cart",n.VIEW_ITEM="view_item",n.VIEW_ITEM_LIST="view_item_list",n.VIEW_PROMOTION="view_promotion",n.VIEW_SEARCH_RESULTS="view_search_results"})(sd||(sd={}));const JR=n=>{const e=n.getProvider("app-compat").getImmediate(),t=n.getProvider("analytics").getImmediate();return new xw(e,t)};function ZR(){const n={Analytics:xw,settings:BR,isSupported:WR,EventName:sd};Te.INTERNAL.registerComponent(new H("analytics-compat",JR,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}ZR();Te.registerVersion(YR,XR);const od=new Map,Ow={activated:!1,tokenObservers:[]},eN={initialized:!1,enabled:!1};function Qe(n){return od.get(n)||Object.assign({},Ow)}function tN(n,e){return od.set(n,e),od.get(n)}function Fl(){return eN}const kf="https://content-firebaseappcheck.googleapis.com/v1",nN="exchangeRecaptchaV3Token",iN="exchangeRecaptchaEnterpriseToken",rN="exchangeDebugToken",Mm={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},sN=24*60*60*1e3;class oN{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Ce,await aN(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Ce,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}function aN(n){return new Promise(e=>{setTimeout(e,n)})}const cN={["already-initialized"]:"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.",["use-before-activation"]:"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.",["fetch-network-error"]:"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-parse-error"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status-error"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["recaptcha-error"]:"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},lt=new pt("appCheck","AppCheck",cN);function Lc(n=!1){var e;return n?(e=self.grecaptcha)===null||e===void 0?void 0:e.enterprise:self.grecaptcha}function Mw(n){if(!Qe(n).activated)throw lt.create("use-before-activation",{appName:n.name})}function Af(n){const e=Math.round(n/1e3),t=Math.floor(e/(3600*24)),i=Math.floor((e-t*3600*24)/3600),r=Math.floor((e-t*3600*24-i*3600)/60),s=e-t*3600*24-i*3600-r*60;let o="";return t&&(o+=Za(t)+"d:"),i&&(o+=Za(i)+"h:"),o+=Za(r)+"m:"+Za(s)+"s",o}function Za(n){return n===0?"00":n>=10?n.toString():"0"+n}async function Rf({url:n,body:e},t){const i={"Content-Type":"application/json"},r=t.getImmediate({optional:!0});if(r){const h=await r.getHeartbeatsHeader();h&&(i["X-Firebase-Client"]=h)}const s={method:"POST",body:JSON.stringify(e),headers:i};let o;try{o=await fetch(n,s)}catch(h){throw lt.create("fetch-network-error",{originalErrorMessage:h==null?void 0:h.message})}if(o.status!==200)throw lt.create("fetch-status-error",{httpStatus:o.status});let a;try{a=await o.json()}catch(h){throw lt.create("fetch-parse-error",{originalErrorMessage:h==null?void 0:h.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw lt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const l=Number(c[1])*1e3,u=Date.now();return{token:a.token,expireTimeMillis:u+l,issuedAtTimeMillis:u}}function lN(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${kf}/projects/${t}/apps/${i}:${nN}?key=${r}`,body:{recaptcha_v3_token:e}}}function uN(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${kf}/projects/${t}/apps/${i}:${iN}?key=${r}`,body:{recaptcha_enterprise_token:e}}}function hN(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${kf}/projects/${t}/apps/${i}:${rN}?key=${r}`,body:{debug_token:e}}}const dN="firebase-app-check-database",fN=1,xo="firebase-app-check-store",Lw="debug-token";let ec=null;function Fw(){return ec||(ec=new Promise((n,e)=>{try{const t=indexedDB.open(dN,fN);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(lt.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{const r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(xo,{keyPath:"compositeKey"})}}}catch(t){e(lt.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}}),ec)}function pN(n){return $w(Vw(n))}function gN(n,e){return Uw(Vw(n),e)}function mN(n){return Uw(Lw,n)}function _N(){return $w(Lw)}async function Uw(n,e){const i=(await Fw()).transaction(xo,"readwrite"),s=i.objectStore(xo).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var l;a(lt.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})}async function $w(n){const t=(await Fw()).transaction(xo,"readonly"),r=t.objectStore(xo).get(n);return new Promise((s,o)=>{r.onsuccess=a=>{const c=a.target.result;s(c?c.value:void 0)},t.onerror=a=>{var c;o(lt.create("storage-get",{originalErrorMessage:(c=a.target.error)===null||c===void 0?void 0:c.message}))}})}function Vw(n){return`${n.options.appId}-${n.name}`}const Oo=new vn("@firebase/app-check");async function yN(n){if(bt()){let e;try{e=await pN(n)}catch(t){Oo.warn(`Failed to read token from IndexedDB. Error: ${t}`)}return e}}function uh(n,e){return bt()?gN(n,e).catch(t=>{Oo.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}async function vN(){let n;try{n=await _N()}catch{}if(n)return n;{const e=ak();return mN(e).catch(t=>Oo.warn(`Failed to persist debug token to IndexedDB. Error: ${t}`)),e}}function Bw(){return Fl().enabled}async function qw(){const n=Fl();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function wN(){const n=Hv(),e=Fl();if(e.initialized=!0,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&n.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;e.enabled=!0;const t=new Ce;e.token=t,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?t.resolve(n.FIREBASE_APPCHECK_DEBUG_TOKEN):t.resolve(vN())}const IN={error:"UNKNOWN_ERROR"};function bN(n){return Rl.encodeString(JSON.stringify(n),!1)}async function Fc(n,e=!1){const t=n.app;Mw(t);const i=Qe(t);let r=i.token,s;if(r&&!Wr(r)&&(i.token=void 0,r=void 0),!r){const c=await i.cachedTokenPromise;c&&(Wr(c)?r=c:await uh(t,void 0))}if(!e&&r&&Wr(r))return{token:r.token};let o=!1;if(Bw()){i.exchangeTokenPromise||(i.exchangeTokenPromise=Rf(hN(t,await qw()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);const c=await i.exchangeTokenPromise;return await uh(t,c),i.token=c,{token:c.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=await Qe(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Oo.warn(c.message):Oo.error(c),s=c}let a;return r?s?Wr(r)?a={token:r.token,internalError:s}:a=Fm(s):(a={token:r.token},i.token=r,await uh(t,r)):a=Fm(s),o&&jw(t,a),a}function Nf(n,e,t,i){const{app:r}=n,s=Qe(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Wr(s.token)){const a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Lm(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Lm(n))}function Df(n,e){const t=Qe(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function Lm(n){const{app:e}=n,t=Qe(e);let i=t.tokenRefresher;i||(i=EN(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function EN(n){const{app:e}=n;return new oN(async()=>{const t=Qe(e);let i;if(t.token?i=await Fc(n,!0):i=await Fc(n),i.error)throw i.error;if(i.internalError)throw i.internalError},()=>!0,()=>{const t=Qe(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5;const r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},Mm.RETRIAL_MIN_WAIT,Mm.RETRIAL_MAX_WAIT)}function jw(n,e){const t=Qe(n).tokenObservers;for(const i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function Wr(n){return n.expireTimeMillis-Date.now()>0}function Fm(n){return{token:bN(IN),error:n}}let TN=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Qe(this.app);for(const t of e)Df(this.app,t.next);return Promise.resolve()}};function SN(n,e){return new TN(n,e)}function CN(n){return{getToken:e=>Fc(n,e),addTokenListener:e=>Nf(n,"INTERNAL",e),removeTokenListener:e=>Df(n.app,e)}}const kN="@firebase/app-check",AN="0.6.0";const RN="https://www.google.com/recaptcha/api.js",NN="https://www.google.com/recaptcha/enterprise.js";function DN(n,e){const t=new Ce,i=Qe(n);i.reCAPTCHAState={initialized:t};const r=Ww(n),s=Lc(!1);return s?Uc(n,e,s,r,t):ON(()=>{const o=Lc(!1);if(!o)throw new Error("no recaptcha");Uc(n,e,o,r,t)}),t.promise}function PN(n,e){const t=new Ce,i=Qe(n);i.reCAPTCHAState={initialized:t};const r=Ww(n),s=Lc(!0);return s?Uc(n,e,s,r,t):MN(()=>{const o=Lc(!0);if(!o)throw new Error("no recaptcha");Uc(n,e,o,r,t)}),t.promise}function Uc(n,e,t,i,r){t.ready(()=>{xN(n,e,t,i),r.resolve(t)})}function Ww(n){const e=`fire_app_check_${n.name}`,t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function Kw(n){Mw(n);const t=await Qe(n).reCAPTCHAState.initialized.promise;return new Promise((i,r)=>{const s=Qe(n).reCAPTCHAState;t.ready(()=>{i(t.execute(s.widgetId,{action:"fire_app_check"}))})})}function xN(n,e,t,i){const r=t.render(i,{sitekey:e,size:"invisible"}),s=Qe(n);s.reCAPTCHAState=Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:r})}function ON(n){const e=document.createElement("script");e.src=RN,e.onload=n,document.head.appendChild(e)}function MN(n){const e=document.createElement("script");e.src=NN,e.onload=n,document.head.appendChild(e)}class Mo{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t;Hw(this._throttleData);const i=await Kw(this._app).catch(s=>{throw lt.create("recaptcha-error")});let r;try{r=await Rf(lN(this._app,i),this._heartbeatServiceProvider)}catch(s){throw!((e=s.code)===null||e===void 0)&&e.includes("fetch-status-error")?(this._throttleData=Gw(Number((t=s.customData)===null||t===void 0?void 0:t.httpStatus),this._throttleData),lt.create("throttled",{time:Af(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):s}return this._throttleData=null,r}initialize(e){this._app=e,this._heartbeatServiceProvider=Tr(e,"heartbeat"),DN(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Mo?this._siteKey===e._siteKey:!1}}class Ul{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t;Hw(this._throttleData);const i=await Kw(this._app).catch(s=>{throw lt.create("recaptcha-error")});let r;try{r=await Rf(uN(this._app,i),this._heartbeatServiceProvider)}catch(s){throw!((e=s.code)===null||e===void 0)&&e.includes("fetch-status-error")?(this._throttleData=Gw(Number((t=s.customData)===null||t===void 0?void 0:t.httpStatus),this._throttleData),lt.create("throttled",{time:Af(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):s}return this._throttleData=null,r}initialize(e){this._app=e,this._heartbeatServiceProvider=Tr(e,"heartbeat"),PN(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Ul?this._siteKey===e._siteKey:!1}}class Lo{constructor(e){this._customProviderOptions=e}async getToken(){const e=await this._customProviderOptions.getToken(),t=ek(e.token),i=t!==null&&t<Date.now()&&t>0?t*1e3:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:i})}initialize(e){this._app=e}isEqual(e){return e instanceof Lo?this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString():!1}}function Gw(n,e){if(n===404||n===403)return{backoffCount:1,allowRequestsAfter:Date.now()+sN,httpStatus:n};{const t=e?e.backoffCount:0,i=xc(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+i,httpStatus:n}}}function Hw(n){if(n&&Date.now()-n.allowRequestsAfter<=0)throw lt.create("throttled",{time:Af(n.allowRequestsAfter-Date.now()),httpStatus:n.httpStatus})}function LN(n=nw(),e){n=v(n);const t=Tr(n,"app-check");if(Fl().initialized||wN(),Bw()&&qw().then(r=>console.log(`App Check debug token: ${r}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(s.isTokenAutoRefreshEnabled===e.isTokenAutoRefreshEnabled&&s.provider.isEqual(e.provider))return r;throw lt.create("already-initialized",{appName:n.name})}const i=t.initialize({options:e});return FN(n,e.provider,e.isTokenAutoRefreshEnabled),Qe(n).isTokenAutoRefreshEnabled&&Nf(i,"INTERNAL",()=>{}),i}function FN(n,e,t){const i=tN(n,Object.assign({},Ow));i.activated=!0,i.provider=e,i.cachedTokenPromise=yN(n).then(r=>(r&&Wr(r)&&(i.token=r,jw(n,{token:r.token})),r)),i.isTokenAutoRefreshEnabled=t===void 0?n.automaticDataCollectionEnabled:t,i.provider.initialize(n)}function UN(n,e){const t=n.app,i=Qe(t);i.tokenRefresher&&(e===!0?i.tokenRefresher.start():i.tokenRefresher.stop()),i.isTokenAutoRefreshEnabled=e}async function $N(n,e){const t=await Fc(n,e);if(t.error)throw t.error;return{token:t.token}}function VN(n,e,t,i){let r=()=>{},s=()=>{};return e.next!=null?r=e.next.bind(e):r=e,e.error!=null?s=e.error.bind(e):t&&(s=t),Nf(n,"EXTERNAL",r,s),()=>Df(n.app,r)}const BN="app-check",Um="app-check-internal";function qN(){ge(new H(BN,n=>{const e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return SN(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Um).initialize()})),ge(new H(Um,n=>{const e=n.getProvider("app-check").getImmediate();return CN(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Z(kN,AN)}qN();const jN="@firebase/app-check-compat",WN="0.3.0";const KN={["use-before-activation"]:"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."},hh=new pt("appCheck","AppCheck",KN);class GN{constructor(e){this.app=e}activate(e,t){let i;typeof e=="string"?i=new Mo(e):e instanceof Ul||e instanceof Mo||e instanceof Lo?i=e:i=new Lo({getToken:e.getToken}),this._delegate=LN(this.app,{provider:i,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw hh.create("use-before-activation",{appName:this.app.name});UN(this._delegate,e)}getToken(e){if(!this._delegate)throw hh.create("use-before-activation",{appName:this.app.name});return $N(this._delegate,e)}onTokenChanged(e,t,i){if(!this._delegate)throw hh.create("use-before-activation",{appName:this.app.name});return VN(this._delegate,e,t)}}const HN=n=>{const e=n.getProvider("app-compat").getImmediate();return new GN(e)};function zN(){Te.INTERNAL.registerComponent(new H("appCheck-compat",HN,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:Ul,ReCaptchaV3Provider:Mo,CustomProvider:Lo}))}zN();Te.registerVersion(jN,WN);function Pf(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}const Gs={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Mr={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function QN(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["login-blocked"]:"Login blocked by user-provided method: {$originalMessage}",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}function zw(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const YN=QN,XN=zw,Qw=new pt("auth","Firebase",zw());const $m=new vn("@firebase/auth");function vc(n,...e){$m.logLevel<=$.ERROR&&$m.error(`Auth (${wn}): ${n}`,...e)}function Ye(n,...e){throw xf(n,...e)}function He(n,...e){return xf(n,...e)}function Yw(n,e,t){const i=Object.assign(Object.assign({},XN()),{[e]:t});return new pt("auth","Firebase",i).create(e,{appName:n.name})}function ks(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Ye(n,"argument-error"),Yw(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function xf(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Qw.create(n,...e)}function b(n,e,...t){if(!n)throw xf(e,...t)}function rn(n){const e="INTERNAL ASSERTION FAILED: "+n;throw vc(e),new Error(e)}function Qt(n,e){n||rn(e)}const Vm=new Map;function At(n){Qt(n instanceof Function,"Expected a class definition");let e=Vm.get(n);return e?(Qt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Vm.set(n,e),e)}function JN(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(At);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function Fo(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Of(){return Bm()==="http:"||Bm()==="https:"}function Bm(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function ZN(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Of()||Dl()||"connection"in navigator)?navigator.onLine:!0}function eD(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class _a{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qt(t>e,"Short delay should be less than long delay!"),this.isMobile=_f()||Pl()}get(){return ZN()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Mf(n,e){Qt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Xw{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;rn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;rn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;rn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const tD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};const nD=new _a(3e4,6e4);function Re(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Be(n,e,t,i,r={}){return Jw(n,r,async()=>{let s={},o={};i&&(e==="GET"?o=i:s={body:JSON.stringify(i)});const a=Er(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),Xw.fetch()(Zw(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},s))})}async function Jw(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},tD),e);try{const r=new iD(n),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw co(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw co(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw co(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw co(n,"user-disabled",o);const u=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Yw(n,u,l);Ye(n,u)}}catch(r){if(r instanceof he)throw r;Ye(n,"network-request-failed")}}async function Un(n,e,t,i,r={}){const s=await Be(n,e,t,i,r);return"mfaPendingCredential"in s&&Ye(n,"multi-factor-auth-required",{_serverResponse:s}),s}function Zw(n,e,t,i){const r=`${e}${t}?${i}`;return n.config.emulator?Mf(n.config,r):`${n.config.apiScheme}://${r}`}class iD{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(He(this.auth,"network-request-failed")),nD.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function co(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=He(n,e,i);return r.customData._tokenResponse=t,r}async function rD(n,e){return Be(n,"POST","/v1/accounts:delete",e)}async function sD(n,e){return Be(n,"POST","/v1/accounts:update",e)}async function oD(n,e){return Be(n,"POST","/v1/accounts:lookup",e)}function po(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function aD(n,e=!1){const t=v(n),i=await t.getIdToken(e),r=$l(i);b(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:po(dh(r.auth_time)),issuedAtTime:po(dh(r.iat)),expirationTime:po(dh(r.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function dh(n){return Number(n)*1e3}function $l(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return vc("JWT malformed, contained fewer than 3 sections"),null;try{const r=Nc(t);return r?JSON.parse(r):(vc("Failed to decode base64 JWT payload"),null)}catch(r){return vc("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function cD(n){const e=$l(n);return b(e,"internal-error"),b(typeof e.exp<"u","internal-error"),b(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function On(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof he&&lD(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function lD({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class uD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class eI{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=po(this.lastLoginAt),this.creationTime=po(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Uo(n){var e;const t=n.auth,i=await n.getIdToken(),r=await On(n,oD(t,{idToken:i}));b(r==null?void 0:r.users.length,t,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?fD(s.providerUserInfo):[],a=dD(n.providerData,o),c=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(a!=null&&a.length),u=c?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new eI(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function hD(n){const e=v(n);await Uo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function dD(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function fD(n){return n.map(e=>{var{providerId:t}=e,i=Pf(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}async function pD(n,e){const t=await Jw(n,{},async()=>{const i=Er({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=Zw(n,r,"/v1/token",`key=${s}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Xw.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}class $o{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){b(e.idToken,"internal-error"),b(typeof e.idToken<"u","internal-error"),b(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):cD(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return b(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:r,expiresIn:s}=await pD(e,t);this.updateTokensAndExpiration(i,r,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new $o;return i&&(b(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(b(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(b(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $o,this.toJSON())}_performRefresh(){return rn("not implemented")}}function Wn(n,e){b(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class zi{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=Pf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new uD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new eI(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await On(this,this.stsTokenManager.getToken(this.auth,e));return b(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return aD(this,e)}reload(){return hD(this)}_assign(e){this!==e&&(b(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new zi(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){b(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await Uo(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await On(this,rD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,c,l,u;const h=(i=t.displayName)!==null&&i!==void 0?i:void 0,d=(r=t.email)!==null&&r!==void 0?r:void 0,f=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,_=(a=t.tenantId)!==null&&a!==void 0?a:void 0,w=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,N=(l=t.createdAt)!==null&&l!==void 0?l:void 0,M=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:x,emailVerified:U,isAnonymous:X,providerData:z,stsTokenManager:ve}=t;b(x&&ve,e,"internal-error");const St=$o.fromJSON(this.name,ve);b(typeof x=="string",e,"internal-error"),Wn(h,e.name),Wn(d,e.name),b(typeof U=="boolean",e,"internal-error"),b(typeof X=="boolean",e,"internal-error"),Wn(f,e.name),Wn(p,e.name),Wn(_,e.name),Wn(w,e.name),Wn(N,e.name),Wn(M,e.name);const Ni=new zi({uid:x,auth:e,email:d,emailVerified:U,displayName:h,isAnonymous:X,photoURL:p,phoneNumber:f,tenantId:_,stsTokenManager:St,createdAt:N,lastLoginAt:M});return z&&Array.isArray(z)&&(Ni.providerData=z.map(V0=>Object.assign({},V0))),w&&(Ni._redirectEventId=w),Ni}static async _fromIdTokenResponse(e,t,i=!1){const r=new $o;r.updateFromServerResponse(t);const s=new zi({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await Uo(s),s}}class tI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}tI.type="NONE";const is=tI;function Qi(n,e,t){return`firebase:${n}:${e}:${t}`}class Hr{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=Qi(this.userKey,r.apiKey,s),this.fullPersistenceKey=Qi("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?zi._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new Hr(At(is),e,i);const r=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let s=r[0]||At(is);const o=Qi(i,e.config.apiKey,e.name);let a=null;for(const l of t)try{const u=await l._get(o);if(u){const h=zi._fromJSON(e,u);l!==s&&(a=h),s=l;break}}catch{}const c=r.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new Hr(s,e,i):(s=c[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async l=>{if(l!==s)try{await l._remove(o)}catch{}})),new Hr(s,e,i))}}function qm(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(rI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(nI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sI(e))return"Blackberry";if(oI(e))return"Webos";if(Lf(e))return"Safari";if((e.includes("chrome/")||iI(e))&&!e.includes("edge/"))return"Chrome";if(ya(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function nI(n=de()){return/firefox\//i.test(n)}function Lf(n=de()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function iI(n=de()){return/crios\//i.test(n)}function rI(n=de()){return/iemobile/i.test(n)}function ya(n=de()){return/android/i.test(n)}function sI(n=de()){return/blackberry/i.test(n)}function oI(n=de()){return/webos/i.test(n)}function As(n=de()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function gD(n=de()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function mD(n=de()){var e;return As(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function _D(){return Kv()&&document.documentMode===10}function aI(n=de()){return As(n)||ya(n)||oI(n)||sI(n)||/windows phone/i.test(n)||rI(n)}function yD(){try{return!!(window&&window!==window.top)}catch{return!1}}function cI(n,e=[]){let t;switch(n){case"Browser":t=qm(de());break;case"Worker":t=`${qm(de())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${wn}/${i}`}class vD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((o,a)=>{try{const c=e(s);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}class wD{constructor(e,t,i){this.app=e,this.heartbeatServiceProvider=t,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jm(this),this.idTokenSubscription=new jm(this),this.beforeStateQueue=new vD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Qw,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=At(t)),this._initializationPromise=this.queue(async()=>{var i,r;if(!this._deleted&&(this.persistenceManager=await Hr.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const i=await this.assertedPersistence.getCurrentUser();let r=i,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return b(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Uo(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=eD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?v(e):null;return t&&b(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&b(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(At(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new pt("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&At(e)||this._popupRedirectResolver;b(t,this,"argument-error"),this.redirectPersistenceManager=await Hr.create(this,[At(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return b(o,this,"internal-error"),o.then(()=>s(this.currentUser)),typeof t=="function"?e.addObserver(t,i,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return b(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=cI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());return i&&(t["X-Firebase-Client"]=i),t}}function Ue(n){return v(n)}class jm{constructor(e){this.auth=e,this.observer=null,this.addObserver=Qv(t=>this.observer=t)}get next(){return b(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ID(n,e,t){const i=Ue(n);b(i._canInitEmulator,i,"emulator-config-failed"),b(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!!(t!=null&&t.disableWarnings),s=lI(e),{host:o,port:a}=bD(e),c=a===null?"":`:${a}`;i.config.emulator={url:`${s}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||ED()}function lI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function bD(n){const e=lI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:Wm(i.substr(s.length+1))}}else{const[s,o]=i.split(":");return{host:s,port:Wm(o)}}}function Wm(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function ED(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Rs{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rn("not implemented")}_getIdTokenResponse(e){return rn("not implemented")}_linkToIdToken(e,t){return rn("not implemented")}_getReauthenticationResolver(e){return rn("not implemented")}}async function uI(n,e){return Be(n,"POST","/v1/accounts:resetPassword",Re(n,e))}async function hI(n,e){return Be(n,"POST","/v1/accounts:update",e)}async function TD(n,e){return Be(n,"POST","/v1/accounts:update",Re(n,e))}async function SD(n,e){return Un(n,"POST","/v1/accounts:signInWithPassword",Re(n,e))}async function Vl(n,e){return Be(n,"POST","/v1/accounts:sendOobCode",Re(n,e))}async function CD(n,e){return Vl(n,e)}async function kD(n,e){return Vl(n,e)}async function AD(n,e){return Vl(n,e)}async function RD(n,e){return Vl(n,e)}async function ND(n,e){return Un(n,"POST","/v1/accounts:signInWithEmailLink",Re(n,e))}async function DD(n,e){return Un(n,"POST","/v1/accounts:signInWithEmailLink",Re(n,e))}class Vo extends Rs{constructor(e,t,i,r=null){super("password",i),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Vo(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new Vo(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return SD(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return ND(e,{email:this._email,oobCode:this._password});default:Ye(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return hI(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return DD(e,{idToken:t,email:this._email,oobCode:this._password});default:Ye(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Dn(n,e){return Un(n,"POST","/v1/accounts:signInWithIdp",Re(n,e))}const PD="http://localhost";class fn extends Rs{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new fn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ye("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r}=t,s=Pf(t,["providerId","signInMethod"]);if(!i||!r)return null;const o=new fn(i,r);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Dn(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Dn(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Dn(e,t)}buildRequest(){const e={requestUri:PD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Er(t)}return e}}async function xD(n,e){return Be(n,"POST","/v1/accounts:sendVerificationCode",Re(n,e))}async function OD(n,e){return Un(n,"POST","/v1/accounts:signInWithPhoneNumber",Re(n,e))}async function MD(n,e){const t=await Un(n,"POST","/v1/accounts:signInWithPhoneNumber",Re(n,e));if(t.temporaryProof)throw co(n,"account-exists-with-different-credential",t);return t}const LD={USER_NOT_FOUND:"user-not-found"};async function FD(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Un(n,"POST","/v1/accounts:signInWithPhoneNumber",Re(n,t),LD)}class Yi extends Rs{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Yi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Yi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return OD(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return MD(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return FD(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:i,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:i,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:i,phoneNumber:r,temporaryProof:s}=e;return!i&&!t&&!r&&!s?null:new Yi({verificationId:t,verificationCode:i,phoneNumber:r,temporaryProof:s})}}function UD(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $D(n){const e=jr(ao(n)).link,t=e?jr(ao(e)).deep_link_id:null,i=jr(ao(n)).deep_link_id;return(i?jr(ao(i)).link:null)||i||t||e||n}class Bl{constructor(e){var t,i,r,s,o,a;const c=jr(ao(e)),l=(t=c.apiKey)!==null&&t!==void 0?t:null,u=(i=c.oobCode)!==null&&i!==void 0?i:null,h=UD((r=c.mode)!==null&&r!==void 0?r:null);b(l&&u&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=u,this.continueUrl=(s=c.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=$D(e);try{return new Bl(t)}catch{return null}}}class Ii{constructor(){this.providerId=Ii.PROVIDER_ID}static credential(e,t){return Vo._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=Bl.parseLink(t);return b(i,"argument-error"),Vo._fromEmailAndCode(e,i.code,i.tenantId)}}Ii.PROVIDER_ID="password";Ii.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ii.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class $n{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ns extends $n{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class zr extends Ns{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return b("providerId"in t&&"signInMethod"in t,"argument-error"),fn._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return b(e.idToken||e.accessToken,"argument-error"),fn._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return zr.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return zr.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i,oauthTokenSecret:r,pendingToken:s,nonce:o,providerId:a}=e;if(!i&&!r&&!t&&!s||!a)return null;try{return new zr(a)._credential({idToken:t,accessToken:i,nonce:o,pendingToken:s})}catch{return null}}}class Xt extends Ns{constructor(){super("facebook.com")}static credential(e){return fn._fromParams({providerId:Xt.PROVIDER_ID,signInMethod:Xt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xt.credentialFromTaggedObject(e)}static credentialFromError(e){return Xt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xt.credential(e.oauthAccessToken)}catch{return null}}}Xt.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xt.PROVIDER_ID="facebook.com";class Jt extends Ns{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return fn._fromParams({providerId:Jt.PROVIDER_ID,signInMethod:Jt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Jt.credentialFromTaggedObject(e)}static credentialFromError(e){return Jt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Jt.credential(t,i)}catch{return null}}}Jt.GOOGLE_SIGN_IN_METHOD="google.com";Jt.PROVIDER_ID="google.com";class Zt extends Ns{constructor(){super("github.com")}static credential(e){return fn._fromParams({providerId:Zt.PROVIDER_ID,signInMethod:Zt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zt.credentialFromTaggedObject(e)}static credentialFromError(e){return Zt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zt.credential(e.oauthAccessToken)}catch{return null}}}Zt.GITHUB_SIGN_IN_METHOD="github.com";Zt.PROVIDER_ID="github.com";const VD="http://localhost";class rs extends Rs{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Dn(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Dn(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Dn(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r,pendingToken:s}=t;return!i||!r||!s||i!==r?null:new rs(i,s)}static _create(e,t){return new rs(e,t)}buildRequest(){return{requestUri:VD,returnSecureToken:!0,pendingToken:this.pendingToken}}}const BD="saml.";class $c extends $n{constructor(e){b(e.startsWith(BD),"argument-error"),super(e)}static credentialFromResult(e){return $c.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return $c.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=rs.fromJSON(e);return b(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:i}=e;if(!t||!i)return null;try{return rs._create(i,t)}catch{return null}}}class en extends Ns{constructor(){super("twitter.com")}static credential(e,t){return fn._fromParams({providerId:en.PROVIDER_ID,signInMethod:en.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return en.credentialFromTaggedObject(e)}static credentialFromError(e){return en.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return en.credential(t,i)}catch{return null}}}en.TWITTER_SIGN_IN_METHOD="twitter.com";en.PROVIDER_ID="twitter.com";async function dI(n,e){return Un(n,"POST","/v1/accounts:signUp",Re(n,e))}class qt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,r=!1){const s=await zi._fromIdTokenResponse(e,i,r),o=Km(i);return new qt({user:s,providerId:o,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const r=Km(i);return new qt({user:e,providerId:r,_tokenResponse:i,operationType:t})}}function Km(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}async function qD(n){var e;const t=Ue(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new qt({user:t.currentUser,providerId:null,operationType:"signIn"});const i=await dI(t,{returnSecureToken:!0}),r=await qt._fromIdTokenResponse(t,"signIn",i,!0);return await t._updateCurrentUser(r.user),r}class Vc extends he{constructor(e,t,i,r){var s;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,Vc.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new Vc(e,t,i,r)}}function fI(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Vc._fromErrorAndOperation(n,s,e,i):s})}function pI(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}async function jD(n,e){const t=v(n);await ql(!0,t,e);const{providerUserInfo:i}=await sD(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),r=pI(i||[]);return t.providerData=t.providerData.filter(s=>r.has(s.providerId)),r.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Ff(n,e,t=!1){const i=await On(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return qt._forOperation(n,"link",i)}async function ql(n,e,t){await Uo(e);const i=pI(e.providerData),r=n===!1?"provider-already-linked":"no-such-provider";b(i.has(t)===n,e.auth,r)}async function gI(n,e,t=!1){const{auth:i}=n,r="reauthenticate";try{const s=await On(n,fI(i,r,e,n),t);b(s.idToken,i,"internal-error");const o=$l(s.idToken);b(o,i,"internal-error");const{sub:a}=o;return b(n.uid===a,i,"user-mismatch"),qt._forOperation(n,r,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Ye(i,"user-mismatch"),s}}async function mI(n,e,t=!1){const i="signIn",r=await fI(n,i,e),s=await qt._fromIdTokenResponse(n,i,r);return t||await n._updateCurrentUser(s.user),s}async function jl(n,e){return mI(Ue(n),e)}async function _I(n,e){const t=v(n);return await ql(!1,t,e.providerId),Ff(t,e)}async function yI(n,e){return gI(v(n),e)}async function WD(n,e){return Un(n,"POST","/v1/accounts:signInWithCustomToken",Re(n,e))}async function KD(n,e){const t=Ue(n),i=await WD(t,{token:e,returnSecureToken:!0}),r=await qt._fromIdTokenResponse(t,"signIn",i);return await t._updateCurrentUser(r.user),r}class Wl{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Uf._fromServerResponse(e,t):Ye(e,"internal-error")}}class Uf extends Wl{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Uf(t)}}function Kl(n,e,t){var i;b(((i=t.url)===null||i===void 0?void 0:i.length)>0,n,"invalid-continue-uri"),b(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(b(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(b(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}async function GD(n,e,t){const i=v(n),r={requestType:"PASSWORD_RESET",email:e};t&&Kl(i,r,t),await kD(i,r)}async function HD(n,e,t){await uI(v(n),{oobCode:e,newPassword:t})}async function zD(n,e){await TD(v(n),{oobCode:e})}async function vI(n,e){const t=v(n),i=await uI(t,{oobCode:e}),r=i.requestType;switch(b(r,t,"internal-error"),r){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":b(i.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":b(i.mfaInfo,t,"internal-error");default:b(i.email,t,"internal-error")}let s=null;return i.mfaInfo&&(s=Wl._fromServerResponse(Ue(t),i.mfaInfo)),{data:{email:(i.requestType==="VERIFY_AND_CHANGE_EMAIL"?i.newEmail:i.email)||null,previousEmail:(i.requestType==="VERIFY_AND_CHANGE_EMAIL"?i.email:i.newEmail)||null,multiFactorInfo:s},operation:r}}async function QD(n,e){const{data:t}=await vI(v(n),e);return t.email}async function YD(n,e,t){const i=Ue(n),r=await dI(i,{returnSecureToken:!0,email:e,password:t}),s=await qt._fromIdTokenResponse(i,"signIn",r);return await i._updateCurrentUser(s.user),s}function XD(n,e,t){return jl(v(n),Ii.credential(e,t))}async function JD(n,e,t){const i=v(n),r={requestType:"EMAIL_SIGNIN",email:e};b(t.handleCodeInApp,i,"argument-error"),t&&Kl(i,r,t),await AD(i,r)}function ZD(n,e){const t=Bl.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function eP(n,e,t){const i=v(n),r=Ii.credentialWithLink(e,t||Fo());return b(r._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),jl(i,r)}async function tP(n,e){return Be(n,"POST","/v1/accounts:createAuthUri",Re(n,e))}async function nP(n,e){const t=Of()?Fo():"http://localhost",i={identifier:e,continueUri:t},{signinMethods:r}=await tP(v(n),i);return r||[]}async function iP(n,e){const t=v(n),r={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Kl(t.auth,r,e);const{email:s}=await CD(t.auth,r);s!==n.email&&await n.reload()}async function rP(n,e,t){const i=v(n),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Kl(i.auth,s,t);const{email:o}=await RD(i.auth,s);o!==n.email&&await n.reload()}async function sP(n,e){return Be(n,"POST","/v1/accounts:update",e)}async function oP(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const i=v(n),s={idToken:await i.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await On(i,sP(i.auth,s));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}function aP(n,e){return wI(v(n),e,null)}function cP(n,e){return wI(v(n),null,e)}async function wI(n,e,t){const{auth:i}=n,s={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);const o=await On(n,hI(i,s));await n._updateTokensIfNecessary(o,!0)}function lP(n){var e,t;if(!n)return null;const{providerId:i}=n,r=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!i&&(n!=null&&n.idToken)){const o=(t=(e=$l(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Qr(s,a)}}if(!i)return null;switch(i){case"facebook.com":return new uP(s,r);case"github.com":return new hP(s,r);case"google.com":return new dP(s,r);case"twitter.com":return new fP(s,r,n.screenName||null);case"custom":case"anonymous":return new Qr(s,null);default:return new Qr(s,i,r)}}class Qr{constructor(e,t,i={}){this.isNewUser=e,this.providerId=t,this.profile=i}}class II extends Qr{constructor(e,t,i,r){super(e,t,i),this.username=r}}class uP extends Qr{constructor(e,t){super(e,"facebook.com",t)}}class hP extends II{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class dP extends Qr{constructor(e,t){super(e,"google.com",t)}}class fP extends II{constructor(e,t,i){super(e,"twitter.com",t,i)}}function pP(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:lP(t)}class qi{constructor(e,t,i){this.type=e,this.credential=t,this.auth=i}static _fromIdtoken(e,t){return new qi("enroll",e,t)}static _fromMfaPendingCredential(e){return new qi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,i;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return qi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((i=e.multiFactorSession)===null||i===void 0)&&i.idToken)return qi._fromIdtoken(e.multiFactorSession.idToken)}return null}}class $f{constructor(e,t,i){this.session=e,this.hints=t,this.signInResolver=i}static _fromError(e,t){const i=Ue(e),r=t.customData._serverResponse,s=(r.mfaInfo||[]).map(a=>Wl._fromServerResponse(i,a));b(r.mfaPendingCredential,i,"internal-error");const o=qi._fromMfaPendingCredential(r.mfaPendingCredential);return new $f(o,s,async a=>{const c=await a._process(i,o);delete r.mfaInfo,delete r.mfaPendingCredential;const l=Object.assign(Object.assign({},r),{idToken:c.idToken,refreshToken:c.refreshToken});switch(t.operationType){case"signIn":const u=await qt._fromIdTokenResponse(i,t.operationType,l);return await i._updateCurrentUser(u.user),u;case"reauthenticate":return b(t.user,i,"internal-error"),qt._forOperation(t.user,t.operationType,l);default:Ye(i,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function gP(n,e){var t;const i=v(n),r=e;return b(e.customData.operationType,i,"argument-error"),b((t=r.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,i,"argument-error"),$f._fromError(i,r)}function mP(n,e){return Be(n,"POST","/v2/accounts/mfaEnrollment:start",Re(n,e))}function _P(n,e){return Be(n,"POST","/v2/accounts/mfaEnrollment:finalize",Re(n,e))}function yP(n,e){return Be(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Re(n,e))}class Vf{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(i=>Wl._fromServerResponse(e.auth,i)))})}static _fromUser(e){return new Vf(e)}async getSession(){return qi._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const i=e,r=await this.getSession(),s=await On(this.user,i._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(s),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,i=await this.user.getIdToken(),r=await On(this.user,yP(this.user.auth,{idToken:i,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:s})=>s!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(s){if((s==null?void 0:s.code)!=="auth/user-token-expired")throw s}}}const fh=new WeakMap;function vP(n){const e=v(n);return fh.has(e)||fh.set(e,Vf._fromUser(e)),fh.get(e)}const Bc="__sak";class bI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Bc,"1"),this.storage.removeItem(Bc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}function wP(){const n=de();return Lf(n)||As(n)}const IP=1e3,bP=10;class EI extends bI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=wP()&&yD(),this.fallbackToPolling=aI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),r=this.localCache[t];i!==r&&e(t,r,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(i);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}const r=()=>{const o=this.storage.getItem(i);!t&&this.localCache[i]===o||this.notifyListeners(i,o)},s=this.storage.getItem(i);_D()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,bP):r()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},IP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}EI.type="LOCAL";const Bf=EI;class TI extends bI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}TI.type="SESSION";const sr=TI;function EP(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Gl{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const i=new Gl(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:r,data:s}=t.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const a=Array.from(o).map(async l=>l(t.origin,s)),c=await EP(a);t.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Gl.receivers=[];function va(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}class TP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const l=va("",20);r.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(h){const d=h;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(d.data.response);break;default:clearTimeout(u),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function Se(){return window}function SP(n){Se().location.href=n}function qf(){return typeof Se().WorkerGlobalScope<"u"&&typeof Se().importScripts=="function"}async function CP(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function kP(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function AP(){return qf()?self:null}const SI="firebaseLocalStorageDb",RP=1,qc="firebaseLocalStorage",CI="fbase_key";class wa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Hl(n,e){return n.transaction([qc],e?"readwrite":"readonly").objectStore(qc)}function NP(){const n=indexedDB.deleteDatabase(SI);return new wa(n).toPromise()}function ad(){const n=indexedDB.open(SI,RP);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(qc,{keyPath:CI})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(qc)?e(i):(i.close(),await NP(),e(await ad()))})})}async function Gm(n,e,t){const i=Hl(n,!0).put({[CI]:e,value:t});return new wa(i).toPromise()}async function DP(n,e){const t=Hl(n,!1).get(e),i=await new wa(t).toPromise();return i===void 0?null:i.value}function Hm(n,e){const t=Hl(n,!0).delete(e);return new wa(t).toPromise()}const PP=800,xP=3;class kI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ad(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>xP)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qf()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Gl._getInstance(AP()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await CP(),!this.activeServiceWorker)return;this.sender=new TP(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||kP()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ad();return await Gm(e,Bc,"1"),await Hm(e,Bc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>Gm(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>DP(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Hm(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=Hl(r,!1).getAll();return new wa(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;for(const{fbase_key:r,value:s}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),PP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}kI.type="LOCAL";const Bo=kI;function OP(n,e){return Be(n,"POST","/v2/accounts/mfaSignIn:start",Re(n,e))}function MP(n,e){return Be(n,"POST","/v2/accounts/mfaSignIn:finalize",Re(n,e))}async function LP(n){return(await Be(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}function FP(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function AI(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=He("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",FP().appendChild(i)})}function RI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const UP=500,$P=6e4,tc=1e12;class VP{constructor(e){this.auth=e,this.counter=tc,this._widgets=new Map}render(e,t){const i=this.counter;return this._widgets.set(i,new BP(e,this.auth.name,t||{})),this.counter++,i}reset(e){var t;const i=e||tc;(t=this._widgets.get(i))===null||t===void 0||t.delete(),this._widgets.delete(i)}getResponse(e){var t;const i=e||tc;return((t=this._widgets.get(i))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const i=e||tc;return(t=this._widgets.get(i))===null||t===void 0||t.execute(),""}}class BP{constructor(e,t,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r=typeof e=="string"?document.getElementById(e):e;b(r,"argument-error",{appName:t}),this.container=r,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=qP(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},$P)},UP))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function qP(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<n;i++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const ph=RI("rcb"),jP=new _a(3e4,6e4),WP="https://www.google.com/recaptcha/api.js?";class KP{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Se().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return b(GP(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(Se().grecaptcha):new Promise((i,r)=>{const s=Se().setTimeout(()=>{r(He(e,"network-request-failed"))},jP.get());Se()[ph]=()=>{Se().clearTimeout(s),delete Se()[ph];const a=Se().grecaptcha;if(!a){r(He(e,"internal-error"));return}const c=a.render;a.render=(l,u)=>{const h=c(l,u);return this.counter++,h},this.hostLanguage=t,i(a)};const o=`${WP}?${Er({onload:ph,render:"explicit",hl:t})}`;AI(o).catch(()=>{clearTimeout(s),r(He(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Se().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function GP(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class HP{async load(e){return new VP(e)}clearedOneInstance(){}}const NI="recaptcha",zP={theme:"light",type:"image"};let QP=class{constructor(e,t=Object.assign({},zP),i){this.parameters=t,this.type=NI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ue(i),this.isInvisible=this.parameters.size==="invisible",b(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const r=typeof e=="string"?document.getElementById(e):e;b(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new HP:new KP,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),i=t.getResponse(e);return i||new Promise(r=>{const s=o=>{o&&(this.tokenChangeListeners.delete(s),r(o))};this.tokenChangeListeners.add(s),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){b(!this.parameters.sitekey,this.auth,"argument-error"),b(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),b(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(i=>i(t)),typeof e=="function")e(t);else if(typeof e=="string"){const i=Se()[e];typeof i=="function"&&i(t)}}}assertNotDestroyed(){b(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){b(Of()&&!qf(),this.auth,"internal-error"),await YP(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await LP(this.auth);b(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return b(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function YP(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}class jf{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Yi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function XP(n,e,t){const i=Ue(n),r=await zl(i,e,v(t));return new jf(r,s=>jl(i,s))}async function JP(n,e,t){const i=v(n);await ql(!1,i,"phone");const r=await zl(i.auth,e,v(t));return new jf(r,s=>_I(i,s))}async function ZP(n,e,t){const i=v(n),r=await zl(i.auth,e,v(t));return new jf(r,s=>yI(i,s))}async function zl(n,e,t){var i;const r=await t.verify();try{b(typeof r=="string",n,"argument-error"),b(t.type===NI,n,"argument-error");let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const o=s.session;if("phoneNumber"in s)return b(o.type==="enroll",n,"internal-error"),(await mP(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}})).phoneSessionInfo.sessionInfo;{b(o.type==="signin",n,"internal-error");const a=((i=s.multiFactorHint)===null||i===void 0?void 0:i.uid)||s.multiFactorUid;return b(a,n,"missing-multi-factor-info"),(await OP(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:r}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await xD(n,{phoneNumber:s.phoneNumber,recaptchaToken:r});return o}}finally{t._reset()}}async function ex(n,e){await Ff(v(n),e)}let an=class{constructor(e){this.providerId=an.PROVIDER_ID,this.auth=Ue(e)}verifyPhoneNumber(e,t){return zl(this.auth,e,v(t))}static credential(e,t){return Yi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return an.credentialFromTaggedObject(t)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:i}=e;return t&&i?Yi._fromTokenResponse(t,i):null}};an.PROVIDER_ID="phone";an.PHONE_SIGN_IN_METHOD="phone";function Sr(n,e){return e?At(e):(b(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Wf extends Rs{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Dn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Dn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Dn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function tx(n){return mI(n.auth,new Wf(n),n.bypassAuthState)}function nx(n){const{auth:e,user:t}=n;return b(t,e,"internal-error"),gI(t,new Wf(n),n.bypassAuthState)}async function ix(n){const{auth:e,user:t}=n;return b(t,e,"internal-error"),Ff(t,new Wf(n),n.bypassAuthState)}class DI{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tx;case"linkViaPopup":case"linkViaRedirect":return ix;case"reauthViaPopup":case"reauthViaRedirect":return nx;default:Ye(this.auth,"internal-error")}}resolve(e){Qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const rx=new _a(2e3,1e4);async function sx(n,e,t){const i=Ue(n);ks(n,e,$n);const r=Sr(i,t);return new Tn(i,"signInViaPopup",e,r).executeNotNull()}async function ox(n,e,t){const i=v(n);ks(i.auth,e,$n);const r=Sr(i.auth,t);return new Tn(i.auth,"reauthViaPopup",e,r,i).executeNotNull()}async function ax(n,e,t){const i=v(n);ks(i.auth,e,$n);const r=Sr(i.auth,t);return new Tn(i.auth,"linkViaPopup",e,r,i).executeNotNull()}class Tn extends DI{constructor(e,t,i,r,s){super(e,t,r,s),this.provider=i,this.authWindow=null,this.pollId=null,Tn.currentPopupAction&&Tn.currentPopupAction.cancel(),Tn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return b(e,this.auth,"internal-error"),e}async onExecution(){Qt(this.filter.length===1,"Popup operations only handle one event");const e=va();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(He(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(He(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Tn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(He(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,rx.get())};e()}}Tn.currentPopupAction=null;const cx="pendingRedirect",go=new Map;class lx extends DI{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=go.get(this.auth._key());if(!e){try{const i=await ux(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}go.set(this.auth._key(),e)}return this.bypassAuthState||go.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ux(n,e){const t=xI(e),i=PI(n);if(!await i._isAvailable())return!1;const r=await i._get(t)==="true";return await i._remove(t),r}async function Kf(n,e){return PI(n)._set(xI(e),"true")}function hx(){go.clear()}function Gf(n,e){go.set(n._key(),e)}function PI(n){return At(n._redirectPersistence)}function xI(n){return Qi(cx,n.config.apiKey,n.name)}function dx(n,e,t){return fx(n,e,t)}async function fx(n,e,t){const i=Ue(n);ks(n,e,$n);const r=Sr(i,t);return await Kf(r,i),r._openRedirect(i,e,"signInViaRedirect")}function px(n,e,t){return gx(n,e,t)}async function gx(n,e,t){const i=v(n);ks(i.auth,e,$n);const r=Sr(i.auth,t);await Kf(r,i.auth);const s=await OI(i);return r._openRedirect(i.auth,e,"reauthViaRedirect",s)}function mx(n,e,t){return _x(n,e,t)}async function _x(n,e,t){const i=v(n);ks(i.auth,e,$n);const r=Sr(i.auth,t);await ql(!1,i,e.providerId),await Kf(r,i.auth);const s=await OI(i);return r._openRedirect(i.auth,e,"linkViaRedirect",s)}async function yx(n,e){return await Ue(n)._initializationPromise,Ql(n,e,!1)}async function Ql(n,e,t=!1){const i=Ue(n),r=Sr(i,e),o=await new lx(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}async function OI(n){const e=va(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}const vx=10*60*1e3;class MI{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!wx(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!LI(e)){const r=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(He(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=vx&&this.cachedEventUids.clear(),this.cachedEventUids.has(zm(e))}saveEventToCache(e){this.cachedEventUids.add(zm(e)),this.lastProcessedEventTime=Date.now()}}function zm(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function LI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function wx(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return LI(n);default:return!1}}async function FI(n,e={}){return Be(n,"GET","/v1/projects",e)}const Ix=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,bx=/^https?/;async function Ex(n){if(n.config.emulator)return;const{authorizedDomains:e}=await FI(n);for(const t of e)try{if(Tx(t))return}catch{}Ye(n,"unauthorized-domain")}function Tx(n){const e=Fo(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!bx.test(t))return!1;if(Ix.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const Sx=new _a(3e4,6e4);function Qm(){const n=Se().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Cx(n){return new Promise((e,t)=>{var i,r,s;function o(){Qm(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Qm(),t(He(n,"network-request-failed"))},timeout:Sx.get()})}if(!((r=(i=Se().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((s=Se().gapi)===null||s===void 0)&&s.load)o();else{const a=RI("iframefcb");return Se()[a]=()=>{gapi.load?o():t(He(n,"network-request-failed"))},AI(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw wc=null,e})}let wc=null;function kx(n){return wc=wc||Cx(n),wc}const Ax=new _a(5e3,15e3),Rx="__/auth/iframe",Nx="emulator/auth/iframe",Dx={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Px=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xx(n){const e=n.config;b(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Mf(e,Nx):`https://${n.config.authDomain}/${Rx}`,i={apiKey:e.apiKey,appName:n.name,v:wn},r=Px.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${Er(i).slice(1)}`}async function Ox(n){const e=await kx(n),t=Se().gapi;return b(t,n,"internal-error"),e.open({where:document.body,url:xx(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Dx,dontclear:!0},i=>new Promise(async(r,s)=>{await i.restyle({setHideOnLeave:!1});const o=He(n,"network-request-failed"),a=Se().setTimeout(()=>{s(o)},Ax.get());function c(){Se().clearTimeout(a),r(i)}i.ping(c).then(c,()=>{s(o)})}))}const Mx={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Lx=500,Fx=600,Ux="_blank",$x="http://localhost";class Ym{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Vx(n,e,t,i=Lx,r=Fx){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Mx),{width:i.toString(),height:r.toString(),top:s,left:o}),l=de().toLowerCase();t&&(a=iI(l)?Ux:t),nI(l)&&(e=e||$x,c.scrollbars="yes");const u=Object.entries(c).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(mD(l)&&a!=="_self")return Bx(e||"",a),new Ym(null);const h=window.open(e||"",a,u);b(h,n,"popup-blocked");try{h.focus()}catch{}return new Ym(h)}function Bx(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}const qx="__/auth/handler",jx="emulator/auth/handler";function cd(n,e,t,i,r,s){b(n.config.authDomain,n,"auth-domain-config-required"),b(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:wn,eventId:r};if(e instanceof $n){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Dc(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,l]of Object.entries(s||{}))o[c]=l}if(e instanceof Ns){const c=e.getScopes().filter(l=>l!=="");c.length>0&&(o.scopes=c.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];return`${Wx(n)}?${Er(a).slice(1)}`}function Wx({config:n}){return n.emulator?Mf(n,jx):`https://${n.authDomain}/${qx}`}const gh="webStorageSupport";class Kx{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=sr,this._completeRedirectFn=Ql,this._overrideRedirectResult=Gf}async _openPopup(e,t,i,r){var s;Qt((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=cd(e,t,i,Fo(),r);return Vx(e,o,va())}async _openRedirect(e,t,i,r){return await this._originValidation(e),SP(cd(e,t,i,Fo(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Qt(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await Ox(e),i=new MI(e);return t.register("authEvent",r=>(b(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(gh,{type:gh},r=>{var s;const o=(s=r==null?void 0:r[0])===null||s===void 0?void 0:s[gh];o!==void 0&&t(!!o),Ye(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ex(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return aI()||Lf()||As()}}const Gx=Kx;class Hx{constructor(e){this.factorId=e}_process(e,t,i){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,i);case"signin":return this._finalizeSignIn(e,t.credential);default:return rn("unexpected MultiFactorSessionType")}}}class Hf extends Hx{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Hf(e)}_finalizeEnroll(e,t,i){return _P(e,{idToken:t,displayName:i,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return MP(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class UI{constructor(){}static assertion(e){return Hf._fromCredential(e)}}UI.FACTOR_ID="phone";var Xm="@firebase/auth",Jm="0.21.0";class zx{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){b(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Qx(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function Yx(n){ge(new H("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:s,authDomain:o}=i.options;return((a,c)=>{b(s&&!s.includes(":"),"invalid-api-key",{appName:a.name}),b(!(o!=null&&o.includes(":")),"argument-error",{appName:a.name});const l={apiKey:s,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cI(n)},u=new wD(a,c,l);return JN(u,t),u})(i,r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),ge(new H("auth-internal",e=>{const t=Ue(e.getProvider("auth").getImmediate());return(i=>new zx(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Z(Xm,Jm,Qx(n)),Z(Xm,Jm,"esm2017")}const Xx=5*60;Y0("authIdTokenMaxAge");Yx("Browser");function or(){return window}const Jx=2e3;async function Zx(n,e,t){var i;const{BuildInfo:r}=or();Qt(e.sessionId,"AuthEvent did not contain a session ID");const s=await rO(e.sessionId),o={};return As()?o.ibi=r.packageName:ya()?o.apn=r.packageName:Ye(n,"operation-not-supported-in-this-environment"),r.displayName&&(o.appDisplayName=r.displayName),o.sessionId=s,cd(n,t,e.type,void 0,(i=e.eventId)!==null&&i!==void 0?i:void 0,o)}async function eO(n){const{BuildInfo:e}=or(),t={};As()?t.iosBundleId=e.packageName:ya()?t.androidPackageName=e.packageName:Ye(n,"operation-not-supported-in-this-environment"),await FI(n,t)}function tO(n){const{cordova:e}=or();return new Promise(t=>{e.plugins.browsertab.isAvailable(i=>{let r=null;i?e.plugins.browsertab.openUrl(n):r=e.InAppBrowser.open(n,gD()?"_blank":"_system","location=yes"),t(r)})})}async function nO(n,e,t){const{cordova:i}=or();let r=()=>{};try{await new Promise((s,o)=>{let a=null;function c(){var h;s();const d=(h=i.plugins.browsertab)===null||h===void 0?void 0:h.close;typeof d=="function"&&d(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function l(){a||(a=window.setTimeout(()=>{o(He(n,"redirect-cancelled-by-user"))},Jx))}function u(){(document==null?void 0:document.visibilityState)==="visible"&&l()}e.addPassiveListener(c),document.addEventListener("resume",l,!1),ya()&&document.addEventListener("visibilitychange",u,!1),r=()=>{e.removePassiveListener(c),document.removeEventListener("resume",l,!1),document.removeEventListener("visibilitychange",u,!1),a&&window.clearTimeout(a)}})}finally{r()}}function iO(n){var e,t,i,r,s,o,a,c,l,u;const h=or();b(typeof((e=h==null?void 0:h.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),b(typeof((t=h==null?void 0:h.BuildInfo)===null||t===void 0?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),b(typeof((s=(r=(i=h==null?void 0:h.cordova)===null||i===void 0?void 0:i.plugins)===null||r===void 0?void 0:r.browsertab)===null||s===void 0?void 0:s.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),b(typeof((c=(a=(o=h==null?void 0:h.cordova)===null||o===void 0?void 0:o.plugins)===null||a===void 0?void 0:a.browsertab)===null||c===void 0?void 0:c.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),b(typeof((u=(l=h==null?void 0:h.cordova)===null||l===void 0?void 0:l.InAppBrowser)===null||u===void 0?void 0:u.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function rO(n){const e=sO(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("")}function sO(n){if(Qt(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let i=0;i<n.length;i++)t[i]=n.charCodeAt(i);return t}const oO=20;class aO extends MI{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function cO(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:hO(),postBody:null,tenantId:n.tenantId,error:He(n,"no-auth-event")}}function lO(n,e){return ld()._set(ud(n),e)}async function Zm(n){const e=await ld()._get(ud(n));return e&&await ld()._remove(ud(n)),e}function uO(n,e){var t,i;const r=fO(e);if(r.includes("/__/auth/callback")){const s=Ic(r),o=s.firebaseError?dO(decodeURIComponent(s.firebaseError)):null,a=(i=(t=o==null?void 0:o.code)===null||t===void 0?void 0:t.split("auth/"))===null||i===void 0?void 0:i[1],c=a?He(a):null;return c?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:c,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:r,postBody:null}}return null}function hO(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<oO;t++){const i=Math.floor(Math.random()*e.length);n.push(e.charAt(i))}return n.join("")}function ld(){return At(Bf)}function ud(n){return Qi("authEvent",n.config.apiKey,n.name)}function dO(n){try{return JSON.parse(n)}catch{return null}}function fO(n){const e=Ic(n),t=e.link?decodeURIComponent(e.link):void 0,i=Ic(t).link,r=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return Ic(r).link||r||i||t||n}function Ic(n){if(!(n!=null&&n.includes("?")))return{};const[e,...t]=n.split("?");return jr(t.join("?"))}const pO=500;class gO{constructor(){this._redirectPersistence=sr,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ql,this._overrideRedirectResult=Gf}async _initialize(e){const t=e._key();let i=this.eventManagers.get(t);return i||(i=new aO(e),this.eventManagers.set(t,i),this.attachCallbackListeners(e,i)),i}_openPopup(e){Ye(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,i,r){iO(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),hx(),await this._originValidation(e);const o=cO(e,i,r);await lO(e,o);const a=await Zx(e,o,t),c=await tO(a);return nO(e,s,c)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=eO(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:i,handleOpenURL:r,BuildInfo:s}=or(),o=setTimeout(async()=>{await Zm(e),t.onEvent(e_())},pO),a=async u=>{clearTimeout(o);const h=await Zm(e);let d=null;h&&(u!=null&&u.url)&&(d=uO(h,u.url)),t.onEvent(d||e_())};typeof i<"u"&&typeof i.subscribe=="function"&&i.subscribe(null,a);const c=r,l=`${s.packageName.toLowerCase()}://`;or().handleOpenURL=async u=>{if(u.toLowerCase().startsWith(l)&&a({url:u}),typeof c=="function")try{c(u)}catch(h){console.error(h)}}}}const mO=gO;function e_(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:He("no-auth-event")}}function _O(n,e){Ue(n)._logFramework(e)}var yO="@firebase/auth-compat",vO="0.3.0";const wO=1e3;function mo(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function IO(){return mo()==="http:"||mo()==="https:"}function $I(n=de()){return!!((mo()==="file:"||mo()==="ionic:"||mo()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function bO(){return Pl()||Nl()}function EO(){return Kv()&&(document==null?void 0:document.documentMode)===11}function TO(n=de()){return/Edge\/\d+/.test(n)}function SO(n=de()){return EO()||TO(n)}function VI(){try{const n=self.localStorage,e=va();if(n)return n.setItem(e,"1"),n.removeItem(e),SO()?bt():!0}catch{return zf()&&bt()}return!1}function zf(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function mh(){return(IO()||Dl()||$I())&&!bO()&&VI()&&!zf()}function BI(){return $I()&&typeof document<"u"}async function CO(){return BI()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},wO);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function kO(){return typeof window<"u"?window:null}const Ct={LOCAL:"local",NONE:"none",SESSION:"session"},Hs=b,qI="persistence";function AO(n,e){if(Hs(Object.values(Ct).includes(e),n,"invalid-persistence-type"),Pl()){Hs(e!==Ct.SESSION,n,"unsupported-persistence-type");return}if(Nl()){Hs(e===Ct.NONE,n,"unsupported-persistence-type");return}if(zf()){Hs(e===Ct.NONE||e===Ct.LOCAL&&bt(),n,"unsupported-persistence-type");return}Hs(e===Ct.NONE||VI(),n,"unsupported-persistence-type")}async function hd(n){await n._initializationPromise;const e=jI(),t=Qi(qI,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())}function RO(n,e){const t=jI();if(!t)return[];const i=Qi(qI,n,e);switch(t.getItem(i)){case Ct.NONE:return[is];case Ct.LOCAL:return[Bo,sr];case Ct.SESSION:return[sr];default:return[]}}function jI(){var n;try{return((n=kO())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}const NO=b;class Yn{constructor(){this.browserResolver=At(Gx),this.cordovaResolver=At(mO),this.underlyingResolver=null,this._redirectPersistence=sr,this._completeRedirectFn=Ql,this._overrideRedirectResult=Gf}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,i,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,i,r)}async _openRedirect(e,t,i,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,i,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return BI()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return NO(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await CO();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function WI(n){return n.unwrap()}function DO(n){return n.wrapped()}function PO(n){return KI(n)}function xO(n,e){var t;const i=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if((e==null?void 0:e.code)==="auth/multi-factor-auth-required"){const r=e;r.resolver=new OO(n,gP(n,e))}else if(i){const r=KI(e),s=e;r&&(s.credential=r,s.tenantId=i.tenantId||void 0,s.email=i.email||void 0,s.phoneNumber=i.phoneNumber||void 0)}}function KI(n){const{_tokenResponse:e}=n instanceof he?n.customData:n;if(!e)return null;if(!(n instanceof he)&&"temporaryProof"in e&&"phoneNumber"in e)return an.credentialFromResult(n);const t=e.providerId;if(!t||t===Gs.PASSWORD)return null;let i;switch(t){case Gs.GOOGLE:i=Jt;break;case Gs.FACEBOOK:i=Xt;break;case Gs.GITHUB:i=Zt;break;case Gs.TWITTER:i=en;break;default:const{oauthIdToken:r,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=e;return!s&&!o&&!r&&!a?null:a?t.startsWith("saml.")?rs._create(t,a):fn._fromParams({providerId:t,signInMethod:t,pendingToken:a,idToken:r,accessToken:s}):new zr(t).credential({idToken:r,accessToken:s,rawNonce:c})}return n instanceof he?i.credentialFromError(n):i.credentialFromResult(n)}function gt(n,e){return e.catch(t=>{throw t instanceof he&&xO(n,t),t}).then(t=>{const i=t.operationType,r=t.user;return{operationType:i,credential:PO(t),additionalUserInfo:pP(t),user:Sn.getOrCreate(r)}})}async function dd(n,e){const t=await e;return{verificationId:t.verificationId,confirm:i=>gt(n,t.confirm(i))}}class OO{constructor(e,t){this.resolver=t,this.auth=DO(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return gt(WI(this.auth),this.resolver.resolveSignIn(e))}}class Sn{constructor(e){this._delegate=e,this.multiFactor=vP(e)}static getOrCreate(e){return Sn.USER_MAP.has(e)||Sn.USER_MAP.set(e,new Sn(e)),Sn.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return gt(this.auth,_I(this._delegate,e))}async linkWithPhoneNumber(e,t){return dd(this.auth,JP(this._delegate,e,t))}async linkWithPopup(e){return gt(this.auth,ax(this._delegate,e,Yn))}async linkWithRedirect(e){return await hd(Ue(this.auth)),mx(this._delegate,e,Yn)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return gt(this.auth,yI(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return dd(this.auth,ZP(this._delegate,e,t))}reauthenticateWithPopup(e){return gt(this.auth,ox(this._delegate,e,Yn))}async reauthenticateWithRedirect(e){return await hd(Ue(this.auth)),px(this._delegate,e,Yn)}sendEmailVerification(e){return iP(this._delegate,e)}async unlink(e){return await jD(this._delegate,e),this}updateEmail(e){return aP(this._delegate,e)}updatePassword(e){return cP(this._delegate,e)}updatePhoneNumber(e){return ex(this._delegate,e)}updateProfile(e){return oP(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return rP(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Sn.USER_MAP=new WeakMap;const zs=b;class fd{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:i}=e.options;zs(i,"invalid-api-key",{appName:e.name}),zs(i,"invalid-api-key",{appName:e.name});const r=typeof window<"u"?Yn:void 0;this._delegate=t.initialize({options:{persistence:MO(i,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(YN),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Sn.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){ID(this._delegate,e,t)}applyActionCode(e){return zD(this._delegate,e)}checkActionCode(e){return vI(this._delegate,e)}confirmPasswordReset(e,t){return HD(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return gt(this._delegate,YD(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return nP(this._delegate,e)}isSignInWithEmailLink(e){return ZD(this._delegate,e)}async getRedirectResult(){zs(mh(),this._delegate,"operation-not-supported-in-this-environment");const e=await yx(this._delegate,Yn);return e?gt(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){_O(this._delegate,e)}onAuthStateChanged(e,t,i){const{next:r,error:s,complete:o}=t_(e,t,i);return this._delegate.onAuthStateChanged(r,s,o)}onIdTokenChanged(e,t,i){const{next:r,error:s,complete:o}=t_(e,t,i);return this._delegate.onIdTokenChanged(r,s,o)}sendSignInLinkToEmail(e,t){return JD(this._delegate,e,t)}sendPasswordResetEmail(e,t){return GD(this._delegate,e,t||void 0)}async setPersistence(e){AO(this._delegate,e);let t;switch(e){case Ct.SESSION:t=sr;break;case Ct.LOCAL:t=await At(Bo)._isAvailable()?Bo:Bf;break;case Ct.NONE:t=is;break;default:return Ye("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return gt(this._delegate,qD(this._delegate))}signInWithCredential(e){return gt(this._delegate,jl(this._delegate,e))}signInWithCustomToken(e){return gt(this._delegate,KD(this._delegate,e))}signInWithEmailAndPassword(e,t){return gt(this._delegate,XD(this._delegate,e,t))}signInWithEmailLink(e,t){return gt(this._delegate,eP(this._delegate,e,t))}signInWithPhoneNumber(e,t){return dd(this._delegate,XP(this._delegate,e,t))}async signInWithPopup(e){return zs(mh(),this._delegate,"operation-not-supported-in-this-environment"),gt(this._delegate,sx(this._delegate,e,Yn))}async signInWithRedirect(e){return zs(mh(),this._delegate,"operation-not-supported-in-this-environment"),await hd(this._delegate),dx(this._delegate,e,Yn)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return QD(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}fd.Persistence=Ct;function t_(n,e,t){let i=n;typeof n!="function"&&({next:i,error:e,complete:t}=n);const r=i;return{next:o=>r(o&&Sn.getOrCreate(o)),error:e,complete:t}}function MO(n,e){const t=RO(n,e);if(typeof self<"u"&&!t.includes(Bo)&&t.push(Bo),typeof window<"u")for(const i of[Bf,sr])t.includes(i)||t.push(i);return t.includes(is)||t.push(is),t}class Qf{constructor(){this.providerId="phone",this._delegate=new an(WI(Te.auth()))}static credential(e,t){return an.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Qf.PHONE_SIGN_IN_METHOD=an.PHONE_SIGN_IN_METHOD;Qf.PROVIDER_ID=an.PROVIDER_ID;const LO=b;class FO{constructor(e,t,i=Te.app()){var r;LO((r=i.options)===null||r===void 0?void 0:r.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new QP(e,t,i.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}const UO="auth-compat";function $O(n){n.INTERNAL.registerComponent(new H(UO,e=>{const t=e.getProvider("app-compat").getImmediate(),i=e.getProvider("auth");return new fd(t,i)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Mr.EMAIL_SIGNIN,PASSWORD_RESET:Mr.PASSWORD_RESET,RECOVER_EMAIL:Mr.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Mr.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Mr.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Mr.VERIFY_EMAIL}},EmailAuthProvider:Ii,FacebookAuthProvider:Xt,GithubAuthProvider:Zt,GoogleAuthProvider:Jt,OAuthProvider:zr,SAMLAuthProvider:$c,PhoneAuthProvider:Qf,PhoneMultiFactorGenerator:UI,RecaptchaVerifier:FO,TwitterAuthProvider:en,Auth:fd,AuthCredential:Rs,Error:he}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(yO,vO)}$O(Te);const n_="@firebase/database",i_="0.14.0";let GI="";function HI(n){GI=n}class VO{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ke(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:No(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class BO{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Dt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const zI=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new VO(e)}}catch{}return new BO},ji=zI("localStorage"),pd=zI("sessionStorage");const Yr=new vn("@firebase/database"),QI=function(){let n=1;return function(){return n++}}(),YI=function(n){const e=ok(n),t=new ik;t.update(e);const i=t.digest();return Rl.encodeByteArray(i)},Ia=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Ia.apply(null,i):typeof i=="object"?e+=ke(i):e+=i,e+=" "}return e};let Xi=null,r_=!0;const XI=function(n,e){E(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Yr.logLevel=$.VERBOSE,Xi=Yr.log.bind(Yr),e&&pd.set("logging_enabled",!0)):typeof n=="function"?Xi=n:(Xi=null,pd.remove("logging_enabled"))},Me=function(...n){if(r_===!0&&(r_=!1,Xi===null&&pd.get("logging_enabled")===!0&&XI(!0)),Xi){const e=Ia.apply(null,n);Xi(e)}},ba=function(n){return function(...e){Me(n,...e)}},gd=function(...n){const e="FIREBASE INTERNAL ERROR: "+Ia(...n);Yr.error(e)},pn=function(...n){const e=`FIREBASE FATAL ERROR: ${Ia(...n)}`;throw Yr.error(e),new Error(e)},nt=function(...n){const e="FIREBASE WARNING: "+Ia(...n);Yr.warn(e)},qO=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&nt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Yl=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},jO=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},ci="[MIN_NAME]",Mn="[MAX_NAME]",Cr=function(n,e){if(n===e)return 0;if(n===ci||e===Mn)return-1;if(e===ci||n===Mn)return 1;{const t=s_(n),i=s_(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},WO=function(n,e){return n===e?0:n<e?-1:1},Qs=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ke(e))},Yf=function(n){if(typeof n!="object"||n===null)return ke(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=ke(e[i]),t+=":",t+=Yf(n[e[i]]);return t+="}",t},JI=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function $e(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const ZI=function(n){E(!Yl(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let r,s,o,a,c;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));const l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(s%2?1:0),s=Math.floor(s/2);l.push(r?1:0),l.reverse();const u=l.join("");let h="";for(c=0;c<64;c+=8){let d=parseInt(u.substr(c,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},KO=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},GO=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function HO(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const zO=new RegExp("^-?(0*)\\d{1,10}$"),QO=-2147483648,YO=2147483647,s_=function(n){if(zO.test(n)){const e=Number(n);if(e>=QO&&e<=YO)return e}return null},Ds=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw nt("Exception was thrown by user callback.",t),e},Math.floor(0))}},XO=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},_o=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class JO{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){nt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class ZO{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Me("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',nt(e)}}class Xr{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Xr.OWNER="owner";const Xf="5",eb="v",tb="s",nb="r",ib="f",rb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,sb="ls",ob="p",md="ac",ab="websocket",cb="long_polling";class lb{constructor(e,t,i,r,s=!1,o="",a=!1){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ji.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ji.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function eM(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ub(n,e,t){E(typeof e=="string","typeof type must == string"),E(typeof t=="object","typeof params must == object");let i;if(e===ab)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===cb)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);eM(n)&&(t.ns=n.namespace);const r=[];return $e(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}class tM{constructor(){this.counters_={}}incrementCounter(e,t=1){Dt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return q0(this.counters_)}}const _h={},yh={};function Jf(n){const e=n.toString();return _h[e]||(_h[e]=new tM),_h[e]}function nM(n,e){const t=n.toString();return yh[t]||(yh[t]=e()),yh[t]}class iM{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&Ds(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const o_="start",rM="close",sM="pLPCommand",oM="pRTLPCB",hb="id",db="pw",fb="ser",aM="cb",cM="seg",lM="ts",uM="d",hM="dframe",pb=1870,gb=30,dM=pb-gb,fM=25e3,pM=3e4;class Xn{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ba(e),this.stats_=Jf(t),this.urlFn=c=>(this.appCheckToken&&(c[md]=this.appCheckToken),ub(t,cb,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new iM(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(pM)),jO(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Zf((...s)=>{const[o,a,c,l,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===o_)this.id=a,this.password=c;else if(o===rM)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[o_]="t",i[fb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[aM]=this.scriptTagHolder.uniqueCallbackIdentifier),i[eb]=Xf,this.transportSessionId&&(i[tb]=this.transportSessionId),this.lastSessionId&&(i[sb]=this.lastSessionId),this.applicationId&&(i[ob]=this.applicationId),this.appCheckToken&&(i[md]=this.appCheckToken),typeof location<"u"&&location.hostname&&rb.test(location.hostname)&&(i[nb]=ib);const r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Xn.forceAllow_=!0}static forceDisallow(){Xn.forceDisallow_=!0}static isAvailable(){return Xn.forceAllow_?!0:!Xn.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!KO()&&!GO()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=ke(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Wv(t),r=JI(i,dM);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[hM]="t",i[hb]=e,i[db]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=ke(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Zf{constructor(e,t,i,r){this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=QI(),window[sM+this.uniqueCallbackIdentifier]=e,window[oM+this.uniqueCallbackIdentifier]=t,this.myIFrame=Zf.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";</script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Me("frame writing exception"),a.stack&&Me(a.stack),Me(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Me("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[hb]=this.myID,e[db]=this.myPW,e[fb]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+gb+i.length<=pb;){const o=this.pendingSegs.shift();i=i+"&"+cM+r+"="+o.seg+"&"+lM+r+"="+o.ts+"&"+uM+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(fM)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Me("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}const gM=16384,mM=45e3;let jc=null;typeof MozWebSocket<"u"?jc=MozWebSocket:typeof WebSocket<"u"&&(jc=WebSocket);class Mt{constructor(e,t,i,r,s,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ba(this.connId),this.stats_=Jf(t),this.connURL=Mt.connectionURL_(t,o,a,r,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,r,s){const o={};return o[eb]=Xf,typeof location<"u"&&location.hostname&&rb.test(location.hostname)&&(o[nb]=ib),t&&(o[tb]=t),i&&(o[sb]=i),r&&(o[md]=r),s&&(o[ob]=s),ub(e,ab,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ji.set("previous_websocket_failure",!0);try{let i;Gv(),this.mySock=new jc(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Mt.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&jc!==null&&!Mt.forceDisallow_}static previouslyFailed(){return ji.isInMemoryStorage||ji.get("previous_websocket_failure")===!0}markConnectionHealthy(){ji.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=No(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(E(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=ke(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=JI(t,gM);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(mM))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Mt.responsesRequiredToBeHealthy=2;Mt.healthyTimeout=3e4;class ss{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Xn,Mt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Mt&&Mt.isAvailable();let i=t&&!Mt.previouslyFailed();if(e.webSocketOnly&&(t||nt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Mt];else{const r=this.transports_=[];for(const s of ss.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s);ss.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ss.globalTransportInitialized_=!1;const _M=6e4,yM=5e3,vM=10*1024,wM=100*1024,vh="t",a_="d",IM="s",c_="r",bM="e",l_="o",u_="a",h_="n",d_="p",EM="h";class TM{constructor(e,t,i,r,s,o,a,c,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ba("c:"+this.id+":"),this.transportManager_=new ss(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=_o(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>wM?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>vM?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(vh in e){const t=e[vh];t===u_?this.upgradeIfSecondaryHealthy_():t===c_?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===l_&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Qs("t",e),i=Qs("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:d_,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:u_,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:h_,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Qs("t",e),i=Qs("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Qs(vh,e);if(a_ in e){const i=e[a_];if(t===EM)this.onHandshake_(i);else if(t===h_){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===IM?this.onConnectionShutdown_(i):t===c_?this.onReset_(i):t===bM?gd("Server Error: "+i):t===l_?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):gd("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Xf!==i&&nt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),_o(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(_M))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):_o(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(yM))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:d_,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ji.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class mb{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class _b{constructor(e){this.allowedEvents_=e,this.listeners_={},E(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){E(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Wc extends _b{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!_f()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Wc}getInitialEvent(e){return E(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const f_=32,p_=768;class Y{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Q(){return new Y("")}function V(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function li(n){return n.pieces_.length-n.pieceNum_}function te(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Y(n.pieces_,e)}function ep(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function SM(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function qo(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function yb(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Y(e,0)}function ae(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof Y)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new Y(t,0)}function B(n){return n.pieceNum_>=n.pieces_.length}function ut(n,e){const t=V(n),i=V(e);if(t===null)return e;if(t===i)return ut(te(n),te(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function CM(n,e){const t=qo(n,0),i=qo(e,0);for(let r=0;r<t.length&&r<i.length;r++){const s=Cr(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function tp(n,e){if(li(n)!==li(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Ft(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(li(n)>li(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class kM{constructor(e,t){this.errorPrefix_=t,this.parts_=qo(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Ol(this.parts_[i]);vb(this)}}function AM(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ol(e),vb(n)}function RM(n){const e=n.parts_.pop();n.byteLength_-=Ol(e),n.parts_.length>0&&(n.byteLength_-=1)}function vb(n){if(n.byteLength_>p_)throw new Error(n.errorPrefix_+"has a key path longer than "+p_+" bytes ("+n.byteLength_+").");if(n.parts_.length>f_)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+f_+") or object contains a cycle "+xi(n))}function xi(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class np extends _b{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new np}getInitialEvent(e){return E(e==="visible","Unknown event type: "+e),[this.visible_]}}const Ys=1e3,NM=60*5*1e3,g_=30*1e3,DM=1.3,PM=3e4,xM="server_kill",m_=3;class Pn extends mb{constructor(e,t,i,r,s,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Pn.nextPersistentConnectionId_++,this.log_=ba("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ys,this.maxReconnectDelay_=NM,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Gv())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");np.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Wc.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const r=++this.requestNumber_,s={r,a:e,b:t};this.log_(ke(s)),E(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),i&&(this.requestCBHash_[r]=i)}get(e){this.initConnection_();const t=new Ce,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),t.promise}listen(e,t,i,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),E(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),E(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:i};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+i+" for "+r);const s={p:i},o="q";e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const c=a.d,l=a.s;Pn.warnOnListenWarnings_(c,t),(this.listens.get(i)&&this.listens.get(i).get(r))===e&&(this.log_("listen response",a),l!=="ok"&&this.removeListen_(i,r),e.onComplete&&e.onComplete(l,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Dt(e,"w")){const i=tr(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',s=t._path.toString();nt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||nk(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=g_)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=tk(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,r=>{const s=r.s,o=r.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),E(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,e._queryObject,t)}sendUnlisten_(e,t,i,r){this.log_("Unlisten on "+e+" for "+t);const s={p:e},o="n";r&&(s.q=i,s.t=r),this.sendRequest(o,s)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,r){const s={p:t,d:i};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,i,r){this.putInternal("p",e,t,i,r)}merge(e,t,i,r){this.putInternal("m",e,t,i,r)}putInternal(e,t,i,r,s){this.initConnection_();const o={p:t,d:i};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,s=>{this.log_(t+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const s=i.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ke(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):gd("Unrecognized action received from server: "+ke(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){E(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ys,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ys,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>PM&&(this.reconnectDelay_=Ys),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*DM)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Pn.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,i())},l=function(h){E(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:c,sendRequest:l};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,d]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?Me("getToken() completed but was canceled"):(Me("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=d&&d.token,a=new TM(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,f=>{nt(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(xM)},s))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&nt(h),c())}}}interrupt(e){Me("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Me("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Dc(this.interruptReasons_)&&(this.reconnectDelay_=Ys,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(s=>Yf(s)).join("$"):i="default";const r=this.removeListen_(e,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const i=new Y(e).toString();let r;if(this.listens.has(i)){const s=this.listens.get(i);r=s.get(t),s.delete(t),s.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(e,t){Me("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=m_&&(this.reconnectDelay_=g_,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Me("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=m_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+GI.replace(/\./g,"-")]=1,_f()?e["framework.cordova"]=1:Pl()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Wc.getInstance().currentlyOnline();return Dc(this.interruptReasons_)&&e}}Pn.nextPersistentConnectionId_=0;Pn.nextConnectionId_=0;class q{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new q(e,t)}}class Xl{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new q(ci,e),r=new q(ci,t);return this.compare(i,r)!==0}minPost(){return q.MIN}}let nc;class wb extends Xl{static get __EMPTY_NODE(){return nc}static set __EMPTY_NODE(e){nc=e}compare(e,t){return Cr(e.name,t.name)}isDefinedOn(e){throw Ss("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return q.MIN}maxPost(){return new q(Mn,nc)}makePost(e,t){return E(typeof e=="string","KeyIndex indexValue must always be a string."),new q(e,nc)}toString(){return".key"}}const cn=new wb;class ic{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class xe{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??xe.RED,this.left=r??yt.EMPTY_NODE,this.right=s??yt.EMPTY_NODE}copy(e,t,i,r,s){return new xe(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return yt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,r;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return yt.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,xe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,xe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}xe.RED=!0;xe.BLACK=!1;class OM{copy(e,t,i,r,s){return this}insert(e,t,i){return new xe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class yt{constructor(e,t=yt.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new yt(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,xe.BLACK,null,null))}remove(e){return new yt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,xe.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ic(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ic(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ic(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ic(this.root_,null,this.comparator_,!0,e)}}yt.EMPTY_NODE=new OM;function MM(n,e){return Cr(n.name,e.name)}function ip(n,e){return Cr(n,e)}let _d;function LM(n){_d=n}const Ib=function(n){return typeof n=="number"?"number:"+ZI(n):"string:"+n},bb=function(n){if(n.isLeafNode()){const e=n.val();E(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Dt(e,".sv"),"Priority must be a string or number.")}else E(n===_d||n.isEmpty(),"priority of unexpected type.");E(n===_d||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let __;class Ne{constructor(e,t=Ne.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,E(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),bb(this.priorityNode_)}static set __childrenNodeConstructor(e){__=e}static get __childrenNodeConstructor(){return __}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ne(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ne.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return B(e)?this:V(e)===".priority"?this.priorityNode_:Ne.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Ne.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=V(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(E(i!==".priority"||li(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,Ne.__childrenNodeConstructor.EMPTY_NODE.updateChild(te(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Ib(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=ZI(this.value_):e+=this.value_,this.lazyHash_=YI(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ne.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ne.__childrenNodeConstructor?-1:(E(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,r=Ne.VALUE_TYPE_ORDER.indexOf(t),s=Ne.VALUE_TYPE_ORDER.indexOf(i);return E(r>=0,"Unknown leaf type: "+t),E(s>=0,"Unknown leaf type: "+i),r===s?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Ne.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Eb,Tb;function FM(n){Eb=n}function UM(n){Tb=n}class $M extends Xl{compare(e,t){const i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?Cr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return q.MIN}maxPost(){return new q(Mn,new Ne("[PRIORITY-POST]",Tb))}makePost(e,t){const i=Eb(e);return new q(t,new Ne("[PRIORITY-POST]",i))}toString(){return".priority"}}const ie=new $M;const VM=Math.log(2);class BM{constructor(e){const t=s=>parseInt(Math.log(s)/VM,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Kc=function(n,e,t,i){n.sort(e);const r=function(c,l){const u=l-c;let h,d;if(u===0)return null;if(u===1)return h=n[c],d=t?t(h):h,new xe(d,h.node,xe.BLACK,null,null);{const f=parseInt(u/2,10)+c,p=r(c,f),_=r(f+1,l);return h=n[f],d=t?t(h):h,new xe(d,h.node,xe.BLACK,p,_)}},s=function(c){let l=null,u=null,h=n.length;const d=function(p,_){const w=h-p,N=h;h-=p;const M=r(w+1,N),x=n[w],U=t?t(x):x;f(new xe(U,x.node,_,null,M))},f=function(p){l?(l.left=p,l=p):(u=p,l=p)};for(let p=0;p<c.count;++p){const _=c.nextBitIsOne(),w=Math.pow(2,c.count-(p+1));_?d(w,xe.BLACK):(d(w,xe.BLACK),d(w,xe.RED))}return u},o=new BM(n.length),a=s(o);return new yt(i||e,a)};let wh;const Lr={};class Cn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return E(Lr&&ie,"ChildrenNode.ts has not been loaded"),wh=wh||new Cn({".priority":Lr},{".priority":ie}),wh}get(e){const t=tr(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof yt?t:null}hasIndex(e){return Dt(this.indexSet_,e.toString())}addIndex(e,t){E(e!==cn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let r=!1;const s=t.getIterator(q.Wrap);let o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Kc(i,e.getCompare()):a=Lr;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const u=Object.assign({},this.indexes_);return u[c]=a,new Cn(u,l)}addToIndexes(e,t){const i=Pc(this.indexes_,(r,s)=>{const o=tr(this.indexSet_,s);if(E(o,"Missing index implementation for "+s),r===Lr)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(q.Wrap);let l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),Kc(a,o.getCompare())}else return Lr;else{const a=t.get(e.name);let c=r;return a&&(c=c.remove(new q(e.name,a))),c.insert(e,e.node)}});return new Cn(i,this.indexSet_)}removeFromIndexes(e,t){const i=Pc(this.indexes_,r=>{if(r===Lr)return r;{const s=t.get(e.name);return s?r.remove(new q(e.name,s)):r}});return new Cn(i,this.indexSet_)}}let Xs;class D{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&bb(this.priorityNode_),this.children_.isEmpty()&&E(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Xs||(Xs=new D(new yt(ip),null,Cn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Xs}updatePriority(e){return this.children_.isEmpty()?this:new D(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Xs:t}}getChild(e){const t=V(e);return t===null?this:this.getImmediateChild(t).getChild(te(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(E(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new q(e,t);let r,s;t.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(i,this.children_));const o=r.isEmpty()?Xs:this.priorityNode_;return new D(r,o,s)}}updateChild(e,t){const i=V(e);if(i===null)return t;{E(V(e)!==".priority"||li(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(i).updateChild(te(e),t);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,r=0,s=!0;if(this.forEachChild(ie,(o,a)=>{t[o]=a.val(e),i++,s&&D.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):s=!1}),!e&&s&&r<2*i){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Ib(this.getPriority().val())+":"),this.forEachChild(ie,(t,i)=>{const r=i.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":YI(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const r=this.resolveIndex_(i);if(r){const s=r.getPredecessorKey(new q(e,t));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new q(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new q(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,q.Wrap);let s=r.peek();for(;s!=null&&t.compare(s,e)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,q.Wrap);let s=r.peek();for(;s!=null&&t.compare(s,e)>0;)r.getNext(),s=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ea?-1:0}withIndex(e){if(e===cn||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new D(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===cn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(ie),r=t.getIterator(ie);let s=i.getNext(),o=r.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=i.getNext(),o=r.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===cn?null:this.indexMap_.get(e.toString())}}D.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class qM extends D{constructor(){super(new yt(ip),D.EMPTY_NODE,Cn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return D.EMPTY_NODE}isEmpty(){return!1}}const Ea=new qM;Object.defineProperties(q,{MIN:{value:new q(ci,D.EMPTY_NODE)},MAX:{value:new q(Mn,Ea)}});wb.__EMPTY_NODE=D.EMPTY_NODE;Ne.__childrenNodeConstructor=D;LM(Ea);UM(Ea);const jM=!0;function ue(n,e=null){if(n===null)return D.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),E(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Ne(t,ue(e))}if(!(n instanceof Array)&&jM){const t=[];let i=!1;if($e(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=ue(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new q(o,c)))}}),t.length===0)return D.EMPTY_NODE;const s=Kc(t,MM,o=>o.name,ip);if(i){const o=Kc(t,ie.getCompare());return new D(s,ue(e),new Cn({".priority":o},{".priority":ie}))}else return new D(s,ue(e),Cn.Default)}else{let t=D.EMPTY_NODE;return $e(n,(i,r)=>{if(Dt(n,i)&&i.substring(0,1)!=="."){const s=ue(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(ue(e))}}FM(ue);class rp extends Xl{constructor(e){super(),this.indexPath_=e,E(!B(e)&&V(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?Cr(e.name,t.name):s}makePost(e,t){const i=ue(e),r=D.EMPTY_NODE.updateChild(this.indexPath_,i);return new q(t,r)}maxPost(){const e=D.EMPTY_NODE.updateChild(this.indexPath_,Ea);return new q(Mn,e)}toString(){return qo(this.indexPath_,0).join("/")}}class WM extends Xl{compare(e,t){const i=e.node.compareTo(t.node);return i===0?Cr(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return q.MIN}maxPost(){return q.MAX}makePost(e,t){const i=ue(e);return new q(t,i)}toString(){return".value"}}const sp=new WM;function Sb(n){return{type:"value",snapshotNode:n}}function os(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function jo(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Wo(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function KM(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class op{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){E(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(jo(t,a)):E(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(os(t,i)):o.trackChildChange(Wo(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(ie,(r,s)=>{t.hasChild(r)||i.trackChildChange(jo(r,s))}),t.isLeafNode()||t.forEachChild(ie,(r,s)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(Wo(r,s,o))}else i.trackChildChange(os(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?D.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Ko{constructor(e){this.indexedFilter_=new op(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ko.getStartPost_(e),this.endPost_=Ko.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new q(t,i))||(i=D.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=D.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(D.EMPTY_NODE);const s=this;return t.forEachChild(ie,(o,a)=>{s.matches(new q(o,a))||(r=r.updateImmediateChild(o,D.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class GM{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Ko(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new q(t,i))||(i=D.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=D.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=D.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(D.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,D.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){const h=this.index_.getCompare();o=(d,f)=>h(f,d)}else o=this.index_.getCompare();const a=e;E(a.numChildren()===this.limit_,"");const c=new q(t,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(a.hasChild(t)){const h=a.getImmediateChild(t);let d=r.getChildAfterChild(this.index_,l,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);const f=d==null?1:o(d,c);if(u&&!i.isEmpty()&&f>=0)return s!=null&&s.trackChildChange(Wo(t,i,h)),a.updateImmediateChild(t,i);{s!=null&&s.trackChildChange(jo(t,h));const _=a.updateImmediateChild(t,D.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(s!=null&&s.trackChildChange(os(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}}else return i.isEmpty()?e:u&&o(l,c)>=0?(s!=null&&(s.trackChildChange(jo(l.name,l.node)),s.trackChildChange(os(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(l.name,D.EMPTY_NODE)):e}}class Jl{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ie}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return E(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return E(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ci}hasEnd(){return this.endSet_}getIndexEndValue(){return E(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return E(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Mn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return E(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ie}copy(){const e=new Jl;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function HM(n){return n.loadsAllData()?new op(n.getIndex()):n.hasLimit()?new GM(n):new Ko(n)}function zM(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function QM(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function yd(n,e,t){const i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function YM(n,e,t){let i;return n.index_===cn||t?i=yd(n,e,t):i=yd(n,e,Mn),i.startAfterSet_=!0,i}function vd(n,e,t){const i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function XM(n,e,t){let i;return n.index_===cn||t?i=vd(n,e,t):i=vd(n,e,ci),i.endBeforeSet_=!0,i}function Zl(n,e){const t=n.copy();return t.index_=e,t}function y_(n){const e={};if(n.isDefault())return e;let t;if(n.index_===ie?t="$priority":n.index_===sp?t="$value":n.index_===cn?t="$key":(E(n.index_ instanceof rp,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ke(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=ke(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+ke(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=ke(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+ke(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function v_(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ie&&(e.i=n.index_.toString()),e}class Gc extends mb{constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=ba("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(E(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,r){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=Gc.getListenId_(e,i),a={};this.listens_[o]=a;const c=y_(e._queryParams);this.restRequest_(s+".json",c,(l,u)=>{let h=u;if(l===404&&(h=null,l=null),l===null&&this.onDataUpdate_(s,h,!1,i),tr(this.listens_,o)===a){let d;l?l===401?d="permission_denied":d="rest_error:"+l:d="ok",r(d,null)}})}unlisten(e,t){const i=Gc.getListenId_(e,t);delete this.listens_[i]}get(e){const t=y_(e._queryParams),i=e._path.toString(),r=new Ce;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Er(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=No(a.responseText)}catch{nt("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&nt("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class JM{constructor(){this.rootNode_=D.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Hc(){return{value:null,children:new Map}}function Ps(n,e,t){if(B(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=V(e);n.children.has(i)||n.children.set(i,Hc());const r=n.children.get(i);e=te(e),Ps(r,e,t)}}function wd(n,e){if(B(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(ie,(i,r)=>{Ps(n,new Y(i),r)}),wd(n,e)}}else if(n.children.size>0){const t=V(e);return e=te(e),n.children.has(t)&&wd(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Id(n,e,t){n.value!==null?t(e,n.value):ZM(n,(i,r)=>{const s=new Y(e.toString()+"/"+i);Id(r,s,t)})}function ZM(n,e){n.children.forEach((t,i)=>{e(i,t)})}class eL{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&$e(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}}const w_=10*1e3,tL=30*1e3,nL=5*60*1e3;class iL{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new eL(e);const i=w_+(tL-w_)*Math.random();_o(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;$e(e,(r,s)=>{s>0&&Dt(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),_o(this.reportStats_.bind(this),Math.floor(Math.random()*2*nL))}}var Gt;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Gt||(Gt={}));function ap(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function cp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function lp(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class zc{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Gt.ACK_USER_WRITE,this.source=ap()}operationForChild(e){if(B(this.path)){if(this.affectedTree.value!=null)return E(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Y(e));return new zc(Q(),t,this.revert)}}else return E(V(this.path)===e,"operationForChild called for unrelated child."),new zc(te(this.path),this.affectedTree,this.revert)}}class Go{constructor(e,t){this.source=e,this.path=t,this.type=Gt.LISTEN_COMPLETE}operationForChild(e){return B(this.path)?new Go(this.source,Q()):new Go(this.source,te(this.path))}}class ar{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Gt.OVERWRITE}operationForChild(e){return B(this.path)?new ar(this.source,Q(),this.snap.getImmediateChild(e)):new ar(this.source,te(this.path),this.snap)}}class as{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Gt.MERGE}operationForChild(e){if(B(this.path)){const t=this.children.subtree(new Y(e));return t.isEmpty()?null:t.value?new ar(this.source,Q(),t.value):new as(this.source,Q(),t)}else return E(V(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new as(this.source,te(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ui{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(B(e))return this.isFullyInitialized()&&!this.filtered_;const t=V(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class rL{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function sL(n,e,t,i){const r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(KM(o.childName,o.snapshotNode))}),Js(n,r,"child_removed",e,i,t),Js(n,r,"child_added",e,i,t),Js(n,r,"child_moved",s,i,t),Js(n,r,"child_changed",e,i,t),Js(n,r,"value",e,i,t),r}function Js(n,e,t,i,r,s){const o=i.filter(a=>a.type===t);o.sort((a,c)=>aL(n,a,c)),o.forEach(a=>{const c=oL(n,a,s);r.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function oL(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function aL(n,e,t){if(e.childName==null||t.childName==null)throw Ss("Should only compare child_ events.");const i=new q(e.childName,e.snapshotNode),r=new q(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function eu(n,e){return{eventCache:n,serverCache:e}}function yo(n,e,t,i){return eu(new ui(e,t,i),n.serverCache)}function Cb(n,e,t,i){return eu(n.eventCache,new ui(e,t,i))}function Qc(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function cr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Ih;const cL=()=>(Ih||(Ih=new yt(WO)),Ih);class ne{constructor(e,t=cL()){this.value=e,this.children=t}static fromObject(e){let t=new ne(null);return $e(e,(i,r)=>{t=t.set(new Y(i),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Q(),value:this.value};if(B(e))return null;{const i=V(e),r=this.children.get(i);if(r!==null){const s=r.findRootMostMatchingPathAndValue(te(e),t);return s!=null?{path:ae(new Y(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(B(e))return this;{const t=V(e),i=this.children.get(t);return i!==null?i.subtree(te(e)):new ne(null)}}set(e,t){if(B(e))return new ne(t,this.children);{const i=V(e),s=(this.children.get(i)||new ne(null)).set(te(e),t),o=this.children.insert(i,s);return new ne(this.value,o)}}remove(e){if(B(e))return this.children.isEmpty()?new ne(null):new ne(null,this.children);{const t=V(e),i=this.children.get(t);if(i){const r=i.remove(te(e));let s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new ne(null):new ne(this.value,s)}else return this}}get(e){if(B(e))return this.value;{const t=V(e),i=this.children.get(t);return i?i.get(te(e)):null}}setTree(e,t){if(B(e))return t;{const i=V(e),s=(this.children.get(i)||new ne(null)).setTree(te(e),t);let o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new ne(this.value,o)}}fold(e){return this.fold_(Q(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(ae(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Q(),t)}findOnPath_(e,t,i){const r=this.value?i(t,this.value):!1;if(r)return r;if(B(e))return null;{const s=V(e),o=this.children.get(s);return o?o.findOnPath_(te(e),ae(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Q(),t)}foreachOnPath_(e,t,i){if(B(e))return this;{this.value&&i(t,this.value);const r=V(e),s=this.children.get(r);return s?s.foreachOnPath_(te(e),ae(t,r),i):new ne(null)}}foreach(e){this.foreach_(Q(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(ae(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class zt{constructor(e){this.writeTree_=e}static empty(){return new zt(new ne(null))}}function vo(n,e,t){if(B(e))return new zt(new ne(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const r=i.path;let s=i.value;const o=ut(r,e);return s=s.updateChild(o,t),new zt(n.writeTree_.set(r,s))}else{const r=new ne(t),s=n.writeTree_.setTree(e,r);return new zt(s)}}}function bd(n,e,t){let i=n;return $e(t,(r,s)=>{i=vo(i,ae(e,r),s)}),i}function I_(n,e){if(B(e))return zt.empty();{const t=n.writeTree_.setTree(e,new ne(null));return new zt(t)}}function Ed(n,e){return kr(n,e)!=null}function kr(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(ut(t.path,e)):null}function b_(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ie,(i,r)=>{e.push(new q(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new q(i,r.value))}),e}function ei(n,e){if(B(e))return n;{const t=kr(n,e);return t!=null?new zt(new ne(t)):new zt(n.writeTree_.subtree(e))}}function Td(n){return n.writeTree_.isEmpty()}function cs(n,e){return kb(Q(),n.writeTree_,e)}function kb(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(E(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=kb(ae(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(ae(n,".priority"),i)),t}}function tu(n,e){return Db(e,n)}function lL(n,e,t,i,r){E(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=vo(n.visibleWrites,e,t)),n.lastWriteId=i}function uL(n,e,t,i){E(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=bd(n.visibleWrites,e,t),n.lastWriteId=i}function hL(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function dL(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);E(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&fL(a,i.path)?r=!1:Ft(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return pL(n),!0;if(i.snap)n.visibleWrites=I_(n.visibleWrites,i.path);else{const a=i.children;$e(a,c=>{n.visibleWrites=I_(n.visibleWrites,ae(i.path,c))})}return!0}else return!1}function fL(n,e){if(n.snap)return Ft(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ft(ae(n.path,t),e))return!0;return!1}function pL(n){n.visibleWrites=Ab(n.allWrites,gL,Q()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function gL(n){return n.visible}function Ab(n,e,t){let i=zt.empty();for(let r=0;r<n.length;++r){const s=n[r];if(e(s)){const o=s.path;let a;if(s.snap)Ft(t,o)?(a=ut(t,o),i=vo(i,a,s.snap)):Ft(o,t)&&(a=ut(o,t),i=vo(i,Q(),s.snap.getChild(a)));else if(s.children){if(Ft(t,o))a=ut(t,o),i=bd(i,a,s.children);else if(Ft(o,t))if(a=ut(o,t),B(a))i=bd(i,Q(),s.children);else{const c=tr(s.children,V(a));if(c){const l=c.getChild(te(a));i=vo(i,Q(),l)}}}else throw Ss("WriteRecord should have .snap or .children")}}return i}function Rb(n,e,t,i,r){if(!i&&!r){const s=kr(n.visibleWrites,e);if(s!=null)return s;{const o=ei(n.visibleWrites,e);if(Td(o))return t;if(t==null&&!Ed(o,Q()))return null;{const a=t||D.EMPTY_NODE;return cs(o,a)}}}else{const s=ei(n.visibleWrites,e);if(!r&&Td(s))return t;if(!r&&t==null&&!Ed(s,Q()))return null;{const o=function(l){return(l.visible||r)&&(!i||!~i.indexOf(l.writeId))&&(Ft(l.path,e)||Ft(e,l.path))},a=Ab(n.allWrites,o,e),c=t||D.EMPTY_NODE;return cs(a,c)}}}function mL(n,e,t){let i=D.EMPTY_NODE;const r=kr(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(ie,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){const s=ei(n.visibleWrites,e);return t.forEachChild(ie,(o,a)=>{const c=cs(ei(s,new Y(o)),a);i=i.updateImmediateChild(o,c)}),b_(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const s=ei(n.visibleWrites,e);return b_(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function _L(n,e,t,i,r){E(i||r,"Either existingEventSnap or existingServerSnap must exist");const s=ae(e,t);if(Ed(n.visibleWrites,s))return null;{const o=ei(n.visibleWrites,s);return Td(o)?r.getChild(t):cs(o,r.getChild(t))}}function yL(n,e,t,i){const r=ae(e,t),s=kr(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){const o=ei(n.visibleWrites,r);return cs(o,i.getNode().getImmediateChild(t))}else return null}function vL(n,e){return kr(n.visibleWrites,e)}function wL(n,e,t,i,r,s,o){let a;const c=ei(n.visibleWrites,e),l=kr(c,Q());if(l!=null)a=l;else if(t!=null)a=cs(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const u=[],h=o.getCompare(),d=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let f=d.getNext();for(;f&&u.length<r;)h(f,i)!==0&&u.push(f),f=d.getNext();return u}else return[]}function IL(){return{visibleWrites:zt.empty(),allWrites:[],lastWriteId:-1}}function Yc(n,e,t,i){return Rb(n.writeTree,n.treePath,e,t,i)}function up(n,e){return mL(n.writeTree,n.treePath,e)}function E_(n,e,t,i){return _L(n.writeTree,n.treePath,e,t,i)}function Xc(n,e){return vL(n.writeTree,ae(n.treePath,e))}function bL(n,e,t,i,r,s){return wL(n.writeTree,n.treePath,e,t,i,r,s)}function hp(n,e,t){return yL(n.writeTree,n.treePath,e,t)}function Nb(n,e){return Db(ae(n.treePath,e),n.writeTree)}function Db(n,e){return{treePath:n,writeTree:e}}class EL{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;E(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),E(i!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(i);if(r){const s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,Wo(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,jo(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,os(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,Wo(i,e.snapshotNode,r.oldSnap));else throw Ss("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}class TL{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const Pb=new TL;class dp{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new ui(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return hp(this.writes_,e,i)}}getChildAfterChild(e,t,i){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:cr(this.viewCache_),s=bL(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}}function SL(n){return{filter:n}}function CL(n,e){E(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),E(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function kL(n,e,t,i,r){const s=new EL;let o,a;if(t.type===Gt.OVERWRITE){const l=t;l.source.fromUser?o=Sd(n,e,l.path,l.snap,i,r,s):(E(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!B(l.path),o=Jc(n,e,l.path,l.snap,i,r,a,s))}else if(t.type===Gt.MERGE){const l=t;l.source.fromUser?o=RL(n,e,l.path,l.children,i,r,s):(E(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=Cd(n,e,l.path,l.children,i,r,a,s))}else if(t.type===Gt.ACK_USER_WRITE){const l=t;l.revert?o=PL(n,e,l.path,i,r,s):o=NL(n,e,l.path,l.affectedTree,i,r,s)}else if(t.type===Gt.LISTEN_COMPLETE)o=DL(n,e,t.path,i,s);else throw Ss("Unknown operation type: "+t.type);const c=s.getChanges();return AL(e,o,c),{viewCache:o,changes:c}}function AL(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Qc(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(Sb(Qc(e)))}}function xb(n,e,t,i,r,s){const o=e.eventCache;if(Xc(i,t)!=null)return e;{let a,c;if(B(t))if(E(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const l=cr(e),u=l instanceof D?l:D.EMPTY_NODE,h=up(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{const l=Yc(i,cr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{const l=V(t);if(l===".priority"){E(li(t)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=E_(i,t,u,c);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{const u=te(t);let h;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();const d=E_(i,t,o.getNode(),c);d!=null?h=o.getNode().getImmediateChild(l).updateChild(u,d):h=o.getNode().getImmediateChild(l)}else h=hp(i,l,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),l,h,u,r,s):a=o.getNode()}}return yo(e,a,o.isFullyInitialized()||B(t),n.filter.filtersNodes())}}function Jc(n,e,t,i,r,s,o,a){const c=e.serverCache;let l;const u=o?n.filter:n.filter.getIndexedFilter();if(B(t))l=u.updateFullNode(c.getNode(),i,null);else if(u.filtersNodes()&&!c.isFiltered()){const f=c.getNode().updateChild(t,i);l=u.updateFullNode(c.getNode(),f,null)}else{const f=V(t);if(!c.isCompleteForPath(t)&&li(t)>1)return e;const p=te(t),w=c.getNode().getImmediateChild(f).updateChild(p,i);f===".priority"?l=u.updatePriority(c.getNode(),w):l=u.updateChild(c.getNode(),f,w,p,Pb,null)}const h=Cb(e,l,c.isFullyInitialized()||B(t),u.filtersNodes()),d=new dp(r,h,s);return xb(n,h,t,r,d,a)}function Sd(n,e,t,i,r,s,o){const a=e.eventCache;let c,l;const u=new dp(r,e,s);if(B(t))l=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=yo(e,l,!0,n.filter.filtersNodes());else{const h=V(t);if(h===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),i),c=yo(e,l,a.isFullyInitialized(),a.isFiltered());else{const d=te(t),f=a.getNode().getImmediateChild(h);let p;if(B(d))p=i;else{const _=u.getCompleteChild(h);_!=null?ep(d)===".priority"&&_.getChild(yb(d)).isEmpty()?p=_:p=_.updateChild(d,i):p=D.EMPTY_NODE}if(f.equals(p))c=e;else{const _=n.filter.updateChild(a.getNode(),h,p,d,u,o);c=yo(e,_,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function T_(n,e){return n.eventCache.isCompleteForChild(e)}function RL(n,e,t,i,r,s,o){let a=e;return i.foreach((c,l)=>{const u=ae(t,c);T_(e,V(u))&&(a=Sd(n,a,u,l,r,s,o))}),i.foreach((c,l)=>{const u=ae(t,c);T_(e,V(u))||(a=Sd(n,a,u,l,r,s,o))}),a}function S_(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function Cd(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;B(t)?l=i:l=new ne(null).setTree(t,i);const u=e.serverCache.getNode();return l.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),p=S_(n,f,d);c=Jc(n,c,new Y(h),p,r,s,o,a)}}),l.children.inorderTraversal((h,d)=>{const f=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!f){const p=e.serverCache.getNode().getImmediateChild(h),_=S_(n,p,d);c=Jc(n,c,new Y(h),_,r,s,o,a)}}),c}function NL(n,e,t,i,r,s,o){if(Xc(r,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(B(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Jc(n,e,t,c.getNode().getChild(t),r,s,a,o);if(B(t)){let l=new ne(null);return c.getNode().forEachChild(cn,(u,h)=>{l=l.set(new Y(u),h)}),Cd(n,e,t,l,r,s,a,o)}else return e}else{let l=new ne(null);return i.foreach((u,h)=>{const d=ae(t,u);c.isCompleteForPath(d)&&(l=l.set(u,c.getNode().getChild(d)))}),Cd(n,e,t,l,r,s,a,o)}}function DL(n,e,t,i,r){const s=e.serverCache,o=Cb(e,s.getNode(),s.isFullyInitialized()||B(t),s.isFiltered());return xb(n,o,t,i,Pb,r)}function PL(n,e,t,i,r,s){let o;if(Xc(i,t)!=null)return e;{const a=new dp(i,e,r),c=e.eventCache.getNode();let l;if(B(t)||V(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Yc(i,cr(e));else{const h=e.serverCache.getNode();E(h instanceof D,"serverChildren would be complete if leaf node"),u=up(i,h)}u=u,l=n.filter.updateFullNode(c,u,s)}else{const u=V(t);let h=hp(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?l=n.filter.updateChild(c,u,h,te(t),a,s):e.eventCache.getNode().hasChild(u)?l=n.filter.updateChild(c,u,D.EMPTY_NODE,te(t),a,s):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Yc(i,cr(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||Xc(i,Q())!=null,yo(e,l,o,n.filter.filtersNodes())}}class xL{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,r=new op(i.getIndex()),s=HM(i);this.processor_=SL(s);const o=t.serverCache,a=t.eventCache,c=r.updateFullNode(D.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(D.EMPTY_NODE,a.getNode(),null),u=new ui(c,o.isFullyInitialized(),r.filtersNodes()),h=new ui(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=eu(h,u),this.eventGenerator_=new rL(this.query_)}get query(){return this.query_}}function OL(n){return n.viewCache_.serverCache.getNode()}function ML(n){return Qc(n.viewCache_)}function LL(n,e){const t=cr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!B(e)&&!t.getImmediateChild(V(e)).isEmpty())?t.getChild(e):null}function C_(n){return n.eventRegistrations_.length===0}function FL(n,e){n.eventRegistrations_.push(e)}function k_(n,e,t){const i=[];if(t){E(e==null,"A cancel should cancel all event registrations.");const r=n.query._path;n.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){const o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function A_(n,e,t,i){e.type===Gt.MERGE&&e.source.queryId!==null&&(E(cr(n.viewCache_),"We should always have a full cache before handling merges"),E(Qc(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,s=kL(n.processor_,r,e,t,i);return CL(n.processor_,s.viewCache),E(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,Ob(n,s.changes,s.viewCache.eventCache.getNode(),null)}function UL(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ie,(s,o)=>{i.push(os(s,o))}),t.isFullyInitialized()&&i.push(Sb(t.getNode())),Ob(n,i,t.getNode(),e)}function Ob(n,e,t,i){const r=i?[i]:n.eventRegistrations_;return sL(n.eventGenerator_,e,t,r)}let Zc;class Mb{constructor(){this.views=new Map}}function $L(n){E(!Zc,"__referenceConstructor has already been defined"),Zc=n}function VL(){return E(Zc,"Reference.ts has not been loaded"),Zc}function BL(n){return n.views.size===0}function fp(n,e,t,i){const r=e.source.queryId;if(r!==null){const s=n.views.get(r);return E(s!=null,"SyncTree gave us an op for an invalid query."),A_(s,e,t,i)}else{let s=[];for(const o of n.views.values())s=s.concat(A_(o,e,t,i));return s}}function Lb(n,e,t,i,r){const s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Yc(t,r?i:null),c=!1;a?c=!0:i instanceof D?(a=up(t,i),c=!1):(a=D.EMPTY_NODE,c=!1);const l=eu(new ui(a,c,!1),new ui(i,r,!1));return new xL(e,l)}return o}function qL(n,e,t,i,r,s){const o=Lb(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),FL(o,t),UL(o,t)}function jL(n,e,t,i){const r=e._queryIdentifier,s=[];let o=[];const a=hi(n);if(r==="default")for(const[c,l]of n.views.entries())o=o.concat(k_(l,t,i)),C_(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const c=n.views.get(r);c&&(o=o.concat(k_(c,t,i)),C_(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!hi(n)&&s.push(new(VL())(e._repo,e._path)),{removed:s,events:o}}function Fb(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function ti(n,e){let t=null;for(const i of n.views.values())t=t||LL(i,e);return t}function Ub(n,e){if(e._queryParams.loadsAllData())return nu(n);{const i=e._queryIdentifier;return n.views.get(i)}}function $b(n,e){return Ub(n,e)!=null}function hi(n){return nu(n)!=null}function nu(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let el;function WL(n){E(!el,"__referenceConstructor has already been defined"),el=n}function KL(){return E(el,"Reference.ts has not been loaded"),el}let GL=1;class R_{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ne(null),this.pendingWriteTree_=IL(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function pp(n,e,t,i,r){return lL(n.pendingWriteTree_,e,t,i,r),r?xs(n,new ar(ap(),e,t)):[]}function HL(n,e,t,i){uL(n.pendingWriteTree_,e,t,i);const r=ne.fromObject(t);return xs(n,new as(ap(),e,r))}function Jn(n,e,t=!1){const i=hL(n.pendingWriteTree_,e);if(dL(n.pendingWriteTree_,e)){let s=new ne(null);return i.snap!=null?s=s.set(Q(),!0):$e(i.children,o=>{s=s.set(new Y(o),!0)}),xs(n,new zc(i.path,s,t))}else return[]}function Ta(n,e,t){return xs(n,new ar(cp(),e,t))}function zL(n,e,t){const i=ne.fromObject(t);return xs(n,new as(cp(),e,i))}function QL(n,e){return xs(n,new Go(cp(),e))}function YL(n,e,t){const i=gp(n,t);if(i){const r=mp(i),s=r.path,o=r.queryId,a=ut(s,e),c=new Go(lp(o),a);return _p(n,s,c)}else return[]}function tl(n,e,t,i,r=!1){const s=e._path,o=n.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||$b(o,e))){const c=jL(o,e,t,i);BL(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));const l=c.removed;if(a=c.events,!r){const u=l.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(s,(d,f)=>hi(f));if(u&&!h){const d=n.syncPointTree_.subtree(s);if(!d.isEmpty()){const f=ZL(d);for(let p=0;p<f.length;++p){const _=f[p],w=_.query,N=jb(n,_);n.listenProvider_.startListening(wo(w),Ho(n,w),N.hashFn,N.onComplete)}}}!h&&l.length>0&&!i&&(u?n.listenProvider_.stopListening(wo(e),null):l.forEach(d=>{const f=n.queryToTagMap.get(ru(d));n.listenProvider_.stopListening(wo(d),f)}))}e1(n,l)}return a}function Vb(n,e,t,i){const r=gp(n,i);if(r!=null){const s=mp(r),o=s.path,a=s.queryId,c=ut(o,e),l=new ar(lp(a),c,t);return _p(n,o,l)}else return[]}function XL(n,e,t,i){const r=gp(n,i);if(r){const s=mp(r),o=s.path,a=s.queryId,c=ut(o,e),l=ne.fromObject(t),u=new as(lp(a),c,l);return _p(n,o,u)}else return[]}function kd(n,e,t,i=!1){const r=e._path;let s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(d,f)=>{const p=ut(d,r);s=s||ti(f,p),o=o||hi(f)});let a=n.syncPointTree_.get(r);a?(o=o||hi(a),s=s||ti(a,Q())):(a=new Mb,n.syncPointTree_=n.syncPointTree_.set(r,a));let c;s!=null?c=!0:(c=!1,s=D.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((f,p)=>{const _=ti(p,Q());_&&(s=s.updateImmediateChild(f,_))}));const l=$b(a,e);if(!l&&!e._queryParams.loadsAllData()){const d=ru(e);E(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");const f=t1();n.queryToTagMap.set(d,f),n.tagToQueryMap.set(f,d)}const u=tu(n.pendingWriteTree_,r);let h=qL(a,e,t,u,s,c);if(!l&&!o&&!i){const d=Ub(a,e);h=h.concat(n1(n,e,d))}return h}function iu(n,e,t){const r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=ut(o,e),l=ti(a,c);if(l)return l});return Rb(r,e,s,t,!0)}function JL(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(l,u)=>{const h=ut(l,t);i=i||ti(u,h)});let r=n.syncPointTree_.get(t);r?i=i||ti(r,Q()):(r=new Mb,n.syncPointTree_=n.syncPointTree_.set(t,r));const s=i!=null,o=s?new ui(i,!0,!1):null,a=tu(n.pendingWriteTree_,e._path),c=Lb(r,e,a,s?o.getNode():D.EMPTY_NODE,s);return ML(c)}function xs(n,e){return Bb(e,n.syncPointTree_,null,tu(n.pendingWriteTree_,Q()))}function Bb(n,e,t,i){if(B(n.path))return qb(n,e,t,i);{const r=e.get(Q());t==null&&r!=null&&(t=ti(r,Q()));let s=[];const o=V(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const l=t?t.getImmediateChild(o):null,u=Nb(i,o);s=s.concat(Bb(a,c,l,u))}return r&&(s=s.concat(fp(r,n,i,t))),s}}function qb(n,e,t,i){const r=e.get(Q());t==null&&r!=null&&(t=ti(r,Q()));let s=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,l=Nb(i,o),u=n.operationForChild(o);u&&(s=s.concat(qb(u,a,c,l)))}),r&&(s=s.concat(fp(r,n,i,t))),s}function jb(n,e){const t=e.query,i=Ho(n,t);return{hashFn:()=>(OL(e)||D.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?YL(n,t._path,i):QL(n,t._path);{const s=HO(r,t);return tl(n,t,null,s)}}}}function Ho(n,e){const t=ru(e);return n.queryToTagMap.get(t)}function ru(n){return n._path.toString()+"$"+n._queryIdentifier}function gp(n,e){return n.tagToQueryMap.get(e)}function mp(n){const e=n.indexOf("$");return E(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Y(n.substr(0,e))}}function _p(n,e,t){const i=n.syncPointTree_.get(e);E(i,"Missing sync point for query tag that we're tracking");const r=tu(n.pendingWriteTree_,e);return fp(i,t,r,null)}function ZL(n){return n.fold((e,t,i)=>{if(t&&hi(t))return[nu(t)];{let r=[];return t&&(r=Fb(t)),$e(i,(s,o)=>{r=r.concat(o)}),r}})}function wo(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(KL())(n._repo,n._path):n}function e1(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const r=ru(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function t1(){return GL++}function n1(n,e,t){const i=e._path,r=Ho(n,e),s=jb(n,t),o=n.listenProvider_.startListening(wo(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)E(!hi(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((l,u,h)=>{if(!B(l)&&u&&hi(u))return[nu(u).query];{let d=[];return u&&(d=d.concat(Fb(u).map(f=>f.query))),$e(h,(f,p)=>{d=d.concat(p)}),d}});for(let l=0;l<c.length;++l){const u=c[l];n.listenProvider_.stopListening(wo(u),Ho(n,u))}}return o}class yp{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new yp(t)}node(){return this.node_}}class vp{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ae(this.path_,e);return new vp(this.syncTree_,t)}node(){return iu(this.syncTree_,this.path_)}}const i1=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},N_=function(n,e,t){if(!n||typeof n!="object")return n;if(E(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return r1(n[".sv"],e,t);if(typeof n[".sv"]=="object")return s1(n[".sv"],e);E(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},r1=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:E(!1,"Unexpected server value: "+n)}},s1=function(n,e,t){n.hasOwnProperty("increment")||E(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&E(!1,"Unexpected increment value: "+i);const r=e.node();if(E(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return typeof o!="number"?i:o+i},Wb=function(n,e,t,i){return Ip(e,new vp(t,n),i)},wp=function(n,e,t){return Ip(n,new yp(e),t)};function Ip(n,e,t){const i=n.getPriority().val(),r=N_(i,e.getImmediateChild(".priority"),t);let s;if(n.isLeafNode()){const o=n,a=N_(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new Ne(a,ue(r)):n}else{const o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new Ne(r))),o.forEachChild(ie,(a,c)=>{const l=Ip(c,e.getImmediateChild(a),t);l!==c&&(s=s.updateImmediateChild(a,l))}),s}}class bp{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function su(n,e){let t=e instanceof Y?e:new Y(e),i=n,r=V(t);for(;r!==null;){const s=tr(i.node.children,r)||{children:{},childCount:0};i=new bp(r,i,s),t=te(t),r=V(t)}return i}function Ar(n){return n.node.value}function Ep(n,e){n.node.value=e,Ad(n)}function Kb(n){return n.node.childCount>0}function o1(n){return Ar(n)===void 0&&!Kb(n)}function ou(n,e){$e(n.node.children,(t,i)=>{e(new bp(t,n,i))})}function Gb(n,e,t,i){t&&!i&&e(n),ou(n,r=>{Gb(r,e,!0,i)}),t&&i&&e(n)}function a1(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Sa(n){return new Y(n.parent===null?n.name:Sa(n.parent)+"/"+n.name)}function Ad(n){n.parent!==null&&c1(n.parent,n.name,n)}function c1(n,e,t){const i=o1(t),r=Dt(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,Ad(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,Ad(n))}const l1=/[\[\].#$\/\u0000-\u001F\u007F]/,u1=/[\[\].#$\u0000-\u001F\u007F]/,bh=10*1024*1024,au=function(n){return typeof n=="string"&&n.length!==0&&!l1.test(n)},Hb=function(n){return typeof n=="string"&&n.length!==0&&!u1.test(n)},h1=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Hb(n)},zo=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Yl(n)||n&&typeof n=="object"&&Dt(n,".sv")},gn=function(n,e,t,i){i&&e===void 0||Ca(It(n,"value"),e,t)},Ca=function(n,e,t){const i=t instanceof Y?new kM(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+xi(i));if(typeof e=="function")throw new Error(n+"contains a function "+xi(i)+" with contents = "+e.toString());if(Yl(e))throw new Error(n+"contains "+e.toString()+" "+xi(i));if(typeof e=="string"&&e.length>bh/3&&Ol(e)>bh)throw new Error(n+"contains a string greater than "+bh+" utf8 bytes "+xi(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if($e(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!au(o)))throw new Error(n+" contains an invalid key ("+o+") "+xi(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);AM(i,o),Ca(n,a,i),RM(i)}),r&&s)throw new Error(n+' contains ".value" child '+xi(i)+" in addition to actual children.")}},d1=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const s=qo(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!au(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(CM);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&Ft(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},zb=function(n,e,t,i){if(i&&e===void 0)return;const r=It(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const s=[];$e(e,(o,a)=>{const c=new Y(o);if(Ca(r,a,ae(t,c)),ep(c)===".priority"&&!zo(a))throw new Error(r+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),d1(r,s)},Tp=function(n,e,t){if(!(t&&e===void 0)){if(Yl(e))throw new Error(It(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!zo(e))throw new Error(It(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ka=function(n,e,t,i){if(!(i&&t===void 0)&&!au(t))throw new Error(It(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Qo=function(n,e,t,i){if(!(i&&t===void 0)&&!Hb(t))throw new Error(It(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},f1=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Qo(n,e,t,i)},Ut=function(n,e){if(V(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Qb=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!au(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!h1(t))throw new Error(It(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class p1{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function cu(n,e){let t=null;for(let i=0;i<e.length;i++){const r=e[i],s=r.getPath();t!==null&&!tp(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function Yb(n,e,t){cu(n,t),Xb(n,i=>tp(i,e))}function Pt(n,e,t){cu(n,t),Xb(n,i=>Ft(i,e)||Ft(e,i))}function Xb(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const r=n.eventLists_[i];if(r){const s=r.path;e(s)?(g1(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function g1(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();Xi&&Me("event: "+t.toString()),Ds(i)}}}const Jb="repo_interrupt",m1=25;class _1{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new p1,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Hc(),this.transactionQueueTree_=new bp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function y1(n,e,t){if(n.stats_=Jf(n.repoInfo_),n.forceRestClient_||XO())n.server_=new Gc(n.repoInfo_,(i,r,s,o)=>{D_(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>P_(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ke(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Pn(n.repoInfo_,e,(i,r,s,o)=>{D_(n,i,r,s,o)},i=>{P_(n,i)},i=>{v1(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=nM(n.repoInfo_,()=>new iL(n.stats_,n.server_)),n.infoData_=new JM,n.infoSyncTree_=new R_({startListening:(i,r,s,o)=>{let a=[];const c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=Ta(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Sp(n,"connected",!1),n.serverSyncTree_=new R_({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{const l=o(a,c);Pt(n.eventQueue_,i._path,l)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function Zb(n){const t=n.infoData_.getNode(new Y(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Aa(n){return i1({timestamp:Zb(n)})}function D_(n,e,t,i,r){n.dataUpdateCount++;const s=new Y(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){const c=Pc(t,l=>ue(l));o=XL(n.serverSyncTree_,s,c,r)}else{const c=ue(t);o=Vb(n.serverSyncTree_,s,c,r)}else if(i){const c=Pc(t,l=>ue(l));o=zL(n.serverSyncTree_,s,c)}else{const c=ue(t);o=Ta(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=ls(n,s)),Pt(n.eventQueue_,a,o)}function P_(n,e){Sp(n,"connected",e),e===!1&&b1(n)}function v1(n,e){$e(e,(t,i)=>{Sp(n,t,i)})}function Sp(n,e,t){const i=new Y("/.info/"+e),r=ue(t);n.infoData_.updateSnapshot(i,r);const s=Ta(n.infoSyncTree_,i,r);Pt(n.eventQueue_,i,s)}function lu(n){return n.nextWriteId_++}function w1(n,e,t){const i=JL(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{const s=ue(r).withIndex(e._queryParams.getIndex());kd(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Ta(n.serverSyncTree_,e._path,s);else{const a=Ho(n.serverSyncTree_,e);o=Vb(n.serverSyncTree_,e._path,s,a)}return Pt(n.eventQueue_,e._path,o),tl(n.serverSyncTree_,e,t,null,!0),s},r=>(Os(n,"get for query "+ke(e)+" failed: "+r),Promise.reject(new Error(r))))}function Cp(n,e,t,i,r){Os(n,"set",{path:e.toString(),value:t,priority:i});const s=Aa(n),o=ue(t,i),a=iu(n.serverSyncTree_,e),c=wp(o,a,s),l=lu(n),u=pp(n.serverSyncTree_,e,c,l,!0);cu(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,f)=>{const p=d==="ok";p||nt("set at "+e+" failed: "+d);const _=Jn(n.serverSyncTree_,l,!p);Pt(n.eventQueue_,e,_),di(n,r,d,f)});const h=Ap(n,e);ls(n,h),Pt(n.eventQueue_,h,[])}function I1(n,e,t,i){Os(n,"update",{path:e.toString(),value:t});let r=!0;const s=Aa(n),o={};if($e(t,(a,c)=>{r=!1,o[a]=Wb(ae(e,a),ue(c),n.serverSyncTree_,s)}),r)Me("update() called with empty data.  Don't do anything."),di(n,i,"ok",void 0);else{const a=lu(n),c=HL(n.serverSyncTree_,e,o,a);cu(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,u)=>{const h=l==="ok";h||nt("update at "+e+" failed: "+l);const d=Jn(n.serverSyncTree_,a,!h),f=d.length>0?ls(n,e):e;Pt(n.eventQueue_,f,d),di(n,i,l,u)}),$e(t,l=>{const u=Ap(n,ae(e,l));ls(n,u)}),Pt(n.eventQueue_,e,[])}}function b1(n){Os(n,"onDisconnectEvents");const e=Aa(n),t=Hc();Id(n.onDisconnect_,Q(),(r,s)=>{const o=Wb(r,s,n.serverSyncTree_,e);Ps(t,r,o)});let i=[];Id(t,Q(),(r,s)=>{i=i.concat(Ta(n.serverSyncTree_,r,s));const o=Ap(n,r);ls(n,o)}),n.onDisconnect_=Hc(),Pt(n.eventQueue_,Q(),i)}function E1(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,r)=>{i==="ok"&&wd(n.onDisconnect_,e),di(n,t,i,r)})}function x_(n,e,t,i){const r=ue(t);n.server_.onDisconnectPut(e.toString(),r.val(!0),(s,o)=>{s==="ok"&&Ps(n.onDisconnect_,e,r),di(n,i,s,o)})}function T1(n,e,t,i,r){const s=ue(t,i);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Ps(n.onDisconnect_,e,s),di(n,r,o,a)})}function S1(n,e,t,i){if(Dc(t)){Me("onDisconnect().update() called with empty data.  Don't do anything."),di(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(r,s)=>{r==="ok"&&$e(t,(o,a)=>{const c=ue(a);Ps(n.onDisconnect_,ae(e,o),c)}),di(n,i,r,s)})}function C1(n,e,t){let i;V(e._path)===".info"?i=kd(n.infoSyncTree_,e,t):i=kd(n.serverSyncTree_,e,t),Yb(n.eventQueue_,e._path,i)}function Rd(n,e,t){let i;V(e._path)===".info"?i=tl(n.infoSyncTree_,e,t):i=tl(n.serverSyncTree_,e,t),Yb(n.eventQueue_,e._path,i)}function eE(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Jb)}function k1(n){n.persistentConnection_&&n.persistentConnection_.resume(Jb)}function Os(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Me(t,...e)}function di(n,e,t,i){e&&Ds(()=>{if(t==="ok")e(null);else{const r=(t||"error").toUpperCase();let s=r;i&&(s+=": "+i);const o=new Error(s);o.code=r,e(o)}})}function A1(n,e,t,i,r,s){Os(n,"transaction on "+e);const o={path:e,update:t,onComplete:i,status:null,order:QI(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=kp(n,e,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Ca("transaction failed: Data returned ",c,o.path),o.status=0;const l=su(n.transactionQueueTree_,e),u=Ar(l)||[];u.push(o),Ep(l,u);let h;typeof c=="object"&&c!==null&&Dt(c,".priority")?(h=tr(c,".priority"),E(zo(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(iu(n.serverSyncTree_,e)||D.EMPTY_NODE).getPriority().val();const d=Aa(n),f=ue(c,h),p=wp(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=p,o.currentWriteId=lu(n);const _=pp(n.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);Pt(n.eventQueue_,e,_),uu(n,n.transactionQueueTree_)}}function kp(n,e,t){return iu(n.serverSyncTree_,e,t)||D.EMPTY_NODE}function uu(n,e=n.transactionQueueTree_){if(e||hu(n,e),Ar(e)){const t=nE(n,e);E(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&R1(n,Sa(e),t)}else Kb(e)&&ou(e,t=>{uu(n,t)})}function R1(n,e,t){const i=t.map(l=>l.currentWriteId),r=kp(n,e,i);let s=r;const o=r.hash();for(let l=0;l<t.length;l++){const u=t[l];E(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=ut(e,u.path);s=s.updateChild(h,u.currentOutputSnapshotRaw)}const a=s.val(!0),c=e;n.server_.put(c.toString(),a,l=>{Os(n,"transaction put response",{path:c.toString(),status:l});let u=[];if(l==="ok"){const h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(Jn(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();hu(n,su(n.transactionQueueTree_,e)),uu(n,n.transactionQueueTree_),Pt(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)Ds(h[d])}else{if(l==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{nt("transaction at "+c.toString()+" failed: "+l);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=l}ls(n,e)}},o)}function ls(n,e){const t=tE(n,e),i=Sa(t),r=nE(n,t);return N1(n,r,i),i}function N1(n,e,t){if(e.length===0)return;const i=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],l=ut(t,c.path);let u=!1,h;if(E(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,r=r.concat(Jn(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=m1)u=!0,h="maxretry",r=r.concat(Jn(n.serverSyncTree_,c.currentWriteId,!0));else{const d=kp(n,c.path,o);c.currentInputSnapshot=d;const f=e[a].update(d.val());if(f!==void 0){Ca("transaction failed: Data returned ",f,c.path);let p=ue(f);typeof f=="object"&&f!=null&&Dt(f,".priority")||(p=p.updatePriority(d.getPriority()));const w=c.currentWriteId,N=Aa(n),M=wp(p,d,N);c.currentOutputSnapshotRaw=p,c.currentOutputSnapshotResolved=M,c.currentWriteId=lu(n),o.splice(o.indexOf(w),1),r=r.concat(pp(n.serverSyncTree_,c.path,M,c.currentWriteId,c.applyLocally)),r=r.concat(Jn(n.serverSyncTree_,w,!0))}else u=!0,h="nodata",r=r.concat(Jn(n.serverSyncTree_,c.currentWriteId,!0))}Pt(n.eventQueue_,t,r),r=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}hu(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Ds(i[a]);uu(n,n.transactionQueueTree_)}function tE(n,e){let t,i=n.transactionQueueTree_;for(t=V(e);t!==null&&Ar(i)===void 0;)i=su(i,t),e=te(e),t=V(e);return i}function nE(n,e){const t=[];return iE(n,e,t),t.sort((i,r)=>i.order-r.order),t}function iE(n,e,t){const i=Ar(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);ou(e,r=>{iE(n,r,t)})}function hu(n,e){const t=Ar(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,Ep(e,t.length>0?t:void 0)}ou(e,i=>{hu(n,i)})}function Ap(n,e){const t=Sa(tE(n,e)),i=su(n.transactionQueueTree_,e);return a1(i,r=>{Eh(n,r)}),Eh(n,i),Gb(i,r=>{Eh(n,r)}),t}function Eh(n,e){const t=Ar(e);if(t){const i=[];let r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(E(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(E(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Jn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Ep(e,void 0):t.length=s+1,Pt(n.eventQueue_,Sa(e),r);for(let o=0;o<i.length;o++)Ds(i[o])}}function D1(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function P1(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):nt(`Invalid query segment '${t}' in query '${n}'`)}return e}const Nd=function(n,e){const t=x1(n),i=t.namespace;t.domain==="firebase.com"&&pn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&pn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||qO();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new lb(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new Y(t.pathString)}},x1=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(r=D1(n.substring(u,h)));const d=P1(n.substring(Math.min(n.length,h)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;const f=e.slice(0,l);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),t=e.substring(p+1),s=i}"ns"in d&&(s=d.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};const O_="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",O1=function(){let n=0;const e=[];return function(t){const i=t===n;n=t;let r;const s=new Array(8);for(r=7;r>=0;r--)s[r]=O_.charAt(t%64),t=Math.floor(t/64);E(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=O_.charAt(e[r]);return E(o.length===20,"nextPushId: Length should be 20."),o}}();class rE{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ke(this.snapshot.exportVal())}}class sE{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Rp{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return E(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}let M1=class{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Ce;return E1(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ut("OnDisconnect.remove",this._path);const e=new Ce;return x_(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ut("OnDisconnect.set",this._path),gn("OnDisconnect.set",e,this._path,!1);const t=new Ce;return x_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ut("OnDisconnect.setWithPriority",this._path),gn("OnDisconnect.setWithPriority",e,this._path,!1),Tp("OnDisconnect.setWithPriority",t,!1);const i=new Ce;return T1(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){Ut("OnDisconnect.update",this._path),zb("OnDisconnect.update",e,this._path,!1);const t=new Ce;return S1(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};class Tt{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return B(this._path)?null:ep(this._path)}get ref(){return new jt(this._repo,this._path)}get _queryIdentifier(){const e=v_(this._queryParams),t=Yf(e);return t==="{}"?"default":t}get _queryObject(){return v_(this._queryParams)}isEqual(e){if(e=v(e),!(e instanceof Tt))return!1;const t=this._repo===e._repo,i=tp(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+SM(this._path)}}function du(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function bi(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===cn){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==ci)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==Mn)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===ie){if(e!=null&&!zo(e)||t!=null&&!zo(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(E(n.getIndex()instanceof rp||n.getIndex()===sp,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function fu(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class jt extends Tt{constructor(e,t){super(e,t,new Jl,!1)}get parent(){const e=yb(this._path);return e===null?null:new jt(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}let us=class{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Y(e),i=lr(this.ref,e);return new us(this._node.getChild(t),i,ie)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new us(r,lr(this.ref,i),ie)))}hasChild(e){const t=new Y(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function oE(n,e){return n=v(n),n._checkNotDeleted("ref"),e!==void 0?lr(n._root,e):n._root}function M_(n,e){n=v(n),n._checkNotDeleted("refFromURL");const t=Nd(e,n._repo.repoInfo_.nodeAdmin);Qb("refFromURL",t);const i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&pn("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),oE(n,t.path.toString())}function lr(n,e){return n=v(n),V(n._path)===null?f1("child","path",e,!1):Qo("child","path",e,!1),new jt(n._repo,ae(n._path,e))}function L1(n,e){n=v(n),Ut("push",n._path),gn("push",e,n._path,!0);const t=Zb(n._repo),i=O1(t),r=lr(n,i),s=lr(n,i);let o;return e!=null?o=Np(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function F1(n){return Ut("remove",n._path),Np(n,null)}function Np(n,e){n=v(n),Ut("set",n._path),gn("set",e,n._path,!1);const t=new Ce;return Cp(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function U1(n,e){n=v(n),Ut("setPriority",n._path),Tp("setPriority",e,!1);const t=new Ce;return Cp(n._repo,ae(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function $1(n,e,t){if(Ut("setWithPriority",n._path),gn("setWithPriority",e,n._path,!1),Tp("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new Ce;return Cp(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function V1(n,e){zb("update",e,n._path,!1);const t=new Ce;return I1(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function B1(n){n=v(n);const e=new Rp(()=>{}),t=new Ra(e);return w1(n._repo,n,t).then(i=>new us(i,new jt(n._repo,n._path),n._queryParams.getIndex()))}class Ra{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new rE("value",this,new us(e.snapshotNode,new jt(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sE(this,e,t):null}matches(e){return e instanceof Ra?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class pu{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sE(this,e,t):null}createEvent(e,t){E(e.childName!=null,"Child events should have a childName.");const i=lr(new jt(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new rE(e.type,this,new us(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof pu?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Na(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){const c=t,l=(u,h)=>{Rd(n._repo,n,a),c(u,h)};l.userCallback=t.userCallback,l.context=t.context,t=l}const o=new Rp(t,s||void 0),a=e==="value"?new Ra(o):new pu(e,o);return C1(n._repo,n,a),()=>Rd(n._repo,n,a)}function Dd(n,e,t,i){return Na(n,"value",e,t,i)}function L_(n,e,t,i){return Na(n,"child_added",e,t,i)}function F_(n,e,t,i){return Na(n,"child_changed",e,t,i)}function U_(n,e,t,i){return Na(n,"child_moved",e,t,i)}function $_(n,e,t,i){return Na(n,"child_removed",e,t,i)}function V_(n,e,t){let i=null;const r=t?new Rp(t):null;e==="value"?i=new Ra(r):e&&(i=new pu(e,r)),Rd(n._repo,n,i)}class Yt{}class aE extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){gn("endAt",this._value,e._path,!0);const t=vd(e._queryParams,this._value,this._key);if(fu(t),bi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Tt(e._repo,e._path,t,e._orderByCalled)}}function q1(n,e){return ka("endAt","key",e,!0),new aE(n,e)}class j1 extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){gn("endBefore",this._value,e._path,!1);const t=XM(e._queryParams,this._value,this._key);if(fu(t),bi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Tt(e._repo,e._path,t,e._orderByCalled)}}function W1(n,e){return ka("endBefore","key",e,!0),new j1(n,e)}class cE extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){gn("startAt",this._value,e._path,!0);const t=yd(e._queryParams,this._value,this._key);if(fu(t),bi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Tt(e._repo,e._path,t,e._orderByCalled)}}function K1(n=null,e){return ka("startAt","key",e,!0),new cE(n,e)}class G1 extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){gn("startAfter",this._value,e._path,!1);const t=YM(e._queryParams,this._value,this._key);if(fu(t),bi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Tt(e._repo,e._path,t,e._orderByCalled)}}function H1(n,e){return ka("startAfter","key",e,!0),new G1(n,e)}class z1 extends Yt{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Tt(e._repo,e._path,zM(e._queryParams,this._limit),e._orderByCalled)}}function Q1(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new z1(n)}class Y1 extends Yt{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Tt(e._repo,e._path,QM(e._queryParams,this._limit),e._orderByCalled)}}function X1(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Y1(n)}class J1 extends Yt{constructor(e){super(),this._path=e}_apply(e){du(e,"orderByChild");const t=new Y(this._path);if(B(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new rp(t),r=Zl(e._queryParams,i);return bi(r),new Tt(e._repo,e._path,r,!0)}}function Z1(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Qo("orderByChild","path",n,!1),new J1(n)}class eF extends Yt{_apply(e){du(e,"orderByKey");const t=Zl(e._queryParams,cn);return bi(t),new Tt(e._repo,e._path,t,!0)}}function tF(){return new eF}class nF extends Yt{_apply(e){du(e,"orderByPriority");const t=Zl(e._queryParams,ie);return bi(t),new Tt(e._repo,e._path,t,!0)}}function iF(){return new nF}class rF extends Yt{_apply(e){du(e,"orderByValue");const t=Zl(e._queryParams,sp);return bi(t),new Tt(e._repo,e._path,t,!0)}}function sF(){return new rF}class oF extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(gn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new aE(this._value,this._key)._apply(new cE(this._value,this._key)._apply(e))}}function aF(n,e){return ka("equalTo","key",e,!0),new oF(n,e)}function Wt(n,...e){let t=v(n);for(const i of e)t=i._apply(t);return t}$L(jt);WL(jt);const cF="FIREBASE_DATABASE_EMULATOR_HOST",Pd={};let lF=!1;function uF(n,e,t,i){n.repoInfo_=new lb(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams),i&&(n.authTokenProvider_=i)}function lE(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||pn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Me("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Nd(s,r),a=o.repoInfo,c,l;typeof process<"u"&&process.env&&(l=process.env[cF]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=Nd(s,r),a=o.repoInfo):c=!o.repoInfo.secure;const u=r&&c?new Xr(Xr.OWNER):new ZO(n.name,n.options,e);Qb("Invalid Firebase Database URL",o),B(o.path)||pn("Database URL must point to the root of a Firebase Database (not including a child path).");const h=dF(a,n,u,new JO(n.name,t));return new fF(h,n)}function hF(n,e){const t=Pd[e];(!t||t[n.key]!==n)&&pn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),eE(n),delete t[n.key]}function dF(n,e,t,i){let r=Pd[e.name];r||(r={},Pd[e.name]=r);let s=r[n.toURLString()];return s&&pn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new _1(n,lF,t,i),r[n.toURLString()]=s,s}let fF=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(y1(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new jt(this._repo,Q())),this._rootInternal}_delete(){return this._rootInternal!==null&&(hF(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&pn("Cannot call "+e+" on a deleted database.")}};function uE(){ss.IS_TRANSPORT_INITIALIZED&&nt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function pF(){uE(),Xn.forceDisallow()}function gF(){uE(),Mt.forceDisallow(),Xn.forceAllow()}function mF(n,e,t,i={}){n=v(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&pn("Cannot call useEmulator() after instance has already been initialized.");const r=n._repoInternal;let s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&pn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Xr(Xr.OWNER);else if(i.mockUserToken){const o=typeof i.mockUserToken=="string"?i.mockUserToken:yf(i.mockUserToken,n.app.options.projectId);s=new Xr(o)}uF(r,e,t,s)}function _F(n){n=v(n),n._checkNotDeleted("goOffline"),eE(n._repo)}function yF(n){n=v(n),n._checkNotDeleted("goOnline"),k1(n._repo)}function vF(n,e){XI(n,e)}function wF(n){HI(wn),ge(new H("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return lE(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Z(n_,i_,n),Z(n_,i_,"esm2017")}const IF={".sv":"timestamp"};function bF(){return IF}function EF(n){return{".sv":{increment:n}}}let TF=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function SF(n,e,t){var i;if(n=v(n),Ut("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(i=t==null?void 0:t.applyLocally)!==null&&i!==void 0?i:!0,s=new Ce,o=(c,l,u)=>{let h=null;c?s.reject(c):(h=new us(u,new jt(n._repo,n._path),ie),s.resolve(new TF(l,h)))},a=Dd(n,()=>{});return A1(n._repo,n._path,e,o,a,r),s.promise}Pn.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Pn.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};wF();const CF="@firebase/database-compat",kF="0.3.0";const AF=new vn("@firebase/database-compat"),hE=function(n){const e="FIREBASE WARNING: "+n;AF.warn(e)};const RF=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(It(n,e)+"must be a boolean.")},NF=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(It(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};class DF{constructor(e){this._delegate=e}cancel(e){P("OnDisconnect.cancel",0,1,arguments.length),Pe("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){P("OnDisconnect.remove",0,1,arguments.length),Pe("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){P("OnDisconnect.set",1,2,arguments.length),Pe("OnDisconnect.set","onComplete",t,!0);const i=this._delegate.set(e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){P("OnDisconnect.setWithPriority",2,3,arguments.length),Pe("OnDisconnect.setWithPriority","onComplete",i,!0);const r=this._delegate.setWithPriority(e,t);return i&&r.then(()=>i(null),s=>i(s)),r}update(e,t){if(P("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,hE("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Pe("OnDisconnect.update","onComplete",t,!0);const i=this._delegate.update(e);return t&&i.then(()=>t(null),r=>t(r)),i}}class PF{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return P("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class ni{constructor(e,t){this._database=e,this._delegate=t}val(){return P("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return P("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return P("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return P("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return P("DataSnapshot.child",0,1,arguments.length),e=String(e),Qo("DataSnapshot.child","path",e,!1),new ni(this._database,this._delegate.child(e))}hasChild(e){return P("DataSnapshot.hasChild",1,1,arguments.length),Qo("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return P("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return P("DataSnapshot.forEach",1,1,arguments.length),Pe("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new ni(this._database,t)))}hasChildren(){return P("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return P("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return P("DataSnapshot.ref",0,0,arguments.length),new Lt(this._database,this._delegate.ref)}get ref(){return this.getRef()}}let Ze=class{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,r){var s;P("Query.on",2,4,arguments.length),Pe("Query.on","callback",t,!1);const o=Ze.getCancelAndContextArgs_("Query.on",i,r),a=(l,u)=>{t.call(o.context,new ni(this.database,l),u)};a.userCallback=t,a.context=o.context;const c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return Dd(this._delegate,a,c),t;case"child_added":return L_(this._delegate,a,c),t;case"child_removed":return $_(this._delegate,a,c),t;case"child_changed":return F_(this._delegate,a,c),t;case"child_moved":return U_(this._delegate,a,c),t;default:throw new Error(It("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(P("Query.off",0,3,arguments.length),NF("Query.off",e,!0),Pe("Query.off","callback",t,!0),_m("Query.off","context",i,!0),t){const r=()=>{};r.userCallback=t,r.context=i,V_(this._delegate,e,r)}else V_(this._delegate,e)}get(){return B1(this._delegate).then(e=>new ni(this.database,e))}once(e,t,i,r){P("Query.once",1,4,arguments.length),Pe("Query.once","callback",t,!0);const s=Ze.getCancelAndContextArgs_("Query.once",i,r),o=new Ce,a=(l,u)=>{const h=new ni(this.database,l);t&&t.call(s.context,h,u),o.resolve(h)};a.userCallback=t,a.context=s.context;const c=l=>{s.cancel&&s.cancel.call(s.context,l),o.reject(l)};switch(e){case"value":Dd(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":L_(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":$_(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":F_(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":U_(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(It("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return P("Query.limitToFirst",1,1,arguments.length),new Ze(this.database,Wt(this._delegate,Q1(e)))}limitToLast(e){return P("Query.limitToLast",1,1,arguments.length),new Ze(this.database,Wt(this._delegate,X1(e)))}orderByChild(e){return P("Query.orderByChild",1,1,arguments.length),new Ze(this.database,Wt(this._delegate,Z1(e)))}orderByKey(){return P("Query.orderByKey",0,0,arguments.length),new Ze(this.database,Wt(this._delegate,tF()))}orderByPriority(){return P("Query.orderByPriority",0,0,arguments.length),new Ze(this.database,Wt(this._delegate,iF()))}orderByValue(){return P("Query.orderByValue",0,0,arguments.length),new Ze(this.database,Wt(this._delegate,sF()))}startAt(e=null,t){return P("Query.startAt",0,2,arguments.length),new Ze(this.database,Wt(this._delegate,K1(e,t)))}startAfter(e=null,t){return P("Query.startAfter",0,2,arguments.length),new Ze(this.database,Wt(this._delegate,H1(e,t)))}endAt(e=null,t){return P("Query.endAt",0,2,arguments.length),new Ze(this.database,Wt(this._delegate,q1(e,t)))}endBefore(e=null,t){return P("Query.endBefore",0,2,arguments.length),new Ze(this.database,Wt(this._delegate,W1(e,t)))}equalTo(e,t){return P("Query.equalTo",1,2,arguments.length),new Ze(this.database,Wt(this._delegate,aF(e,t)))}toString(){return P("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return P("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(P("Query.isEqual",1,1,arguments.length),!(e instanceof Ze)){const t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){const r={cancel:void 0,context:void 0};if(t&&i)r.cancel=t,Pe(e,"cancel",r.cancel,!0),r.context=i,_m(e,"context",r.context,!0);else if(t)if(typeof t=="object"&&t!==null)r.context=t;else if(typeof t=="function")r.cancel=t;else throw new Error(It(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return r}get ref(){return new Lt(this.database,new jt(this._delegate._repo,this._delegate._path))}},Lt=class extends Ze{constructor(e,t){super(e,new Tt(t._repo,t._path,new Jl,!1)),this.database=e,this._delegate=t}getKey(){return P("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return P("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new Lt(this.database,lr(this._delegate,e))}getParent(){P("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new Lt(this.database,e):null}getRoot(){return P("Reference.root",0,0,arguments.length),new Lt(this.database,this._delegate.root)}set(e,t){P("Reference.set",1,2,arguments.length),Pe("Reference.set","onComplete",t,!0);const i=Np(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}update(e,t){if(P("Reference.update",1,2,arguments.length),Array.isArray(e)){const r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,hE("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ut("Reference.update",this._delegate._path),Pe("Reference.update","onComplete",t,!0);const i=V1(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){P("Reference.setWithPriority",2,3,arguments.length),Pe("Reference.setWithPriority","onComplete",i,!0);const r=$1(this._delegate,e,t);return i&&r.then(()=>i(null),s=>i(s)),r}remove(e){P("Reference.remove",0,1,arguments.length),Pe("Reference.remove","onComplete",e,!0);const t=F1(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){P("Reference.transaction",1,3,arguments.length),Pe("Reference.transaction","transactionUpdate",e,!1),Pe("Reference.transaction","onComplete",t,!0),RF("Reference.transaction","applyLocally",i,!0);const r=SF(this._delegate,e,{applyLocally:i}).then(s=>new PF(s.committed,new ni(this.database,s.snapshot)));return t&&r.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),r}setPriority(e,t){P("Reference.setPriority",1,2,arguments.length),Pe("Reference.setPriority","onComplete",t,!0);const i=U1(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}push(e,t){P("Reference.push",0,2,arguments.length),Pe("Reference.push","onComplete",t,!0);const i=L1(this._delegate,e),r=i.then(o=>new Lt(this.database,o));t&&r.then(()=>t(null),o=>t(o));const s=new Lt(this.database,i);return s.then=r.then.bind(r),s.catch=r.catch.bind(r,void 0),s}onDisconnect(){return Ut("Reference.onDisconnect",this._delegate._path),new DF(new M1(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};class Yo{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:pF,forceLongPolling:gF}}useEmulator(e,t,i={}){mF(this._delegate,e,t,i)}ref(e){if(P("database.ref",0,1,arguments.length),e instanceof Lt){const t=M_(this._delegate,e.toString());return new Lt(this,t)}else{const t=oE(this._delegate,e);return new Lt(this,t)}}refFromURL(e){P("database.refFromURL",1,1,arguments.length);const i=M_(this._delegate,e);return new Lt(this,i)}goOffline(){return P("database.goOffline",0,0,arguments.length),_F(this._delegate)}goOnline(){return P("database.goOnline",0,0,arguments.length),yF(this._delegate)}}Yo.ServerValue={TIMESTAMP:bF(),increment:n=>EF(n)};function xF({app:n,url:e,version:t,customAuthImpl:i,namespace:r,nodeAdmin:s=!1}){HI(t);const o=new Yv("auth-internal",new Xv("database-standalone"));return o.setComponent(new H("auth-internal",()=>i,"PRIVATE")),{instance:new Yo(lE(n,o,void 0,e,s),n),namespace:r}}var OF=Object.freeze({__proto__:null,initStandalone:xF});const MF=Yo.ServerValue;function LF(n){n.INTERNAL.registerComponent(new H("database-compat",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new Yo(r,i)},"PUBLIC").setServiceProps({Reference:Lt,Query:Ze,Database:Yo,DataSnapshot:ni,enableLogging:vF,INTERNAL:OF,ServerValue:MF}).setMultipleInstances(!0)),n.registerVersion(CF,kF)}LF(Te);var FF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},k,Dp=Dp||{},O=FF||self;function nl(){}function gu(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Da(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function UF(n){return Object.prototype.hasOwnProperty.call(n,Th)&&n[Th]||(n[Th]=++$F)}var Th="closure_uid_"+(1e9*Math.random()>>>0),$F=0;function VF(n,e,t){return n.call.apply(n.bind,arguments)}function BF(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function it(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?it=VF:it=BF,it.apply(null,arguments)}function rc(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Je(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(i,r,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(i,o)}}function Ei(){this.s=this.s,this.o=this.o}var qF=0;Ei.prototype.s=!1;Ei.prototype.na=function(){!this.s&&(this.s=!0,this.M(),qF!=0)&&UF(this)};Ei.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const dE=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Pp(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function B_(n,e){for(let t=1;t<arguments.length;t++){const i=arguments[t];if(gu(i)){const r=n.length||0,s=i.length||0;n.length=r+s;for(let o=0;o<s;o++)n[r+o]=i[o]}else n.push(i)}}function rt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}rt.prototype.h=function(){this.defaultPrevented=!0};var jF=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{O.addEventListener("test",nl,e),O.removeEventListener("test",nl,e)}catch{}return n}();function il(n){return/^[\s\xa0]*$/.test(n)}var q_=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Sh(n,e){return n<e?-1:n>e?1:0}function mu(){var n=O.navigator;return n&&(n=n.userAgent)?n:""}function tn(n){return mu().indexOf(n)!=-1}function xp(n){return xp[" "](n),n}xp[" "]=nl;function WF(n){var e=HF;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}var KF=tn("Opera"),hs=tn("Trident")||tn("MSIE"),fE=tn("Edge"),xd=fE||hs,pE=tn("Gecko")&&!(mu().toLowerCase().indexOf("webkit")!=-1&&!tn("Edge"))&&!(tn("Trident")||tn("MSIE"))&&!tn("Edge"),GF=mu().toLowerCase().indexOf("webkit")!=-1&&!tn("Edge");function gE(){var n=O.document;return n?n.documentMode:void 0}var rl;e:{var Ch="",kh=function(){var n=mu();if(pE)return/rv:([^\);]+)(\)|;)/.exec(n);if(fE)return/Edge\/([\d\.]+)/.exec(n);if(hs)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(GF)return/WebKit\/(\S+)/.exec(n);if(KF)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(kh&&(Ch=kh?kh[1]:""),hs){var Ah=gE();if(Ah!=null&&Ah>parseFloat(Ch)){rl=String(Ah);break e}}rl=Ch}var HF={};function zF(){return WF(function(){let n=0;const e=q_(String(rl)).split("."),t=q_("9").split("."),i=Math.max(e.length,t.length);for(let o=0;n==0&&o<i;o++){var r=e[o]||"",s=t[o]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r[0].length==0&&s[0].length==0)break;n=Sh(r[1].length==0?0:parseInt(r[1],10),s[1].length==0?0:parseInt(s[1],10))||Sh(r[2].length==0,s[2].length==0)||Sh(r[2],s[2]),r=r[3],s=s[3]}while(n==0)}return 0<=n})}var Od;if(O.document&&hs){var j_=gE();Od=j_||parseInt(rl,10)||void 0}else Od=void 0;var QF=Od;function Xo(n,e){if(rt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(pE){e:{try{xp(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:YF[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Xo.X.h.call(this)}}Je(Xo,rt);var YF={2:"touch",3:"pen",4:"mouse"};Xo.prototype.h=function(){Xo.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Pa="closure_listenable_"+(1e6*Math.random()|0),XF=0;function JF(n,e,t,i,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.ha=r,this.key=++XF,this.ba=this.ea=!1}function _u(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function Op(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function mE(n){const e={};for(const t in n)e[t]=n[t];return e}const W_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _E(n,e){let t,i;for(let r=1;r<arguments.length;r++){i=arguments[r];for(t in i)n[t]=i[t];for(let s=0;s<W_.length;s++)t=W_[s],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function yu(n){this.src=n,this.g={},this.h=0}yu.prototype.add=function(n,e,t,i,r){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Ld(n,e,i,r);return-1<o?(e=n[o],t||(e.ea=!1)):(e=new JF(e,this.src,s,!!i,r),e.ea=t,n.push(e)),e};function Md(n,e){var t=e.type;if(t in n.g){var i=n.g[t],r=dE(i,e),s;(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(_u(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Ld(n,e,t,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.ba&&s.listener==e&&s.capture==!!t&&s.ha==i)return r}return-1}var Mp="closure_lm_"+(1e6*Math.random()|0),Rh={};function yE(n,e,t,i,r){if(i&&i.once)return wE(n,e,t,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)yE(n,e[s],t,i,r);return null}return t=Up(t),n&&n[Pa]?n.N(e,t,Da(i)?!!i.capture:!!i,r):vE(n,e,t,!1,i,r)}function vE(n,e,t,i,r,s){if(!e)throw Error("Invalid event type");var o=Da(r)?!!r.capture:!!r,a=Fp(n);if(a||(n[Mp]=a=new yu(n)),t=a.add(e,t,i,o,s),t.proxy)return t;if(i=ZF(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)jF||(r=o),r===void 0&&(r=!1),n.addEventListener(e.toString(),i,r);else if(n.attachEvent)n.attachEvent(bE(e.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return t}function ZF(){function n(t){return e.call(n.src,n.listener,t)}const e=eU;return n}function wE(n,e,t,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)wE(n,e[s],t,i,r);return null}return t=Up(t),n&&n[Pa]?n.O(e,t,Da(i)?!!i.capture:!!i,r):vE(n,e,t,!0,i,r)}function IE(n,e,t,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)IE(n,e[s],t,i,r);else i=Da(i)?!!i.capture:!!i,t=Up(t),n&&n[Pa]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Ld(s,t,i,r),-1<t&&(_u(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Fp(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ld(e,t,i,r)),(t=-1<n?e[n]:null)&&Lp(t))}function Lp(n){if(typeof n!="number"&&n&&!n.ba){var e=n.src;if(e&&e[Pa])Md(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(bE(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=Fp(e))?(Md(t,n),t.h==0&&(t.src=null,e[Mp]=null)):_u(n)}}}function bE(n){return n in Rh?Rh[n]:Rh[n]="on"+n}function eU(n,e){if(n.ba)n=!0;else{e=new Xo(e,this);var t=n.listener,i=n.ha||n.src;n.ea&&Lp(n),n=t.call(i,e)}return n}function Fp(n){return n=n[Mp],n instanceof yu?n:null}var Nh="__closure_events_fn_"+(1e9*Math.random()>>>0);function Up(n){return typeof n=="function"?n:(n[Nh]||(n[Nh]=function(e){return n.handleEvent(e)}),n[Nh])}function Ve(){Ei.call(this),this.i=new yu(this),this.P=this,this.I=null}Je(Ve,Ei);Ve.prototype[Pa]=!0;Ve.prototype.removeEventListener=function(n,e,t,i){IE(this,n,e,t,i)};function ze(n,e){var t,i=n.I;if(i)for(t=[];i;i=i.I)t.push(i);if(n=n.P,i=e.type||e,typeof e=="string")e=new rt(e,n);else if(e instanceof rt)e.target=e.target||n;else{var r=e;e=new rt(i,n),_E(e,r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];r=sc(o,i,!0,e)&&r}if(o=e.g=n,r=sc(o,i,!0,e)&&r,r=sc(o,i,!1,e)&&r,t)for(s=0;s<t.length;s++)o=e.g=t[s],r=sc(o,i,!1,e)&&r}Ve.prototype.M=function(){if(Ve.X.M.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)_u(t[i]);delete n.g[e],n.h--}}this.I=null};Ve.prototype.N=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)};Ve.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};function sc(n,e,t,i){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.ba&&o.capture==t){var a=o.listener,c=o.ha||o.src;o.ea&&Md(n.i,o),r=a.call(c,i)!==!1&&r}}return r&&!i.defaultPrevented}var $p=O.JSON.stringify;function tU(){var n=SE;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class nU{constructor(){this.h=this.g=null}add(e,t){const i=EE.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}}var EE=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new iU,n=>n.reset());class iU{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function rU(n){O.setTimeout(()=>{throw n},0)}function TE(n,e){Fd||sU(),Ud||(Fd(),Ud=!0),SE.add(n,e)}var Fd;function sU(){var n=O.Promise.resolve(void 0);Fd=function(){n.then(oU)}}var Ud=!1,SE=new nU;function oU(){for(var n;n=tU();){try{n.h.call(n.g)}catch(t){rU(t)}var e=EE;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Ud=!1}function vu(n,e){Ve.call(this),this.h=n||1,this.g=e||O,this.j=it(this.lb,this),this.l=Date.now()}Je(vu,Ve);k=vu.prototype;k.ca=!1;k.R=null;k.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),ze(this,"tick"),this.ca&&(Vp(this),this.start()))}};k.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Vp(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}k.M=function(){vu.X.M.call(this),Vp(this),delete this.g};function Bp(n,e,t){if(typeof n=="function")t&&(n=it(n,t));else if(n&&typeof n.handleEvent=="function")n=it(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:O.setTimeout(n,e||0)}function CE(n){n.g=Bp(()=>{n.g=null,n.i&&(n.i=!1,CE(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class aU extends Ei{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:CE(this)}M(){super.M(),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jo(n){Ei.call(this),this.h=n,this.g={}}Je(Jo,Ei);var K_=[];function kE(n,e,t,i){Array.isArray(t)||(t&&(K_[0]=t.toString()),t=K_);for(var r=0;r<t.length;r++){var s=yE(e,t[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function AE(n){Op(n.g,function(e,t){this.g.hasOwnProperty(t)&&Lp(e)},n),n.g={}}Jo.prototype.M=function(){Jo.X.M.call(this),AE(this)};Jo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function wu(){this.g=!0}wu.prototype.Aa=function(){this.g=!1};function cU(n,e,t,i,r,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+l+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+`
`+t+`
`+o})}function lU(n,e,t,i,r,s,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+`
`+t+`
`+s+" "+o})}function Kr(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+hU(n,t)+(i?" "+i:"")})}function uU(n,e){n.info(function(){return"TIMEOUT: "+e})}wu.prototype.info=function(){};function hU(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return $p(t)}catch{return e}}var Rr={},G_=null;function Iu(){return G_=G_||new Ve}Rr.Pa="serverreachability";function RE(n){rt.call(this,Rr.Pa,n)}Je(RE,rt);function Zo(n){const e=Iu();ze(e,new RE(e))}Rr.STAT_EVENT="statevent";function NE(n,e){rt.call(this,Rr.STAT_EVENT,n),this.stat=e}Je(NE,rt);function ht(n){const e=Iu();ze(e,new NE(e,n))}Rr.Qa="timingevent";function DE(n,e){rt.call(this,Rr.Qa,n),this.size=e}Je(DE,rt);function xa(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){n()},e)}var bu={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},PE={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function qp(){}qp.prototype.h=null;function H_(n){return n.h||(n.h=n.i())}function xE(){}var Oa={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function jp(){rt.call(this,"d")}Je(jp,rt);function Wp(){rt.call(this,"c")}Je(Wp,rt);var $d;function Eu(){}Je(Eu,qp);Eu.prototype.g=function(){return new XMLHttpRequest};Eu.prototype.i=function(){return{}};$d=new Eu;function Ma(n,e,t,i){this.l=n,this.j=e,this.m=t,this.U=i||1,this.S=new Jo(this),this.O=dU,n=xd?125:void 0,this.T=new vu(n),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new OE}function OE(){this.i=null,this.g="",this.h=!1}var dU=45e3,Vd={},sl={};k=Ma.prototype;k.setTimeout=function(n){this.O=n};function Bd(n,e,t){n.K=1,n.v=Su(Ln(e)),n.s=t,n.P=!0,ME(n,null)}function ME(n,e){n.F=Date.now(),La(n),n.A=Ln(n.v);var t=n.A,i=n.U;Array.isArray(i)||(i=[String(i)]),jE(t.i,"t",i),n.C=0,t=n.l.H,n.h=new OE,n.g=uT(n.l,t?e:null,!n.s),0<n.N&&(n.L=new aU(it(n.La,n,n.g),n.N)),kE(n.S,n.g,"readystatechange",n.ib),e=n.H?mE(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Zo(),cU(n.j,n.u,n.A,n.m,n.U,n.s)}k.ib=function(n){n=n.target;const e=this.L;e&&kn(n)==3?e.l():this.La(n)};k.La=function(n){try{if(n==this.g)e:{const u=kn(this.g);var e=this.g.Ea();const h=this.g.aa();if(!(3>u)&&(u!=3||xd||this.g&&(this.h.h||this.g.fa()||X_(this.g)))){this.I||u!=4||e==7||(e==8||0>=h?Zo(3):Zo(2)),Tu(this);var t=this.g.aa();this.Y=t;t:if(LE(this)){var i=X_(this.g);n="";var r=i.length,s=kn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Wi(this),Io(this);var o="";break t}this.h.i=new O.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=t==200,lU(this.j,this.u,this.A,this.m,this.U,u,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!il(a)){var l=a;break t}}l=null}if(t=l)Kr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,qd(this,t);else{this.i=!1,this.o=3,ht(12),Wi(this),Io(this);break e}}this.P?(FE(this,u,o),xd&&this.i&&u==3&&(kE(this.S,this.T,"tick",this.hb),this.T.start())):(Kr(this.j,this.m,o,null),qd(this,o)),u==4&&Wi(this),this.i&&!this.I&&(u==4?oT(this.l,this):(this.i=!1,La(this)))}else t==400&&0<o.indexOf("Unknown SID")?(this.o=3,ht(12)):(this.o=0,ht(13)),Wi(this),Io(this)}}}catch{}finally{}};function LE(n){return n.g?n.u=="GET"&&n.K!=2&&n.l.Da:!1}function FE(n,e,t){let i=!0,r;for(;!n.I&&n.C<t.length;)if(r=fU(n,t),r==sl){e==4&&(n.o=4,ht(14),i=!1),Kr(n.j,n.m,null,"[Incomplete Response]");break}else if(r==Vd){n.o=4,ht(15),Kr(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}else Kr(n.j,n.m,r,null),qd(n,r);LE(n)&&r!=sl&&r!=Vd&&(n.h.g="",n.C=0),e!=4||t.length!=0||n.h.h||(n.o=1,ht(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.$&&(n.$=!0,e=n.l,e.g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Xp(e),e.K=!0,ht(11))):(Kr(n.j,n.m,t,"[Invalid Chunked Response]"),Wi(n),Io(n))}k.hb=function(){if(this.g){var n=kn(this.g),e=this.g.fa();this.C<e.length&&(Tu(this),FE(this,n,e),this.i&&n!=4&&La(this))}};function fU(n,e){var t=n.C,i=e.indexOf(`
`,t);return i==-1?sl:(t=Number(e.substring(t,i)),isNaN(t)?Vd:(i+=1,i+t>e.length?sl:(e=e.substr(i,t),n.C=i+t,e)))}k.cancel=function(){this.I=!0,Wi(this)};function La(n){n.V=Date.now()+n.O,UE(n,n.O)}function UE(n,e){if(n.B!=null)throw Error("WatchDog timer not null");n.B=xa(it(n.gb,n),e)}function Tu(n){n.B&&(O.clearTimeout(n.B),n.B=null)}k.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(uU(this.j,this.A),this.K!=2&&(Zo(),ht(17)),Wi(this),this.o=2,Io(this)):UE(this,this.V-n)};function Io(n){n.l.G==0||n.I||oT(n.l,n)}function Wi(n){Tu(n);var e=n.L;e&&typeof e.na=="function"&&e.na(),n.L=null,Vp(n.T),AE(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function qd(n,e){try{var t=n.l;if(t.G!=0&&(t.g==n||jd(t.h,n))){if(!n.J&&jd(t.h,n)&&t.G==3){try{var i=t.Fa.g.parse(e)}catch{i=null}if(Array.isArray(i)&&i.length==3){var r=i;if(r[0]==0){e:if(!t.u){if(t.g)if(t.g.F+3e3<n.F)cl(t),Au(t);else break e;Yp(t),ht(18)}}else t.Ba=r[1],0<t.Ba-t.T&&37500>r[2]&&t.L&&t.A==0&&!t.v&&(t.v=xa(it(t.cb,t),6e3));if(1>=GE(t.h)&&t.ja){try{t.ja()}catch{}t.ja=void 0}}else Ki(t,11)}else if((n.J||t.g==n)&&cl(t),!il(e))for(r=t.Fa.g.parse(e),e=0;e<r.length;e++){let l=r[e];if(t.T=l[0],l=l[1],t.G==2)if(l[0]=="c"){t.I=l[1],t.ka=l[2];const u=l[3];u!=null&&(t.ma=u,t.j.info("VER="+t.ma));const h=l[4];h!=null&&(t.Ca=h,t.j.info("SVER="+t.Ca));const d=l[5];d!=null&&typeof d=="number"&&0<d&&(i=1.5*d,t.J=i,t.j.info("backChannelRequestTimeoutMs_="+i)),i=t;const f=n.g;if(f){const p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var s=i.h;s.g||p.indexOf("spdy")==-1&&p.indexOf("quic")==-1&&p.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Kp(s,s.h),s.h=null))}if(i.D){const _=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;_&&(i.za=_,oe(i.F,i.D,_))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms")),i=t;var o=n;if(i.sa=lT(i,i.H?i.ka:null,i.V),o.J){HE(i.h,o);var a=o,c=i.J;c&&a.setTimeout(c),a.B&&(Tu(a),La(a)),i.g=o}else rT(i);0<t.i.length&&Ru(t)}else l[0]!="stop"&&l[0]!="close"||Ki(t,7);else t.G==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?Ki(t,7):Qp(t):l[0]!="noop"&&t.l&&t.l.wa(l),t.A=0)}}Zo(4)}catch{}}function pU(n){if(n.W&&typeof n.W=="function")return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(gu(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}e=[],t=0;for(i in n)e[t++]=n[i];return e}function gU(n){if(n.oa&&typeof n.oa=="function")return n.oa();if(!n.W||typeof n.W!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(gu(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const i in n)e[t++]=i;return e}}}function $E(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(gu(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=gU(n),i=pU(n),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],t&&t[s],n)}var VE=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mU(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),r=null;if(0<=i){var s=n[t].substring(0,i);r=n[t].substring(i+1)}else s=n[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Ji(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ji){this.h=e!==void 0?e:n.h,ol(this,n.j),this.s=n.s,this.g=n.g,al(this,n.m),this.l=n.l,e=n.i;var t=new ea;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),z_(this,t),this.o=n.o}else n&&(t=String(n).match(VE))?(this.h=!!e,ol(this,t[1]||"",!0),this.s=lo(t[2]||""),this.g=lo(t[3]||"",!0),al(this,t[4]),this.l=lo(t[5]||"",!0),z_(this,t[6]||"",!0),this.o=lo(t[7]||"")):(this.h=!!e,this.i=new ea(null,this.h))}Ji.prototype.toString=function(){var n=[],e=this.j;e&&n.push(uo(e,Q_,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(uo(e,Q_,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(uo(t,t.charAt(0)=="/"?vU:yU,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",uo(t,IU)),n.join("")};function Ln(n){return new Ji(n)}function ol(n,e,t){n.j=t?lo(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function al(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function z_(n,e,t){e instanceof ea?(n.i=e,bU(n.i,n.h)):(t||(e=uo(e,wU)),n.i=new ea(e,n.h))}function oe(n,e,t){n.i.set(e,t)}function Su(n){return oe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function lo(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function uo(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,_U),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function _U(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Q_=/[#\/\?@]/g,yU=/[#\?:]/g,vU=/[#\?]/g,wU=/[#\?@]/g,IU=/#/g;function ea(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Ti(n){n.g||(n.g=new Map,n.h=0,n.i&&mU(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}k=ea.prototype;k.add=function(n,e){Ti(this),this.i=null,n=Ms(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function BE(n,e){Ti(n),e=Ms(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function qE(n,e){return Ti(n),e=Ms(n,e),n.g.has(e)}k.forEach=function(n,e){Ti(this),this.g.forEach(function(t,i){t.forEach(function(r){n.call(e,r,i,this)},this)},this)};k.oa=function(){Ti(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){const r=n[i];for(let s=0;s<r.length;s++)t.push(e[i])}return t};k.W=function(n){Ti(this);let e=[];if(typeof n=="string")qE(this,n)&&(e=e.concat(this.g.get(Ms(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};k.set=function(n,e){return Ti(this),this.i=null,n=Ms(this,n),qE(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};k.get=function(n,e){return n?(n=this.W(n),0<n.length?String(n[0]):e):e};function jE(n,e,t){BE(n,e),0<t.length&&(n.i=null,n.g.set(Ms(n,e),Pp(t)),n.h+=t.length)}k.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];const s=encodeURIComponent(String(i)),o=this.W(i);for(i=0;i<o.length;i++){var r=s;o[i]!==""&&(r+="="+encodeURIComponent(String(o[i]))),n.push(r)}}return this.i=n.join("&")};function Ms(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function bU(n,e){e&&!n.j&&(Ti(n),n.i=null,n.g.forEach(function(t,i){var r=i.toLowerCase();i!=r&&(BE(this,i),jE(this,r,t))},n)),n.j=e}var EU=class{constructor(e,t){this.h=e,this.g=t}};function WE(n){this.l=n||TU,O.PerformanceNavigationTiming?(n=O.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(O.g&&O.g.Ga&&O.g.Ga()&&O.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var TU=10;function KE(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function GE(n){return n.h?1:n.g?n.g.size:0}function jd(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Kp(n,e){n.g?n.g.add(e):n.h=e}function HE(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}WE.prototype.cancel=function(){if(this.i=zE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function zE(n){if(n.h!=null)return n.i.concat(n.h.D);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return Pp(n.i)}function Gp(){}Gp.prototype.stringify=function(n){return O.JSON.stringify(n,void 0)};Gp.prototype.parse=function(n){return O.JSON.parse(n,void 0)};function SU(){this.g=new Gp}function CU(n,e,t){const i=t||"";try{$E(n,function(r,s){let o=r;Da(r)&&(o=$p(r)),e.push(i+s+"="+encodeURIComponent(o))})}catch(r){throw e.push(i+"type="+encodeURIComponent("_badmap")),r}}function kU(n,e){const t=new wu;if(O.Image){const i=new Image;i.onload=rc(oc,t,i,"TestLoadImage: loaded",!0,e),i.onerror=rc(oc,t,i,"TestLoadImage: error",!1,e),i.onabort=rc(oc,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=rc(oc,t,i,"TestLoadImage: timeout",!1,e),O.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}function oc(n,e,t,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch{}}function Fa(n){this.l=n.ac||null,this.j=n.jb||!1}Je(Fa,qp);Fa.prototype.g=function(){return new Cu(this.l,this.j)};Fa.prototype.i=function(n){return function(){return n}}({});function Cu(n,e){Ve.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Hp,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Je(Cu,Ve);var Hp=0;k=Cu.prototype;k.open=function(n,e){if(this.readyState!=Hp)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,ta(this)};k.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||O).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))};k.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ua(this)),this.readyState=Hp};k.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ta(this)),this.g&&(this.readyState=3,ta(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof O.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;QE(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))};function QE(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}k.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Ua(this):ta(this),this.readyState==3&&QE(this)}};k.Va=function(n){this.g&&(this.response=this.responseText=n,Ua(this))};k.Ua=function(n){this.g&&(this.response=n,Ua(this))};k.ga=function(){this.g&&Ua(this)};function Ua(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ta(n)}k.setRequestHeader=function(n,e){this.v.append(n,e)};k.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};k.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function ta(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Cu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var AU=O.JSON.parse;function me(n){Ve.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=YE,this.K=this.L=!1}Je(me,Ve);var YE="",RU=/^https?$/i,NU=["POST","PUT"];k=me.prototype;k.Ka=function(n){this.L=n};k.da=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():$d.g(),this.C=this.u?H_(this.u):H_($d),this.g.onreadystatechange=it(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){Y_(this,s);return}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)t.set(r,i[r]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(const s of i.keys())t.set(s,i.get(s));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),r=O.FormData&&n instanceof O.FormData,!(0<=dE(NU,e))||i||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ZE(this),0<this.B&&((this.K=DU(this.g))?(this.g.timeout=this.B,this.g.ontimeout=it(this.qa,this)):this.A=Bp(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Y_(this,s)}};function DU(n){return hs&&zF()&&typeof n.timeout=="number"&&n.ontimeout!==void 0}k.qa=function(){typeof Dp<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ze(this,"timeout"),this.abort(8))};function Y_(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,XE(n),ku(n)}function XE(n){n.D||(n.D=!0,ze(n,"complete"),ze(n,"error"))}k.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ze(this,"complete"),ze(this,"abort"),ku(this))};k.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ku(this,!0)),me.X.M.call(this)};k.Ha=function(){this.s||(this.F||this.v||this.l?JE(this):this.fb())};k.fb=function(){JE(this)};function JE(n){if(n.h&&typeof Dp<"u"&&(!n.C[1]||kn(n)!=4||n.aa()!=2)){if(n.v&&kn(n)==4)Bp(n.Ha,0,n);else if(ze(n,"readystatechange"),kn(n)==4){n.h=!1;try{const a=n.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=a===0){var r=String(n.H).match(VE)[1]||null;if(!r&&O.self&&O.self.location){var s=O.self.location.protocol;r=s.substr(0,s.length-1)}i=!RU.test(r?r.toLowerCase():"")}t=i}if(t)ze(n,"complete"),ze(n,"success");else{n.m=6;try{var o=2<kn(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.aa()+"]",XE(n)}}finally{ku(n)}}}}function ku(n,e){if(n.g){ZE(n);const t=n.g,i=n.C[0]?nl:null;n.g=null,n.C=null,e||ze(n,"ready");try{t.onreadystatechange=i}catch{}}}function ZE(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(O.clearTimeout(n.A),n.A=null)}function kn(n){return n.g?n.g.readyState:0}k.aa=function(){try{return 2<kn(this)?this.g.status:-1}catch{return-1}};k.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};k.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),AU(e)}};function X_(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case YE:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}k.Ea=function(){return this.m};k.Oa=function(){return typeof this.j=="string"?this.j:String(this.j)};function eT(n){let e="";return Op(n,function(t,i){e+=i,e+=":",e+=t,e+=`\r
`}),e}function zp(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=eT(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):oe(n,e,t))}function Zs(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function tT(n){this.Ca=0,this.i=[],this.j=new wu,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Zs("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Zs("baseRetryDelayMs",5e3,n),this.bb=Zs("retryDelaySeedMs",1e4,n),this.$a=Zs("forwardChannelMaxRetries",2,n),this.ta=Zs("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new WE(n&&n.concurrentRequestLimit),this.Fa=new SU,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}k=tT.prototype;k.ma=8;k.G=1;function Qp(n){if(nT(n),n.G==3){var e=n.U++,t=Ln(n.F);oe(t,"SID",n.I),oe(t,"RID",e),oe(t,"TYPE","terminate"),$a(n,t),e=new Ma(n,n.j,e,void 0),e.K=2,e.v=Su(Ln(t)),t=!1,O.navigator&&O.navigator.sendBeacon&&(t=O.navigator.sendBeacon(e.v.toString(),"")),!t&&O.Image&&(new Image().src=e.v,t=!0),t||(e.g=uT(e.l,null),e.g.da(e.v)),e.F=Date.now(),La(e)}cT(n)}function Au(n){n.g&&(Xp(n),n.g.cancel(),n.g=null)}function nT(n){Au(n),n.u&&(O.clearTimeout(n.u),n.u=null),cl(n),n.h.cancel(),n.m&&(typeof n.m=="number"&&O.clearTimeout(n.m),n.m=null)}function Ru(n){KE(n.h)||n.m||(n.m=!0,TE(n.Ja,n),n.C=0)}function PU(n,e){return GE(n.h)>=n.h.j-(n.m?1:0)?!1:n.m?(n.i=e.D.concat(n.i),!0):n.G==1||n.G==2||n.C>=(n.Za?0:n.$a)?!1:(n.m=xa(it(n.Ja,n,e),aT(n,n.C)),n.C++,!0)}k.Ja=function(n){if(this.m)if(this.m=null,this.G==1){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const r=new Ma(this,this.j,n,void 0);let s=this.s;if(this.S&&(s?(s=mE(s),_E(s,this.S)):s=this.S),this.o!==null||this.N||(r.H=s,s=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){t:{var i=this.i[t];if("__data__"in i.g&&(i=i.g.__data__,typeof i=="string")){i=i.length;break t}i=void 0}if(i===void 0)break;if(e+=i,4096<e){e=t;break e}if(e===4096||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=iT(this,r,e),t=Ln(this.F),oe(t,"RID",n),oe(t,"CVER",22),this.D&&oe(t,"X-HTTP-Session-Id",this.D),$a(this,t),s&&(this.N?e="headers="+encodeURIComponent(String(eT(s)))+"&"+e:this.o&&zp(t,this.o,s)),Kp(this.h,r),this.Ya&&oe(t,"TYPE","init"),this.O?(oe(t,"$req",e),oe(t,"SID","null"),r.Z=!0,Bd(r,t,null)):Bd(r,t,e),this.G=2}}else this.G==3&&(n?J_(this,n):this.i.length==0||KE(this.h)||J_(this))};function J_(n,e){var t;e?t=e.m:t=n.U++;const i=Ln(n.F);oe(i,"SID",n.I),oe(i,"RID",t),oe(i,"AID",n.T),$a(n,i),n.o&&n.s&&zp(i,n.o,n.s),t=new Ma(n,n.j,t,n.C+1),n.o===null&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=iT(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Kp(n.h,t),Bd(t,i,e)}function $a(n,e){n.ia&&Op(n.ia,function(t,i){oe(e,i,t)}),n.l&&$E({},function(t,i){oe(e,i,t)})}function iT(n,e,t){t=Math.min(n.i.length,t);var i=n.l?it(n.l.Ra,n.l,n):null;e:{var r=n.i;let s=-1;for(;;){const o=["count="+t];s==-1?0<t?(s=r[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<t;c++){let l=r[c].h;const u=r[c].g;if(l-=s,0>l)s=Math.max(0,r[c].h-100),a=!1;else try{CU(u,o,"req"+l+"_")}catch{i&&i(u)}}if(a){i=o.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,i}function rT(n){n.g||n.u||(n.Z=1,TE(n.Ia,n),n.A=0)}function Yp(n){return n.g||n.u||3<=n.A?!1:(n.Z++,n.u=xa(it(n.Ia,n),aT(n,n.A)),n.A++,!0)}k.Ia=function(){if(this.u=null,sT(this),this.$&&!(this.K||this.g==null||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=xa(it(this.eb,this),n)}};k.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,ht(10),Au(this),sT(this))};function Xp(n){n.B!=null&&(O.clearTimeout(n.B),n.B=null)}function sT(n){n.g=new Ma(n,n.j,"rpc",n.Z),n.o===null&&(n.g.H=n.s),n.g.N=0;var e=Ln(n.sa);oe(e,"RID","rpc"),oe(e,"SID",n.I),oe(e,"CI",n.L?"0":"1"),oe(e,"AID",n.T),oe(e,"TYPE","xmlhttp"),$a(n,e),n.o&&n.s&&zp(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Su(Ln(e)),t.s=null,t.P=!0,ME(t,n)}k.cb=function(){this.v!=null&&(this.v=null,Au(this),Yp(this),ht(19))};function cl(n){n.v!=null&&(O.clearTimeout(n.v),n.v=null)}function oT(n,e){var t=null;if(n.g==e){cl(n),Xp(n),n.g=null;var i=2}else if(jd(n.h,e))t=e.D,HE(n.h,e),i=1;else return;if(n.G!=0){if(n.pa=e.Y,e.i)if(i==1){t=e.s?e.s.length:0,e=Date.now()-e.F;var r=n.C;i=Iu(),ze(i,new DE(i,t)),Ru(n)}else rT(n);else if(r=e.o,r==3||r==0&&0<n.pa||!(i==1&&PU(n,e)||i==2&&Yp(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),r){case 1:Ki(n,5);break;case 4:Ki(n,10);break;case 3:Ki(n,6);break;default:Ki(n,2)}}}function aT(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function Ki(n,e){if(n.j.info("Error code "+e),e==2){var t=null;n.l&&(t=null);var i=it(n.kb,n);t||(t=new Ji("//www.google.com/images/cleardot.gif"),O.location&&O.location.protocol=="http"||ol(t,"https"),Su(t)),kU(t.toString(),i)}else ht(2);n.G=0,n.l&&n.l.va(e),cT(n),nT(n)}k.kb=function(n){n?(this.j.info("Successfully pinged google.com"),ht(2)):(this.j.info("Failed to ping google.com"),ht(1))};function cT(n){if(n.G=0,n.la=[],n.l){const e=zE(n.h);(e.length!=0||n.i.length!=0)&&(B_(n.la,e),B_(n.la,n.i),n.h.i.length=0,Pp(n.i),n.i.length=0),n.l.ua()}}function lT(n,e,t){var i=t instanceof Ji?Ln(t):new Ji(t,void 0);if(i.g!="")e&&(i.g=e+"."+i.g),al(i,i.m);else{var r=O.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new Ji(null,void 0);i&&ol(s,i),e&&(s.g=e),r&&al(s,r),t&&(s.l=t),i=s}return t=n.D,e=n.za,t&&e&&oe(i,t,e),oe(i,"VER",n.ma),$a(n,i),i}function uT(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=t&&n.Da&&!n.ra?new me(new Fa({jb:!0})):new me(n.ra),e.Ka(n.H),e}function hT(){}k=hT.prototype;k.xa=function(){};k.wa=function(){};k.va=function(){};k.ua=function(){};k.Ra=function(){};function ll(){if(hs&&!(10<=Number(QF)))throw Error("Environmental error: no available transport.")}ll.prototype.g=function(n,e){return new xt(n,e)};function xt(n,e){Ve.call(this),this.g=new tT(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!il(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!il(e)&&(this.g.D=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Ls(this)}Je(xt,Ve);xt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;ht(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=lT(n,null,n.V),Ru(n)};xt.prototype.close=function(){Qp(this.g)};xt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=$p(n),n=t);e.i.push(new EU(e.ab++,n)),e.G==3&&Ru(e)};xt.prototype.M=function(){this.g.l=null,delete this.j,Qp(this.g),delete this.g,xt.X.M.call(this)};function dT(n){jp.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Je(dT,jp);function fT(){Wp.call(this),this.status=1}Je(fT,Wp);function Ls(n){this.g=n}Je(Ls,hT);Ls.prototype.xa=function(){ze(this.g,"a")};Ls.prototype.wa=function(n){ze(this.g,new dT(n))};Ls.prototype.va=function(n){ze(this.g,new fT)};Ls.prototype.ua=function(){ze(this.g,"b")};ll.prototype.createWebChannel=ll.prototype.g;xt.prototype.send=xt.prototype.u;xt.prototype.open=xt.prototype.m;xt.prototype.close=xt.prototype.close;bu.NO_ERROR=0;bu.TIMEOUT=8;bu.HTTP_ERROR=6;PE.COMPLETE="complete";xE.EventType=Oa;Oa.OPEN="a";Oa.CLOSE="b";Oa.ERROR="c";Oa.MESSAGE="d";Ve.prototype.listen=Ve.prototype.N;me.prototype.listenOnce=me.prototype.O;me.prototype.getLastError=me.prototype.Oa;me.prototype.getLastErrorCode=me.prototype.Ea;me.prototype.getStatus=me.prototype.aa;me.prototype.getResponseJson=me.prototype.Sa;me.prototype.getResponseText=me.prototype.fa;me.prototype.send=me.prototype.da;me.prototype.setWithCredentials=me.prototype.Ka;var xU=function(){return new ll},OU=function(){return Iu()},Dh=bu,MU=PE,LU=Rr,Z_={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},FU=Fa,ac=xE,UU=me;const ey="@firebase/firestore";class Oe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Oe.UNAUTHENTICATED=new Oe(null),Oe.GOOGLE_CREDENTIALS=new Oe("google-credentials-uid"),Oe.FIRST_PARTY=new Oe("first-party-uid"),Oe.MOCK_USER=new Oe("mock-user");let Fs="9.15.0";const fi=new vn("@firebase/firestore");function Wd(){return fi.logLevel}function $U(n){fi.setLogLevel(n)}function I(n,...e){if(fi.logLevel<=$.DEBUG){const t=e.map(Jp);fi.debug(`Firestore (${Fs}): ${n}`,...t)}}function we(n,...e){if(fi.logLevel<=$.ERROR){const t=e.map(Jp);fi.error(`Firestore (${Fs}): ${n}`,...t)}}function ds(n,...e){if(fi.logLevel<=$.WARN){const t=e.map(Jp);fi.warn(`Firestore (${Fs}): ${n}`,...t)}}function Jp(n){if(typeof n=="string")return n;try{return e=n,JSON.stringify(e)}catch{return n}var e}function C(n="Unexpected state"){const e=`FIRESTORE (${Fs}) INTERNAL ASSERTION FAILED: `+n;throw we(e),new Error(e)}function A(n,e){n||C()}function VU(n,e){n||C()}function S(n,e){return n}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends he{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Le{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class pT{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class BU{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Oe.UNAUTHENTICATED))}shutdown(){}}class qU{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class jU{constructor(e){this.t=e,this.currentUser=Oe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.i;const r=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let s=new Le;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Le,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const c=s;e.enqueueRetryable(async()=>{await c.promise,await r(this.currentUser)})},a=c=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Le)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(A(typeof i.accessToken=="string"),new pT(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return A(e===null||typeof e=="string"),new Oe(e)}}class WU{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r,this.type="FirstParty",this.user=Oe.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(A(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class KU{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r}getToken(){return Promise.resolve(new WU(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Oe.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class GU{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class HU{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const i=s=>{s.error!=null&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.A;return this.A=s.token,I("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?r(s):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(A(typeof t.token=="string"),this.A=t.token,new GU(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function zU(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}class gT{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const r=zU(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}}function L(n,e){return n<e?-1:n>e?1:0}function fs(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function mT(n){return n+"\0"}class le{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return le.fromMillis(Date.now())}static fromDate(e){return le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new le(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?L(this.nanoseconds,e.nanoseconds):L(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class R{constructor(e){this.timestamp=e}static fromTimestamp(e){return new R(e)}static min(){return new R(new le(0,0))}static max(){return new R(new le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class na{constructor(e,t,i){t===void 0?t=0:t>e.length&&C(),i===void 0?i=e.length-t:i>e.length-t&&C(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return na.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof na?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class K extends na{construct(e,t,i){return new K(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new K(t)}static emptyPath(){return new K([])}}const QU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ie extends na{construct(e,t,i){return new Ie(e,t,i)}static isValidIdentifier(e){return QU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ie.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ie(["__name__"])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(i.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new y(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new y(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new y(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ie(t)}static emptyPath(){return new Ie([])}}class T{constructor(e){this.path=e}static fromPath(e){return new T(K.fromString(e))}static fromName(e){return new T(K.fromString(e).popFirst(5))}static empty(){return new T(K.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&K.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return K.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new T(new K(e.slice()))}}class _T{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}}function Kd(n){return n.fields.find(e=>e.kind===2)}function Oi(n){return n.fields.filter(e=>e.kind!==2)}_T.UNKNOWN_ID=-1;class YU{constructor(e,t){this.fieldPath=e,this.kind=t}}class ul{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ul(0,Ot.min())}}function yT(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=R.fromTimestamp(i===1e9?new le(t+1,0):new le(t,i));return new Ot(r,T.empty(),e)}function vT(n){return new Ot(n.readTime,n.key,-1)}class Ot{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Ot(R.min(),T.empty(),-1)}static max(){return new Ot(R.max(),T.empty(),-1)}}function Zp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=T.comparator(n.documentKey,e.documentKey),t!==0?t:L(n.largestBatchId,e.largestBatchId))}const wT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class IT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Si(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==wT)throw n;I("LocalStore","Unexpectedly lost primary lease")}class g{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&C(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new g((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof g?t:g.resolve(t)}catch(t){return g.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):g.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):g.reject(t)}static resolve(e){return new g((t,i)=>{t(e)})}static reject(e){return new g((t,i)=>{i(e)})}static waitFor(e){return new g((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},c=>i(c))}),o=!0,s===r&&t()})}static or(e){let t=g.resolve(!1);for(const i of e)t=t.next(r=>r?g.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new g((i,r)=>{const s=e.length,o=new Array(s);let a=0;for(let c=0;c<s;c++){const l=c;t(e[l]).next(u=>{o[l]=u,++a,a===s&&i(o)},u=>r(u))}})}static doWhile(e,t){return new g((i,r)=>{const s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}}class Nu{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new Le,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new bo(e,t.error)):this.P.resolve()},this.transaction.onerror=i=>{const r=eg(i.target.error);this.P.reject(new bo(e,r))}}static open(e,t,i,r){try{return new Nu(t,e.transaction(r,i))}catch(s){throw new bo(t,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(I("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new JU(t)}}class Ht{constructor(e,t,i){this.name=e,this.version=t,this.S=i,Ht.D(de())===12.2&&we("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return I("SimpleDb","Removing database:",e),Li(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!bt())return!1;if(Ht.N())return!0;const e=de(),t=Ht.D(e),i=0<t&&t<10,r=Ht.k(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static N(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.O)==="YES"}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static k(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}async F(e){return this.db||(I("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,i)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{const o=s.target.result;t(o)},r.onblocked=()=>{i(new bo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{const o=s.target.error;o.name==="VersionError"?i(new y(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new y(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new bo(e,o))},r.onupgradeneeded=s=>{I("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const o=s.target.result;this.S.$(o,r.transaction,s.oldVersion,this.version).next(()=>{I("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,i,r){const s=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.F(e);const a=Nu.open(this.db,e,s?"readonly":"readwrite",i),c=r(a).next(l=>(a.V(),l)).catch(l=>(a.abort(l),g.reject(l))).toPromise();return c.catch(()=>{}),await a.v,c}catch(a){const c=a,l=c.name!=="FirebaseError"&&o<3;if(I("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),this.close(),!l)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}class XU{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return Li(this.q.delete())}}class bo extends y{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ci(n){return n.name==="IndexedDbTransactionError"}class JU{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(I("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Li(i)}add(e){return I("SimpleDb","ADD",this.store.name,e,e),Li(this.store.add(e))}get(e){return Li(this.store.get(e)).next(t=>(t===void 0&&(t=null),I("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return I("SimpleDb","DELETE",this.store.name,e),Li(this.store.delete(e))}count(){return I("SimpleDb","COUNT",this.store.name),Li(this.store.count())}W(e,t){const i=this.options(e,t);if(i.index||typeof this.store.getAll!="function"){const r=this.cursor(i),s=[];return this.H(r,(o,a)=>{s.push(a)}).next(()=>s)}{const r=this.store.getAll(i.range);return new g((s,o)=>{r.onerror=a=>{o(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}}J(e,t){const i=this.store.getAll(e,t===null?void 0:t);return new g((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}Y(e,t){I("SimpleDb","DELETE ALL",this.store.name);const i=this.options(e,t);i.X=!1;const r=this.cursor(i);return this.H(r,(s,o,a)=>a.delete())}Z(e,t){let i;t?i=e:(i={},t=e);const r=this.cursor(i);return this.H(r,t)}tt(e){const t=this.cursor({});return new g((i,r)=>{t.onerror=s=>{const o=eg(s.target.error);r(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}H(e,t){const i=[];return new g((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const c=new XU(a),l=t(a.primaryKey,a.value,c);if(l instanceof g){const u=l.catch(h=>(c.done(),g.reject(h)));i.push(u)}c.isDone?r():c.G===null?a.continue():a.continue(c.G)}}).next(()=>g.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.X?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Li(n){return new g((e,t)=>{n.onsuccess=i=>{const r=i.target.result;e(r)},n.onerror=i=>{const r=eg(i.target.error);t(r)}})}let ty=!1;function eg(n){const e=Ht.D(de());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ty||(ty=!0,setTimeout(()=>{throw i},0)),i}}return n}class ZU{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}nt(e){I("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{I("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(t){Ci(t)?I("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await Si(t)}await this.nt(6e4)})}}class e${constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.it(t,e))}it(e,t){const i=new Set;let r=t,s=!0;return g.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!i.has(o))return I("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,r).next(a=>{r-=a,i.add(o)});s=!1})).next(()=>t-r)}rt(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(r,s)).next(a=>(I("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ot(e,t){let i=e;return t.changes.forEach((r,s)=>{const o=vT(s);Zp(o,i)>0&&(i=o)}),new Ot(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}class vt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ut(i),this.ct=i=>t.writeSequenceNumber(i))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}vt.at=-1;class t${constructor(e,t,i,r,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=c}}class pi{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new pi("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof pi&&e.projectId===this.projectId&&e.database===this.database}}function ny(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Nr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function bT(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Va(n){return n==null}function ia(n){return n===0&&1/n==-1/0}function ET(n){return typeof n=="number"&&Number.isInteger(n)&&!ia(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function n$(){return typeof atob<"u"}class Ae{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Ae(t)}static fromUint8Array(e){const t=function(i){let r="";for(let s=0;s<i.length;++s)r+=String.fromCharCode(i[s]);return r}(e);return new Ae(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return L(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ae.EMPTY_BYTE_STRING=new Ae("");const i$=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gi(n){if(A(!!n),typeof n=="string"){let e=0;const t=i$.exec(n);if(A(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:pe(n.seconds),nanos:pe(n.nanos)}}function pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ur(n){return typeof n=="string"?Ae.fromBase64String(n):Ae.fromUint8Array(n)}function tg(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function TT(n){const e=n.mapValue.fields.__previous_value__;return tg(e)?TT(e):e}function ra(n){const e=gi(n.mapValue.fields.__local_write_time__.timestampValue);return new le(e.seconds,e.nanos)}const Zn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},bc={nullValue:"NULL_VALUE"};function hr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?tg(n)?4:ST(n)?9007199254740991:10:C()}function mn(n,e){if(n===e)return!0;const t=hr(n);if(t!==hr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ra(n).isEqual(ra(e));case 3:return function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const s=gi(i.timestampValue),o=gi(r.timestampValue);return s.seconds===o.seconds&&s.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,r){return ur(i.bytesValue).isEqual(ur(r.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,r){return pe(i.geoPointValue.latitude)===pe(r.geoPointValue.latitude)&&pe(i.geoPointValue.longitude)===pe(r.geoPointValue.longitude)}(n,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return pe(i.integerValue)===pe(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const s=pe(i.doubleValue),o=pe(r.doubleValue);return s===o?ia(s)===ia(o):isNaN(s)&&isNaN(o)}return!1}(n,e);case 9:return fs(n.arrayValue.values||[],e.arrayValue.values||[],mn);case 10:return function(i,r){const s=i.mapValue.fields||{},o=r.mapValue.fields||{};if(ny(s)!==ny(o))return!1;for(const a in s)if(s.hasOwnProperty(a)&&(o[a]===void 0||!mn(s[a],o[a])))return!1;return!0}(n,e);default:return C()}}function sa(n,e){return(n.values||[]).find(t=>mn(t,e))!==void 0}function mi(n,e){if(n===e)return 0;const t=hr(n),i=hr(e);if(t!==i)return L(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return L(n.booleanValue,e.booleanValue);case 2:return function(r,s){const o=pe(r.integerValue||r.doubleValue),a=pe(s.integerValue||s.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return iy(n.timestampValue,e.timestampValue);case 4:return iy(ra(n),ra(e));case 5:return L(n.stringValue,e.stringValue);case 6:return function(r,s){const o=ur(r),a=ur(s);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(r,s){const o=r.split("/"),a=s.split("/");for(let c=0;c<o.length&&c<a.length;c++){const l=L(o[c],a[c]);if(l!==0)return l}return L(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,s){const o=L(pe(r.latitude),pe(s.latitude));return o!==0?o:L(pe(r.longitude),pe(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,s){const o=r.values||[],a=s.values||[];for(let c=0;c<o.length&&c<a.length;++c){const l=mi(o[c],a[c]);if(l)return l}return L(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,s){if(r===Zn.mapValue&&s===Zn.mapValue)return 0;if(r===Zn.mapValue)return 1;if(s===Zn.mapValue)return-1;const o=r.fields||{},a=Object.keys(o),c=s.fields||{},l=Object.keys(c);a.sort(),l.sort();for(let u=0;u<a.length&&u<l.length;++u){const h=L(a[u],l[u]);if(h!==0)return h;const d=mi(o[a[u]],c[l[u]]);if(d!==0)return d}return L(a.length,l.length)}(n.mapValue,e.mapValue);default:throw C()}}function iy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return L(n,e);const t=gi(n),i=gi(e),r=L(t.seconds,i.seconds);return r!==0?r:L(t.nanos,i.nanos)}function ps(n){return Gd(n)}function Gd(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const r=gi(i);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?ur(n.bytesValue).toBase64():"referenceValue"in n?(t=n.referenceValue,T.fromName(t).toString()):"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(i){let r="[",s=!0;for(const o of i.values||[])s?s=!1:r+=",",r+=Gd(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(i){const r=Object.keys(i.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Gd(i.fields[a])}`;return s+"}"}(n.mapValue):C();var e,t}function dr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Hd(n){return!!n&&"integerValue"in n}function oa(n){return!!n&&"arrayValue"in n}function ry(n){return!!n&&"nullValue"in n}function sy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ec(n){return!!n&&"mapValue"in n}function Eo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Nr(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Eo(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Eo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function ST(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function r$(n){return"nullValue"in n?bc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?dr(pi.empty(),T.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:C()}function s$(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?dr(pi.empty(),T.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Zn:C()}function oy(n,e){const t=mi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ay(n,e){const t=mi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class _i{constructor(e,t){this.position=e,this.inclusive=t}}function cy(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],o=n.position[r];if(s.field.isKeyField()?i=T.comparator(T.fromName(o.referenceValue),t.key):i=mi(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function ly(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!mn(n.position[t],e.position[t]))return!1;return!0}class CT{}class j extends CT{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new o$(e,t,i):t==="array-contains"?new l$(e,i):t==="in"?new OT(e,i):t==="not-in"?new u$(e,i):t==="array-contains-any"?new h$(e,i):new j(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new a$(e,i):new c$(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(mi(t,this.value)):t!==null&&hr(this.value)===hr(t)&&this.matchesComparison(mi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return C()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class J extends CT{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new J(e,t)}matches(e){return gs(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ht!==null||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return e!==null?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function gs(n){return n.op==="and"}function zd(n){return n.op==="or"}function kT(n){return AT(n)&&gs(n)}function AT(n){for(const e of n.filters)if(e instanceof J)return!1;return!0}function RT(n){if(n instanceof j)return n.field.canonicalString()+n.op.toString()+ps(n.value);{const e=n.filters.map(t=>RT(t)).join(",");return`${n.op}(${e})`}}function NT(n,e){return n instanceof j?function(t,i){return i instanceof j&&t.op===i.op&&t.field.isEqual(i.field)&&mn(t.value,i.value)}(n,e):n instanceof J?function(t,i){return i instanceof J&&t.op===i.op&&t.filters.length===i.filters.length?t.filters.reduce((r,s,o)=>r&&NT(s,i.filters[o]),!0):!1}(n,e):void C()}function DT(n,e){const t=n.filters.concat(e);return J.create(t,n.op)}function PT(n){return n instanceof j?function(e){return`${e.field.canonicalString()} ${e.op} ${ps(e.value)}`}(n):n instanceof J?function(e){return e.op.toString()+" {"+e.getFilters().map(PT).join(" ,")+"}"}(n):"Filter"}class o$ extends j{constructor(e,t,i){super(e,t,i),this.key=T.fromName(i.referenceValue)}matches(e){const t=T.comparator(e.key,this.key);return this.matchesComparison(t)}}class a$ extends j{constructor(e,t){super(e,"in",t),this.keys=xT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class c$ extends j{constructor(e,t){super(e,"not-in",t),this.keys=xT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function xT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>T.fromName(i.referenceValue))}class l$ extends j{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return oa(t)&&sa(t.arrayValue,this.value)}}class OT extends j{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&sa(this.value.arrayValue,t)}}class u$ extends j{constructor(e,t){super(e,"not-in",t)}matches(e){if(sa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!sa(this.value.arrayValue,t)}}class h$ extends j{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!oa(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>sa(this.value.arrayValue,i))}}class Jr{constructor(e,t="asc"){this.field=e,this.dir=t}}function d$(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class _e{constructor(e,t){this.comparator=e,this.root=t||We.EMPTY}insert(e,t){return new _e(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,We.BLACK,null,null))}remove(e){return new _e(this.comparator,this.root.remove(e,this.comparator).copy(null,null,We.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cc(this.root,e,this.comparator,!1)}getReverseIterator(){return new cc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cc(this.root,e,this.comparator,!0)}}class cc{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class We{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??We.RED,this.left=r??We.EMPTY,this.right=s??We.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new We(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return We.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return We.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,We.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,We.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw C();const e=this.left.check();if(e!==this.right.check())throw C();return e+(this.isRed()?0:1)}}We.EMPTY=null,We.RED=!0,We.BLACK=!1;We.EMPTY=new class{constructor(){this.size=0}get key(){throw C()}get value(){throw C()}get color(){throw C()}get left(){throw C()}get right(){throw C()}copy(n,e,t,i,r){return this}insert(n,e,t){return new We(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ee{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new uy(this.data.getIterator())}getIteratorFrom(e){return new uy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof ee)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ee(this.comparator);return t.data=e,t}}class uy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Fr(n){return n.hasNext()?n.getNext():void 0}class Nt{constructor(e){this.fields=e,e.sort(Ie.comparator)}static empty(){return new Nt([])}unionWith(e){let t=new ee(Ie.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Nt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return fs(this.fields,e.fields,(t,i)=>t.isEqual(i))}}class Ke{constructor(e){this.value=e}static empty(){return new Ke({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Ec(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Eo(t)}setAll(e){let t=Ie.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=Eo(o):r.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());Ec(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return mn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Ec(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Nr(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new Ke(Eo(this.value))}}function MT(n){const e=[];return Nr(n.fields,(t,i)=>{const r=new Ie([t]);if(Ec(i)){const s=MT(i.mapValue).fields;if(s.length===0)e.push(r);else for(const o of s)e.push(r.child(o))}else e.push(r)}),new Nt(e)}class re{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new re(e,0,R.min(),R.min(),R.min(),Ke.empty(),0)}static newFoundDocument(e,t,i,r){return new re(e,1,t,R.min(),i,r,0)}static newNoDocument(e,t){return new re(e,2,t,R.min(),R.min(),Ke.empty(),0)}static newUnknownDocument(e,t){return new re(e,3,t,R.min(),R.min(),Ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(R.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=R.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new re(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class f${constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ft=null}}function Qd(n,e=null,t=[],i=[],r=null,s=null,o=null){return new f$(n,e,t,i,r,s,o)}function fr(n){const e=S(n);if(e.ft===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>RT(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(r){return r.field.canonicalString()+r.dir}(i)).join(","),Va(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>ps(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>ps(i)).join(",")),e.ft=t}return e.ft}function Ba(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!d$(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!NT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ly(n.startAt,e.startAt)&&ly(n.endAt,e.endAt)}function hl(n){return T.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function dl(n,e){return n.filters.filter(t=>t instanceof j&&t.field.isEqual(e))}function hy(n,e,t){let i=bc,r=!0;for(const s of dl(n,e)){let o=bc,a=!0;switch(s.op){case"<":case"<=":o=r$(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=bc}oy({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];oy({value:i,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}function dy(n,e,t){let i=Zn,r=!0;for(const s of dl(n,e)){let o=Zn,a=!0;switch(s.op){case">=":case">":o=s$(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Zn}ay({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];ay({value:i,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}class Vn{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.dt=null,this._t=null,this.startAt,this.endAt}}function LT(n,e,t,i,r,s,o,a){return new Vn(n,e,t,i,r,s,o,a)}function Us(n){return new Vn(n)}function fy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ng(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Du(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(t!==null)return t}return null}function ig(n){return n.collectionGroup!==null}function Zi(n){const e=S(n);if(e.dt===null){e.dt=[];const t=Du(e),i=ng(e);if(t!==null&&i===null)t.isKeyField()||e.dt.push(new Jr(t)),e.dt.push(new Jr(Ie.keyField(),"asc"));else{let r=!1;for(const s of e.explicitOrderBy)e.dt.push(s),s.field.isKeyField()&&(r=!0);if(!r){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new Jr(Ie.keyField(),s))}}}return e.dt}function Et(n){const e=S(n);if(!e._t)if(e.limitType==="F")e._t=Qd(e.path,e.collectionGroup,Zi(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Zi(e)){const o=s.dir==="desc"?"asc":"desc";t.push(new Jr(s.field,o))}const i=e.endAt?new _i(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new _i(e.startAt.position,e.startAt.inclusive):null;e._t=Qd(e.path,e.collectionGroup,t,e.filters,e.limit,i,r)}return e._t}function Yd(n,e){e.getFirstInequalityField(),Du(n);const t=n.filters.concat([e]);return new Vn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function fl(n,e,t){return new Vn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function qa(n,e){return Ba(Et(n),Et(e))&&n.limitType===e.limitType}function FT(n){return`${fr(Et(n))}|lt:${n.limitType}`}function Xd(n){return`Query(target=${function(e){let t=e.path.canonicalString();return e.collectionGroup!==null&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(i=>PT(i)).join(", ")}]`),Va(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(i=>function(r){return`${r.field.canonicalString()} (${r.dir})`}(i)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>ps(i)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>ps(i)).join(",")),`Target(${t})`}(Et(n))}; limitType=${n.limitType})`}function rg(n,e){return e.isFoundDocument()&&function(t,i){const r=i.key.path;return t.collectionGroup!==null?i.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):T.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r)}(n,e)&&function(t,i){for(const r of Zi(t))if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0}(n,e)&&function(t,i){for(const r of t.filters)if(!r.matches(i))return!1;return!0}(n,e)&&function(t,i){return!(t.startAt&&!function(r,s,o){const a=cy(r,s,o);return r.inclusive?a<=0:a<0}(t.startAt,Zi(t),i)||t.endAt&&!function(r,s,o){const a=cy(r,s,o);return r.inclusive?a>=0:a>0}(t.endAt,Zi(t),i))}(n,e)}function UT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function $T(n){return(e,t)=>{let i=!1;for(const r of Zi(n)){const s=p$(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function p$(n,e,t){const i=n.field.isKeyField()?T.comparator(e.key,t.key):function(r,s,o){const a=s.data.field(r),c=o.data.field(r);return a!==null&&c!==null?mi(a,c):C()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return C()}}function VT(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ia(e)?"-0":e}}function BT(n){return{integerValue:""+n}}function qT(n,e){return ET(e)?BT(e):VT(n,e)}class Pu{constructor(){this._=void 0}}function g$(n,e,t){return n instanceof ms?function(i,r){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&(s.fields.__previous_value__=r),{mapValue:s}}(t,e):n instanceof pr?WT(n,e):n instanceof gr?KT(n,e):function(i,r){const s=jT(i,r),o=py(s)+py(i.gt);return Hd(s)&&Hd(i.gt)?BT(o):VT(i.yt,o)}(n,e)}function m$(n,e,t){return n instanceof pr?WT(n,e):n instanceof gr?KT(n,e):t}function jT(n,e){return n instanceof _s?Hd(t=e)||function(i){return!!i&&"doubleValue"in i}(t)?e:{integerValue:0}:null;var t}class ms extends Pu{}class pr extends Pu{constructor(e){super(),this.elements=e}}function WT(n,e){const t=GT(e);for(const i of n.elements)t.some(r=>mn(r,i))||t.push(i);return{arrayValue:{values:t}}}class gr extends Pu{constructor(e){super(),this.elements=e}}function KT(n,e){let t=GT(e);for(const i of n.elements)t=t.filter(r=>!mn(r,i));return{arrayValue:{values:t}}}class _s extends Pu{constructor(e,t){super(),this.yt=e,this.gt=t}}function py(n){return pe(n.integerValue||n.doubleValue)}function GT(n){return oa(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class ja{constructor(e,t){this.field=e,this.transform=t}}function _$(n,e){return n.field.isEqual(e.field)&&function(t,i){return t instanceof pr&&i instanceof pr||t instanceof gr&&i instanceof gr?fs(t.elements,i.elements,mn):t instanceof _s&&i instanceof _s?mn(t.gt,i.gt):t instanceof ms&&i instanceof ms}(n.transform,e.transform)}class y${constructor(e,t){this.version=e,this.transformResults=t}}class ce{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ce}static exists(e){return new ce(void 0,e)}static updateTime(e){return new ce(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Tc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class xu{}function HT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Vs(n.key,ce.none()):new $s(n.key,n.data,ce.none());{const t=n.data,i=Ke.empty();let r=new ee(Ie.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new Bn(n.key,i,new Nt(r.toArray()),ce.none())}}function v$(n,e,t){n instanceof $s?function(i,r,s){const o=i.value.clone(),a=my(i.fieldTransforms,r,s.transformResults);o.setAll(a),r.convertToFoundDocument(s.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Bn?function(i,r,s){if(!Tc(i.precondition,r))return void r.convertToUnknownDocument(s.version);const o=my(i.fieldTransforms,r,s.transformResults),a=r.data;a.setAll(zT(i)),a.setAll(o),r.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(n,e,t):function(i,r,s){r.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,t)}function To(n,e,t,i){return n instanceof $s?function(r,s,o,a){if(!Tc(r.precondition,s))return o;const c=r.value.clone(),l=_y(r.fieldTransforms,a,s);return c.setAll(l),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),null}(n,e,t,i):n instanceof Bn?function(r,s,o,a){if(!Tc(r.precondition,s))return o;const c=_y(r.fieldTransforms,a,s),l=s.data;return l.setAll(zT(r)),l.setAll(c),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),o===null?null:o.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(u=>u.field))}(n,e,t,i):function(r,s,o){return Tc(r.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):o}(n,e,t)}function w$(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=jT(i.transform,r||null);s!=null&&(t===null&&(t=Ke.empty()),t.set(i.field,s))}return t||null}function gy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(t,i){return t===void 0&&i===void 0||!(!t||!i)&&fs(t,i,(r,s)=>_$(r,s))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class $s extends xu{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Bn extends xu{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function zT(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function my(n,e,t){const i=new Map;A(n.length===t.length);for(let r=0;r<t.length;r++){const s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,m$(o,a,t[r]))}return i}function _y(n,e,t){const i=new Map;for(const r of n){const s=r.transform,o=t.data.field(r.field);i.set(r.field,g$(s,o,e))}return i}class Vs extends xu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sg extends xu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class I${constructor(e){this.count=e}}var Ee,W;function QT(n){switch(n){default:return C();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function YT(n){if(n===void 0)return we("GRPC error has no .code"),m.UNKNOWN;switch(n){case Ee.OK:return m.OK;case Ee.CANCELLED:return m.CANCELLED;case Ee.UNKNOWN:return m.UNKNOWN;case Ee.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case Ee.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case Ee.INTERNAL:return m.INTERNAL;case Ee.UNAVAILABLE:return m.UNAVAILABLE;case Ee.UNAUTHENTICATED:return m.UNAUTHENTICATED;case Ee.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case Ee.NOT_FOUND:return m.NOT_FOUND;case Ee.ALREADY_EXISTS:return m.ALREADY_EXISTS;case Ee.PERMISSION_DENIED:return m.PERMISSION_DENIED;case Ee.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case Ee.ABORTED:return m.ABORTED;case Ee.OUT_OF_RANGE:return m.OUT_OF_RANGE;case Ee.UNIMPLEMENTED:return m.UNIMPLEMENTED;case Ee.DATA_LOSS:return m.DATA_LOSS;default:return C()}}(W=Ee||(Ee={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";class ki{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Nr(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return bT(this.inner)}size(){return this.innerSize}}const b$=new _e(T.comparator);function wt(){return b$}const XT=new _e(T.comparator);function ho(...n){let e=XT;for(const t of n)e=e.insert(t.key,t);return e}function JT(n){let e=XT;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function sn(){return So()}function ZT(){return So()}function So(){return new ki(n=>n.toString(),(n,e)=>n.isEqual(e))}const E$=new _e(T.comparator),T$=new ee(T.comparator);function F(...n){let e=T$;for(const t of n)e=e.add(t);return e}const S$=new ee(L);function Ou(){return S$}class Wa{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,Ka.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new Wa(R.min(),r,Ou(),wt(),F())}}class Ka{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new Ka(i,t,F(),F(),F())}}class Sc{constructor(e,t,i,r){this.It=e,this.removedTargetIds=t,this.key=i,this.Tt=r}}class eS{constructor(e,t){this.targetId=e,this.Et=t}}class tS{constructor(e,t,i=Ae.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class yy{constructor(){this.At=0,this.Rt=wy(),this.bt=Ae.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return this.At!==0}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=F(),t=F(),i=F();return this.Rt.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:C()}}),new Ka(this.bt,this.Pt,e,t,i)}xt(){this.vt=!1,this.Rt=wy()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class C${constructor(e){this.$t=e,this.Bt=new Map,this.Lt=wt(),this.qt=vy(),this.Ut=new ee(L)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const i=this.Wt(t);switch(e.state){case 0:this.zt(t)&&i.Dt(e.resumeToken);break;case 1:i.Mt(),i.Vt||i.xt(),i.Dt(e.resumeToken);break;case 2:i.Mt(),i.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(i.Ft(),i.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),i.Dt(e.resumeToken));break;default:C()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((i,r)=>{this.zt(r)&&t(r)})}Jt(e){const t=e.targetId,i=e.Et.count,r=this.Yt(t);if(r){const s=r.target;if(hl(s))if(i===0){const o=new T(s.path);this.Qt(t,o,re.newNoDocument(o,R.min()))}else A(i===1);else this.Xt(t)!==i&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((s,o)=>{const a=this.Yt(o);if(a){if(s.current&&hl(a.target)){const c=new T(a.target.path);this.Lt.get(c)!==null||this.te(o,c)||this.Qt(o,c,re.newNoDocument(c,e))}s.St&&(t.set(o,s.Ct()),s.xt())}});let i=F();this.qt.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.Yt(c);return!l||l.purpose===2||(a=!1,!1)}),a&&(i=i.add(s))}),this.Lt.forEach((s,o)=>o.setReadTime(e));const r=new Wa(e,t,this.Ut,this.Lt,i);return this.Lt=wt(),this.qt=vy(),this.Ut=new ee(L),r}Gt(e,t){if(!this.zt(e))return;const i=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,i),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,i){if(!this.zt(e))return;const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),i&&(this.Lt=this.Lt.insert(t,i))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new yy,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new ee(L),this.qt=this.qt.insert(e,t)),t}zt(e){const t=this.Yt(e)!==null;return t||I("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new yy),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function vy(){return new _e(T.comparator)}function wy(){return new _e(T.comparator)}const k$=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),A$=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),R$=(()=>({and:"AND",or:"OR"}))();class N${constructor(e,t){this.databaseId=e,this.wt=t}}function ys(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function nS(n,e){return n.wt?e.toBase64():e.toUint8Array()}function D$(n,e){return ys(n,e.toTimestamp())}function be(n){return A(!!n),R.fromTimestamp(function(e){const t=gi(e);return new le(t.seconds,t.nanos)}(n))}function og(n,e){return function(t){return new K(["projects",t.projectId,"databases",t.database])}(n).child("documents").child(e).canonicalString()}function iS(n){const e=K.fromString(n);return A(dS(e)),e}function aa(n,e){return og(n.databaseId,e.path)}function ln(n,e){const t=iS(e);if(t.get(1)!==n.databaseId.projectId)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new T(sS(t))}function Jd(n,e){return og(n.databaseId,e)}function rS(n){const e=iS(n);return e.length===4?K.emptyPath():sS(e)}function ca(n){return new K(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function sS(n){return A(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Iy(n,e,t){return{name:aa(n,e),fields:t.value.mapValue.fields}}function oS(n,e,t){const i=ln(n,e.name),r=be(e.updateTime),s=e.createTime?be(e.createTime):R.min(),o=new Ke({mapValue:{fields:e.fields}}),a=re.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function P$(n,e){return"found"in e?function(t,i){A(!!i.found),i.found.name,i.found.updateTime;const r=ln(t,i.found.name),s=be(i.found.updateTime),o=i.found.createTime?be(i.found.createTime):R.min(),a=new Ke({mapValue:{fields:i.found.fields}});return re.newFoundDocument(r,s,o,a)}(n,e):"missing"in e?function(t,i){A(!!i.missing),A(!!i.readTime);const r=ln(t,i.missing),s=be(i.readTime);return re.newNoDocument(r,s)}(n,e):C()}function x$(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:C()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(c,l){return c.wt?(A(l===void 0||typeof l=="string"),Ae.fromBase64String(l||"")):(A(l===void 0||l instanceof Uint8Array),Ae.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=c.code===void 0?m.UNKNOWN:YT(c.code);return new y(l,c.message||"")}(o);t=new tS(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=ln(n,i.document.name),s=be(i.document.updateTime),o=i.document.createTime?be(i.document.createTime):R.min(),a=new Ke({mapValue:{fields:i.document.fields}}),c=re.newFoundDocument(r,s,o,a),l=i.targetIds||[],u=i.removedTargetIds||[];t=new Sc(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=ln(n,i.document),s=i.readTime?be(i.readTime):R.min(),o=re.newNoDocument(r,s),a=i.removedTargetIds||[];t=new Sc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=ln(n,i.document),s=i.removedTargetIds||[];t=new Sc([],s,r,null)}else{if(!("filter"in e))return C();{e.filter;const i=e.filter;i.targetId;const r=i.count||0,s=new I$(r),o=i.targetId;t=new eS(o,s)}}return t}function la(n,e){let t;if(e instanceof $s)t={update:Iy(n,e.key,e.value)};else if(e instanceof Vs)t={delete:aa(n,e.key)};else if(e instanceof Bn)t={update:Iy(n,e.key,e.data),updateMask:$$(e.fieldMask)};else{if(!(e instanceof sg))return C();t={verify:aa(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(r,s){const o=s.transform;if(o instanceof ms)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof pr)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof gr)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof _s)return{fieldPath:s.field.canonicalString(),increment:o.gt};throw C()}(0,i))),e.precondition.isNone||(t.currentDocument=function(i,r){return r.updateTime!==void 0?{updateTime:D$(i,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:C()}(n,e.precondition)),t}function Zd(n,e){const t=e.currentDocument?function(r){return r.updateTime!==void 0?ce.updateTime(be(r.updateTime)):r.exists!==void 0?ce.exists(r.exists):ce.none()}(e.currentDocument):ce.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(s,o){let a=null;if("setToServerValue"in o)A(o.setToServerValue==="REQUEST_TIME"),a=new ms;else if("appendMissingElements"in o){const l=o.appendMissingElements.values||[];a=new pr(l)}else if("removeAllFromArray"in o){const l=o.removeAllFromArray.values||[];a=new gr(l)}else"increment"in o?a=new _s(s,o.increment):C();const c=Ie.fromServerFormat(o.fieldPath);return new ja(c,a)}(n,r)):[];if(e.update){e.update.name;const r=ln(n,e.update.name),s=new Ke({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(a){const c=a.fieldPaths||[];return new Nt(c.map(l=>Ie.fromServerFormat(l)))}(e.updateMask);return new Bn(r,s,o,t,i)}return new $s(r,s,t,i)}if(e.delete){const r=ln(n,e.delete);return new Vs(r,t)}if(e.verify){const r=ln(n,e.verify);return new sg(r,t)}return C()}function O$(n,e){return n&&n.length>0?(A(e!==void 0),n.map(t=>function(i,r){let s=i.updateTime?be(i.updateTime):be(r);return s.isEqual(R.min())&&(s=be(r)),new y$(s,i.transformResults||[])}(t,e))):[]}function aS(n,e){return{documents:[Jd(n,e.path)]}}function cS(n,e){const t={structuredQuery:{}},i=e.path;e.collectionGroup!==null?(t.parent=Jd(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Jd(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(c){if(c.length!==0)return hS(J.create(c,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const s=function(c){if(c.length!==0)return c.map(l=>function(u){return{field:Vr(u.field),direction:L$(u.dir)}}(l))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=function(c,l){return c.wt||Va(l)?l:{value:l}}(n,e.limit);var a;return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),t}function lS(n){let e=rS(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){A(i===1);const u=t.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=function(u){const h=uS(u);return h instanceof J&&kT(h)?h.getFilters():[h]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(u=>function(h){return new Jr(Br(h.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction))}(u)));let a=null;t.limit&&(a=function(u){let h;return h=typeof u=="object"?u.value:u,Va(h)?null:h}(t.limit));let c=null;t.startAt&&(c=function(u){const h=!!u.before,d=u.values||[];return new _i(d,h)}(t.startAt));let l=null;return t.endAt&&(l=function(u){const h=!u.before,d=u.values||[];return new _i(d,h)}(t.endAt)),LT(e,r,o,s,a,"F",c,l)}function M$(n,e){const t=function(i,r){switch(r){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return C()}}(0,e.purpose);return t==null?null:{"goog-listen-tags":t}}function uS(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Br(e.unaryFilter.field);return j.create(t,"==",{doubleValue:NaN});case"IS_NULL":const i=Br(e.unaryFilter.field);return j.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Br(e.unaryFilter.field);return j.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Br(e.unaryFilter.field);return j.create(s,"!=",{nullValue:"NULL_VALUE"});default:return C()}}(n):n.fieldFilter!==void 0?function(e){return j.create(Br(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return C()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return J.create(e.compositeFilter.filters.map(t=>uS(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return C()}}(e.compositeFilter.op))}(n):C()}function L$(n){return k$[n]}function F$(n){return A$[n]}function U$(n){return R$[n]}function Vr(n){return{fieldPath:n.canonicalString()}}function Br(n){return Ie.fromServerFormat(n.fieldPath)}function hS(n){return n instanceof j?function(e){if(e.op==="=="){if(sy(e.value))return{unaryFilter:{field:Vr(e.field),op:"IS_NAN"}};if(ry(e.value))return{unaryFilter:{field:Vr(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(sy(e.value))return{unaryFilter:{field:Vr(e.field),op:"IS_NOT_NAN"}};if(ry(e.value))return{unaryFilter:{field:Vr(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vr(e.field),op:F$(e.op),value:e.value}}}(n):n instanceof J?function(e){const t=e.getFilters().map(i=>hS(i));return t.length===1?t[0]:{compositeFilter:{op:U$(e.op),filters:t}}}(n):C()}function $$(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function dS(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function dt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=by(e)),e=V$(n.get(t),e);return by(e)}function V$(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function by(n){return n+""}function on(n){const e=n.length;if(A(e>=2),e===2)return A(n.charAt(0)===""&&n.charAt(1)===""),K.emptyPath();const t=e-2,i=[];let r="";for(let s=0;s<e;){const o=n.indexOf("",s);switch((o<0||o>t)&&C(),n.charAt(o+1)){case"":const a=n.substring(s,o);let c;r.length===0?c=a:(r+=a,c=r,r=""),i.push(c);break;case"":r+=n.substring(s,o),r+="\0";break;case"":r+=n.substring(s,o+1);break;default:C()}s=o+2}return new K(i)}const Ey=["userId","batchId"];function Cc(n,e){return[n,dt(e)]}function fS(n,e,t){return[n,dt(e),t]}const B$={},q$=["prefixPath","collectionGroup","readTime","documentId"],j$=["prefixPath","collectionGroup","documentId"],W$=["collectionGroup","readTime","prefixPath","documentId"],K$=["canonicalId","targetId"],G$=["targetId","path"],H$=["path","targetId"],z$=["collectionId","parent"],Q$=["indexId","uid"],Y$=["uid","sequenceNumber"],X$=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],J$=["indexId","uid","orderedDocumentKey"],Z$=["userId","collectionPath","documentId"],eV=["userId","collectionPath","largestBatchId"],tV=["userId","collectionGroup","largestBatchId"],pS=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],nV=[...pS,"documentOverlays"],gS=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],mS=gS,iV=[...mS,"indexConfiguration","indexState","indexEntries"];class ef extends IT{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function qe(n,e){const t=S(n);return Ht.M(t.se,e)}class ag{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&v$(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=To(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=To(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=ZT();return this.mutations.forEach(r=>{const s=e.get(r.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;const c=HT(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(R.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),F())}isEqual(e){return this.batchId===e.batchId&&fs(this.mutations,e.mutations,(t,i)=>gy(t,i))&&fs(this.baseMutations,e.baseMutations,(t,i)=>gy(t,i))}}class cg{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){A(e.mutations.length===i.length);let r=E$;const s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new cg(e,t,i,r)}}class lg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ii{constructor(e,t,i,r,s=R.min(),o=R.min(),a=Ae.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new ii(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new ii(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ii(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class _S{constructor(e){this.ie=e}}function rV(n,e){let t;if(e.document)t=oS(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=T.fromSegments(e.noDocument.path),r=_r(e.noDocument.readTime);t=re.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return C();{const i=T.fromSegments(e.unknownDocument.path),r=_r(e.unknownDocument.version);t=re.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(i){const r=new le(i[0],i[1]);return R.fromTimestamp(r)}(e.readTime)),t}function Ty(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:pl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(r,s){return{name:aa(r,s.key),fields:s.data.value.mapValue.fields,updateTime:ys(r,s.version.toTimestamp()),createTime:ys(r,s.createTime.toTimestamp())}}(n.ie,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:mr(e.version)};else{if(!e.isUnknownDocument())return C();i.unknownDocument={path:t.path.toArray(),version:mr(e.version)}}return i}function pl(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function mr(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function _r(n){const e=new le(n.seconds,n.nanoseconds);return R.fromTimestamp(e)}function Fi(n,e){const t=(e.baseMutations||[]).map(s=>Zd(n.ie,s));for(let s=0;s<e.mutations.length-1;++s){const o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const i=e.mutations.map(s=>Zd(n.ie,s)),r=le.fromMillis(e.localWriteTimeMs);return new ag(e.batchId,r,t,i)}function fo(n){const e=_r(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?_r(n.lastLimboFreeSnapshotVersion):R.min();let i;var r;return n.query.documents!==void 0?(A((r=n.query).documents.length===1),i=Et(Us(rS(r.documents[0])))):i=function(s){return Et(lS(s))}(n.query),new ii(i,n.targetId,0,n.lastListenSequenceNumber,e,t,Ae.fromBase64String(n.resumeToken))}function yS(n,e){const t=mr(e.snapshotVersion),i=mr(e.lastLimboFreeSnapshotVersion);let r;r=hl(e.target)?aS(n.ie,e.target):cS(n.ie,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:fr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ug(n){const e=lS({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?fl(e,e.limit,"L"):e}function Ph(n,e){return new lg(e.largestBatchId,Zd(n.ie,e.overlayMutation))}function Sy(n,e){const t=e.path.lastSegment();return[n,dt(e.path.popLast()),t]}function Cy(n,e,t,i){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:mr(i.readTime),documentKey:dt(i.documentKey.path),largestBatchId:i.largestBatchId}}class sV{getBundleMetadata(e,t){return ky(e).get(t).next(i=>{if(i)return{id:(r=i).bundleId,createTime:_r(r.createTime),version:r.version};var r})}saveBundleMetadata(e,t){return ky(e).put({bundleId:(i=t).id,createTime:mr(be(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Ay(e).get(t).next(i=>{if(i)return{name:(r=i).name,query:ug(r.bundledQuery),readTime:_r(r.readTime)};var r})}saveNamedQuery(e,t){return Ay(e).put(function(i){return{name:i.name,readTime:mr(be(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function ky(n){return qe(n,"bundles")}function Ay(n){return qe(n,"namedQueries")}class Mu{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){const i=t.uid||"";return new Mu(e,i)}getOverlay(e,t){return eo(e).get(Sy(this.userId,t)).next(i=>i?Ph(this.yt,i):null)}getOverlays(e,t){const i=sn();return g.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){const r=[];return i.forEach((s,o)=>{const a=new lg(t,o);r.push(this.oe(e,a))}),g.waitFor(r)}removeOverlaysForBatchId(e,t,i){const r=new Set;t.forEach(o=>r.add(dt(o.getCollectionPath())));const s=[];return r.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(eo(e).Y("collectionPathOverlayIndex",a))}),g.waitFor(s)}getOverlaysForCollection(e,t,i){const r=sn(),s=dt(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return eo(e).W("collectionPathOverlayIndex",o).next(a=>{for(const c of a){const l=Ph(this.yt,c);r.set(l.getKey(),l)}return r})}getOverlaysForCollectionGroup(e,t,i,r){const s=sn();let o;const a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return eo(e).Z({index:"collectionGroupOverlayIndex",range:a},(c,l,u)=>{const h=Ph(this.yt,l);s.size()<r||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>s)}oe(e,t){return eo(e).put(function(i,r,s){const[o,a,c]=Sy(r,s.mutation.key);return{userId:r,collectionPath:a,documentId:c,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:la(i.ie,s.mutation)}}(this.yt,this.userId,t))}}function eo(n){return qe(n,"documentOverlays")}class Ui{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(pe(e.integerValue));else if("doubleValue"in e){const i=pe(e.doubleValue);isNaN(i)?this.he(t,13):(this.he(t,15),ia(i)?t.le(0):t.le(i))}else if("timestampValue"in e){const i=e.timestampValue;this.he(t,20),typeof i=="string"?t.fe(i):(t.fe(`${i.seconds||""}`),t.le(i.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(ur(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.he(t,45),t.le(i.latitude||0),t.le(i.longitude||0)}else"mapValue"in e?ST(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):C()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const i=e.fields||{};this.he(t,55);for(const r of Object.keys(i))this.de(r,t),this.ce(i[r],t)}ye(e,t){const i=e.values||[];this.he(t,50);for(const r of i)this.ce(r,t)}me(e,t){this.he(t,37),T.fromName(e).path.forEach(i=>{this.he(t,60),this.pe(i,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}Ui.Ie=new Ui;function oV(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Ry(n){const e=64-function(t){let i=0;for(let r=0;r<8;++r){const s=oV(255&t[r]);if(i+=s,s!==8)break}return i}(n);return Math.ceil(e/8)}class aV{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Ee(i.value),i=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.be(i.value),i=t.next();this.Pe()}ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Ee(i);else if(i<2048)this.Ee(960|i>>>6),this.Ee(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Ee(480|i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i);else{const r=t.codePointAt(0);this.Ee(240|r>>>18),this.Ee(128|63&r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r)}}this.Ae()}Ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.be(i);else if(i<2048)this.be(960|i>>>6),this.be(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.be(480|i>>>12),this.be(128|63&i>>>6),this.be(128|63&i);else{const r=t.codePointAt(0);this.be(240|r>>>18),this.be(128|63&r>>>12),this.be(128|63&r>>>6),this.be(128|63&r)}}this.Pe()}Se(e){const t=this.De(e),i=Ry(t);this.Ce(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}xe(e){const t=this.De(e),i=Ry(t);this.Ce(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(r){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,r,!1),new Uint8Array(s.buffer)}(e),i=(128&t[0])!=0;t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Ee(e){const t=255&e;t===0?(this.ke(0),this.ke(255)):t===255?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;t===0?(this.Me(0),this.Me(255)):t===255?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}}class cV{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class lV{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class to{constructor(){this.$e=new aV,this.Be=new cV(this.$e),this.Le=new lV(this.$e)}seed(e){this.$e.seed(e)}qe(e){return e===0?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class $i{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new $i(this.indexId,this.documentKey,this.arrayValue,i)}}function Kn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Ny(n.arrayValue,e.arrayValue),t!==0?t:(t=Ny(n.directionalValue,e.directionalValue),t!==0?t:T.comparator(n.documentKey,e.documentKey)))}function Ny(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}class uV{constructor(e){this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const i=t;i.isInequality()?this.Qe=i:this.Ge.push(i)}}je(e){A(e.collectionGroup===this.collectionId);const t=Kd(e);if(t!==void 0&&!this.We(t))return!1;const i=Oi(e);let r=0,s=0;for(;r<i.length&&this.We(i[r]);++r);if(r===i.length)return!0;if(this.Qe!==void 0){const o=i[r];if(!this.ze(this.Qe,o)||!this.He(this.Ke[s++],o))return!1;++r}for(;r<i.length;++r){const o=i[r];if(s>=this.Ke.length||!this.He(this.Ke[s++],o))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function vS(n){var e,t;if(A(n instanceof j||n instanceof J),n instanceof j){if(n instanceof OT){const r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>j.create(n.field,"==",s)))||[];return J.create(r,"or")}return n}const i=n.filters.map(r=>vS(r));return J.create(i,n.op)}function hV(n){if(n.getFilters().length===0)return[];const e=rf(vS(n));return A(wS(e)),tf(e)||nf(e)?[e]:e.getFilters()}function tf(n){return n instanceof j}function nf(n){return n instanceof J&&kT(n)}function wS(n){return tf(n)||nf(n)||function(e){if(e instanceof J&&zd(e)){for(const t of e.getFilters())if(!tf(t)&&!nf(t))return!1;return!0}return!1}(n)}function rf(n){if(A(n instanceof j||n instanceof J),n instanceof j)return n;if(n.filters.length===1)return rf(n.filters[0]);const e=n.filters.map(i=>rf(i));let t=J.create(e,n.op);return t=gl(t),wS(t)?t:(A(t instanceof J),A(gs(t)),A(t.filters.length>1),t.filters.reduce((i,r)=>hg(i,r)))}function hg(n,e){let t;return A(n instanceof j||n instanceof J),A(e instanceof j||e instanceof J),t=n instanceof j?e instanceof j?function(i,r){return J.create([i,r],"and")}(n,e):Dy(n,e):e instanceof j?Dy(e,n):function(i,r){if(A(i.filters.length>0&&r.filters.length>0),gs(i)&&gs(r))return DT(i,r.getFilters());const s=zd(i)?i:r,o=zd(i)?r:i,a=s.filters.map(c=>hg(c,o));return J.create(a,"or")}(n,e),gl(t)}function Dy(n,e){if(gs(e))return DT(e,n.getFilters());{const t=e.filters.map(i=>hg(n,i));return J.create(t,"or")}}function gl(n){if(A(n instanceof j||n instanceof J),n instanceof j)return n;const e=n.getFilters();if(e.length===1)return gl(e[0]);if(AT(n))return n;const t=e.map(r=>gl(r)),i=[];return t.forEach(r=>{r instanceof j?i.push(r):r instanceof J&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:J.create(i,n.op)}class dV{constructor(){this.Je=new dg}addToCollectionParentIndex(e,t){return this.Je.add(t),g.resolve()}getCollectionParents(e,t){return g.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return g.resolve()}deleteFieldIndex(e,t){return g.resolve()}getDocumentsMatchingTarget(e,t){return g.resolve(null)}getIndexType(e,t){return g.resolve(0)}getFieldIndexes(e,t){return g.resolve([])}getNextCollectionGroupToUpdate(e){return g.resolve(null)}getMinOffset(e,t){return g.resolve(Ot.min())}getMinOffsetFromCollectionGroup(e,t){return g.resolve(Ot.min())}updateCollectionGroup(e,t,i){return g.resolve()}updateIndexEntries(e,t){return g.resolve()}}class dg{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new ee(K.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new ee(K.comparator)).toArray()}}const lc=new Uint8Array(0);class fV{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new dg,this.Xe=new ki(i=>fr(i),(i,r)=>Ba(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const s={collectionId:i,parent:dt(r)};return Py(e).put(s)}return g.resolve()}getCollectionParents(e,t){const i=[],r=IDBKeyRange.bound([t,""],[mT(t),""],!1,!0);return Py(e).W(r).next(s=>{for(const o of s){if(o.collectionId!==t)break;i.push(on(o.parent))}return i})}addFieldIndex(e,t){const i=uc(e),r=function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}(t);delete r.indexId;const s=i.add(r);if(t.indexState){const o=io(e);return s.next(a=>{o.put(Cy(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const i=uc(e),r=io(e),s=no(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const i=no(e);let r=!0;const s=new Map;return g.forEach(this.Ze(t),o=>this.tn(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=F();const a=[];return g.forEach(s,(c,l)=>{var u;I("IndexedDbIndexManager",`Using index ${u=c,`id=${u.indexId}|cg=${u.collectionGroup}|f=${u.fields.map(x=>`${x.fieldPath}:${x.kind}`).join(",")}`} to execute ${fr(t)}`);const h=function(x,U){const X=Kd(U);if(X===void 0)return null;for(const z of dl(x,X.fieldPath))switch(z.op){case"array-contains-any":return z.value.arrayValue.values||[];case"array-contains":return[z.value]}return null}(l,c),d=function(x,U){const X=new Map;for(const z of Oi(U))for(const ve of dl(x,z.fieldPath))switch(ve.op){case"==":case"in":X.set(z.fieldPath.canonicalString(),ve.value);break;case"not-in":case"!=":return X.set(z.fieldPath.canonicalString(),ve.value),Array.from(X.values())}return null}(l,c),f=function(x,U){const X=[];let z=!0;for(const ve of Oi(U)){const St=ve.kind===0?hy(x,ve.fieldPath,x.startAt):dy(x,ve.fieldPath,x.startAt);X.push(St.value),z&&(z=St.inclusive)}return new _i(X,z)}(l,c),p=function(x,U){const X=[];let z=!0;for(const ve of Oi(U)){const St=ve.kind===0?dy(x,ve.fieldPath,x.endAt):hy(x,ve.fieldPath,x.endAt);X.push(St.value),z&&(z=St.inclusive)}return new _i(X,z)}(l,c),_=this.en(c,l,f),w=this.en(c,l,p),N=this.nn(c,l,d),M=this.sn(c.indexId,h,_,f.inclusive,w,p.inclusive,N);return g.forEach(M,x=>i.J(x,t.limit).next(U=>{U.forEach(X=>{const z=T.fromSegments(X.documentKey);o.has(z)||(o=o.add(z),a.push(z))})}))}).next(()=>a)}return g.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(e.filters.length===0?t=[e]:t=hV(J.create(e.filters,"and")).map(i=>Qd(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,i,r,s,o,a){const c=(t!=null?t.length:1)*Math.max(i.length,s.length),l=c/(t!=null?t.length:1),u=[];for(let h=0;h<c;++h){const d=t?this.rn(t[h/l]):lc,f=this.on(e,d,i[h%l],r),p=this.un(e,d,s[h%l],o),_=a.map(w=>this.on(e,d,w,!0));u.push(...this.createRange(f,p,_))}return u}on(e,t,i,r){const s=new $i(e,T.empty(),t,i);return r?s:s.Ue()}un(e,t,i,r){const s=new $i(e,T.empty(),t,i);return r?s.Ue():s}tn(e,t){const i=new uV(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(const a of s)i.je(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2;const r=this.Ze(t);return g.forEach(r,s=>this.tn(e,s).next(o=>{o?i!==0&&o.fields.length<function(a){let c=new ee(Ie.comparator),l=!1;for(const u of a.filters)for(const h of u.getFlattenedFilters())h.field.isKeyField()||(h.op==="array-contains"||h.op==="array-contains-any"?l=!0:c=c.add(h.field));for(const u of a.orderBy)u.field.isKeyField()||(c=c.add(u.field));return c.size+(l?1:0)}(s)&&(i=1):i=0})).next(()=>function(s){return s.limit!==null}(t)&&r.length>1&&i===2?1:i)}cn(e,t){const i=new to;for(const r of Oi(e)){const s=t.data.field(r.fieldPath);if(s==null)return null;const o=i.qe(r.kind);Ui.Ie.ue(s,o)}return i.Fe()}rn(e){const t=new to;return Ui.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const i=new to;return Ui.Ie.ue(dr(this.databaseId,t),i.qe(function(r){const s=Oi(r);return s.length===0?0:s[s.length-1].kind}(e))),i.Fe()}nn(e,t,i){if(i===null)return[];let r=[];r.push(new to);let s=0;for(const o of Oi(e)){const a=i[s++];for(const c of r)if(this.hn(t,o.fieldPath)&&oa(a))r=this.ln(r,o,a);else{const l=c.qe(o.kind);Ui.Ie.ue(a,l)}}return this.fn(r)}en(e,t,i){return this.nn(e,t,i.position)}fn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Fe();return t}ln(e,t,i){const r=[...e],s=[];for(const o of i.arrayValue.values||[])for(const a of r){const c=new to;c.seed(a.Fe()),Ui.Ie.ue(o,c.qe(t.kind)),s.push(c)}return s}hn(e,t){return!!e.filters.find(i=>i instanceof j&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){const i=uc(e),r=io(e);return(t?i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.W()).next(s=>{const o=[];return g.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(function(l,u){const h=u?new ul(u.sequenceNumber,new Ot(_r(u.readTime),new T(on(u.documentKey)),u.largestBatchId)):ul.empty(),d=l.fields.map(([f,p])=>new YU(Ie.fromServerFormat(f),p));return new _T(l.indexId,l.collectionGroup,d,h)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{const s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:L(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const r=uc(e),s=io(e);return this.dn(e).next(o=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>g.forEach(a,c=>s.put(Cy(c.indexId,this.user,o,i)))))}updateIndexEntries(e,t){const i=new Map;return g.forEach(t,(r,s)=>{const o=i.get(r.collectionGroup);return(o?g.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),g.forEach(a,c=>this._n(e,r,c).next(l=>{const u=this.wn(s,c);return l.isEqual(u)?g.resolve():this.mn(e,s,c,l,u)}))))})}gn(e,t,i,r){return no(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(i,t.key),documentKey:t.key.path.toArray()})}yn(e,t,i,r){return no(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(i,t.key),t.key.path.toArray()])}_n(e,t,i){const r=no(e);let s=new ee(Kn);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.an(i,t)])},(o,a)=>{s=s.add(new $i(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}wn(e,t){let i=new ee(Kn);const r=this.cn(t,e);if(r==null)return i;const s=Kd(t);if(s!=null){const o=e.data.field(s.fieldPath);if(oa(o))for(const a of o.arrayValue.values||[])i=i.add(new $i(t.indexId,e.key,this.rn(a),r))}else i=i.add(new $i(t.indexId,e.key,lc,r));return i}mn(e,t,i,r,s){I("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,c,l,u,h){const d=a.getIterator(),f=c.getIterator();let p=Fr(d),_=Fr(f);for(;p||_;){let w=!1,N=!1;if(p&&_){const M=l(p,_);M<0?N=!0:M>0&&(w=!0)}else p!=null?N=!0:w=!0;w?(u(_),_=Fr(f)):N?(h(p),p=Fr(d)):(p=Fr(d),_=Fr(f))}}(r,s,Kn,a=>{o.push(this.gn(e,t,i,a))},a=>{o.push(this.yn(e,t,i,a))}),g.waitFor(o)}dn(e){let t=1;return io(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>Kn(o,a)).filter((o,a,c)=>!a||Kn(o,c[a-1])!==0);const r=[];r.push(e);for(const o of i){const a=Kn(o,e),c=Kn(o,t);if(a===0)r[0]=e.Ue();else if(a>0&&c<0)r.push(o),r.push(o.Ue());else if(c>0)break}r.push(t);const s=[];for(let o=0;o<r.length;o+=2){if(this.pn(r[o],r[o+1]))return[];const a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,lc,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,lc,[]];s.push(IDBKeyRange.bound(a,c))}return s}pn(e,t){return Kn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(xy)}getMinOffset(e,t){return g.mapArray(this.Ze(t),i=>this.tn(e,i).next(r=>r||C())).next(xy)}}function Py(n){return qe(n,"collectionParents")}function no(n){return qe(n,"indexEntries")}function uc(n){return qe(n,"indexConfiguration")}function io(n){return qe(n,"indexState")}function xy(n){A(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const r=n[i].indexState.offset;Zp(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Ot(e.readTime,e.documentKey,t)}const Oy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class mt{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new mt(e,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function IS(n,e,t){const i=n.store("mutations"),r=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=i.Z({range:o},(u,h,d)=>(a++,d.delete()));s.push(c.next(()=>{A(a===1)}));const l=[];for(const u of t.mutations){const h=fS(e,u.key.path,t.batchId);s.push(r.delete(h)),l.push(u.key)}return g.waitFor(s).next(()=>l)}function ml(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw C();e=n.noDocument}return JSON.stringify(e).length}mt.DEFAULT_COLLECTION_PERCENTILE=10,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mt.DEFAULT=new mt(41943040,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mt.DISABLED=new mt(-1,0,0);class Lu{constructor(e,t,i,r){this.userId=e,this.yt=t,this.indexManager=i,this.referenceDelegate=r,this.In={}}static re(e,t,i,r){A(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new Lu(s,t,i,r)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gn(e).Z({index:"userMutationsIndex",range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){const s=qr(e),o=Gn(e);return o.add({}).next(a=>{A(typeof a=="number");const c=new ag(a,t,i,r),l=function(d,f,p){const _=p.baseMutations.map(N=>la(d.ie,N)),w=p.mutations.map(N=>la(d.ie,N));return{userId:f,batchId:p.batchId,localWriteTimeMs:p.localWriteTime.toMillis(),baseMutations:_,mutations:w}}(this.yt,this.userId,c),u=[];let h=new ee((d,f)=>L(d.canonicalString(),f.canonicalString()));for(const d of r){const f=fS(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(l)),u.push(s.put(f,B$))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.In[a]=c.keys()}),g.waitFor(u).next(()=>c)})}lookupMutationBatch(e,t){return Gn(e).get(t).next(i=>i?(A(i.userId===this.userId),Fi(this.yt,i)):null)}Tn(e,t){return this.In[t]?g.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const r=i.keys();return this.In[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]);let s=null;return Gn(e).Z({index:"userMutationsIndex",range:r},(o,a,c)=>{a.userId===this.userId&&(A(a.batchId>=i),s=Fi(this.yt,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return Gn(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Gn(e).W("userMutationsIndex",t).next(i=>i.map(r=>Fi(this.yt,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=Cc(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return qr(e).Z({range:r},(o,a,c)=>{const[l,u,h]=o,d=on(u);if(l===this.userId&&t.path.isEqual(d))return Gn(e).get(h).next(f=>{if(!f)throw C();A(f.userId===this.userId),s.push(Fi(this.yt,f))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ee(L);const r=[];return t.forEach(s=>{const o=Cc(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=qr(e).Z({range:a},(l,u,h)=>{const[d,f,p]=l,_=on(f);d===this.userId&&s.path.isEqual(_)?i=i.add(p):h.done()});r.push(c)}),g.waitFor(r).next(()=>this.En(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1,s=Cc(this.userId,i),o=IDBKeyRange.lowerBound(s);let a=new ee(L);return qr(e).Z({range:o},(c,l,u)=>{const[h,d,f]=c,p=on(d);h===this.userId&&i.isPrefixOf(p)?p.length===r&&(a=a.add(f)):u.done()}).next(()=>this.En(e,a))}En(e,t){const i=[],r=[];return t.forEach(s=>{r.push(Gn(e).get(s).next(o=>{if(o===null)throw C();A(o.userId===this.userId),i.push(Fi(this.yt,o))}))}),g.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return IS(e.se,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),g.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return g.resolve();const i=IDBKeyRange.lowerBound([this.userId]),r=[];return qr(e).Z({range:i},(s,o,a)=>{if(s[0]===this.userId){const c=on(s[1]);r.push(c)}else a.done()}).next(()=>{A(r.length===0)})})}containsKey(e,t){return bS(e,this.userId,t)}Rn(e){return ES(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function bS(n,e,t){const i=Cc(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i);let o=!1;return qr(n).Z({range:s,X:!0},(a,c,l)=>{const[u,h,d]=a;u===e&&h===r&&(o=!0),l.done()}).next(()=>o)}function Gn(n){return qe(n,"mutations")}function qr(n){return qe(n,"documentMutations")}function ES(n){return qe(n,"mutationQueues")}class yr{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new yr(0)}static vn(){return new yr(-1)}}class pV{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const i=new yr(t.highestTargetId);return t.highestTargetId=i.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>R.fromTimestamp(new le(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Vn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(i=>(i.targetCount+=1,this.Cn(t,i),this.Sn(e,i))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ur(e).delete(t.targetId)).next(()=>this.Vn(e)).next(i=>(A(i.targetCount>0),i.targetCount-=1,this.Sn(e,i)))}removeTargets(e,t,i){let r=0;const s=[];return Ur(e).Z((o,a)=>{const c=fo(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>g.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Ur(e).Z((i,r)=>{const s=fo(r);t(s)})}Vn(e){return My(e).get("targetGlobalKey").next(t=>(A(t!==null),t))}Sn(e,t){return My(e).put("targetGlobalKey",t)}Dn(e,t){return Ur(e).put(yS(this.yt,t))}Cn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const i=fr(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let s=null;return Ur(e).Z({range:r,index:"queryTargetsIndex"},(o,a,c)=>{const l=fo(a);Ba(t,l.target)&&(s=l,c.done())}).next(()=>s)}addMatchingKeys(e,t,i){const r=[],s=zn(e);return t.forEach(o=>{const a=dt(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),g.waitFor(r)}removeMatchingKeys(e,t,i){const r=zn(e);return g.forEach(t,s=>{const o=dt(s.path);return g.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){const i=zn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),r=zn(e);let s=F();return r.Z({range:i,X:!0},(o,a,c)=>{const l=on(o[1]),u=new T(l);s=s.add(u)}).next(()=>s)}containsKey(e,t){const i=dt(t.path),r=IDBKeyRange.bound([i],[mT(i)],!1,!0);let s=0;return zn(e).Z({index:"documentTargetsIndex",X:!0,range:r},([o,a],c,l)=>{o!==0&&(s++,l.done())}).next(()=>s>0)}ne(e,t){return Ur(e).get(t).next(i=>i?fo(i):null)}}function Ur(n){return qe(n,"targets")}function My(n){return qe(n,"targetGlobal")}function zn(n){return qe(n,"targetDocuments")}function Ly([n,e],[t,i]){const r=L(n,t);return r===0?L(e,i):r}class gV{constructor(e){this.xn=e,this.buffer=new ee(Ly),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();Ly(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class mV{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Mn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return this.Mn!==null}Fn(e){I("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ci(t)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Si(t)}await this.Fn(3e5)})}}class _V{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return g.resolve(vt.at);const i=new gV(t);return this.$n.forEachTarget(e,r=>i.On(r.sequenceNumber)).next(()=>this.$n.Ln(e,r=>i.On(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.$n.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(I("LruGarbageCollector","Garbage collection skipped; disabled"),g.resolve(Oy)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Oy):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let i,r,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,o=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(i=h,a=Date.now(),this.removeTargets(e,i,t))).next(h=>(s=h,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(h=>(l=Date.now(),Wd()<=$.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${h} documents in `+(l-c)+`ms
Total Duration: ${l-u}ms`),g.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:h})))}}class yV{constructor(e,t){this.db=e,this.garbageCollector=function(i,r){return new _V(i,r)}(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}Un(e){let t=0;return this.Ln(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(i,r)=>t(r))}addReference(e,t,i){return hc(e,i)}removeReference(e,t,i){return hc(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return hc(e,t)}Gn(e,t){return function(i,r){let s=!1;return ES(i).tt(o=>bS(i,o,r).next(a=>(a&&(s=!0),g.resolve(!a)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Kn(e,(o,a)=>{if(a<=t){const c=this.Gn(e,o).next(l=>{if(!l)return s++,i.getEntry(e,o).next(()=>(i.removeEntry(o,R.min()),zn(e).delete([0,dt(o.path)])))});r.push(c)}}).next(()=>g.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return hc(e,t)}Kn(e,t){const i=zn(e);let r,s=vt.at;return i.Z({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:l})=>{o===0?(s!==vt.at&&t(new T(on(r)),s),s=l,r=c):s=vt.at}).next(()=>{s!==vt.at&&t(new T(on(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function hc(n,e){return zn(n).put(function(t,i){return{targetId:0,path:dt(t.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}class TS{constructor(){this.changes=new ki(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?g.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class vV{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return Di(e).put(i)}removeEntry(e,t,i){return Di(e).delete(function(r,s){const o=r.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],pl(s),o[o.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.Qn(e,i)))}getEntry(e,t){let i=re.newInvalidDocument(t);return Di(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(ro(t))},(r,s)=>{i=this.jn(t,s)}).next(()=>i)}Wn(e,t){let i={size:0,document:re.newInvalidDocument(t)};return Di(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(ro(t))},(r,s)=>{i={document:this.jn(t,s),size:ml(s)}}).next(()=>i)}getEntries(e,t){let i=wt();return this.zn(e,t,(r,s)=>{const o=this.jn(r,s);i=i.insert(r,o)}).next(()=>i)}Hn(e,t){let i=wt(),r=new _e(T.comparator);return this.zn(e,t,(s,o)=>{const a=this.jn(s,o);i=i.insert(s,a),r=r.insert(s,ml(o))}).next(()=>({documents:i,Jn:r}))}zn(e,t,i){if(t.isEmpty())return g.resolve();let r=new ee($y);t.forEach(c=>r=r.add(c));const s=IDBKeyRange.bound(ro(r.first()),ro(r.last())),o=r.getIterator();let a=o.getNext();return Di(e).Z({index:"documentKeyIndex",range:s},(c,l,u)=>{const h=T.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;a&&$y(a,h)<0;)i(a,null),a=o.getNext();a&&a.isEqual(h)&&(i(a,l),a=o.hasNext()?o.getNext():null),a?u.j(ro(a)):u.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(e,t,i){const r=[t.popLast().toArray(),t.lastSegment(),pl(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Di(e).W(IDBKeyRange.bound(r,s,!0)).next(o=>{let a=wt();for(const c of o){const l=this.jn(T.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);a=a.insert(l.key,l)}return a})}getAllFromCollectionGroup(e,t,i,r){let s=wt();const o=Uy(t,i),a=Uy(t,Ot.max());return Di(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,l,u)=>{const h=this.jn(T.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(h.key,h),s.size===r&&u.done()}).next(()=>s)}newChangeBuffer(e){return new wV(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Fy(e).get("remoteDocumentGlobalKey").next(t=>(A(!!t),t))}Qn(e,t){return Fy(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const i=rV(this.yt,t);if(!(i.isNoDocument()&&i.version.isEqual(R.min())))return i}return re.newInvalidDocument(e)}}function SS(n){return new vV(n)}class wV extends TS{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new ki(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){const t=[];let i=0,r=new ee((s,o)=>L(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.Xn.get(s);if(t.push(this.Yn.removeEntry(e,s,a.readTime)),o.isValidDocument()){const c=Ty(this.Yn.yt,o);r=r.add(s.path.popLast());const l=ml(c);i+=l-a.size,t.push(this.Yn.addEntry(e,s,c))}else if(i-=a.size,this.trackRemovals){const c=Ty(this.Yn.yt,o.convertToNoDocument(R.min()));t.push(this.Yn.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Yn.updateMetadata(e,i)),g.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(i=>(this.Xn.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:i,Jn:r})=>(r.forEach((s,o)=>{this.Xn.set(s,{size:o,readTime:i.get(s).readTime})}),i))}}function Fy(n){return qe(n,"remoteDocumentGlobal")}function Di(n){return qe(n,"remoteDocumentsV14")}function ro(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Uy(n,e){const t=e.documentKey.path.toArray();return[n,pl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function $y(n,e){const t=n.path.toArray(),i=e.path.toArray();let r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=L(t[s],i[s]),r)return r;return r=L(t.length,i.length),r||(r=L(t[t.length-2],i[i.length-2]),r||L(t[t.length-1],i[i.length-1]))}class IV{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class CS{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&To(i.mutation,r,Nt.empty(),le.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,F()).next(()=>i))}getLocalViewOfDocuments(e,t,i=F()){const r=sn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=ho();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const i=sn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,F()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=wt();const o=So(),a=So();return t.forEach((c,l)=>{const u=i.get(l.key);r.has(l.key)&&(u===void 0||u.mutation instanceof Bn)?s=s.insert(l.key,l):u!==void 0&&(o.set(l.key,u.mutation.getFieldMask()),To(u.mutation,l,u.mutation.getFieldMask(),le.now()))}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((l,u)=>o.set(l,u)),t.forEach((l,u)=>{var h;return a.set(l,new IV(u,(h=o.get(l))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){const i=So();let r=new _e((o,a)=>o-a),s=F();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const l=t.get(c);if(l===null)return;let u=i.get(c)||Nt.empty();u=a.applyToLocalView(l,u),i.set(c,u);const h=(r.get(a.batchId)||F()).add(c);r=r.insert(a.batchId,h)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,u=c.value,h=ZT();u.forEach(d=>{if(!s.has(d)){const f=HT(t.get(d),i.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,h))}return g.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i){return function(r){return T.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ig(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i):this.getDocumentsMatchingCollectionQuery(e,t,i)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):g.resolve(sn());let a=-1,c=s;return o.next(l=>g.forEach(l,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?g.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{c=c.insert(u,d)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,c,l,F())).next(u=>({batchId:a,changes:JT(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new T(t)).next(i=>{let r=ho();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i){const r=t.collectionGroup;let s=ho();return this.indexManager.getCollectionParents(e,r).next(o=>g.forEach(o,a=>{const c=function(l,u){return new Vn(u,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(t,a.child(r));return this.getDocumentsMatchingCollectionQuery(e,c,i).next(l=>{l.forEach((u,h)=>{s=s.insert(u,h)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,i){let r;return this.remoteDocumentCache.getAllFromCollection(e,t.path,i).next(s=>(r=s,this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId))).next(s=>{s.forEach((a,c)=>{const l=c.getKey();r.get(l)===null&&(r=r.insert(l,re.newInvalidDocument(l)))});let o=ho();return r.forEach((a,c)=>{const l=s.get(a);l!==void 0&&To(l.mutation,c,Nt.empty(),le.now()),rg(t,c)&&(o=o.insert(a,c))}),o})}}class bV{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return g.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var i;return this.Zn.set(t.id,{id:(i=t).id,version:i.version,createTime:be(i.createTime)}),g.resolve()}getNamedQuery(e,t){return g.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,function(i){return{name:i.name,query:ug(i.bundledQuery),readTime:be(i.readTime)}}(t)),g.resolve()}}class EV{constructor(){this.overlays=new _e(T.comparator),this.es=new Map}getOverlay(e,t){return g.resolve(this.overlays.get(t))}getOverlays(e,t){const i=sn();return g.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.oe(e,t,s)}),g.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.es.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(i)),g.resolve()}getOverlaysForCollection(e,t,i){const r=sn(),s=t.length+1,o=new T(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return g.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new _e((l,u)=>l-u);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>i){let u=s.get(l.largestBatchId);u===null&&(u=sn(),s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const a=sn(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=r)););return g.resolve(a)}oe(e,t,i){const r=this.overlays.get(i.key);if(r!==null){const o=this.es.get(r.largestBatchId).delete(i.key);this.es.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new lg(t,i));let s=this.es.get(t);s===void 0&&(s=F(),this.es.set(t,s)),this.es.set(t,s.add(i.key))}}class fg{constructor(){this.ns=new ee(De.ss),this.rs=new ee(De.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const i=new De(e,t);this.ns=this.ns.add(i),this.rs=this.rs.add(i)}us(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.cs(new De(e,t))}hs(e,t){e.forEach(i=>this.removeReference(i,t))}ls(e){const t=new T(new K([])),i=new De(t,e),r=new De(t,e+1),s=[];return this.rs.forEachInRange([i,r],o=>{this.cs(o),s.push(o.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new T(new K([])),i=new De(t,e),r=new De(t,e+1);let s=F();return this.rs.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new De(e,0),i=this.ns.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class De{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return T.comparator(e.key,t.key)||L(e._s,t._s)}static os(e,t){return L(e._s,t._s)||T.comparator(e.key,t.key)}}class TV{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new ee(De.ss)}checkEmpty(e){return g.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){const s=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new ag(s,t,i,r);this.mutationQueue.push(o);for(const a of r)this.gs=this.gs.add(new De(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(e,t){return g.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=this.ps(i),s=r<0?0:r;return g.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(this.mutationQueue.length===0?-1:this.ws-1)}getAllMutationBatches(e){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new De(t,0),r=new De(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([i,r],o=>{const a=this.ys(o._s);s.push(a)}),g.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ee(L);return t.forEach(r=>{const s=new De(r,0),o=new De(r,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,o],a=>{i=i.add(a._s)})}),g.resolve(this.Is(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;T.isDocumentKey(s)||(s=s.child(""));const o=new De(new T(s),0);let a=new ee(L);return this.gs.forEachWhile(c=>{const l=c.key.path;return!!i.isPrefixOf(l)&&(l.length===r&&(a=a.add(c._s)),!0)},o),g.resolve(this.Is(a))}Is(e){const t=[];return e.forEach(i=>{const r=this.ys(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){A(this.Ts(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.gs;return g.forEach(t.mutations,r=>{const s=new De(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){const i=new De(t,0),r=this.gs.firstAfterOrEqual(i);return g.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,g.resolve()}Ts(e,t){return this.ps(e)}ps(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class SV{constructor(e){this.Es=e,this.docs=new _e(T.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.Es(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return g.resolve(i?i.document.mutableCopy():re.newInvalidDocument(t))}getEntries(e,t){let i=wt();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():re.newInvalidDocument(r))}),g.resolve(i)}getAllFromCollection(e,t,i){let r=wt();const s=new T(t.child("")),o=this.docs.getIteratorFrom(s);for(;o.hasNext();){const{key:a,value:{document:c}}=o.getNext();if(!t.isPrefixOf(a.path))break;a.path.length>t.length+1||Zp(vT(c),i)<=0||(r=r.insert(c.key,c.mutableCopy()))}return g.resolve(r)}getAllFromCollectionGroup(e,t,i,r){C()}As(e,t){return g.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new CV(this)}getSize(e){return g.resolve(this.size)}}class CV extends TS{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(i)}),g.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class kV{constructor(e){this.persistence=e,this.Rs=new ki(t=>fr(t),Ba),this.lastRemoteSnapshotVersion=R.min(),this.highestTargetId=0,this.bs=0,this.Ps=new fg,this.targetCount=0,this.vs=yr.Pn()}forEachTarget(e,t){return this.Rs.forEach((i,r)=>t(r)),g.resolve()}getLastRemoteSnapshotVersion(e){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.bs&&(this.bs=t),g.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new yr(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,g.resolve()}updateTargetData(e,t){return this.Dn(t),g.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,g.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Rs.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),g.waitFor(s).next(()=>r)}getTargetCount(e){return g.resolve(this.targetCount)}getTargetData(e,t){const i=this.Rs.get(t)||null;return g.resolve(i)}addMatchingKeys(e,t,i){return this.Ps.us(t,i),g.resolve()}removeMatchingKeys(e,t,i){this.Ps.hs(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),g.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),g.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Ps.ds(t);return g.resolve(i)}containsKey(e,t){return g.resolve(this.Ps.containsKey(t))}}class kS{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new vt(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new kV(this),this.indexManager=new dV,this.remoteDocumentCache=function(i){return new SV(i)}(i=>this.referenceDelegate.xs(i)),this.yt=new _S(t),this.Ns=new bV(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new EV,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Vs[e.toKey()];return i||(i=new TV(t,this.referenceDelegate),this.Vs[e.toKey()]=i),i}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,i){I("MemoryPersistence","Starting transaction:",e);const r=new AV(this.Ss.next());return this.referenceDelegate.ks(),i(r).next(s=>this.referenceDelegate.Os(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ms(e,t){return g.or(Object.values(this.Vs).map(i=>()=>i.containsKey(e,t)))}}class AV extends IT{constructor(e){super(),this.currentSequenceNumber=e}}class Fu{constructor(e){this.persistence=e,this.Fs=new fg,this.$s=null}static Bs(e){return new Fu(e)}get Ls(){if(this.$s)return this.$s;throw C()}addReference(e,t,i){return this.Fs.addReference(i,t),this.Ls.delete(i.toString()),g.resolve()}removeReference(e,t,i){return this.Fs.removeReference(i,t),this.Ls.add(i.toString()),g.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),g.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(r=>this.Ls.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Ls.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.Ls,i=>{const r=T.fromPath(i);return this.qs(e,r).next(s=>{s||t.removeEntry(r,R.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(i=>{i?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return g.or([()=>g.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class RV{constructor(e){this.yt=e}$(e,t,i,r){const s=new Nu("createOrUpgrade",t);i<1&&r>=1&&(function(a){a.createObjectStore("owner")}(e),function(a){a.createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ey,{unique:!0}),a.createObjectStore("documentMutations")}(e),Vy(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=g.resolve();return i<3&&r>=3&&(i!==0&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),Vy(e)),o=o.next(()=>function(a){const c=a.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:R.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>function(a,c){return c.store("mutations").W().next(l=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ey,{unique:!0});const u=c.store("mutations"),h=l.map(d=>u.put(d));return g.waitFor(h)})}(e,s))),o=o.next(()=>{(function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),i<5&&r>=5&&(o=o.next(()=>this.Us(s))),i<6&&r>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),i<7&&r>=7&&(o=o.next(()=>this.Gs(s))),i<8&&r>=8&&(o=o.next(()=>this.Qs(e,s))),i<9&&r>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&r>=10&&(o=o.next(()=>this.js(s))),i<11&&r>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&r>=12&&(o=o.next(()=>{(function(a){const c=a.createObjectStore("documentOverlays",{keyPath:Z$});c.createIndex("collectionPathOverlayIndex",eV,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",tV,{unique:!1})})(e)})),i<13&&r>=13&&(o=o.next(()=>function(a){const c=a.createObjectStore("remoteDocumentsV14",{keyPath:q$});c.createIndex("documentKeyIndex",j$),c.createIndex("collectionGroupIndex",W$)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(o=o.next(()=>this.zs(e,s))),i<15&&r>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:Q$}).createIndex("sequenceNumberIndex",Y$,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:X$}).createIndex("documentKeyIndex",J$,{unique:!1})}(e))),o}Ks(e){let t=0;return e.store("remoteDocuments").Z((i,r)=>{t+=ml(r)}).next(()=>{const i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Us(e){const t=e.store("mutationQueues"),i=e.store("mutations");return t.W().next(r=>g.forEach(r,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.W("userMutationsIndex",o).next(a=>g.forEach(a,c=>{A(c.userId===s.userId);const l=Fi(this.yt,c);return IS(e,s.userId,l).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{const s=[];return i.Z((o,a)=>{const c=new K(o),l=function(u){return[0,dt(u)]}(c);s.push(t.get(l).next(u=>u?g.resolve():(h=>t.put({targetId:0,path:dt(h),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>g.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:z$});const i=t.store("collectionParents"),r=new dg,s=o=>{if(r.add(o)){const a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:dt(c)})}};return t.store("remoteDocuments").Z({X:!0},(o,a)=>{const c=new K(o);return s(c.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([o,a,c],l)=>{const u=on(a);return s(u.popLast())}))}js(e){const t=e.store("targets");return t.Z((i,r)=>{const s=fo(r),o=yS(this.yt,s);return t.put(o)})}Ws(e,t){const i=t.store("remoteDocuments"),r=[];return i.Z((s,o)=>{const a=t.store("remoteDocumentsV14"),c=(l=o,l.document?new T(K.fromString(l.document.name).popFirst(5)):l.noDocument?T.fromSegments(l.noDocument.path):l.unknownDocument?T.fromSegments(l.unknownDocument.path):C()).path.toArray();var l;const u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))}).next(()=>g.waitFor(r))}zs(e,t){const i=t.store("mutations"),r=SS(this.yt),s=new kS(Fu.Bs,this.yt.ie);return i.W().next(o=>{const a=new Map;return o.forEach(c=>{var l;let u=(l=a.get(c.userId))!==null&&l!==void 0?l:F();Fi(this.yt,c).keys().forEach(h=>u=u.add(h)),a.set(c.userId,u)}),g.forEach(a,(c,l)=>{const u=new Oe(l),h=Mu.re(this.yt,u),d=s.getIndexManager(u),f=Lu.re(u,this.yt,d,s.referenceDelegate);return new CS(r,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new ef(t,vt.at),c).next()})})}}function Vy(n){n.createObjectStore("targetDocuments",{keyPath:G$}).createIndex("documentTargetsIndex",H$,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",K$,{unique:!0}),n.createObjectStore("targetGlobal")}const xh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class pg{constructor(e,t,i,r,s,o,a,c,l,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Hs=s,this.window=o,this.document=a,this.Js=l,this.Ys=u,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=d=>Promise.resolve(),!pg.C())throw new y(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new yV(this,r),this.ii=t+"main",this.yt=new _S(c),this.ri=new Ht(this.ii,this.Xs,new RV(this.yt)),this.Cs=new pV(this.referenceDelegate,this.yt),this.remoteDocumentCache=SS(this.yt),this.Ns=new sV,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,u===!1&&we("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,xh);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new vt(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){return this.si=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>dc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Ci(e))return I("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return so(e).get("owner").next(t=>g.resolve(this.mi(t)))}gi(e){return dc(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const i=qe(t,"clientMetadata");return i.W().next(r=>{const s=this.Ii(r,18e5),o=r.filter(a=>s.indexOf(a)===-1);return g.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?g.resolve(!0):so(e).get("owner").next(t=>{if(t!==null&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,xh);return!1}}return!(!this.networkEnabled||!this.inForeground)||dc(e).W().next(i=>this.Ii(i,5e3).find(r=>{if(this.clientId!==r.clientId){const s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new ef(e,vt.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(i=>this.pi(i.updateTimeMs,t)&&!this.Ei(i.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>dc(e).W().next(t=>this.Ii(t,18e5).map(i=>i.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Lu.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new fV(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return Mu.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,i){I("IndexedDbPersistence","Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",s=(o=this.Xs)===15?iV:o===14?mS:o===13?gS:o===12?nV:o===11?pS:void C();var o;let a;return this.ri.runTransaction(e,r,s,c=>(a=new ef(c,this.Ss?this.Ss.next():vt.at),t==="readwrite-primary"?this.fi(a).next(l=>!!l||this.di(a)).next(l=>{if(!l)throw we(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new y(m.FAILED_PRECONDITION,wT);return i(a)}).next(l=>this.wi(a).next(()=>l)):this.Vi(a).next(()=>i(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}Vi(e){return so(e).get("owner").next(t=>{if(t!==null&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(m.FAILED_PRECONDITION,xh)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return so(e).put("owner",t)}static C(){return Ht.C()}_i(e){const t=so(e);return t.get("owner").next(i=>this.mi(i)?(I("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):g.resolve())}pi(e,t){const i=Date.now();return!(e<i-t)&&(!(e>i)||(we(`Detected an update time that is in the future: ${e} > ${i}`),!1))}ci(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground=this.document.visibilityState==="visible")}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Zs=()=>{this.Ai(),K0()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const i=((t=this.oi)===null||t===void 0?void 0:t.getItem(this.Ti(e)))!==null;return I("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return we("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){we("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch{}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function so(n){return qe(n,"owner")}function dc(n){return qe(n,"clientMetadata")}function gg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class mg{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Si=i,this.Di=r}static Ci(e,t){let i=F(),r=F();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new mg(e,t.fromCache,i,r)}}class AS{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,i,r){return this.ki(e,t).next(s=>s||this.Oi(e,t,r,i)).next(s=>s||this.Mi(e,t))}ki(e,t){if(fy(t))return g.resolve(null);let i=Et(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=fl(t,null,"F"),i=Et(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const o=F(...s);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{const l=this.Fi(t,a);return this.$i(t,l,o,c.readTime)?this.ki(e,fl(t,null,"F")):this.Bi(e,l,t,c)}))})))}Oi(e,t,i,r){return fy(t)||r.isEqual(R.min())?this.Mi(e,t):this.Ni.getDocuments(e,i).next(s=>{const o=this.Fi(t,s);return this.$i(t,o,i,r)?this.Mi(e,t):(Wd()<=$.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Xd(t)),this.Bi(e,o,t,yT(r,-1)))})}Fi(e,t){let i=new ee($T(e));return t.forEach((r,s)=>{rg(e,s)&&(i=i.add(s))}),i}$i(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Mi(e,t){return Wd()<=$.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",Xd(t)),this.Ni.getDocumentsMatchingQuery(e,t,Ot.min())}Bi(e,t,i,r){return this.Ni.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class NV{constructor(e,t,i,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new _e(L),this.Ui=new ki(s=>fr(s),Ba),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(i)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new CS(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function RS(n,e,t,i){return new NV(n,e,t,i)}async function NS(n,e){const t=S(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Qi(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const o=[],a=[];let c=F();for(const l of r){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of s){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(i,c).next(l=>({ji:l,removedBatchIds:o,addedBatchIds:a}))})})}function DV(n,e){const t=S(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,c,l){const u=c.batch,h=u.keys();let d=g.resolve();return h.forEach(f=>{d=d.next(()=>l.getEntry(a,f)).next(p=>{const _=c.docVersions.get(f);A(_!==null),p.version.compareTo(_)<0&&(u.applyToRemoteDocument(p,c),p.isValidDocument()&&(p.setReadTime(c.commitVersion),l.addEntry(p)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,u))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let a=F();for(let c=0;c<o.mutationResults.length;++c)o.mutationResults[c].transformResults.length>0&&(a=a.add(o.batch.mutations[c].key));return a}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function DS(n){const e=S(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function PV(n,e){const t=S(n),i=e.snapshotVersion;let r=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.Gi.newChangeBuffer({trackRemovals:!0});r=t.qi;const a=[];e.targetChanges.forEach((u,h)=>{const d=r.get(h);if(!d)return;a.push(t.Cs.removeMatchingKeys(s,u.removedDocuments,h).next(()=>t.Cs.addMatchingKeys(s,u.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.has(h)?f=f.withResumeToken(Ae.EMPTY_BYTE_STRING,R.min()).withLastLimboFreeSnapshotVersion(R.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,i)),r=r.insert(h,f),function(p,_,w){return p.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-p.snapshotVersion.toMicroseconds()>=3e8?!0:w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0}(d,f,u)&&a.push(t.Cs.updateTargetData(s,f))});let c=wt(),l=F();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(PS(s,o,e.documentUpdates).next(u=>{c=u.Wi,l=u.zi})),!i.isEqual(R.min())){const u=t.Cs.getLastRemoteSnapshotVersion(s).next(h=>t.Cs.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(u)}return g.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(t.qi=r,s))}function PS(n,e,t){let i=F(),r=F();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=wt();return t.forEach((a,c)=>{const l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(R.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):I("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{Wi:o,zi:r}})}function xV(n,e){const t=S(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function vs(n,e){const t=S(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Cs.getTargetData(i,e).next(s=>s?(r=s,g.resolve(r)):t.Cs.allocateTargetId(i).next(o=>(r=new ii(e,o,0,i.currentSequenceNumber),t.Cs.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.qi.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.qi=t.qi.insert(i.targetId,i),t.Ui.set(e,i.targetId)),i})}async function ws(n,e,t){const i=S(n),r=i.qi.get(e),s=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!Ci(o))throw o;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.qi=i.qi.remove(e),i.Ui.delete(r.target)}function _l(n,e,t){const i=S(n);let r=R.min(),s=F();return i.persistence.runTransaction("Execute query","readonly",o=>function(a,c,l){const u=S(a),h=u.Ui.get(l);return h!==void 0?g.resolve(u.qi.get(h)):u.Cs.getTargetData(c,l)}(i,o,Et(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.Li.getDocumentsMatchingQuery(o,e,t?r:R.min(),t?s:F())).next(a=>(MS(i,UT(e),a),{documents:a,Hi:s})))}function xS(n,e){const t=S(n),i=S(t.Cs),r=t.qi.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.ne(s,e).next(o=>o?o.target:null))}function OS(n,e){const t=S(n),i=t.Ki.get(e)||R.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.Gi.getAllFromCollectionGroup(r,e,yT(i,-1),Number.MAX_SAFE_INTEGER)).then(r=>(MS(t,e,r),r))}function MS(n,e,t){let i=n.Ki.get(e)||R.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Ki.set(e,i)}async function OV(n,e,t,i){const r=S(n);let s=F(),o=wt();for(const l of t){const u=e.Ji(l.metadata.name);l.document&&(s=s.add(u));const h=e.Yi(l);h.setReadTime(e.Xi(l.metadata.readTime)),o=o.insert(u,h)}const a=r.Gi.newChangeBuffer({trackRemovals:!0}),c=await vs(r,function(l){return Et(Us(K.fromString(`__bundle__/docs/${l}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",l=>PS(l,a,o).next(u=>(a.apply(l),u)).next(u=>r.Cs.removeMatchingKeysForTargetId(l,c.targetId).next(()=>r.Cs.addMatchingKeys(l,s,c.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(l,u.Wi,u.zi)).next(()=>u.Wi)))}async function MV(n,e,t=F()){const i=await vs(n,Et(ug(e.bundledQuery))),r=S(n);return r.persistence.runTransaction("Save named query","readwrite",s=>{const o=be(e.readTime);if(i.snapshotVersion.compareTo(o)>=0)return r.Ns.saveNamedQuery(s,e);const a=i.withResumeToken(Ae.EMPTY_BYTE_STRING,o);return r.qi=r.qi.insert(a.targetId,a),r.Cs.updateTargetData(s,a).next(()=>r.Cs.removeMatchingKeysForTargetId(s,i.targetId)).next(()=>r.Cs.addMatchingKeys(s,t,i.targetId)).next(()=>r.Ns.saveNamedQuery(s,e))})}function By(n,e){return`firestore_clients_${n}_${e}`}function qy(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function Oh(n,e){return`firestore_targets_${n}_${e}`}class yl{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static Zi(e,t,i){const r=JSON.parse(i);let s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new y(r.error.code,r.error.message))),o?new yl(e,t,r.state,s):(we("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Co{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Zi(e,t){const i=JSON.parse(t);let r,s=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(r=new y(i.error.code,i.error.message))),s?new Co(e,i.state,r):(we("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class vl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const i=JSON.parse(t);let r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=Ou();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=ET(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new vl(e,s):(we("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class _g{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new _g(t.clientId,t.onlineState):(we("SharedClientState",`Failed to parse online state: ${e}`),null)}}class sf{constructor(){this.activeTargetIds=Ou()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mh{constructor(e,t,i,r,s){this.window=e,this.Hs=t,this.persistenceKey=i,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new _e(L),this.started=!1,this.cr=[];const o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=By(this.persistenceKey,this.sr),this.hr=function(a){return`firestore_sequence_number_${a}`}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new sf),this.lr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.wr=function(a){return`firestore_online_state_${a}`}(this.persistenceKey),this.mr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const i of e){if(i===this.sr)continue;const r=this.getItem(By(this.persistenceKey,i));if(r){const s=vl.Zi(i,r);s&&(this.ur=this.ur.insert(s.clientId,s))}}this.gr();const t=this.storage.getItem(this.wr);if(t){const i=this.yr(t);i&&this.pr(i)}for(const i of this.cr)this.rr(i);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,i){this.Tr(e,t,i),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(Oh(this.persistenceKey,e));if(i){const r=Co.Zi(e,i);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Oh(this.persistenceKey,e))}updateQueryState(e,t,i){this.Rr(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.Er(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return I("SharedClientState","READ",e,t),t}setItem(e,t){I("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){I("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const t=e;if(t.storageArea===this.storage){if(I("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ar)return void we("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.lr.test(t.key)){if(t.newValue==null){const i=this.vr(t.key);return this.Vr(i,null)}{const i=this.Sr(t.key,t.newValue);if(i)return this.Vr(i.clientId,i)}}else if(this.dr.test(t.key)){if(t.newValue!==null){const i=this.Dr(t.key,t.newValue);if(i)return this.Cr(i)}}else if(this._r.test(t.key)){if(t.newValue!==null){const i=this.Nr(t.key,t.newValue);if(i)return this.kr(i)}}else if(t.key===this.wr){if(t.newValue!==null){const i=this.yr(t.newValue);if(i)return this.pr(i)}}else if(t.key===this.hr){const i=function(r){let s=vt.at;if(r!=null)try{const o=JSON.parse(r);A(typeof o=="number"),s=o}catch(o){we("SharedClientState","Failed to read sequence number from WebStorage",o)}return s}(t.newValue);i!==vt.at&&this.sequenceNumberHandler(i)}else if(t.key===this.mr){const i=this.Or(t.newValue);await Promise.all(i.map(r=>this.syncEngine.Mr(r)))}}}else this.cr.push(t)})}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,i){const r=new yl(this.currentUser,e,t,i),s=qy(this.persistenceKey,this.currentUser,e);this.setItem(s,r.tr())}Er(e){const t=qy(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){const t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,i){const r=Oh(this.persistenceKey,e),s=new Co(e,t,i);this.setItem(r,s.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const i=this.vr(e);return vl.Zi(i,t)}Dr(e,t){const i=this.dr.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return yl.Zi(new Oe(s),r,t)}Nr(e,t){const i=this._r.exec(e),r=Number(i[1]);return Co.Zi(r,t)}yr(e){return _g.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);I("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const i=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),s=this.Ir(i),o=[],a=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.Br(o,a).then(()=>{this.ur=i})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=Ou();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class LS{constructor(){this.Lr=new sf,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,i){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new sf,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class LV{Ur(e){}shutdown(){}}class jy{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}const FV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class UV{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class $V extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,i,r,s){const o=this.ho(e,t);I("RestConnection","Sending: ",o,i);const a={};return this.lo(a,r,s),this.fo(e,o,a,i).then(c=>(I("RestConnection","Received: ",c),c),c=>{throw ds("RestConnection",`${e} failed with error: `,c,"url: ",o,"request:",i),c})}_o(e,t,i,r,s,o){return this.ao(e,t,i,r,s)}lo(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+Fs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}ho(e,t){const i=FV[e];return`${this.oo}/v1/${t}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,i,r){return new Promise((s,o)=>{const a=new UU;a.setWithCredentials(!0),a.listenOnce(MU.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Dh.NO_ERROR:const l=a.getResponseJson();I("Connection","XHR received:",JSON.stringify(l)),s(l);break;case Dh.TIMEOUT:I("Connection",'RPC "'+e+'" timed out'),o(new y(m.DEADLINE_EXCEEDED,"Request time out"));break;case Dh.HTTP_ERROR:const u=a.getStatus();if(I("Connection",'RPC "'+e+'" failed with status:',u,"response text:",a.getResponseText()),u>0){let h=a.getResponseJson();Array.isArray(h)&&(h=h[0]);const d=h==null?void 0:h.error;if(d&&d.status&&d.message){const f=function(p){const _=p.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(_)>=0?_:m.UNKNOWN}(d.status);o(new y(f,d.message))}else o(new y(m.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new y(m.UNAVAILABLE,"Connection failed."));break;default:C()}}finally{I("Connection",'RPC "'+e+'" completed.')}});const c=JSON.stringify(r);a.send(t,"POST",c,i,15)})}wo(e,t,i){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=xU(),o=OU(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new FU({})),this.lo(a.initMessageHeaders,t,i),a.encodeInitMessageHeaders=!0;const c=r.join("");I("Connection","Creating WebChannel: "+c,a);const l=s.createWebChannel(c,a);let u=!1,h=!1;const d=new UV({Hr:p=>{h?I("Connection","Not sending because WebChannel is closed:",p):(u||(I("Connection","Opening WebChannel transport."),l.open(),u=!0),I("Connection","WebChannel sending:",p),l.send(p))},Jr:()=>l.close()}),f=(p,_,w)=>{p.listen(_,N=>{try{w(N)}catch(M){setTimeout(()=>{throw M},0)}})};return f(l,ac.EventType.OPEN,()=>{h||I("Connection","WebChannel transport opened.")}),f(l,ac.EventType.CLOSE,()=>{h||(h=!0,I("Connection","WebChannel transport closed"),d.io())}),f(l,ac.EventType.ERROR,p=>{h||(h=!0,ds("Connection","WebChannel transport errored:",p),d.io(new y(m.UNAVAILABLE,"The operation could not be completed")))}),f(l,ac.EventType.MESSAGE,p=>{var _;if(!h){const w=p.data[0];A(!!w);const N=w,M=N.error||((_=N[0])===null||_===void 0?void 0:_.error);if(M){I("Connection","WebChannel received error:",M);const x=M.status;let U=function(z){const ve=Ee[z];if(ve!==void 0)return YT(ve)}(x),X=M.message;U===void 0&&(U=m.INTERNAL,X="Unknown error status: "+x+" with message "+M.message),h=!0,d.io(new y(U,X)),l.close()}else I("Connection","WebChannel received:",w),d.ro(w)}}),f(o,LU.STAT_EVENT,p=>{p.stat===Z_.PROXY?I("Connection","Detected buffering proxy"):p.stat===Z_.NOPROXY&&I("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}function FS(){return typeof window<"u"?window:null}function kc(){return typeof document<"u"?document:null}function Ga(n){return new N$(n,!0)}class yg{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=i,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),i=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-i);r>0&&I("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class US{constructor(e,t,i,r,s,o,a,c){this.Hs=e,this.vo=i,this.Vo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new yg(e,t)}No(){return this.state===1||this.state===5||this.ko()}ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&this.Do===null&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,e!==4?this.xo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(we(t.toString()),we("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===m.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.So===t&&this.Go(i,r)},i=>{e(()=>{const r=new y(m.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Qo(r)})})}Go(e,t){const i=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{i(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(r=>{i(()=>this.Qo(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return I("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class VV extends US{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=x$(this.yt,e),i=function(r){if(!("targetChange"in r))return R.min();const s=r.targetChange;return s.targetIds&&s.targetIds.length?R.min():s.readTime?be(s.readTime):R.min()}(e);return this.listener.Wo(t,i)}zo(e){const t={};t.database=ca(this.yt),t.addTarget=function(r,s){let o;const a=s.target;return o=hl(a)?{documents:aS(r,a)}:{query:cS(r,a)},o.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?o.resumeToken=nS(r,s.resumeToken):s.snapshotVersion.compareTo(R.min())>0&&(o.readTime=ys(r,s.snapshotVersion.toTimestamp())),o}(this.yt,e);const i=M$(this.yt,e);i&&(t.labels=i),this.Bo(t)}Ho(e){const t={};t.database=ca(this.yt),t.removeTarget=e,this.Bo(t)}}class BV extends US{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(A(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=O$(e.writeResults,e.commitTime),i=be(e.commitTime);return this.listener.Zo(i,t)}return A(!e.writeResults||e.writeResults.length===0),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=ca(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>la(this.yt,i))};this.Bo(t)}}class qV extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.yt=r,this.nu=!1}su(){if(this.nu)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.ao(e,t,i,r,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new y(m.UNKNOWN,r.toString())})}_o(e,t,i,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection._o(e,t,i,s,o,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(m.UNKNOWN,s.toString())})}terminate(){this.nu=!0}}class jV{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){this.iu===0&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){this.state==="Online"?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,e==="Online"&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(we(t),this.ou=!1):I("OnlineStateTracker",t)}lu(){this.ru!==null&&(this.ru.cancel(),this.ru=null)}}class WV{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(o=>{i.enqueueAndForget(async()=>{Ai(this)&&(I("RemoteStore","Restarting streams for network reachability change."),await async function(a){const c=S(a);c._u.add(4),await Bs(c),c.gu.set("Unknown"),c._u.delete(4),await Ha(c)}(this))})}),this.gu=new jV(i,r)}}async function Ha(n){if(Ai(n))for(const e of n.wu)await e(!0)}async function Bs(n){for(const e of n.wu)await e(!1)}function Uu(n,e){const t=S(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Ig(t)?wg(t):js(t).ko()&&vg(t,e))}function ua(n,e){const t=S(n),i=js(t);t.du.delete(e),i.ko()&&$S(t,e),t.du.size===0&&(i.ko()?i.Fo():Ai(t)&&t.gu.set("Unknown"))}function vg(n,e){n.yu.Ot(e.targetId),js(n).zo(e)}function $S(n,e){n.yu.Ot(e),js(n).Ho(e)}function wg(n){n.yu=new C$({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),js(n).start(),n.gu.uu()}function Ig(n){return Ai(n)&&!js(n).No()&&n.du.size>0}function Ai(n){return S(n)._u.size===0}function VS(n){n.yu=void 0}async function KV(n){n.du.forEach((e,t)=>{vg(n,e)})}async function GV(n,e){VS(n),Ig(n)?(n.gu.hu(e),wg(n)):n.gu.set("Unknown")}async function HV(n,e,t){if(n.gu.set("Online"),e instanceof tS&&e.state===2&&e.cause)try{await async function(i,r){const s=r.cause;for(const o of r.targetIds)i.du.has(o)&&(await i.remoteSyncer.rejectListen(o,s),i.du.delete(o),i.yu.removeTarget(o))}(n,e)}catch(i){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await wl(n,i)}else if(e instanceof Sc?n.yu.Kt(e):e instanceof eS?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(R.min()))try{const i=await DS(n.localStore);t.compareTo(i)>=0&&await function(r,s){const o=r.yu.Zt(s);return o.targetChanges.forEach((a,c)=>{if(a.resumeToken.approximateByteSize()>0){const l=r.du.get(c);l&&r.du.set(c,l.withResumeToken(a.resumeToken,s))}}),o.targetMismatches.forEach(a=>{const c=r.du.get(a);if(!c)return;r.du.set(a,c.withResumeToken(Ae.EMPTY_BYTE_STRING,c.snapshotVersion)),$S(r,a);const l=new ii(c.target,a,1,c.sequenceNumber);vg(r,l)}),r.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(i){I("RemoteStore","Failed to raise snapshot:",i),await wl(n,i)}}async function wl(n,e,t){if(!Ci(e))throw e;n._u.add(1),await Bs(n),n.gu.set("Offline"),t||(t=()=>DS(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{I("RemoteStore","Retrying IndexedDB access"),await t(),n._u.delete(1),await Ha(n)})}function BS(n,e){return e().catch(t=>wl(n,t,e))}async function qs(n){const e=S(n),t=yi(e);let i=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;zV(e);)try{const r=await xV(e.localStore,i);if(r===null){e.fu.length===0&&t.Fo();break}i=r.batchId,QV(e,r)}catch(r){await wl(e,r)}qS(e)&&jS(e)}function zV(n){return Ai(n)&&n.fu.length<10}function QV(n,e){n.fu.push(e);const t=yi(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function qS(n){return Ai(n)&&!yi(n).No()&&n.fu.length>0}function jS(n){yi(n).start()}async function YV(n){yi(n).eu()}async function XV(n){const e=yi(n);for(const t of n.fu)e.Xo(t.mutations)}async function JV(n,e,t){const i=n.fu.shift(),r=cg.from(i,e,t);await BS(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await qs(n)}async function ZV(n,e){e&&yi(n).Yo&&await async function(t,i){if(r=i.code,QT(r)&&r!==m.ABORTED){const s=t.fu.shift();yi(t).Mo(),await BS(t,()=>t.remoteSyncer.rejectFailedWrite(s.batchId,i)),await qs(t)}var r}(n,e),qS(n)&&jS(n)}async function Wy(n,e){const t=S(n);t.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const i=Ai(t);t._u.add(3),await Bs(t),i&&t.gu.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),await Ha(t)}async function of(n,e){const t=S(n);e?(t._u.delete(2),await Ha(t)):e||(t._u.add(2),await Bs(t),t.gu.set("Unknown"))}function js(n){return n.pu||(n.pu=function(e,t,i){const r=S(e);return r.su(),new VV(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:KV.bind(null,n),Zr:GV.bind(null,n),Wo:HV.bind(null,n)}),n.wu.push(async e=>{e?(n.pu.Mo(),Ig(n)?wg(n):n.gu.set("Unknown")):(await n.pu.stop(),VS(n))})),n.pu}function yi(n){return n.Iu||(n.Iu=function(e,t,i){const r=S(e);return r.su(),new BV(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:YV.bind(null,n),Zr:ZV.bind(null,n),tu:XV.bind(null,n),Zo:JV.bind(null,n)}),n.wu.push(async e=>{e?(n.Iu.Mo(),await qs(n)):(await n.Iu.stop(),n.fu.length>0&&(I("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))})),n.Iu}class bg{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new Le,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,i,r,s){const o=Date.now()+i,a=new bg(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ws(n,e){if(we("AsyncQueue",`${e}: ${n}`),Ci(n))return new y(m.UNAVAILABLE,`${e}: ${n}`);throw n}class Zr{constructor(e){this.comparator=e?(t,i)=>e(t,i)||T.comparator(t.key,i.key):(t,i)=>T.comparator(t.key,i.key),this.keyedMap=ho(),this.sortedSet=new _e(this.comparator)}static emptySet(e){return new Zr(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Zr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new Zr;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}class Ky{constructor(){this.Tu=new _e(T.comparator)}track(e){const t=e.doc.key,i=this.Tu.get(t);i?e.type!==0&&i.type===3?this.Tu=this.Tu.insert(t,e):e.type===3&&i.type!==1?this.Tu=this.Tu.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.Tu=this.Tu.remove(t):e.type===1&&i.type===2?this.Tu=this.Tu.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):C():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,i)=>{e.push(i)}),e}}class Is{constructor(e,t,i,r,s,o,a,c,l){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,i,r,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Is(e,t,Zr.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}class eB{constructor(){this.Au=void 0,this.listeners=[]}}class tB{constructor(){this.queries=new ki(e=>FT(e),qa),this.onlineState="Unknown",this.Ru=new Set}}async function Eg(n,e){const t=S(n),i=e.query;let r=!1,s=t.queries.get(i);if(s||(r=!0,s=new eB),r)try{s.Au=await t.onListen(i)}catch(o){const a=Ws(o,`Initialization of query '${Xd(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.listeners.push(e),e.bu(t.onlineState),s.Au&&e.Pu(s.Au)&&Sg(t)}async function Tg(n,e){const t=S(n),i=e.query;let r=!1;const s=t.queries.get(i);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),r=s.listeners.length===0)}if(r)return t.queries.delete(i),t.onUnlisten(i)}function nB(n,e){const t=S(n);let i=!1;for(const r of e){const s=r.query,o=t.queries.get(s);if(o){for(const a of o.listeners)a.Pu(r)&&(i=!0);o.Au=r}}i&&Sg(t)}function iB(n,e,t){const i=S(n),r=i.queries.get(e);if(r)for(const s of r.listeners)s.onError(t);i.queries.delete(e)}function Sg(n){n.Ru.forEach(e=>{e.next()})}class Cg{constructor(e,t,i){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=i||{}}Pu(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)r.type!==3&&i.push(r);e=new Is(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){if(!e.fromCache)return!0;const i=t!=="Offline";return(!this.options.Nu||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Du(e){if(e.docChanges.length>0)return!0;const t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}xu(e){e=Is.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class rB{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Gy{constructor(e){this.yt=e}Ji(e){return ln(this.yt,e)}Yi(e){return e.metadata.exists?oS(this.yt,e.document,!1):re.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return be(e)}}class sB{constructor(e,t,i){this.Mu=e,this.localStore=t,this.yt=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=WS(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const i=K.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,i=new Gy(this.yt);for(const r of e)if(r.metadata.queries){const s=i.Ji(r.metadata.name);for(const o of r.metadata.queries){const a=(t.get(o)||F()).add(s);t.set(o,a)}}return t}async complete(){const e=await OV(this.localStore,new Gy(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(const i of this.queries)await MV(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function WS(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}let KS=class{constructor(e){this.key=e}};class GS{constructor(e){this.key=e}}class HS{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=F(),this.mutatedKeys=F(),this.Gu=$T(e),this.Qu=new Zr(this.Gu)}get ju(){return this.qu}Wu(e,t){const i=t?t.zu:new Ky,r=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,l=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,h)=>{const d=r.get(u),f=rg(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),_=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let w=!1;d&&f?d.data.isEqual(f.data)?p!==_&&(i.track({type:3,doc:f}),w=!0):this.Hu(d,f)||(i.track({type:2,doc:f}),w=!0,(c&&this.Gu(f,c)>0||l&&this.Gu(f,l)<0)&&(a=!0)):!d&&f?(i.track({type:0,doc:f}),w=!0):d&&!f&&(i.track({type:1,doc:d}),w=!0,(c||l)&&(a=!0)),w&&(f?(o=o.add(f),s=_?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{Qu:o,zu:i,$i:a,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((l,u)=>function(h,d){const f=p=>{switch(p){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return C()}};return f(h)-f(d)}(l.type,u.type)||this.Gu(l.doc,u.doc)),this.Ju(i);const o=t?this.Yu():[],a=this.Ku.size===0&&this.current?1:0,c=a!==this.Uu;return this.Uu=a,s.length!==0||c?{snapshot:new Is(this.query,e.Qu,r,s,e.mutatedKeys,a===0,c,!1,!!i&&i.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}bu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Ky,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=F(),this.Qu.forEach(i=>{this.Zu(i.key)&&(this.Ku=this.Ku.add(i.key))});const t=[];return e.forEach(i=>{this.Ku.has(i)||t.push(new GS(i))}),this.Ku.forEach(i=>{e.has(i)||t.push(new KS(i))}),t}tc(e){this.qu=e.Hi,this.Ku=F();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Is.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.Uu===0,this.hasCachedResults)}}class oB{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class aB{constructor(e){this.key=e,this.nc=!1}}class cB{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new ki(a=>FT(a),qa),this.rc=new Map,this.oc=new Set,this.uc=new _e(T.comparator),this.cc=new Map,this.ac=new fg,this.hc={},this.lc=new Map,this.fc=yr.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return this.dc===!0}}async function lB(n,e){const t=Dg(n);let i,r;const s=t.ic.get(e);if(s)i=s.targetId,t.sharedClientState.addLocalQueryTarget(i),r=s.view.ec();else{const o=await vs(t.localStore,Et(e));t.isPrimaryClient&&Uu(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,r=await kg(t,e,i,a==="current",o.resumeToken)}return r}async function kg(n,e,t,i,r){n._c=(h,d,f)=>async function(p,_,w,N){let M=_.view.Wu(w);M.$i&&(M=await _l(p.localStore,_.query,!1).then(({documents:X})=>_.view.Wu(X,M)));const x=N&&N.targetChanges.get(_.targetId),U=_.view.applyChanges(M,p.isPrimaryClient,x);return af(p,_.targetId,U.Xu),U.snapshot}(n,h,d,f);const s=await _l(n.localStore,e,!0),o=new HS(e,s.Hi),a=o.Wu(s.documents),c=Ka.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),l=o.applyChanges(a,n.isPrimaryClient,c);af(n,t,l.Xu);const u=new oB(e,t,o);return n.ic.set(e,u),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),l.snapshot}async function uB(n,e){const t=S(n),i=t.ic.get(e),r=t.rc.get(i.targetId);if(r.length>1)return t.rc.set(i.targetId,r.filter(s=>!qa(s,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||await ws(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),ua(t.remoteStore,i.targetId),bs(t,i.targetId)}).catch(Si)):(bs(t,i.targetId),await ws(t.localStore,i.targetId,!0))}async function hB(n,e,t){const i=Pg(n);try{const r=await function(s,o){const a=S(s),c=le.now(),l=o.reduce((d,f)=>d.add(f.key),F());let u,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let f=wt(),p=F();return a.Gi.getEntries(d,l).next(_=>{f=_,f.forEach((w,N)=>{N.isValidDocument()||(p=p.add(w))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,f)).next(_=>{u=_;const w=[];for(const N of o){const M=w$(N,u.get(N.key).overlayedDocument);M!=null&&w.push(new Bn(N.key,M,MT(M.value.mapValue),ce.exists(!0)))}return a.mutationQueue.addMutationBatch(d,c,w,o)}).next(_=>{h=_;const w=_.applyToLocalDocumentSet(u,p);return a.documentOverlayCache.saveOverlays(d,_.batchId,w)})}).then(()=>({batchId:h.batchId,changes:JT(u)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(s,o,a){let c=s.hc[s.currentUser.toKey()];c||(c=new _e(L)),c=c.insert(o,a),s.hc[s.currentUser.toKey()]=c}(i,r.batchId,t),await qn(i,r.changes),await qs(i.remoteStore)}catch(r){const s=Ws(r,"Failed to persist write");t.reject(s)}}async function zS(n,e){const t=S(n);try{const i=await PV(t.localStore,e);e.targetChanges.forEach((r,s)=>{const o=t.cc.get(s);o&&(A(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.nc=!0:r.modifiedDocuments.size>0?A(o.nc):r.removedDocuments.size>0&&(A(o.nc),o.nc=!1))}),await qn(t,i,e)}catch(i){await Si(i)}}function Hy(n,e,t){const i=S(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const r=[];i.ic.forEach((s,o)=>{const a=o.view.bu(e);a.snapshot&&r.push(a.snapshot)}),function(s,o){const a=S(s);a.onlineState=o;let c=!1;a.queries.forEach((l,u)=>{for(const h of u.listeners)h.bu(o)&&(c=!0)}),c&&Sg(a)}(i.eventManager,e),r.length&&i.sc.Wo(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function dB(n,e,t){const i=S(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.cc.get(e),s=r&&r.key;if(s){let o=new _e(T.comparator);o=o.insert(s,re.newNoDocument(s,R.min()));const a=F().add(s),c=new Wa(R.min(),new Map,new ee(L),o,a);await zS(i,c),i.uc=i.uc.remove(s),i.cc.delete(e),Ng(i)}else await ws(i.localStore,e,!1).then(()=>bs(i,e,t)).catch(Si)}async function fB(n,e){const t=S(n),i=e.batch.batchId;try{const r=await DV(t.localStore,e);Rg(t,i,null),Ag(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await qn(t,r)}catch(r){await Si(r)}}async function pB(n,e,t){const i=S(n);try{const r=await function(s,o){const a=S(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return a.mutationQueue.lookupMutationBatch(c,o).next(u=>(A(u!==null),l=u.keys(),a.mutationQueue.removeMutationBatch(c,u))).next(()=>a.mutationQueue.performConsistencyCheck(c)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(c,l,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>a.localDocuments.getDocuments(c,l))})}(i.localStore,e);Rg(i,e,t),Ag(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await qn(i,r)}catch(r){await Si(r)}}async function gB(n,e){const t=S(n);Ai(t.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const i=await function(s){const o=S(s);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(i===-1)return void e.resolve();const r=t.lc.get(i)||[];r.push(e),t.lc.set(i,r)}catch(i){const r=Ws(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}function Ag(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function Rg(n,e,t){const i=S(n);let r=i.hc[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.hc[i.currentUser.toKey()]=r}}function bs(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.rc.get(e))n.ic.delete(i),t&&n.sc.wc(i,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(i=>{n.ac.containsKey(i)||QS(n,i)})}function QS(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);t!==null&&(ua(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),Ng(n))}function af(n,e,t){for(const i of t)i instanceof KS?(n.ac.addReference(i.key,e),mB(n,i)):i instanceof GS?(I("SyncEngine","Document no longer in limbo: "+i.key),n.ac.removeReference(i.key,e),n.ac.containsKey(i.key)||QS(n,i.key)):C()}function mB(n,e){const t=e.key,i=t.path.canonicalString();n.uc.get(t)||n.oc.has(i)||(I("SyncEngine","New document in limbo: "+t),n.oc.add(i),Ng(n))}function Ng(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new T(K.fromString(e)),i=n.fc.next();n.cc.set(i,new aB(t)),n.uc=n.uc.insert(t,i),Uu(n.remoteStore,new ii(Et(Us(t.path)),i,2,vt.at))}}async function qn(n,e,t){const i=S(n),r=[],s=[],o=[];i.ic.isEmpty()||(i.ic.forEach((a,c)=>{o.push(i._c(c,e,t).then(l=>{if((l||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,l!=null&&l.fromCache?"not-current":"current"),l){r.push(l);const u=mg.Ci(c.targetId,l);s.push(u)}}))}),await Promise.all(o),i.sc.Wo(r),await async function(a,c){const l=S(a);try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",u=>g.forEach(c,h=>g.forEach(h.Si,d=>l.persistence.referenceDelegate.addReference(u,h.targetId,d)).next(()=>g.forEach(h.Di,d=>l.persistence.referenceDelegate.removeReference(u,h.targetId,d)))))}catch(u){if(!Ci(u))throw u;I("LocalStore","Failed to update sequence numbers: "+u)}for(const u of c){const h=u.targetId;if(!u.fromCache){const d=l.qi.get(h),f=d.snapshotVersion,p=d.withLastLimboFreeSnapshotVersion(f);l.qi=l.qi.insert(h,p)}}}(i.localStore,s))}async function _B(n,e){const t=S(n);if(!t.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const i=await NS(t.localStore,e);t.currentUser=e,function(r,s){r.lc.forEach(o=>{o.forEach(a=>{a.reject(new y(m.CANCELLED,s))})}),r.lc.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await qn(t,i.ji)}}function yB(n,e){const t=S(n),i=t.cc.get(e);if(i&&i.nc)return F().add(i.key);{let r=F();const s=t.rc.get(e);if(!s)return r;for(const o of s){const a=t.ic.get(o);r=r.unionWith(a.view.ju)}return r}}async function vB(n,e){const t=S(n),i=await _l(t.localStore,e.query,!0),r=e.view.tc(i);return t.isPrimaryClient&&af(t,e.targetId,r.Xu),r}async function wB(n,e){const t=S(n);return OS(t.localStore,e).then(i=>qn(t,i))}async function IB(n,e,t,i){const r=S(n),s=await function(o,a){const c=S(o),l=S(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",u=>l.Tn(u,a).next(h=>h?c.localDocuments.getDocuments(u,h):g.resolve(null)))}(r.localStore,e);s!==null?(t==="pending"?await qs(r.remoteStore):t==="acknowledged"||t==="rejected"?(Rg(r,e,i||null),Ag(r,e),function(o,a){S(S(o).mutationQueue).An(a)}(r.localStore,e)):C(),await qn(r,s)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}async function bB(n,e){const t=S(n);if(Dg(t),Pg(t),e===!0&&t.dc!==!0){const i=t.sharedClientState.getAllActiveQueryTargets(),r=await zy(t,i.toArray());t.dc=!0,await of(t.remoteStore,!0);for(const s of r)Uu(t.remoteStore,s)}else if(e===!1&&t.dc!==!1){const i=[];let r=Promise.resolve();t.rc.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(bs(t,o),ws(t.localStore,o,!0))),ua(t.remoteStore,o)}),await r,await zy(t,i),function(s){const o=S(s);o.cc.forEach((a,c)=>{ua(o.remoteStore,c)}),o.ac.fs(),o.cc=new Map,o.uc=new _e(T.comparator)}(t),t.dc=!1,await of(t.remoteStore,!1)}}async function zy(n,e,t){const i=S(n),r=[],s=[];for(const o of e){let a;const c=i.rc.get(o);if(c&&c.length!==0){a=await vs(i.localStore,Et(c[0]));for(const l of c){const u=i.ic.get(l),h=await vB(i,u);h.snapshot&&s.push(h.snapshot)}}else{const l=await xS(i.localStore,o);a=await vs(i.localStore,l),await kg(i,YS(l),o,!1,a.resumeToken)}r.push(a)}return i.sc.Wo(s),r}function YS(n){return LT(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function EB(n){const e=S(n);return S(S(e.localStore).persistence).vi()}async function TB(n,e,t,i){const r=S(n);if(r.dc)return void I("SyncEngine","Ignoring unexpected query state notification.");const s=r.rc.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=await OS(r.localStore,UT(s[0])),a=Wa.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ae.EMPTY_BYTE_STRING);await qn(r,o,a);break}case"rejected":await ws(r.localStore,e,!0),bs(r,e,i);break;default:C()}}async function SB(n,e,t){const i=Dg(n);if(i.dc){for(const r of e){if(i.rc.has(r)){I("SyncEngine","Adding an already active target "+r);continue}const s=await xS(i.localStore,r),o=await vs(i.localStore,s);await kg(i,YS(s),o.targetId,!1,o.resumeToken),Uu(i.remoteStore,o)}for(const r of t)i.rc.has(r)&&await ws(i.localStore,r,!1).then(()=>{ua(i.remoteStore,r),bs(i,r)}).catch(Si)}}function Dg(n){const e=S(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=zS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=yB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dB.bind(null,e),e.sc.Wo=nB.bind(null,e.eventManager),e.sc.wc=iB.bind(null,e.eventManager),e}function Pg(n){const e=S(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pB.bind(null,e),e}function CB(n,e,t){const i=S(n);(async function(r,s,o){try{const a=await s.getMetadata();if(await function(h,d){const f=S(h),p=be(d.createTime);return f.persistence.runTransaction("hasNewerBundle","readonly",_=>f.Ns.getBundleMetadata(_,d.id)).then(_=>!!_&&_.createTime.compareTo(p)>=0)}(r.localStore,a))return await s.close(),o._completeWith(function(h){return{taskState:"Success",documentsLoaded:h.totalDocuments,bytesLoaded:h.totalBytes,totalDocuments:h.totalDocuments,totalBytes:h.totalBytes}}(a)),Promise.resolve(new Set);o._updateProgress(WS(a));const c=new sB(a,r.localStore,s.yt);let l=await s.mc();for(;l;){const h=await c.Fu(l);h&&o._updateProgress(h),l=await s.mc()}const u=await c.complete();return await qn(r,u.Lu,void 0),await function(h,d){const f=S(h);return f.persistence.runTransaction("Save bundle","readwrite",p=>f.Ns.saveBundleMetadata(p,d))}(r.localStore,a),o._completeWith(u.progress),Promise.resolve(u.Bu)}catch(a){return ds("SyncEngine",`Loading bundle failed with ${a}`),o._failWith(a),Promise.resolve(new Set)}})(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}class XS{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=Ga(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return RS(this.persistence,new AS,e.initialUser,this.yt)}yc(e){return new kS(Fu.Bs,this.yt)}gc(e){return new LS}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class JS extends XS{constructor(e,t,i){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await Pg(this.Ac.syncEngine),await qs(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return RS(this.persistence,new AS,e.initialUser,this.yt)}Tc(e,t){const i=this.persistence.referenceDelegate.garbageCollector;return new mV(i,e.asyncQueue,t)}Ec(e,t){const i=new e$(t,this.persistence);return new ZU(e.asyncQueue,i)}yc(e){const t=gg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?mt.withCacheSize(this.cacheSizeBytes):mt.DEFAULT;return new pg(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,FS(),kc(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new LS}}class kB extends JS{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ac.syncEngine;this.sharedClientState instanceof Mh&&(this.sharedClientState.syncEngine={Fr:IB.bind(null,t),$r:TB.bind(null,t),Br:SB.bind(null,t),vi:EB.bind(null,t),Mr:wB.bind(null,t)},await this.sharedClientState.start()),await this.persistence.li(async i=>{await bB(this.Ac.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())})}gc(e){const t=FS();if(!Mh.C(t))throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=gg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Mh(t,e.asyncQueue,i,e.clientId,e.initialUser)}}class xg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Hy(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=_B.bind(null,this.syncEngine),await of(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new tB}createDatastore(e){const t=Ga(e.databaseInfo.databaseId),i=(r=e.databaseInfo,new $V(r));var r;return function(s,o,a,c){return new qV(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return t=this.localStore,i=this.datastore,r=e.asyncQueue,s=a=>Hy(this.syncEngine,a,0),o=jy.C()?new jy:new LV,new WV(t,i,r,s,o);var t,i,r,s,o}createSyncEngine(e,t){return function(i,r,s,o,a,c,l){const u=new cB(i,r,s,o,a,c);return l&&(u.dc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=S(e);I("RemoteStore","RemoteStore shutting down."),t._u.add(5),await Bs(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function Og(n,e,t){if(!t)throw new y(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ZS(n,e,t,i){if(e===!0&&i===!0)throw new y(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Qy(n){if(!T.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Yy(n){if(T.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $u(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":C()}function G(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=$u(n);throw new y(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function eC(n,e){if(e<=0)throw new y(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const Xy=new Map;class Jy{constructor(e){var t;if(e.host===void 0){if(e.ssl!==void 0)throw new y(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,ZS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class za{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jy({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jy(e),e.credentials!==void 0&&(this._authCredentials=function(t){if(!t)return new BU;switch(t.type){case"gapi":const i=t.client;return new KU(i,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new y(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Xy.get(e);t&&(I("ComponentProvider","Removing Datastore"),Xy.delete(e),t.terminate())}(this),Promise.resolve()}}function AB(n,e,t,i={}){var r;const s=(n=G(n,za))._getSettings();if(s.host!=="firestore.googleapis.com"&&s.host!==e&&ds("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),i.mockUserToken){let o,a;if(typeof i.mockUserToken=="string")o=i.mockUserToken,a=Oe.MOCK_USER;else{o=yf(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);const c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new y(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Oe(c)}n._authCredentials=new qU(new pT(o,a))}}class se{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new un(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new se(this.firestore,e,this._key)}}class Xe{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Xe(this.firestore,e,this._query)}}class un extends Xe{constructor(e,t,i){super(e,t,Us(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new se(this.firestore,null,new T(e))}withConverter(e){return new un(this.firestore,e,this._path)}}function tC(n,e,...t){if(n=v(n),Og("collection","path",e),n instanceof za){const i=K.fromString(e,...t);return Yy(i),new un(n,null,i)}{if(!(n instanceof se||n instanceof un))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(K.fromString(e,...t));return Yy(i),new un(n.firestore,null,i)}}function RB(n,e){if(n=G(n,za),Og("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Xe(n,null,function(t){return new Vn(K.emptyPath(),t)}(e))}function Il(n,e,...t){if(n=v(n),arguments.length===1&&(e=gT.R()),Og("doc","path",e),n instanceof za){const i=K.fromString(e,...t);return Qy(i),new se(n,null,new T(i))}{if(!(n instanceof se||n instanceof un))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(K.fromString(e,...t));return Qy(i),new se(n.firestore,n instanceof un?n.converter:null,new T(i))}}function nC(n,e){return n=v(n),e=v(e),(n instanceof se||n instanceof un)&&(e instanceof se||e instanceof un)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function iC(n,e){return n=v(n),e=v(e),n instanceof Xe&&e instanceof Xe&&n.firestore===e.firestore&&qa(n._query,e._query)&&n.converter===e.converter}function Zy(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Vu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):we("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class NB{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new Le,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(i=>{i&&i.Ou()?this.metadata.resolve(i.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i==null?void 0:i.ku)}`))},i=>this.metadata.reject(i))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){const e=await this.Sc();if(e===null)return null;const t=this.vc.decode(e),i=Number(t);isNaN(i)&&this.Dc(`length string (${t}) is not valid number`);const r=await this.Cc(i);return new rB(JSON.parse(r),e.length+i)}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(this.buffer.length===0)return null;const e=this.xc();e<0&&this.Dc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");const t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Nc(){const e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class DB{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new y(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(i,r){const s=S(i),o=ca(s.yt)+"/documents",a={documents:r.map(h=>aa(s.yt,h))},c=await s._o("BatchGetDocuments",o,a,r.length),l=new Map;c.forEach(h=>{const d=P$(s.yt,h);l.set(d.key.toString(),d)});const u=[];return r.forEach(h=>{const d=l.get(h.toString());A(!!d),u.push(d)}),u}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Vs(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{const r=T.fromPath(i);this.mutations.push(new sg(r,this.precondition(r)))}),await async function(t,i){const r=S(t),s=ca(r.yt)+"/documents",o={writes:i.map(a=>la(r.yt,a))};await r.ao("Commit",s,o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw C();t=R.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new y(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(R.min())?ce.exists(!1):ce.updateTime(t):ce.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(R.min()))throw new y(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ce.updateTime(t)}return ce.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class PB{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.kc=i.maxAttempts,this.xo=new yg(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){this.xo.Ro(async()=>{const e=new DB(this.datastore),t=this.Mc(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.Fc(r)}))}).catch(i=>{this.Fc(i)})})}Mc(e){try{const t=this.updateFunction(e);return!Va(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!QT(t)}return!1}}class xB{constructor(e,t,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Oe.UNAUTHENTICATED,this.clientId=gT.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,async s=>{I("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(i,s=>(I("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Le;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=Ws(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function rC(n,e){n.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async r=>{i.isEqual(r)||(await NS(e.localStore,r),i=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}async function sC(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Mg(n);I("FirestoreClient","Initializing OnlineComponentProvider");const i=await n.getConfiguration();await e.initialize(t,i),n.setCredentialChangeListener(r=>Wy(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Wy(e.remoteStore,s)),n.onlineComponents=e}async function Mg(n){return n.offlineComponents||(I("FirestoreClient","Using default OfflineComponentProvider"),await rC(n,new XS)),n.offlineComponents}async function Bu(n){return n.onlineComponents||(I("FirestoreClient","Using default OnlineComponentProvider"),await sC(n,new xg)),n.onlineComponents}function oC(n){return Mg(n).then(e=>e.persistence)}function Lg(n){return Mg(n).then(e=>e.localStore)}function aC(n){return Bu(n).then(e=>e.remoteStore)}function Fg(n){return Bu(n).then(e=>e.syncEngine)}function OB(n){return Bu(n).then(e=>e.datastore)}async function Es(n){const e=await Bu(n),t=e.eventManager;return t.onListen=lB.bind(null,e.syncEngine),t.onUnlisten=uB.bind(null,e.syncEngine),t}function MB(n){return n.asyncQueue.enqueue(async()=>{const e=await oC(n),t=await aC(n);return e.setNetworkEnabled(!0),function(i){const r=S(i);return r._u.delete(0),Ha(r)}(t)})}function LB(n){return n.asyncQueue.enqueue(async()=>{const e=await oC(n),t=await aC(n);return e.setNetworkEnabled(!1),async function(i){const r=S(i);r._u.add(0),await Bs(r),r.gu.set("Offline")}(t)})}function FB(n,e){const t=new Le;return n.asyncQueue.enqueueAndForget(async()=>async function(i,r,s){try{const o=await function(a,c){const l=S(a);return l.persistence.runTransaction("read document","readonly",u=>l.localDocuments.getDocument(u,c))}(i,r);o.isFoundDocument()?s.resolve(o):o.isNoDocument()?s.resolve(null):s.reject(new y(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(o){const a=Ws(o,`Failed to get document '${r} from cache`);s.reject(a)}}(await Lg(n),e,t)),t.promise}function cC(n,e,t={}){const i=new Le;return n.asyncQueue.enqueueAndForget(async()=>function(r,s,o,a,c){const l=new Vu({next:h=>{s.enqueueAndForget(()=>Tg(r,u));const d=h.docs.has(o);!d&&h.fromCache?c.reject(new y(m.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&a.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(h)},error:h=>c.reject(h)}),u=new Cg(Us(o.path),l,{includeMetadataChanges:!0,Nu:!0});return Eg(r,u)}(await Es(n),n.asyncQueue,e,t,i)),i.promise}function UB(n,e){const t=new Le;return n.asyncQueue.enqueueAndForget(async()=>async function(i,r,s){try{const o=await _l(i,r,!0),a=new HS(r,o.Hi),c=a.Wu(o.documents),l=a.applyChanges(c,!1);s.resolve(l.snapshot)}catch(o){const a=Ws(o,`Failed to execute query '${r} against cache`);s.reject(a)}}(await Lg(n),e,t)),t.promise}function lC(n,e,t={}){const i=new Le;return n.asyncQueue.enqueueAndForget(async()=>function(r,s,o,a,c){const l=new Vu({next:h=>{s.enqueueAndForget(()=>Tg(r,u)),h.fromCache&&a.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(h)},error:h=>c.reject(h)}),u=new Cg(o,l,{includeMetadataChanges:!0,Nu:!0});return Eg(r,u)}(await Es(n),n.asyncQueue,e,t,i)),i.promise}function $B(n,e){const t=new Vu(e);return n.asyncQueue.enqueueAndForget(async()=>function(i,r){S(i).Ru.add(r),r.next()}(await Es(n),t)),()=>{t.bc(),n.asyncQueue.enqueueAndForget(async()=>function(i,r){S(i).Ru.delete(r)}(await Es(n),t))}}function VB(n,e,t,i){const r=function(s,o){let a;return a=typeof s=="string"?new TextEncoder().encode(s):s,function(c,l){return new NB(c,l)}(function(c,l){if(c instanceof Uint8Array)return Zy(c,l);if(c instanceof ArrayBuffer)return Zy(new Uint8Array(c),l);if(c instanceof ReadableStream)return c.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),o)}(t,Ga(e));n.asyncQueue.enqueueAndForget(async()=>{CB(await Fg(n),r,i)})}function BB(n,e){return n.asyncQueue.enqueue(async()=>function(t,i){const r=S(t);return r.persistence.runTransaction("Get named query","readonly",s=>r.Ns.getNamedQuery(s,i))}(await Lg(n),e))}class qB{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new yg(this,"async_queue_retry"),this.Wc=()=>{const t=kc();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=kc();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=kc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new Le;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(this.Lc.length!==0){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!Ci(e))throw e;I("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(i=>{this.Kc=i,this.Gc=!1;const r=function(s){let o=s.message||"";return s.stack&&(o=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),o}(i);throw we("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.Gc=!1,i))));return this.Bc=t,t}enqueueAfterDelay(e,t,i){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=bg.createAndSchedule(this,e,t,i,s=>this.Yc(s));return this.Uc.push(r),r}zc(){this.Kc&&C()}verifyOperationInProgress(){}async Xc(){let e;do e=this.Bc,await e;while(e!==this.Bc)}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function cf(n){return function(e,t){if(typeof e!="object"||e===null)return!1;const i=e;for(const r of t)if(r in i&&typeof i[r]=="function")return!0;return!1}(n,["next","error","complete"])}class jB{constructor(){this._progressObserver={},this._taskCompletionResolver=new Le,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const WB=-1;class ye extends za{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new qB,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||uC(this),this._firestoreClient.terminate()}}function je(n){return n._firestoreClient||uC(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function uC(n){var e;const t=n._freezeSettings(),i=function(r,s,o,a){return new t$(r,s,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,t);n._firestoreClient=new xB(n._authCredentials,n._appCheckCredentials,n._queue,i)}function KB(n,e){dC(n=G(n,ye));const t=je(n),i=n._freezeSettings(),r=new xg;return hC(t,r,new JS(r,i.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function GB(n){dC(n=G(n,ye));const e=je(n),t=n._freezeSettings(),i=new xg;return hC(e,i,new kB(i,t.cacheSizeBytes))}function hC(n,e,t){const i=new Le;return n.asyncQueue.enqueue(async()=>{try{await rC(n,t),await sC(n,e),i.resolve()}catch(r){const s=r;if(!function(o){return o.name==="FirebaseError"?o.code===m.FAILED_PRECONDITION||o.code===m.UNIMPLEMENTED:typeof DOMException<"u"&&o instanceof DOMException?o.code===22||o.code===20||o.code===11:!0}(s))throw s;ds("Error enabling offline persistence. Falling back to persistence disabled: "+s),i.reject(s)}}).then(()=>i.promise)}function HB(n){if(n._initialized&&!n._terminated)throw new y(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Le;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(t){if(!Ht.C())return Promise.resolve();const i=t+"main";await Ht.delete(i)}(gg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function zB(n){return function(e){const t=new Le;return e.asyncQueue.enqueueAndForget(async()=>gB(await Fg(e),t)),t.promise}(je(n=G(n,ye)))}function QB(n){return MB(je(n=G(n,ye)))}function YB(n){return LB(je(n=G(n,ye)))}function XB(n,e){const t=je(n=G(n,ye)),i=new jB;return VB(t,n._databaseId,e,i),i}function JB(n,e){return BB(je(n=G(n,ye)),e).then(t=>t?new Xe(n,null,t.query):null)}function dC(n){if(n._initialized||n._terminated)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class _n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _n(Ae.fromBase64String(e))}catch(t){throw new y(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new _n(Ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class vi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new y(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ie(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Dr{constructor(e){this._methodName=e}}class qu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return L(this._lat,e._lat)||L(this._long,e._long)}}const ZB=/^__.*__$/;class eq{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Bn(e,this.data,this.fieldMask,t,this.fieldTransforms):new $s(e,this.data,t,this.fieldTransforms)}}class fC{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Bn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function pC(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw C()}}class ju{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.yt=i,this.ignoreUndefinedProperties=r,s===void 0&&this.na(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new ju(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.ua(e),r}ca(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return bl(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(e.length===0)throw this.ha("Document fields must not be empty");if(pC(this.sa)&&ZB.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class tq{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=i||Ga(e)}da(e,t,i,r=!1){return new ju({sa:e,methodName:t,fa:i,path:Ie.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Pr(n){const e=n._freezeSettings(),t=Ga(n._databaseId);return new tq(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Wu(n,e,t,i,r,s={}){const o=n.da(s.merge||s.mergeFields?2:0,e,t,r);Bg("Data must be an object, but it was:",o,i);const a=_C(i,o);let c,l;if(s.merge)c=new Nt(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const h of s.mergeFields){const d=lf(e,h,t);if(!o.contains(d))throw new y(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);vC(u,d)||u.push(d)}c=new Nt(u),l=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,l=o.fieldTransforms;return new eq(new Ke(a),c,l)}class Qa extends Dr{_toFieldTransform(e){if(e.sa!==2)throw e.sa===1?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Qa}}function gC(n,e,t){return new ju({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class Ug extends Dr{_toFieldTransform(e){return new ja(e.path,new ms)}isEqual(e){return e instanceof Ug}}class nq extends Dr{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=gC(this,e,!0),i=this._a.map(s=>xr(s,t)),r=new pr(i);return new ja(e.path,r)}isEqual(e){return this===e}}class iq extends Dr{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=gC(this,e,!0),i=this._a.map(s=>xr(s,t)),r=new gr(i);return new ja(e.path,r)}isEqual(e){return this===e}}class rq extends Dr{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new _s(e.yt,qT(e.yt,this.wa));return new ja(e.path,t)}isEqual(e){return this===e}}function $g(n,e,t,i){const r=n.da(1,e,t);Bg("Data must be an object, but it was:",r,i);const s=[],o=Ke.empty();Nr(i,(c,l)=>{const u=qg(e,c,t);l=v(l);const h=r.ca(u);if(l instanceof Qa)s.push(u);else{const d=xr(l,h);d!=null&&(s.push(u),o.set(u,d))}});const a=new Nt(s);return new fC(o,a,r.fieldTransforms)}function Vg(n,e,t,i,r,s){const o=n.da(1,e,t),a=[lf(e,i,t)],c=[r];if(s.length%2!=0)throw new y(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(lf(e,s[d])),c.push(s[d+1]);const l=[],u=Ke.empty();for(let d=a.length-1;d>=0;--d)if(!vC(l,a[d])){const f=a[d];let p=c[d];p=v(p);const _=o.ca(f);if(p instanceof Qa)l.push(f);else{const w=xr(p,_);w!=null&&(l.push(f),u.set(f,w))}}const h=new Nt(l);return new fC(u,h,o.fieldTransforms)}function mC(n,e,t,i=!1){return xr(t,n.da(i?4:3,e))}function xr(n,e){if(yC(n=v(n)))return Bg("Unsupported field value:",e,n),_C(n,e);if(n instanceof Dr)return function(t,i){if(!pC(i.sa))throw i.ha(`${t._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ha(`${t._methodName}() is not currently supported inside arrays`);const r=t._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&e.sa!==4)throw e.ha("Nested arrays are not supported");return function(t,i){const r=[];let s=0;for(const o of t){let a=xr(o,i.aa(s));a==null&&(a={nullValue:"NULL_VALUE"}),r.push(a),s++}return{arrayValue:{values:r}}}(n,e)}return function(t,i){if((t=v(t))===null)return{nullValue:"NULL_VALUE"};if(typeof t=="number")return qT(i.yt,t);if(typeof t=="boolean")return{booleanValue:t};if(typeof t=="string")return{stringValue:t};if(t instanceof Date){const r=le.fromDate(t);return{timestampValue:ys(i.yt,r)}}if(t instanceof le){const r=new le(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ys(i.yt,r)}}if(t instanceof qu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof _n)return{bytesValue:nS(i.yt,t._byteString)};if(t instanceof se){const r=i.databaseId,s=t.firestore._databaseId;if(!s.isEqual(r))throw i.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:og(t.firestore._databaseId||i.databaseId,t._key.path)}}throw i.ha(`Unsupported field value: ${$u(t)}`)}(n,e)}function _C(n,e){const t={};return bT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Nr(n,(i,r)=>{const s=xr(r,e.ra(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function yC(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof le||n instanceof qu||n instanceof _n||n instanceof se||n instanceof Dr)}function Bg(n,e,t){if(!yC(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const i=$u(t);throw i==="an object"?e.ha(n+" a custom object"):e.ha(n+" "+i)}}function lf(n,e,t){if((e=v(e))instanceof vi)return e._internalPath;if(typeof e=="string")return qg(n,e);throw bl("Field path arguments must be of type string or ",n,!1,void 0,t)}const sq=new RegExp("[~\\*/\\[\\]]");function qg(n,e,t){if(e.search(sq)>=0)throw bl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new vi(...e.split("."))._internalPath}catch{throw bl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function bl(n,e,t,i,r){const s=i&&!i.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new y(m.INVALID_ARGUMENT,a+n+c)}function vC(n,e){return n.some(t=>t.isEqual(e))}class ha{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new se(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new oq(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ku("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class oq extends ha{data(){return super.data()}}function Ku(n,e){return typeof e=="string"?qg(n,e):e instanceof vi?e._internalPath:e._delegate._internalPath}function wC(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class jg{}class Ya extends jg{}function Hn(n,e,...t){let i=[];e instanceof jg&&i.push(e),i=i.concat(t),function(r){const s=r.filter(a=>a instanceof Wg).length,o=r.filter(a=>a instanceof Gu).length;if(s>1||s>0&&o>0)throw new y(m.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class Gu extends Ya{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Gu(e,t,i)}_apply(e){const t=this._parse(e);return bC(e._query,t),new Xe(e.firestore,e.converter,Yd(e._query,t))}_parse(e){const t=Pr(e.firestore);return function(r,s,o,a,c,l,u){let h;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){tv(u,l);const d=[];for(const f of u)d.push(ev(a,r,f));h={arrayValue:{values:d}}}else h=ev(a,r,u)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||tv(u,l),h=mC(o,s,u,l==="in"||l==="not-in");return j.create(c,l,h)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function aq(n,e,t){const i=e,r=Ku("where",n);return Gu._create(r,i,t)}class Wg extends jg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Wg(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:J.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,r){let s=i;const o=r.getFlattenedFilters();for(const a of o)bC(s,a),s=Yd(s,a)}(e._query,t),new Xe(e.firestore,e.converter,Yd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Kg extends Ya{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Kg(e,t)}_apply(e){const t=function(i,r,s){if(i.startAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Jr(r,s);return function(a,c){if(ng(a)===null){const l=Du(a);l!==null&&EC(a,l,c.field)}}(i,o),o}(e._query,this._field,this._direction);return new Xe(e.firestore,e.converter,function(i,r){const s=i.explicitOrderBy.concat([r]);return new Vn(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function cq(n,e="asc"){const t=e,i=Ku("orderBy",n);return Kg._create(i,t)}class Hu extends Ya{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new Hu(e,t,i)}_apply(e){return new Xe(e.firestore,e.converter,fl(e._query,this._limit,this._limitType))}}function lq(n){return eC("limit",n),Hu._create("limit",n,"F")}function uq(n){return eC("limitToLast",n),Hu._create("limitToLast",n,"L")}class zu extends Ya{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new zu(e,t,i)}_apply(e){const t=IC(e,this.type,this._docOrFields,this._inclusive);return new Xe(e.firestore,e.converter,function(i,r){return new Vn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,r,i.endAt)}(e._query,t))}}function hq(...n){return zu._create("startAt",n,!0)}function dq(...n){return zu._create("startAfter",n,!1)}class Qu extends Ya{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new Qu(e,t,i)}_apply(e){const t=IC(e,this.type,this._docOrFields,this._inclusive);return new Xe(e.firestore,e.converter,function(i,r){return new Vn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,r)}(e._query,t))}}function fq(...n){return Qu._create("endBefore",n,!1)}function pq(...n){return Qu._create("endAt",n,!0)}function IC(n,e,t,i){if(t[0]=v(t[0]),t[0]instanceof ha)return function(r,s,o,a,c){if(!a)throw new y(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const l=[];for(const u of Zi(r))if(u.field.isKeyField())l.push(dr(s,a.key));else{const h=a.data.field(u.field);if(tg(h))throw new y(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(h===null){const d=u.field.canonicalString();throw new y(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}l.push(h)}return new _i(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{const r=Pr(n.firestore);return function(s,o,a,c,l,u){const h=s.explicitOrderBy;if(l.length>h.length)throw new y(m.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let f=0;f<l.length;f++){const p=l[f];if(h[f].field.isKeyField()){if(typeof p!="string")throw new y(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof p}`);if(!ig(s)&&p.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${p}' contains a slash.`);const _=s.path.child(K.fromString(p));if(!T.isDocumentKey(_))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);const w=new T(_);d.push(dr(o,w))}else{const _=mC(a,c,p);d.push(_)}}return new _i(d,u)}(n._query,n.firestore._databaseId,r,e,t,i)}}function ev(n,e,t){if(typeof(t=v(t))=="string"){if(t==="")throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ig(e)&&t.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(K.fromString(t));if(!T.isDocumentKey(i))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return dr(n,new T(i))}if(t instanceof se)return dr(n,t._key);throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$u(t)}.`)}function tv(n,e){if(!Array.isArray(n)||n.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new y(m.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function bC(n,e){if(e.isInequality()){const i=Du(n),r=e.field;if(i!==null&&!i.isEqual(r))throw new y(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${i.toString()}' and '${r.toString()}'`);const s=ng(n);s!==null&&EC(n,r,s)}const t=function(i,r){for(const s of i)for(const o of s.getFlattenedFilters())if(r.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function EC(n,e,t){if(!t.isEqual(e))throw new y(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Gg{convertValue(e,t="none"){switch(hr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ur(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw C()}}convertObject(e,t){const i={};return Nr(e.fields,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertGeoPoint(e){return new qu(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=TT(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(ra(e));default:return null}}convertTimestamp(e){const t=gi(e);return new le(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=K.fromString(e);A(dS(i));const r=new pi(i.get(1),i.get(3)),s=new T(i.popFirst(5));return r.isEqual(t)||we(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Yu(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class gq extends Gg{constructor(e){super(),this.firestore=e}convertBytes(e){return new _n(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new se(this.firestore,null,t)}}class Gi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Fn extends ha{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ko(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Ku("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class ko extends Fn{data(e={}){return super.data(e)}}class wi{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Gi(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new ko(this._firestore,this._userDataWriter,i.key,i,new Gi(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(o=>{const a=new ko(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Gi(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);return o.doc,{type:"added",doc:a,oldIndex:-1,newIndex:s++}})}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>r||o.type!==3).map(o=>{const a=new ko(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Gi(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return o.type!==0&&(c=s.indexOf(o.doc.key),s=s.delete(o.doc.key)),o.type!==1&&(s=s.add(o.doc),l=s.indexOf(o.doc.key)),{type:mq(o.type),doc:a,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function mq(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return C()}}function TC(n,e){return n instanceof Fn&&e instanceof Fn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof wi&&e instanceof wi&&n._firestore===e._firestore&&iC(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function _q(n){n=G(n,se);const e=G(n.firestore,ye);return cC(je(e),n._key).then(t=>Hg(e,n,t))}class Or extends Gg{constructor(e){super(),this.firestore=e}convertBytes(e){return new _n(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new se(this.firestore,null,t)}}function yq(n){n=G(n,se);const e=G(n.firestore,ye),t=je(e),i=new Or(e);return FB(t,n._key).then(r=>new Fn(e,i,n._key,r,new Gi(r!==null&&r.hasLocalMutations,!0),n.converter))}function vq(n){n=G(n,se);const e=G(n.firestore,ye);return cC(je(e),n._key,{source:"server"}).then(t=>Hg(e,n,t))}function wq(n){n=G(n,Xe);const e=G(n.firestore,ye),t=je(e),i=new Or(e);return wC(n._query),lC(t,n._query).then(r=>new wi(e,i,n,r))}function Iq(n){n=G(n,Xe);const e=G(n.firestore,ye),t=je(e),i=new Or(e);return UB(t,n._query).then(r=>new wi(e,i,n,r))}function bq(n){n=G(n,Xe);const e=G(n.firestore,ye),t=je(e),i=new Or(e);return lC(t,n._query,{source:"server"}).then(r=>new wi(e,i,n,r))}function nv(n,e,t){n=G(n,se);const i=G(n.firestore,ye),r=Yu(n.converter,e,t);return Xa(i,[Wu(Pr(i),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,ce.none())])}function iv(n,e,t,...i){n=G(n,se);const r=G(n.firestore,ye),s=Pr(r);let o;return o=typeof(e=v(e))=="string"||e instanceof vi?Vg(s,"updateDoc",n._key,e,t,i):$g(s,"updateDoc",n._key,e),Xa(r,[o.toMutation(n._key,ce.exists(!0))])}function Eq(n){return Xa(G(n.firestore,ye),[new Vs(n._key,ce.none())])}function Tq(n,e){const t=G(n.firestore,ye),i=Il(n),r=Yu(n.converter,e);return Xa(t,[Wu(Pr(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,ce.exists(!1))]).then(()=>i)}function SC(n,...e){var t,i,r;n=v(n);let s={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||cf(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(cf(e[o])){const h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),e[o+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}let c,l,u;if(n instanceof se)l=G(n.firestore,ye),u=Us(n._key.path),c={next:h=>{e[o]&&e[o](Hg(l,n,h))},error:e[o+1],complete:e[o+2]};else{const h=G(n,Xe);l=G(h.firestore,ye),u=h._query;const d=new Or(l);c={next:f=>{e[o]&&e[o](new wi(l,d,h,f))},error:e[o+1],complete:e[o+2]},wC(n._query)}return function(h,d,f,p){const _=new Vu(p),w=new Cg(d,_,f);return h.asyncQueue.enqueueAndForget(async()=>Eg(await Es(h),w)),()=>{_.bc(),h.asyncQueue.enqueueAndForget(async()=>Tg(await Es(h),w))}}(je(l),u,a,c)}function Sq(n,e){return $B(je(n=G(n,ye)),cf(e)?e:{next:e})}function Xa(n,e){return function(t,i){const r=new Le;return t.asyncQueue.enqueueAndForget(async()=>hB(await Fg(t),i,r)),r.promise}(je(n),e)}function Hg(n,e,t){const i=t.docs.get(e._key),r=new Or(n);return new Fn(n,r,e._key,i,new Gi(t.hasPendingWrites,t.fromCache),e.converter)}const Cq={maxAttempts:5};class kq{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Pr(e)}set(e,t,i){this._verifyNotCommitted();const r=Qn(e,this._firestore),s=Yu(r.converter,t,i),o=Wu(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,ce.none())),this}update(e,t,i,...r){this._verifyNotCommitted();const s=Qn(e,this._firestore);let o;return o=typeof(t=v(t))=="string"||t instanceof vi?Vg(this._dataReader,"WriteBatch.update",s._key,t,i,r):$g(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ce.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Qn(e,this._firestore);return this._mutations=this._mutations.concat(new Vs(t._key,ce.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Qn(n,e){if((n=v(n)).firestore!==e)throw new y(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Aq extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Pr(e)}get(e){const t=Qn(e,this._firestore),i=new gq(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||r.length!==1)return C();const s=r[0];if(s.isFoundDocument())return new ha(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new ha(this._firestore,i,t._key,null,t.converter);throw C()})}set(e,t,i){const r=Qn(e,this._firestore),s=Yu(r.converter,t,i),o=Wu(this._dataReader,"Transaction.set",r._key,s,r.converter!==null,i);return this._transaction.set(r._key,o),this}update(e,t,i,...r){const s=Qn(e,this._firestore);let o;return o=typeof(t=v(t))=="string"||t instanceof vi?Vg(this._dataReader,"Transaction.update",s._key,t,i,r):$g(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){const t=Qn(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Qn(e,this._firestore),i=new Or(this._firestore);return super.get(e).then(r=>new Fn(this._firestore,i,t._key,r._document,new Gi(!1,!1),t.converter))}}function Rq(n,e,t){n=G(n,ye);const i=Object.assign(Object.assign({},Cq),t);return function(r){if(r.maxAttempts<1)throw new y(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(r,s,o){const a=new Le;return r.asyncQueue.enqueueAndForget(async()=>{const c=await OB(r);new PB(r.asyncQueue,c,o,s,a).run()}),a.promise}(je(n),r=>e(new Aq(n,r)),i)}function Nq(){return new Qa("deleteField")}function Dq(){return new Ug("serverTimestamp")}function Pq(...n){return new nq("arrayUnion",n)}function xq(...n){return new iq("arrayRemove",n)}function Oq(n){return new rq("increment",n)}(function(n,e=!0){(function(t){Fs=t})(wn),ge(new H("firestore",(t,{instanceIdentifier:i,options:r})=>{const s=t.getProvider("app").getImmediate(),o=new ye(new jU(t.getProvider("auth-internal")),new HU(t.getProvider("app-check-internal")),function(a,c){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new y(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pi(a.options.projectId,c)}(s,i),s);return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),Z(ey,"3.8.0",n),Z(ey,"3.8.0","esm2017")})();const Mq="@firebase/firestore-compat",Lq="0.3.0";function zg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function rv(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function sv(){if(!n$())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}let El=class{constructor(e){this._delegate=e}static fromBase64String(e){return sv(),new El(_n.fromBase64String(e))}static fromUint8Array(e){return rv(),new El(_n.fromUint8Array(e))}toBase64(){return sv(),this._delegate.toBase64()}toUint8Array(){return rv(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function uf(n){return Fq(n,["next","error","complete"])}function Fq(n,e){if(typeof n!="object"||n===null)return!1;const t=n;for(const i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}class Uq{enableIndexedDbPersistence(e,t){return KB(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return GB(e._delegate)}clearIndexedDbPersistence(e){return HB(e._delegate)}}class CC{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof pi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ds("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){AB(this._delegate,e,t,i)}enableNetwork(){return QB(this._delegate)}disableNetwork(){return YB(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,ZS("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return zB(this._delegate)}onSnapshotsInSync(e){return Sq(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ts(this,tC(this._delegate,e))}catch(t){throw at(t,"collection()","Firestore.collection()")}}doc(e){try{return new $t(this,Il(this._delegate,e))}catch(t){throw at(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ot(this,RB(this._delegate,e))}catch(t){throw at(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Rq(this._delegate,t=>e(new kC(this,t)))}batch(){return je(this._delegate),new AC(new kq(this._delegate,e=>Xa(this._delegate,e)))}loadBundle(e){return XB(this._delegate,e)}namedQuery(e){return JB(this._delegate,e).then(t=>t?new ot(this,t):null)}}class Xu extends Gg{constructor(e){super(),this.firestore=e}convertBytes(e){return new El(new _n(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return $t.forKey(t,this.firestore,null)}}function $q(n){$U(n)}class kC{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Xu(e)}get(e){const t=Hi(e);return this._delegate.get(t).then(i=>new da(this._firestore,new Fn(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){const r=Hi(e);return i?(zg("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=Hi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=Hi(e);return this._delegate.delete(t),this}}class AC{constructor(e){this._delegate=e}set(e,t,i){const r=Hi(e);return i?(zg("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=Hi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=Hi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class vr{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){const i=new ko(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new fa(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const i=vr.INSTANCES;let r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new vr(e,new Xu(e),t),r.set(t,s)),s}}vr.INSTANCES=new WeakMap;class $t{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Xu(e)}static forPath(e,t,i){if(e.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new $t(t,new se(t._delegate,i,new T(e)))}static forKey(e,t,i){return new $t(t,new se(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new Ts(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ts(this.firestore,tC(this._delegate,e))}catch(t){throw at(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=v(e),e instanceof se?nC(this._delegate,e):!1}set(e,t){t=zg("DocumentReference.set",t);try{return t?nv(this._delegate,e,t):nv(this._delegate,e)}catch(i){throw at(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?iv(this._delegate,e):iv(this._delegate,e,t,...i)}catch(r){throw at(r,"updateDoc()","DocumentReference.update()")}}delete(){return Eq(this._delegate)}onSnapshot(...e){const t=RC(e),i=NC(e,r=>new da(this.firestore,new Fn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return SC(this._delegate,t,i)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=yq(this._delegate):(e==null?void 0:e.source)==="server"?t=vq(this._delegate):t=_q(this._delegate),t.then(i=>new da(this.firestore,new Fn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new $t(this.firestore,e?this._delegate.withConverter(vr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function at(n,e,t){return n.message=n.message.replace(e,t),n}function RC(n){for(const e of n)if(typeof e=="object"&&!uf(e))return e;return{}}function NC(n,e){var t,i;let r;return uf(n[0])?r=n[0]:uf(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}class da{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new $t(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return TC(this._delegate,e._delegate)}}class fa extends da{data(e){const t=this._delegate.data(e);return VU(t!==void 0),t}}class ot{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Xu(e)}where(e,t,i){try{return new ot(this.firestore,Hn(this._delegate,aq(e,t,i)))}catch(r){throw at(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ot(this.firestore,Hn(this._delegate,cq(e,t)))}catch(i){throw at(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ot(this.firestore,Hn(this._delegate,lq(e)))}catch(t){throw at(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ot(this.firestore,Hn(this._delegate,uq(e)))}catch(t){throw at(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ot(this.firestore,Hn(this._delegate,hq(...e)))}catch(t){throw at(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ot(this.firestore,Hn(this._delegate,dq(...e)))}catch(t){throw at(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ot(this.firestore,Hn(this._delegate,fq(...e)))}catch(t){throw at(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ot(this.firestore,Hn(this._delegate,pq(...e)))}catch(t){throw at(t,"endAt()","Query.endAt()")}}isEqual(e){return iC(this._delegate,e._delegate)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=Iq(this._delegate):(e==null?void 0:e.source)==="server"?t=bq(this._delegate):t=wq(this._delegate),t.then(i=>new hf(this.firestore,new wi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){const t=RC(e),i=NC(e,r=>new hf(this.firestore,new wi(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return SC(this._delegate,t,i)}withConverter(e){return new ot(this.firestore,e?this._delegate.withConverter(vr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Vq{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new fa(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class hf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ot(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new fa(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Vq(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new fa(this._firestore,i))})}isEqual(e){return TC(this._delegate,e._delegate)}}class Ts extends ot{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new $t(this.firestore,e):null}doc(e){try{return e===void 0?new $t(this.firestore,Il(this._delegate)):new $t(this.firestore,Il(this._delegate,e))}catch(t){throw at(t,"doc()","CollectionReference.doc()")}}add(e){return Tq(this._delegate,e).then(t=>new $t(this.firestore,t))}isEqual(e){return nC(this._delegate,e._delegate)}withConverter(e){return new Ts(this.firestore,e?this._delegate.withConverter(vr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Hi(n){return G(n,se)}class Qg{constructor(...e){this._delegate=new vi(...e)}static documentId(){return new Qg(Ie.keyField().canonicalString())}isEqual(e){return e=v(e),e instanceof vi?this._delegate._internalPath.isEqual(e._internalPath):!1}}class Vi{constructor(e){this._delegate=e}static serverTimestamp(){const e=Dq();return e._methodName="FieldValue.serverTimestamp",new Vi(e)}static delete(){const e=Nq();return e._methodName="FieldValue.delete",new Vi(e)}static arrayUnion(...e){const t=Pq(...e);return t._methodName="FieldValue.arrayUnion",new Vi(t)}static arrayRemove(...e){const t=xq(...e);return t._methodName="FieldValue.arrayRemove",new Vi(t)}static increment(e){const t=Oq(e);return t._methodName="FieldValue.increment",new Vi(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Bq={Firestore:CC,GeoPoint:qu,Timestamp:le,Blob:El,Transaction:kC,WriteBatch:AC,DocumentReference:$t,DocumentSnapshot:da,Query:ot,QueryDocumentSnapshot:fa,QuerySnapshot:hf,CollectionReference:Ts,FieldPath:Qg,FieldValue:Vi,setLogLevel:$q,CACHE_SIZE_UNLIMITED:WB};function qq(n,e){n.INTERNAL.registerComponent(new H("firestore-compat",t=>{const i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},Bq)))}function jq(n){qq(n,(e,t)=>new CC(e,t,new Uq)),n.registerVersion(Mq,Lq)}jq(Te);const Wq="type.googleapis.com/google.protobuf.Int64Value",Kq="type.googleapis.com/google.protobuf.UInt64Value";function DC(n,e){const t={};for(const i in n)n.hasOwnProperty(i)&&(t[i]=e(n[i]));return t}function df(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>df(e));if(typeof n=="function"||typeof n=="object")return DC(n,e=>df(e));throw new Error("Data cannot be encoded in JSON: "+n)}function Tl(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case Wq:case Kq:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>Tl(e)):typeof n=="function"||typeof n=="object"?DC(n,e=>Tl(e)):n}const PC="functions";const ov={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class es extends he{constructor(e,t,i){super(`${PC}/${e}`,t||""),this.details=i}}function Gq(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Hq(n,e){let t=Gq(n),i=t,r;try{const s=e&&e.error;if(s){const o=s.status;if(typeof o=="string"){if(!ov[o])return new es("internal","internal");t=ov[o],i=o}const a=s.message;typeof a=="string"&&(i=a),r=s.details,r!==void 0&&(r=Tl(r))}}catch{}return t==="ok"?null:new es(t,i,r)}class zq{constructor(e,t,i){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(r=>this.auth=r,()=>{}),this.messaging||t.get().then(r=>this.messaging=r,()=>{}),this.appCheck||i.get().then(r=>this.appCheck=r,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(){if(this.appCheck){const e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){const e=await this.getAuthToken(),t=await this.getMessagingToken(),i=await this.getAppCheckToken();return{authToken:e,messagingToken:t,appCheckToken:i}}}const av="us-central1";function Qq(n){let e=null;return{promise:new Promise((t,i)=>{e=setTimeout(()=>{i(new es("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}let Yq=class{constructor(e,t,i,r,s=av,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new zq(t,i,r),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(s);this.customDomain=a.origin,this.region=av}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}};function Xq(n,e,t){n.emulatorOrigin=`http://${e}:${t}`}function Jq(n,e,t){return i=>tj(n,e,i,t||{})}function Zq(n,e,t){return i=>xC(n,e,i,t||{})}async function ej(n,e,t,i){t["Content-Type"]="application/json";let r;try{r=await i(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let s=null;try{s=await r.json()}catch{}return{status:r.status,json:s}}function tj(n,e,t,i){const r=n._url(e);return xC(n,r,t,i)}async function xC(n,e,t,i){t=df(t);const r={data:t},s={},o=await n.contextProvider.getContext();o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=i.timeout||7e4,c=Qq(a),l=await Promise.race([ej(e,r,s,n.fetchImpl),c.promise,n.cancelAllRequests]);if(c.cancel(),!l)throw new es("cancelled","Firebase Functions instance was deleted.");const u=Hq(l.status,l.json);if(u)throw u;if(!l.json)throw new es("internal","Response is not valid JSON object.");let h=l.json.data;if(typeof h>"u"&&(h=l.json.result),typeof h>"u")throw new es("internal","Response is missing data field.");return{data:Tl(h)}}const cv="@firebase/functions",lv="0.9.0";const nj="auth-internal",ij="app-check-internal",rj="messaging-internal";function sj(n,e){const t=(i,{instanceIdentifier:r})=>{const s=i.getProvider("app").getImmediate(),o=i.getProvider(nj),a=i.getProvider(rj),c=i.getProvider(ij);return new Yq(s,o,a,c,r,n)};ge(new H(PC,t,"PUBLIC").setMultipleInstances(!0)),Z(cv,lv,e),Z(cv,lv,"esm2017")}function uv(n,e,t){Xq(v(n),e,t)}function oj(n,e,t){return Jq(v(n),e,t)}function aj(n,e,t){return Zq(v(n),e,t)}sj(fetch.bind(self));const cj="@firebase/functions-compat",lj="0.3.0";class OC{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return oj(this._delegate,e,t)}httpsCallableFromURL(e,t){return aj(this._delegate,e,t)}useFunctionsEmulator(e){const t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(t==null)throw new he("functions","No origin provided to useFunctionsEmulator()");if(t[2]==null)throw new he("functions","Port missing in origin provided to useFunctionsEmulator()");return uv(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return uv(this._delegate,e,t)}}const uj="us-central1",hj=(n,{instanceIdentifier:e})=>{const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("functions").getImmediate({identifier:e??uj});return new OC(t,i)};function dj(){const n={Functions:OC};Te.INTERNAL.registerComponent(new H("functions-compat",hj,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}dj();Te.registerVersion(cj,lj);const fj="/firebase-messaging-sw.js",pj="/firebase-cloud-messaging-push-scope",MC="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",gj="https://fcmregistrations.googleapis.com/v1",LC="google.c.a.c_id",mj="google.c.a.c_l",_j="google.c.a.ts",yj="google.c.a.e";var hv;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(hv||(hv={}));var pa;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(pa||(pa={}));function In(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function vj(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}const Lh="fcm_token_details_db",wj=5,dv="fcm_token_object_Store";async function Ij(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(s=>s.name).includes(Lh))return null;let e=null;return(await Cs(Lh,wj,{upgrade:async(i,r,s,o)=>{var a;if(r<2||!i.objectStoreNames.contains(dv))return;const c=o.objectStore(dv),l=await c.index("fcmSenderId").get(n);if(await c.clear(),!!l){if(r===2){const u=l;if(!u.auth||!u.p256dh||!u.endpoint)return;e={token:u.fcmToken,createTime:(a=u.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:u.auth,p256dh:u.p256dh,endpoint:u.endpoint,swScope:u.swScope,vapidKey:typeof u.vapidKey=="string"?u.vapidKey:In(u.vapidKey)}}}else if(r===3){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:In(u.auth),p256dh:In(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:In(u.vapidKey)}}}else if(r===4){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:In(u.auth),p256dh:In(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:In(u.vapidKey)}}}}}})).close(),await Gr(Lh),await Gr("fcm_vapid_details_db"),await Gr("undefined"),bj(e)?e:null}function bj(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}const Ej="firebase-messaging-database",Tj=1,wr="firebase-messaging-store";let Fh=null;function Yg(){return Fh||(Fh=Cs(Ej,Tj,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(wr)}}})),Fh}async function FC(n){const e=Jg(n),i=await(await Yg()).transaction(wr).objectStore(wr).get(e);if(i)return i;{const r=await Ij(n.appConfig.senderId);if(r)return await Xg(n,r),r}}async function Xg(n,e){const t=Jg(n),r=(await Yg()).transaction(wr,"readwrite");return await r.objectStore(wr).put(e,t),await r.done,e}async function Sj(n){const e=Jg(n),i=(await Yg()).transaction(wr,"readwrite");await i.objectStore(wr).delete(e),await i.done}function Jg({appConfig:n}){return n.appId}const Cj={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},ft=new pt("messaging","Messaging",Cj);async function kj(n,e){const t=await em(n),i=$C(e),r={method:"POST",headers:t,body:JSON.stringify(i)};let s;try{s=await(await fetch(Zg(n.appConfig),r)).json()}catch(o){throw ft.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(s.error){const o=s.error.message;throw ft.create("token-subscribe-failed",{errorInfo:o})}if(!s.token)throw ft.create("token-subscribe-no-token");return s.token}async function Aj(n,e){const t=await em(n),i=$C(e.subscriptionOptions),r={method:"PATCH",headers:t,body:JSON.stringify(i)};let s;try{s=await(await fetch(`${Zg(n.appConfig)}/${e.token}`,r)).json()}catch(o){throw ft.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(s.error){const o=s.error.message;throw ft.create("token-update-failed",{errorInfo:o})}if(!s.token)throw ft.create("token-update-no-token");return s.token}async function UC(n,e){const i={method:"DELETE",headers:await em(n)};try{const s=await(await fetch(`${Zg(n.appConfig)}/${e}`,i)).json();if(s.error){const o=s.error.message;throw ft.create("token-unsubscribe-failed",{errorInfo:o})}}catch(r){throw ft.create("token-unsubscribe-failed",{errorInfo:r==null?void 0:r.toString()})}}function Zg({projectId:n}){return`${gj}/projects/${n}/registrations`}async function em({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function $C({p256dh:n,auth:e,endpoint:t,vapidKey:i}){const r={web:{endpoint:t,auth:e,p256dh:n}};return i!==MC&&(r.web.applicationPubKey=i),r}const Rj=7*24*60*60*1e3;async function Nj(n){const e=await Pj(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:In(e.getKey("auth")),p256dh:In(e.getKey("p256dh"))},i=await FC(n.firebaseDependencies);if(i){if(xj(i.subscriptionOptions,t))return Date.now()>=i.createTime+Rj?Dj(n,{token:i.token,createTime:Date.now(),subscriptionOptions:t}):i.token;try{await UC(n.firebaseDependencies,i.token)}catch(r){console.warn(r)}return fv(n.firebaseDependencies,t)}else return fv(n.firebaseDependencies,t)}async function VC(n){const e=await FC(n.firebaseDependencies);e&&(await UC(n.firebaseDependencies,e.token),await Sj(n.firebaseDependencies));const t=await n.swRegistration.pushManager.getSubscription();return t?t.unsubscribe():!0}async function Dj(n,e){try{const t=await Aj(n.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await Xg(n.firebaseDependencies,i),t}catch(t){throw await VC(n),t}}async function fv(n,e){const i={token:await kj(n,e),createTime:Date.now(),subscriptionOptions:e};return await Xg(n,i),i.token}async function Pj(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:vj(e)})}function xj(n,e){const t=e.vapidKey===n.vapidKey,i=e.endpoint===n.endpoint,r=e.auth===n.auth,s=e.p256dh===n.p256dh;return t&&i&&r&&s}function pv(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return Oj(e,n),Mj(e,n),Lj(e,n),e}function Oj(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const i=e.notification.body;i&&(n.notification.body=i);const r=e.notification.image;r&&(n.notification.image=r);const s=e.notification.icon;s&&(n.notification.icon=s)}function Mj(n,e){e.data&&(n.data=e.data)}function Lj(n,e){var t,i,r,s,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(r=(i=e.fcmOptions)===null||i===void 0?void 0:i.link)!==null&&r!==void 0?r:(s=e.notification)===null||s===void 0?void 0:s.click_action;a&&(n.fcmOptions.link=a);const c=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;c&&(n.fcmOptions.analyticsLabel=c)}function Fj(n){return typeof n=="object"&&!!n&&LC in n}BC("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");BC("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function BC(n,e){const t=[];for(let i=0;i<n.length;i++)t.push(n.charAt(i)),i<e.length&&t.push(e.charAt(i));return t.join("")}function Uj(n){if(!n||!n.options)throw Uh("App Configuration Object");if(!n.name)throw Uh("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const i of e)if(!t[i])throw Uh(i);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Uh(n){return ft.create("missing-app-config-values",{valueName:n})}let $j=class{constructor(e,t,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=Uj(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:i}}_delete(){return Promise.resolve()}};async function qC(n){try{n.swRegistration=await navigator.serviceWorker.register(fj,{scope:pj}),n.swRegistration.update().catch(()=>{})}catch(e){throw ft.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}async function Vj(n,e){if(!e&&!n.swRegistration&&await qC(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw ft.create("invalid-sw-registration");n.swRegistration=e}}async function Bj(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=MC)}async function jC(n,e){if(!navigator)throw ft.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw ft.create("permission-blocked");return await Bj(n,e==null?void 0:e.vapidKey),await Vj(n,e==null?void 0:e.serviceWorkerRegistration),Nj(n)}async function qj(n,e,t){const i=jj(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:t[LC],message_name:t[mj],message_time:t[_j],message_device_time:Math.floor(Date.now()/1e3)})}function jj(n){switch(n){case pa.NOTIFICATION_CLICKED:return"notification_open";case pa.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}async function Wj(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===pa.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(pv(t)):n.onMessageHandler.next(pv(t)));const i=t.data;Fj(i)&&i[yj]==="1"&&await qj(n,t.messageType,i)}const gv="@firebase/messaging",mv="0.12.0";const Kj=n=>{const e=new $j(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>Wj(e,t)),e},Gj=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:i=>jC(e,i)}};function Hj(){ge(new H("messaging",Kj,"PUBLIC")),ge(new H("messaging-internal",Gj,"PRIVATE")),Z(gv,mv),Z(gv,mv,"esm2017")}async function zj(n){if(!navigator)throw ft.create("only-available-in-window");return n.swRegistration||await qC(n),VC(n)}function Qj(n,e){if(!navigator)throw ft.create("only-available-in-window");return n.onMessageHandler=e,()=>{n.onMessageHandler=null}}async function Yj(n,e){return n=v(n),jC(n,e)}function Xj(n){return n=v(n),zj(n)}function Jj(n,e){return n=v(n),Qj(n,e)}Hj();const WC="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Zj="https://fcmregistrations.googleapis.com/v1",KC="FCM_MSG",eW="google.c.a.c_id",tW=3,nW=1;var Sl;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(Sl||(Sl={}));var Cl;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(Cl||(Cl={}));function bn(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function iW(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}const $h="fcm_token_details_db",rW=5,_v="fcm_token_object_Store";async function sW(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(s=>s.name).includes($h))return null;let e=null;return(await Cs($h,rW,{upgrade:async(i,r,s,o)=>{var a;if(r<2||!i.objectStoreNames.contains(_v))return;const c=o.objectStore(_v),l=await c.index("fcmSenderId").get(n);if(await c.clear(),!!l){if(r===2){const u=l;if(!u.auth||!u.p256dh||!u.endpoint)return;e={token:u.fcmToken,createTime:(a=u.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:u.auth,p256dh:u.p256dh,endpoint:u.endpoint,swScope:u.swScope,vapidKey:typeof u.vapidKey=="string"?u.vapidKey:bn(u.vapidKey)}}}else if(r===3){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:bn(u.auth),p256dh:bn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:bn(u.vapidKey)}}}else if(r===4){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:bn(u.auth),p256dh:bn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:bn(u.vapidKey)}}}}}})).close(),await Gr($h),await Gr("fcm_vapid_details_db"),await Gr("undefined"),oW(e)?e:null}function oW(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}const aW="firebase-messaging-database",cW=1,Ir="firebase-messaging-store";let Vh=null;function tm(){return Vh||(Vh=Cs(aW,cW,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Ir)}}})),Vh}async function nm(n){const e=rm(n),i=await(await tm()).transaction(Ir).objectStore(Ir).get(e);if(i)return i;{const r=await sW(n.appConfig.senderId);if(r)return await im(n,r),r}}async function im(n,e){const t=rm(n),r=(await tm()).transaction(Ir,"readwrite");return await r.objectStore(Ir).put(e,t),await r.done,e}async function lW(n){const e=rm(n),i=(await tm()).transaction(Ir,"readwrite");await i.objectStore(Ir).delete(e),await i.done}function rm({appConfig:n}){return n.appId}const uW={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},hn=new pt("messaging","Messaging",uW);async function hW(n,e){const t=await om(n),i=HC(e),r={method:"POST",headers:t,body:JSON.stringify(i)};let s;try{s=await(await fetch(sm(n.appConfig),r)).json()}catch(o){throw hn.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(s.error){const o=s.error.message;throw hn.create("token-subscribe-failed",{errorInfo:o})}if(!s.token)throw hn.create("token-subscribe-no-token");return s.token}async function dW(n,e){const t=await om(n),i=HC(e.subscriptionOptions),r={method:"PATCH",headers:t,body:JSON.stringify(i)};let s;try{s=await(await fetch(`${sm(n.appConfig)}/${e.token}`,r)).json()}catch(o){throw hn.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(s.error){const o=s.error.message;throw hn.create("token-update-failed",{errorInfo:o})}if(!s.token)throw hn.create("token-update-no-token");return s.token}async function GC(n,e){const i={method:"DELETE",headers:await om(n)};try{const s=await(await fetch(`${sm(n.appConfig)}/${e}`,i)).json();if(s.error){const o=s.error.message;throw hn.create("token-unsubscribe-failed",{errorInfo:o})}}catch(r){throw hn.create("token-unsubscribe-failed",{errorInfo:r==null?void 0:r.toString()})}}function sm({projectId:n}){return`${Zj}/projects/${n}/registrations`}async function om({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function HC({p256dh:n,auth:e,endpoint:t,vapidKey:i}){const r={web:{endpoint:t,auth:e,p256dh:n}};return i!==WC&&(r.web.applicationPubKey=i),r}const fW=7*24*60*60*1e3;async function pW(n){const e=await mW(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:bn(e.getKey("auth")),p256dh:bn(e.getKey("p256dh"))},i=await nm(n.firebaseDependencies);if(i){if(_W(i.subscriptionOptions,t))return Date.now()>=i.createTime+fW?gW(n,{token:i.token,createTime:Date.now(),subscriptionOptions:t}):i.token;try{await GC(n.firebaseDependencies,i.token)}catch(r){console.warn(r)}return yv(n.firebaseDependencies,t)}else return yv(n.firebaseDependencies,t)}async function ff(n){const e=await nm(n.firebaseDependencies);e&&(await GC(n.firebaseDependencies,e.token),await lW(n.firebaseDependencies));const t=await n.swRegistration.pushManager.getSubscription();return t?t.unsubscribe():!0}async function gW(n,e){try{const t=await dW(n.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await im(n.firebaseDependencies,i),t}catch(t){throw await ff(n),t}}async function yv(n,e){const i={token:await hW(n,e),createTime:Date.now(),subscriptionOptions:e};return await im(n,i),i.token}async function mW(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:iW(e)})}function _W(n,e){const t=e.vapidKey===n.vapidKey,i=e.endpoint===n.endpoint,r=e.auth===n.auth,s=e.p256dh===n.p256dh;return t&&i&&r&&s}function yW(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return vW(e,n),wW(e,n),IW(e,n),e}function vW(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const i=e.notification.body;i&&(n.notification.body=i);const r=e.notification.image;r&&(n.notification.image=r);const s=e.notification.icon;s&&(n.notification.icon=s)}function wW(n,e){e.data&&(n.data=e.data)}function IW(n,e){var t,i,r,s,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(r=(i=e.fcmOptions)===null||i===void 0?void 0:i.link)!==null&&r!==void 0?r:(s=e.notification)===null||s===void 0?void 0:s.click_action;a&&(n.fcmOptions.link=a);const c=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;c&&(n.fcmOptions.analyticsLabel=c)}function bW(n){return typeof n=="object"&&!!n&&eW in n}function EW(n){return new Promise(e=>{setTimeout(e,n)})}zC("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");zC("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");async function TW(n,e){const t=SW(e,await n.firebaseDependencies.installations.getId());CW(n,t)}function SW(n,e){var t,i;const r={};return n.from&&(r.project_number=n.from),n.fcmMessageId&&(r.message_id=n.fcmMessageId),r.instance_id=e,n.notification?r.message_type=Sl.DISPLAY_NOTIFICATION.toString():r.message_type=Sl.DATA_MESSAGE.toString(),r.sdk_platform=tW.toString(),r.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),n.collapse_key&&(r.collapse_key=n.collapse_key),r.event=nW.toString(),!((t=n.fcmOptions)===null||t===void 0)&&t.analytics_label&&(r.analytics_label=(i=n.fcmOptions)===null||i===void 0?void 0:i.analytics_label),r}function CW(n,e){const t={};t.event_time_ms=Math.floor(Date.now()).toString(),t.source_extension_json_proto3=JSON.stringify(e),n.logEvents.push(t)}function zC(n,e){const t=[];for(let i=0;i<n.length;i++)t.push(n.charAt(i)),i<e.length&&t.push(e.charAt(i));return t.join("")}async function kW(n,e){var t,i;const{newSubscription:r}=n;if(!r){await ff(e);return}const s=await nm(e.firebaseDependencies);await ff(e),e.vapidKey=(i=(t=s==null?void 0:s.subscriptionOptions)===null||t===void 0?void 0:t.vapidKey)!==null&&i!==void 0?i:WC,await pW(e)}async function AW(n,e){const t=DW(n);if(!t)return;e.deliveryMetricsExportedToBigQueryEnabled&&await TW(e,t);const i=await QC();if(xW(i))return OW(i,t);if(t.notification&&await MW(NW(t)),!!e&&e.onBackgroundMessageHandler){const r=yW(t);typeof e.onBackgroundMessageHandler=="function"?await e.onBackgroundMessageHandler(r):e.onBackgroundMessageHandler.next(r)}}async function RW(n){var e,t;const i=(t=(e=n.notification)===null||e===void 0?void 0:e.data)===null||t===void 0?void 0:t[KC];if(i){if(n.action)return}else return;n.stopImmediatePropagation(),n.notification.close();const r=LW(i);if(!r)return;const s=new URL(r,self.location.href),o=new URL(self.location.origin);if(s.host!==o.host)return;let a=await PW(s);if(a?a=await a.focus():(a=await self.clients.openWindow(r),await EW(3e3)),!!a)return i.messageType=Cl.NOTIFICATION_CLICKED,i.isFirebaseMessaging=!0,a.postMessage(i)}function NW(n){const e=Object.assign({},n.notification);return e.data={[KC]:n},e}function DW({data:n}){if(!n)return null;try{return n.json()}catch{return null}}async function PW(n){const e=await QC();for(const t of e){const i=new URL(t.url,self.location.href);if(n.host===i.host)return t}return null}function xW(n){return n.some(e=>e.visibilityState==="visible"&&!e.url.startsWith("chrome-extension://"))}function OW(n,e){e.isFirebaseMessaging=!0,e.messageType=Cl.PUSH_RECEIVED;for(const t of n)t.postMessage(e)}function QC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function MW(n){var e;const{actions:t}=n,{maxActions:i}=Notification;return t&&i&&t.length>i&&console.warn(`This browser only supports ${i} actions. The remaining actions will not be displayed.`),self.registration.showNotification((e=n.title)!==null&&e!==void 0?e:"",n)}function LW(n){var e,t,i;const r=(t=(e=n.fcmOptions)===null||e===void 0?void 0:e.link)!==null&&t!==void 0?t:(i=n.notification)===null||i===void 0?void 0:i.click_action;return r||(bW(n.data)?self.location.origin:null)}function FW(n){if(!n||!n.options)throw Bh("App Configuration Object");if(!n.name)throw Bh("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const i of e)if(!t[i])throw Bh(i);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Bh(n){return hn.create("missing-app-config-values",{valueName:n})}class UW{constructor(e,t,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=FW(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:i}}_delete(){return Promise.resolve()}}const $W=n=>{const e=new UW(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return self.addEventListener("push",t=>{t.waitUntil(AW(t,e))}),self.addEventListener("pushsubscriptionchange",t=>{t.waitUntil(kW(t,e))}),self.addEventListener("notificationclick",t=>{t.waitUntil(RW(t))}),e};function VW(){ge(new H("messaging-sw",$W,"PUBLIC"))}function BW(n,e){if(self.document!==void 0)throw hn.create("only-available-in-sw");return n.onBackgroundMessageHandler=e,()=>{n.onBackgroundMessageHandler=null}}function qW(n,e){return n=v(n),BW(n,e)}VW();const jW="@firebase/messaging-compat",WW="0.2.0";function KW(){return self&&"ServiceWorkerGlobalScope"in self?HW():GW()}function GW(){return typeof window<"u"&&bt()&&xl()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function HW(){return bt()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}class vv{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return Yj(this._delegate,e)}async deleteToken(){return Xj(this._delegate)}onMessage(e){return Jj(this._delegate,e)}onBackgroundMessage(e){return qW(this._delegate,e)}}const zW=n=>self&&"ServiceWorkerGlobalScope"in self?new vv(n.getProvider("app-compat").getImmediate(),n.getProvider("messaging-sw").getImmediate()):new vv(n.getProvider("app-compat").getImmediate(),n.getProvider("messaging").getImmediate()),QW={isSupported:KW};function YW(){Te.INTERNAL.registerComponent(new H("messaging-compat",zW,"PUBLIC").setServiceProps(QW))}YW();Te.registerVersion(jW,WW);const YC="firebasestorage.googleapis.com",XC="storageBucket",XW=2*60*1e3,JW=10*60*1e3,ZW=1e3;class fe extends he{constructor(e,t,i=0){super(qh(e),`Firebase Storage: ${t} (${qh(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,fe.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return qh(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function qh(n){return"storage/"+n}function am(){const n="An unknown error occurred, please check the error payload for server response.";return new fe("unknown",n)}function eK(n){return new fe("object-not-found","Object '"+n+"' does not exist.")}function tK(n){return new fe("quota-exceeded","Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function nK(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new fe("unauthenticated",n)}function iK(){return new fe("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function rK(n){return new fe("unauthorized","User does not have permission to access '"+n+"'.")}function JC(){return new fe("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function ZC(){return new fe("canceled","User canceled the upload/download.")}function sK(n){return new fe("invalid-url","Invalid URL '"+n+"'.")}function oK(n){return new fe("invalid-default-bucket","Invalid default bucket '"+n+"'.")}function aK(){return new fe("no-default-bucket","No default bucket found. Did you set the '"+XC+"' property when initializing the app?")}function e0(){return new fe("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function cK(){return new fe("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function lK(){return new fe("no-download-url","The given file does not have any download URLs.")}function uK(n){return new fe("unsupported-environment",`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function ts(n){return new fe("invalid-argument",n)}function t0(){return new fe("app-deleted","The Firebase app was deleted.")}function n0(n){return new fe("invalid-root-operation","The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ao(n,e){return new fe("invalid-format","String does not match format '"+n+"': "+e)}function oo(n){throw new fe("internal-error","Internal error: "+n)}class tt{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=tt.makeFromUrl(e,t)}catch{return new tt(e,"")}if(i.path==="")return i;throw oK(e)}static makeFromUrl(e,t){let i=null;const r="([A-Za-z0-9.\\-_]+)";function s(U){U.path.charAt(U.path.length-1)==="/"&&(U.path_=U.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+r+o,"i"),c={bucket:1,path:3};function l(U){U.path_=decodeURIComponent(U.path)}const u="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${u}/b/${r}/o${d}`,"i"),p={bucket:1,path:3},_=t===YC?"(?:storage.googleapis.com|storage.cloud.google.com)":t,w="([^?#]*)",N=new RegExp(`^https?://${_}/${r}/${w}`,"i"),x=[{regex:a,indices:c,postModify:s},{regex:f,indices:p,postModify:l},{regex:N,indices:{bucket:1,path:2},postModify:l}];for(let U=0;U<x.length;U++){const X=x[U],z=X.regex.exec(e);if(z){const ve=z[X.indices.bucket];let St=z[X.indices.path];St||(St=""),i=new tt(ve,St),X.postModify(i);break}}if(i==null)throw sK(e);return i}}class hK{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function dK(n,e,t){let i=1,r=null,s=null,o=!1,a=0;function c(){return a===2}let l=!1;function u(...w){l||(l=!0,e.apply(null,w))}function h(w){r=setTimeout(()=>{r=null,n(f,c())},w)}function d(){s&&clearTimeout(s)}function f(w,...N){if(l){d();return}if(w){d(),u.call(null,w,...N);return}if(c()||o){d(),u.call(null,w,...N);return}i<64&&(i*=2);let x;a===1?(a=2,x=0):x=(i+Math.random())*1e3,h(x)}let p=!1;function _(w){p||(p=!0,d(),!l&&(r!==null?(w||(a=2),clearTimeout(r),h(0)):w||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,_(!0)},t),_}function fK(n){n(!1)}function pK(n){return n!==void 0}function gK(n){return typeof n=="function"}function mK(n){return typeof n=="object"&&!Array.isArray(n)}function Ju(n){return typeof n=="string"||n instanceof String}function wv(n){return cm()&&n instanceof Blob}function cm(){return typeof Blob<"u"&&!Nl()}function pf(n,e,t,i){if(i<e)throw ts(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw ts(`Invalid value for '${n}'. Expected ${t} or less.`)}function Ri(n,e,t){let i=e;return t==null&&(i=`https://${e}`),`${t}://${i}/v0${n}`}function i0(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const r=e(i)+"="+e(n[i]);t=t+r+"&"}return t=t.slice(0,-1),t}var er;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(er||(er={}));function r0(n,e){const t=n>=500&&n<600,r=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||r||s}class _K{constructor(e,t,i,r,s,o,a,c,l,u,h,d=!0){this.url_=e,this.method_=t,this.headers_=i,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,p)=>{this.resolve_=f,this.reject_=p,this.start_()})}start_(){const e=(i,r)=>{if(r){i(!1,new fc(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const o=a=>{const c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const a=s.getErrorCode()===er.NO_ERROR,c=s.getStatus();if((!a||r0(c,this.additionalRetryCodes_))&&this.retry){const u=s.getErrorCode()===er.ABORT;i(!1,new fc(!1,null,u));return}const l=this.successCodes_.indexOf(c)!==-1;i(!0,new fc(l,s))})},t=(i,r)=>{const s=this.resolve_,o=this.reject_,a=r.connection;if(r.wasSuccessCode)try{const c=this.callback_(a,a.getResponse());pK(c)?s(c):s()}catch(c){o(c)}else if(a!==null){const c=am();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(r.canceled){const c=this.appDelete_?t0():ZC();o(c)}else{const c=JC();o(c)}};this.canceled_?t(!1,new fc(!1,null,!0)):this.backoffId_=dK(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&fK(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class fc{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function yK(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function vK(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function wK(n,e){e&&(n["X-Firebase-GMPID"]=e)}function IK(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function bK(n,e,t,i,r,s,o=!0){const a=i0(n.urlParams),c=n.url+a,l=Object.assign({},n.headers);return wK(l,e),yK(l,t),vK(l,s),IK(l,i),new _K(c,n.method,l,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r,o)}function EK(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function TK(...n){const e=EK();if(e!==void 0){const t=new e;for(let i=0;i<n.length;i++)t.append(n[i]);return t.getBlob()}else{if(cm())return new Blob(n);throw new fe("unsupported-environment","This browser doesn't seem to support creating Blobs")}}function SK(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}function CK(n){if(typeof atob>"u")throw uK("base-64");return atob(n)}const Vt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class jh{constructor(e,t){this.data=e,this.contentType=t||null}}function s0(n,e){switch(n){case Vt.RAW:return new jh(o0(e));case Vt.BASE64:case Vt.BASE64URL:return new jh(a0(n,e));case Vt.DATA_URL:return new jh(AK(e),RK(e))}throw am()}function o0(n){const e=[];for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);if(i<=127)e.push(i);else if(i<=2047)e.push(192|i>>6,128|i&63);else if((i&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const s=i,o=n.charCodeAt(++t);i=65536|(s&1023)<<10|o&1023,e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}else(i&64512)===56320?e.push(239,191,189):e.push(224|i>>12,128|i>>6&63,128|i&63)}return new Uint8Array(e)}function kK(n){let e;try{e=decodeURIComponent(n)}catch{throw Ao(Vt.DATA_URL,"Malformed data URL.")}return o0(e)}function a0(n,e){switch(n){case Vt.BASE64:{const r=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(r||s)throw Ao(n,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case Vt.BASE64URL:{const r=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(r||s)throw Ao(n,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=CK(e)}catch(r){throw r.message.includes("polyfill")?r:Ao(n,"Invalid character found")}const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}class c0{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Ao(Vt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=t[1]||null;i!=null&&(this.base64=NK(i,";base64"),this.contentType=this.base64?i.substring(0,i.length-7):i),this.rest=e.substring(e.indexOf(",")+1)}}function AK(n){const e=new c0(n);return e.base64?a0(Vt.BASE64,e.rest):kK(e.rest)}function RK(n){return new c0(n).contentType}function NK(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}class En{constructor(e,t){let i=0,r="";wv(e)?(this.data_=e,i=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),i=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),i=e.length),this.size_=i,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(wv(this.data_)){const i=this.data_,r=SK(i,e,t);return r===null?null:new En(r)}else{const i=new Uint8Array(this.data_.buffer,e,t-e);return new En(i,!0)}}static getBlob(...e){if(cm()){const t=e.map(i=>i instanceof En?i.data_:i);return new En(TK.apply(null,t))}else{const t=e.map(o=>Ju(o)?s0(Vt.RAW,o).data:o.data_);let i=0;t.forEach(o=>{i+=o.byteLength});const r=new Uint8Array(i);let s=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)r[s++]=o[a]}),new En(r,!0)}}uploadData(){return this.data_}}function lm(n){let e;try{e=JSON.parse(n)}catch{return null}return mK(e)?e:null}function DK(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function PK(n,e){const t=e.split("/").filter(i=>i.length>0).join("/");return n.length===0?t:n+"/"+t}function l0(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function xK(n,e){return e}class st{constructor(e,t,i,r){this.server=e,this.local=t||e,this.writable=!!i,this.xform=r||xK}}let pc=null;function OK(n){return!Ju(n)||n.length<2?n:l0(n)}function Zu(){if(pc)return pc;const n=[];n.push(new st("bucket")),n.push(new st("generation")),n.push(new st("metageneration")),n.push(new st("name","fullPath",!0));function e(s,o){return OK(o)}const t=new st("name");t.xform=e,n.push(t);function i(s,o){return o!==void 0?Number(o):o}const r=new st("size");return r.xform=i,n.push(r),n.push(new st("timeCreated")),n.push(new st("updated")),n.push(new st("md5Hash",null,!0)),n.push(new st("cacheControl",null,!0)),n.push(new st("contentDisposition",null,!0)),n.push(new st("contentEncoding",null,!0)),n.push(new st("contentLanguage",null,!0)),n.push(new st("contentType",null,!0)),n.push(new st("metadata","customMetadata",!0)),pc=n,pc}function MK(n,e){function t(){const i=n.bucket,r=n.fullPath,s=new tt(i,r);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function LK(n,e,t){const i={};i.type="file";const r=t.length;for(let s=0;s<r;s++){const o=t[s];i[o.local]=o.xform(i,e[o.server])}return MK(i,n),i}function u0(n,e,t){const i=lm(e);return i===null?null:LK(n,i,t)}function FK(n,e,t,i){const r=lm(e);if(r===null||!Ju(r.downloadTokens))return null;const s=r.downloadTokens;if(s.length===0)return null;const o=encodeURIComponent;return s.split(",").map(l=>{const u=n.bucket,h=n.fullPath,d="/b/"+o(u)+"/o/"+o(h),f=Ri(d,t,i),p=i0({alt:"media",token:l});return f+p})[0]}function um(n,e){const t={},i=e.length;for(let r=0;r<i;r++){const s=e[r];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}const Iv="prefixes",bv="items";function UK(n,e,t){const i={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[Iv])for(const r of t[Iv]){const s=r.replace(/\/$/,""),o=n._makeStorageReference(new tt(e,s));i.prefixes.push(o)}if(t[bv])for(const r of t[bv]){const s=n._makeStorageReference(new tt(e,r.name));i.items.push(s)}return i}function $K(n,e,t){const i=lm(t);return i===null?null:UK(n,e,i)}class jn{constructor(e,t,i,r){this.url=e,this.method=t,this.handler=i,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function dn(n){if(!n)throw am()}function eh(n,e){function t(i,r){const s=u0(n,r,e);return dn(s!==null),s}return t}function VK(n,e){function t(i,r){const s=$K(n,e,r);return dn(s!==null),s}return t}function BK(n,e){function t(i,r){const s=u0(n,r,e);return dn(s!==null),FK(s,r,n.host,n._protocol)}return t}function Ks(n){function e(t,i){let r;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?r=iK():r=nK():t.getStatus()===402?r=tK(n.bucket):t.getStatus()===403?r=rK(n.path):r=i,r.status=t.getStatus(),r.serverResponse=i.serverResponse,r}return e}function th(n){const e=Ks(n);function t(i,r){let s=e(i,r);return i.getStatus()===404&&(s=eK(n.path)),s.serverResponse=r.serverResponse,s}return t}function h0(n,e,t){const i=e.fullServerUrl(),r=Ri(i,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new jn(r,s,eh(n,t),o);return a.errorHandler=th(e),a}function qK(n,e,t,i,r){const s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),i&&(s.pageToken=i),r&&(s.maxResults=r);const o=e.bucketOnlyServerUrl(),a=Ri(o,n.host,n._protocol),c="GET",l=n.maxOperationRetryTime,u=new jn(a,c,VK(n,e.bucket),l);return u.urlParams=s,u.errorHandler=Ks(e),u}function jK(n,e,t){const i=e.fullServerUrl(),r=Ri(i,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new jn(r,s,BK(n,t),o);return a.errorHandler=th(e),a}function WK(n,e,t,i){const r=e.fullServerUrl(),s=Ri(r,n.host,n._protocol),o="PATCH",a=um(t,i),c={"Content-Type":"application/json; charset=utf-8"},l=n.maxOperationRetryTime,u=new jn(s,o,eh(n,i),l);return u.headers=c,u.body=a,u.errorHandler=th(e),u}function KK(n,e){const t=e.fullServerUrl(),i=Ri(t,n.host,n._protocol),r="DELETE",s=n.maxOperationRetryTime;function o(c,l){}const a=new jn(i,r,o,s);return a.successCodes=[200,204],a.errorHandler=th(e),a}function GK(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function d0(n,e,t){const i=Object.assign({},t);return i.fullPath=n.path,i.size=e.size(),i.contentType||(i.contentType=GK(null,e)),i}function HK(n,e,t,i,r){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let x="";for(let U=0;U<2;U++)x=x+Math.random().toString().slice(2);return x}const c=a();o["Content-Type"]="multipart/related; boundary="+c;const l=d0(e,i,r),u=um(l,t),h="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+c+`\r
Content-Type: `+l.contentType+`\r
\r
`,d=`\r
--`+c+"--",f=En.getBlob(h,i,d);if(f===null)throw e0();const p={name:l.fullPath},_=Ri(s,n.host,n._protocol),w="POST",N=n.maxUploadRetryTime,M=new jn(_,w,eh(n,t),N);return M.urlParams=p,M.headers=o,M.body=f.uploadData(),M.errorHandler=Ks(e),M}class kl{constructor(e,t,i,r){this.current=e,this.total=t,this.finalized=!!i,this.metadata=r||null}}function hm(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{dn(!1)}return dn(!!t&&(e||["active"]).indexOf(t)!==-1),t}function zK(n,e,t,i,r){const s=e.bucketOnlyServerUrl(),o=d0(e,i,r),a={name:o.fullPath},c=Ri(s,n.host,n._protocol),l="POST",u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${i.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=um(o,t),d=n.maxUploadRetryTime;function f(_){hm(_);let w;try{w=_.getResponseHeader("X-Goog-Upload-URL")}catch{dn(!1)}return dn(Ju(w)),w}const p=new jn(c,l,f,d);return p.urlParams=a,p.headers=u,p.body=h,p.errorHandler=Ks(e),p}function QK(n,e,t,i){const r={"X-Goog-Upload-Command":"query"};function s(l){const u=hm(l,["active","final"]);let h=null;try{h=l.getResponseHeader("X-Goog-Upload-Size-Received")}catch{dn(!1)}h||dn(!1);const d=Number(h);return dn(!isNaN(d)),new kl(d,i.size(),u==="final")}const o="POST",a=n.maxUploadRetryTime,c=new jn(t,o,s,a);return c.headers=r,c.errorHandler=Ks(e),c}const Ev=256*1024;function YK(n,e,t,i,r,s,o,a){const c=new kl(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=i.size()),i.size()!==c.total)throw cK();const l=c.total-c.current;let u=l;r>0&&(u=Math.min(u,r));const h=c.current,d=h+u;let f="";u===0?f="finalize":l===u?f="upload, finalize":f="upload";const p={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${c.current}`},_=i.slice(h,d);if(_===null)throw e0();function w(U,X){const z=hm(U,["active","final"]),ve=c.current+u,St=i.size();let Ni;return z==="final"?Ni=eh(e,s)(U,X):Ni=null,new kl(ve,St,z==="final",Ni)}const N="POST",M=e.maxUploadRetryTime,x=new jn(t,N,w,M);return x.headers=p,x.body=_.uploadData(),x.progressCallback=a||null,x.errorHandler=Ks(n),x}const XK={STATE_CHANGED:"state_changed"},ct={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Wh(n){switch(n){case"running":case"pausing":case"canceling":return ct.RUNNING;case"paused":return ct.PAUSED;case"success":return ct.SUCCESS;case"canceled":return ct.CANCELED;case"error":return ct.ERROR;default:return ct.ERROR}}class JK{constructor(e,t,i){if(gK(e)||t!=null||i!=null)this.next=e,this.error=t??void 0,this.complete=i??void 0;else{const s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}}function $r(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}class ZK{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=er.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=er.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=er.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,i,r){if(this.sent_)throw oo("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),r!==void 0)for(const s in r)r.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,r[s].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw oo("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw oo("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw oo("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw oo("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class eG extends ZK{initXhr(){this.xhr_.responseType="text"}}function nn(){return new eG}class f0{constructor(e,t,i=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=i,this._mappings=Zu(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=r=>{if(this._request=void 0,this._chunkMultiplier=1,r._codeEquals("canceled"))this._needToFetchStatus=!0,this.completeTransitions_();else{const s=this.isExponentialBackoffExpired();if(r0(r.status,[]))if(s)r=JC();else{this.sleepTime=Math.max(this.sleepTime*2,ZW),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=r,this._transition("error")}},this._metadataErrorHandler=r=>{this._request=void 0,r._codeEquals("canceled")?this.completeTransitions_():(this._error=r,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((r,s)=>{this._resolve=r,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,i])=>{switch(this._state){case"running":e(t,i);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{const i=zK(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(i,nn,e,t);this._request=r,r.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,i)=>{const r=QK(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(r,nn,t,i);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=Ev*this._chunkMultiplier,t=new kl(this._transferred,this._blob.size()),i=this._uploadUrl;this._resolveToken((r,s)=>{let o;try{o=YK(this._ref._location,this._ref.storage,i,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(c){this._error=c,this._transition("error");return}const a=this._ref.storage._makeRequest(o,nn,r,s,!1);this._request=a,a.getPromise().then(c=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(c.current),c.finalized?(this._metadata=c.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Ev*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const i=h0(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(i,nn,e,t);this._request=r,r.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const i=HK(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(i,nn,e,t);this._request=r,r.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=ZC(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=Wh(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,i,r){const s=new JK(t||void 0,i||void 0,r||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(Wh(this._state)){case ct.SUCCESS:$r(this._resolve.bind(null,this.snapshot))();break;case ct.CANCELED:case ct.ERROR:const t=this._reject;$r(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Wh(this._state)){case ct.RUNNING:case ct.PAUSED:e.next&&$r(e.next.bind(e,this.snapshot))();break;case ct.SUCCESS:e.complete&&$r(e.complete.bind(e))();break;case ct.CANCELED:case ct.ERROR:e.error&&$r(e.error.bind(e,this._error))();break;default:e.error&&$r(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}class br{constructor(e,t){this._service=e,t instanceof tt?this._location=t:this._location=tt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new br(e,t)}get root(){const e=new tt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return l0(this._location.path)}get storage(){return this._service}get parent(){const e=DK(this._location.path);if(e===null)return null;const t=new tt(this._location.bucket,e);return new br(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw n0(e)}}function tG(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new f0(n,new En(e),t)}function nG(n){const e={prefixes:[],items:[]};return p0(n,e).then(()=>e)}async function p0(n,e,t){const r=await g0(n,{pageToken:t});e.prefixes.push(...r.prefixes),e.items.push(...r.items),r.nextPageToken!=null&&await p0(n,e,r.nextPageToken)}function g0(n,e){e!=null&&typeof e.maxResults=="number"&&pf("options.maxResults",1,1e3,e.maxResults);const t=e||{},i=qK(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(i,nn)}function iG(n){n._throwIfRoot("getMetadata");const e=h0(n.storage,n._location,Zu());return n.storage.makeRequestWithTokens(e,nn)}function rG(n,e){n._throwIfRoot("updateMetadata");const t=WK(n.storage,n._location,e,Zu());return n.storage.makeRequestWithTokens(t,nn)}function sG(n){n._throwIfRoot("getDownloadURL");const e=jK(n.storage,n._location,Zu());return n.storage.makeRequestWithTokens(e,nn).then(t=>{if(t===null)throw lK();return t})}function oG(n){n._throwIfRoot("deleteObject");const e=KK(n.storage,n._location);return n.storage.makeRequestWithTokens(e,nn)}function m0(n,e){const t=PK(n._location.path,e),i=new tt(n._location.bucket,t);return new br(n.storage,i)}function aG(n){return/^[A-Za-z]+:\/\//.test(n)}function cG(n,e){return new br(n,e)}function _0(n,e){if(n instanceof dm){const t=n;if(t._bucket==null)throw aK();const i=new br(t,t._bucket);return e!=null?_0(i,e):i}else return e!==void 0?m0(n,e):n}function lG(n,e){if(e&&aG(e)){if(n instanceof dm)return cG(n,e);throw ts("To use ref(service, url), the first argument must be a Storage instance.")}else return _0(n,e)}function Tv(n,e){const t=e==null?void 0:e[XC];return t==null?null:tt.makeFromBucketSpec(t,n)}function uG(n,e,t,i={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:r}=i;r&&(n._overrideAuthToken=typeof r=="string"?r:yf(r,n.app.options.projectId))}class dm{constructor(e,t,i,r,s){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=r,this._firebaseVersion=s,this._bucket=null,this._host=YC,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=XW,this._maxUploadRetryTime=JW,this._requests=new Set,r!=null?this._bucket=tt.makeFromBucketSpec(r,this._host):this._bucket=Tv(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=tt.makeFromBucketSpec(this._url,e):this._bucket=Tv(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){pf("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){pf("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new br(this,e)}_makeRequest(e,t,i,r,s=!0){if(this._deleted)return new hK(t0());{const o=bK(e,this._appId,i,r,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[i,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,r).getPromise()}}const Sv="@firebase/storage",Cv="0.10.0";const hG="storage";function dG(n,e,t){return n=v(n),tG(n,e,t)}function fG(n){return n=v(n),iG(n)}function pG(n,e){return n=v(n),rG(n,e)}function gG(n,e){return n=v(n),g0(n,e)}function mG(n){return n=v(n),nG(n)}function _G(n){return n=v(n),sG(n)}function yG(n){return n=v(n),oG(n)}function kv(n,e){return n=v(n),lG(n,e)}function vG(n,e){return m0(n,e)}function wG(n,e,t,i={}){uG(n,e,t,i)}function IG(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new dm(t,i,r,e,wn)}function bG(){ge(new H(hG,IG,"PUBLIC").setMultipleInstances(!0)),Z(Sv,Cv,""),Z(Sv,Cv,"esm2017")}bG();class gc{constructor(e,t,i){this._delegate=e,this.task=t,this.ref=i}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class Av{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new gc(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(i=>{if(e)return e(new gc(i,this,this._ref))},t)}on(e,t,i,r){let s;return t&&(typeof t=="function"?s=o=>t(new gc(o,this,this._ref)):s={next:t.next?o=>t.next(new gc(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,s,i||void 0,r||void 0)}}class Rv{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new xn(e,this._service))}get items(){return this._delegate.items.map(e=>new xn(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class xn{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=vG(this._delegate,e);return new xn(t,this.storage)}get root(){return new xn(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return e==null?null:new xn(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Av(dG(this._delegate,e,t),this)}putString(e,t=Vt.RAW,i){this._throwIfRoot("putString");const r=s0(t,e),s=Object.assign({},i);return s.contentType==null&&r.contentType!=null&&(s.contentType=r.contentType),new Av(new f0(this._delegate,new En(r.data,!0),s),this)}listAll(){return mG(this._delegate).then(e=>new Rv(e,this.storage))}list(e){return gG(this._delegate,e||void 0).then(t=>new Rv(t,this.storage))}getMetadata(){return fG(this._delegate)}updateMetadata(e){return pG(this._delegate,e)}getDownloadURL(){return _G(this._delegate)}delete(){return this._throwIfRoot("delete"),yG(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw n0(e)}}class y0{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Nv(e))throw ts("ref() expected a child path but got a URL, use refFromURL instead.");return new xn(kv(this._delegate,e),this)}refFromURL(e){if(!Nv(e))throw ts("refFromURL() expected a full URL but got a child path, use ref() instead.");try{tt.makeFromUrl(e,this._delegate.host)}catch{throw ts("refFromUrl() expected a valid full URL but got an invalid one.")}return new xn(kv(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,i={}){wG(this._delegate,e,t,i)}}function Nv(n){return/^[A-Za-z]+:\/\//.test(n)}const EG="@firebase/storage-compat",TG="0.2.0";const SG="storage-compat";function CG(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("storage").getImmediate({identifier:e});return new y0(t,i)}function kG(n){const e={TaskState:ct,TaskEvent:XK,StringFormat:Vt,Storage:y0,Reference:xn};n.INTERNAL.registerComponent(new H(SG,CG,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion(EG,TG)}kG(Te);const Dv="@firebase/performance",gf="0.6.0";const v0=gf,AG="FB-PERF-TRACE-START",RG="FB-PERF-TRACE-STOP",mf="FB-PERF-TRACE-MEASURE",w0="_wt_",I0="_fp",b0="_fcp",E0="_fid",T0="@firebase/performance/config",S0="@firebase/performance/configexpire",NG="performance",C0="Performance";const DG={["trace started"]:"Trace {$traceName} was started before.",["trace stopped"]:"Trace {$traceName} is not running.",["nonpositive trace startTime"]:"Trace {$traceName} startTime should be positive.",["nonpositive trace duration"]:"Trace {$traceName} duration should be positive.",["no window"]:"Window is not available.",["no app id"]:"App id is not available.",["no project id"]:"Project id is not available.",["no api key"]:"Api key is not available.",["invalid cc log"]:"Attempted to queue invalid cc event",["FB not default"]:"Performance can only start when Firebase app instance is the default one.",["RC response not ok"]:"RC response is not ok",["invalid attribute name"]:"Attribute name {$attributeName} is invalid.",["invalid attribute value"]:"Attribute value {$attributeValue} is invalid.",["invalid custom metric name"]:"Custom metric name {$customMetricName} is invalid",["invalid String merger input"]:"Input for String merger is invalid, contact support team to resolve.",["already initialized"]:"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},et=new pt(NG,C0,DG);const yn=new vn(C0);yn.logLevel=$.INFO;let Kh,k0;class Fe{constructor(e){if(this.window=e,!e)throw et.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){!this.performance||!this.performance.mark||this.performance.mark(e)}measure(e,t,i){!this.performance||!this.performance.measure||this.performance.measure(e,t,i)}getEntriesByType(e){return!this.performance||!this.performance.getEntriesByType?[]:this.performance.getEntriesByType(e)}getEntriesByName(e){return!this.performance||!this.performance.getEntriesByName?[]:this.performance.getEntriesByName(e)}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return!fetch||!Promise||!xl()?(yn.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1):bt()?!0:(yn.info("IndexedDB is not supported by current browswer"),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(r=>{for(const s of r.getEntries())t(s)}).observe({entryTypes:[e]})}static getInstance(){return Kh===void 0&&(Kh=new Fe(k0)),Kh}}function PG(n){k0=n}let A0;function xG(n){const e=n.getId();return e.then(t=>{A0=t}),e}function fm(){return A0}function OG(n){const e=n.getToken();return e.then(t=>{}),e}function Pv(n,e){const t=n.length-e.length;if(t<0||t>1)throw et.create("invalid String merger input");const i=[];for(let r=0;r<n.length;r++)i.push(n.charAt(r)),e.length>r&&i.push(e.charAt(r));return i.join("")}let Gh;class Rt{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=Pv("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=Pv("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return Gh===void 0&&(Gh=new Rt),Gh}}var ns;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.VISIBLE=1]="VISIBLE",n[n.HIDDEN=2]="HIDDEN"})(ns||(ns={}));const MG=["firebase_","google_","ga_"],LG=new RegExp("^[a-zA-Z]\\w*$"),FG=40,UG=100;function $G(){const n=Fe.getInstance().navigator;return n!=null&&n.serviceWorker?n.serviceWorker.controller?2:3:1}function R0(){switch(Fe.getInstance().document.visibilityState){case"visible":return ns.VISIBLE;case"hidden":return ns.HIDDEN;default:return ns.UNKNOWN}}function VG(){const e=Fe.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function BG(n){return n.length===0||n.length>FG?!1:!MG.some(t=>n.startsWith(t))&&!!n.match(LG)}function qG(n){return n.length!==0&&n.length<=UG}function N0(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.appId;if(!t)throw et.create("no app id");return t}function jG(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.projectId;if(!t)throw et.create("no project id");return t}function WG(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.apiKey;if(!t)throw et.create("no api key");return t}const KG="0.0.1",Kt={loggingEnabled:!0},GG="FIREBASE_INSTALLATIONS_AUTH";function HG(n,e){const t=zG();return t?(xv(t),Promise.resolve()):XG(n,e).then(xv).then(i=>QG(i),()=>{})}function zG(){const n=Fe.getInstance().localStorage;if(!n)return;const e=n.getItem(S0);if(!e||!JG(e))return;const t=n.getItem(T0);if(t)try{return JSON.parse(t)}catch{return}}function QG(n){const e=Fe.getInstance().localStorage;!n||!e||(e.setItem(T0,JSON.stringify(n)),e.setItem(S0,String(Date.now()+Rt.getInstance().configTimeToLive*60*60*1e3)))}const YG="Could not fetch config, will use default configs";function XG(n,e){return OG(n.installations).then(t=>{const i=jG(n.app),r=WG(n.app),s=`https://firebaseremoteconfig.googleapis.com/v1/projects/${i}/namespaces/fireperf:fetch?key=${r}`,o=new Request(s,{method:"POST",headers:{Authorization:`${GG} ${t}`},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:N0(n.app),app_version:v0,sdk_version:KG})});return fetch(o).then(a=>{if(a.ok)return a.json();throw et.create("RC response not ok")})}).catch(()=>{yn.info(YG)})}function xv(n){if(!n)return n;const e=Rt.getInstance(),t=n.entries||{};return t.fpr_enabled!==void 0?e.loggingEnabled=String(t.fpr_enabled)==="true":e.loggingEnabled=Kt.loggingEnabled,t.fpr_log_source?e.logSource=Number(t.fpr_log_source):Kt.logSource&&(e.logSource=Kt.logSource),t.fpr_log_endpoint_url?e.logEndPointUrl=t.fpr_log_endpoint_url:Kt.logEndPointUrl&&(e.logEndPointUrl=Kt.logEndPointUrl),t.fpr_log_transport_key?e.transportKey=t.fpr_log_transport_key:Kt.transportKey&&(e.transportKey=Kt.transportKey),t.fpr_vc_network_request_sampling_rate!==void 0?e.networkRequestsSamplingRate=Number(t.fpr_vc_network_request_sampling_rate):Kt.networkRequestsSamplingRate!==void 0&&(e.networkRequestsSamplingRate=Kt.networkRequestsSamplingRate),t.fpr_vc_trace_sampling_rate!==void 0?e.tracesSamplingRate=Number(t.fpr_vc_trace_sampling_rate):Kt.tracesSamplingRate!==void 0&&(e.tracesSamplingRate=Kt.tracesSamplingRate),e.logTraceAfterSampling=Ov(e.tracesSamplingRate),e.logNetworkAfterSampling=Ov(e.networkRequestsSamplingRate),n}function JG(n){return Number(n)>Date.now()}function Ov(n){return Math.random()<=n}let pm=1,Hh;function D0(n){return pm=2,Hh=Hh||eH(n),Hh}function ZG(){return pm===3}function eH(n){return tH().then(()=>xG(n.installations)).then(e=>HG(n,e)).then(()=>Mv(),()=>Mv())}function tH(){const n=Fe.getInstance().document;return new Promise(e=>{if(n&&n.readyState!=="complete"){const t=()=>{n.readyState==="complete"&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}function Mv(){pm=3}const gm=10*1e3,nH=5.5*1e3,P0=3,iH=1e3;let Al=P0,ri=[],Lv=!1;function rH(){Lv||(nh(nH),Lv=!0)}function nh(n){setTimeout(()=>{if(Al!==0){if(!ri.length)return nh(gm);sH()}},n)}function sH(){const n=ri.splice(0,iH),e=n.map(i=>({source_extension_json_proto3:i.message,event_time_ms:String(i.eventTime)})),t={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Rt.getInstance().logSource,log_event:e};oH(t,n).catch(()=>{ri=[...n,...ri],Al--,yn.info(`Tries left: ${Al}.`),nh(gm)})}function oH(n,e){return aH(n).then(t=>(t.ok||yn.info("Call to Firebase backend failed."),t.json())).then(t=>{const i=Number(t.nextRequestWaitMillis);let r=gm;isNaN(i)||(r=Math.max(i,r));const s=t.logResponseDetails;Array.isArray(s)&&s.length>0&&s[0].responseAction==="RETRY_REQUEST_LATER"&&(ri=[...e,...ri],yn.info("Retry transport request later.")),Al=P0,nh(r)})}function aH(n){const e=Rt.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(n)})}function cH(n){if(!n.eventTime||!n.message)throw et.create("invalid cc log");ri=[...ri,n]}function lH(n){return(...e)=>{const t=n(...e);cH({message:t,eventTime:Date.now()})}}let zh;function x0(n,e){zh||(zh=lH(hH)),zh(n,e)}function mc(n){const e=Rt.getInstance();!e.instrumentationEnabled&&n.isAuto||!e.dataCollectionEnabled&&!n.isAuto||Fe.getInstance().requiredApisAvailable()&&(n.isAuto&&R0()!==ns.VISIBLE||(ZG()?Qh(n):D0(n.performanceController).then(()=>Qh(n),()=>Qh(n))))}function Qh(n){if(!fm())return;const e=Rt.getInstance();!e.loggingEnabled||!e.logTraceAfterSampling||setTimeout(()=>x0(n,1),0)}function uH(n){const e=Rt.getInstance();if(!e.instrumentationEnabled)return;const t=n.url,i=e.logEndPointUrl.split("?")[0],r=e.flTransportEndpointUrl.split("?")[0];t===i||t===r||!e.loggingEnabled||!e.logNetworkAfterSampling||setTimeout(()=>x0(n,0),0)}function hH(n,e){return e===0?dH(n):fH(n)}function dH(n){const e={url:n.url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},t={application_info:O0(n.performanceController.app),network_request_metric:e};return JSON.stringify(t)}function fH(n){const e={name:n.name,is_auto:n.isAuto,client_start_time_us:n.startTimeUs,duration_us:n.durationUs};Object.keys(n.counters).length!==0&&(e.counters=n.counters);const t=n.getAttributes();Object.keys(t).length!==0&&(e.custom_attributes=t);const i={application_info:O0(n.performanceController.app),trace_metric:e};return JSON.stringify(i)}function O0(n){return{google_app_id:N0(n),app_instance_id:fm(),web_app_info:{sdk_version:v0,page_url:Fe.getInstance().getUrl(),service_worker_status:$G(),visibility_state:R0(),effective_connection_type:VG()},application_process_state:0}}const pH=100,gH="_",mH=[I0,b0,E0];function _H(n,e){return n.length===0||n.length>pH?!1:e&&e.startsWith(w0)&&mH.indexOf(n)>-1||!n.startsWith(gH)}function yH(n){const e=Math.floor(n);return e<n&&yn.info(`Metric value should be an Integer, setting the value as : ${e}.`),e}class si{constructor(e,t,i=!1,r){this.performanceController=e,this.name=t,this.isAuto=i,this.state=1,this.customAttributes={},this.counters={},this.api=Fe.getInstance(),this.randomId=Math.floor(Math.random()*1e6),this.isAuto||(this.traceStartMark=`${AG}-${this.randomId}-${this.name}`,this.traceStopMark=`${RG}-${this.randomId}-${this.name}`,this.traceMeasure=r||`${mf}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(this.state!==1)throw et.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(this.state!==2)throw et.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),mc(this)}record(e,t,i){if(e<=0)throw et.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw et.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(t*1e3),this.startTimeUs=Math.floor(e*1e3),i&&i.attributes&&(this.customAttributes=Object.assign({},i.attributes)),i&&i.metrics)for(const r of Object.keys(i.metrics))isNaN(Number(i.metrics[r]))||(this.counters[r]=Math.floor(Number(i.metrics[r])));mc(this)}incrementMetric(e,t=1){this.counters[e]===void 0?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(_H(e,this.name))this.counters[e]=yH(t??0);else throw et.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const i=BG(e),r=qG(t);if(i&&r){this.customAttributes[e]=t;return}if(!i)throw et.create("invalid attribute name",{attributeName:e});if(!r)throw et.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){this.customAttributes[e]!==void 0&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(t.duration*1e3),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,i,r){const s=Fe.getInstance().getUrl();if(!s)return;const o=new si(e,w0+s,!0),a=Math.floor(Fe.getInstance().getTimeOrigin()*1e3);o.setStartTime(a),t&&t[0]&&(o.setDuration(Math.floor(t[0].duration*1e3)),o.putMetric("domInteractive",Math.floor(t[0].domInteractive*1e3)),o.putMetric("domContentLoadedEventEnd",Math.floor(t[0].domContentLoadedEventEnd*1e3)),o.putMetric("loadEventEnd",Math.floor(t[0].loadEventEnd*1e3)));const c="first-paint",l="first-contentful-paint";if(i){const u=i.find(d=>d.name===c);u&&u.startTime&&o.putMetric(I0,Math.floor(u.startTime*1e3));const h=i.find(d=>d.name===l);h&&h.startTime&&o.putMetric(b0,Math.floor(h.startTime*1e3)),r&&o.putMetric(E0,Math.floor(r*1e3))}mc(o)}static createUserTimingTrace(e,t){const i=new si(e,t,!1,t);mc(i)}}function Fv(n,e){const t=e;if(!t||t.responseStart===void 0)return;const i=Fe.getInstance().getTimeOrigin(),r=Math.floor((t.startTime+i)*1e3),s=t.responseStart?Math.floor((t.responseStart-t.startTime)*1e3):void 0,o=Math.floor((t.responseEnd-t.startTime)*1e3),a=t.name&&t.name.split("?")[0],c={performanceController:n,url:a,responsePayloadBytes:t.transferSize,startTimeUs:r,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:o};uH(c)}const vH=5e3;function Uv(n){fm()&&(setTimeout(()=>IH(n),0),setTimeout(()=>wH(n),0),setTimeout(()=>bH(n),0))}function wH(n){const e=Fe.getInstance(),t=e.getEntriesByType("resource");for(const i of t)Fv(n,i);e.setupObserver("resource",i=>Fv(n,i))}function IH(n){const e=Fe.getInstance(),t=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let r=setTimeout(()=>{si.createOobTrace(n,t,i),r=void 0},vH);e.onFirstInputDelay(s=>{r&&(clearTimeout(r),si.createOobTrace(n,t,i,s))})}else si.createOobTrace(n,t,i)}function bH(n){const e=Fe.getInstance(),t=e.getEntriesByType("measure");for(const i of t)$v(n,i);e.setupObserver("measure",i=>$v(n,i))}function $v(n,e){const t=e.name;t.substring(0,mf.length)!==mf&&si.createUserTimingTrace(n,t)}class EH{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||((e==null?void 0:e.dataCollectionEnabled)!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),(e==null?void 0:e.instrumentationEnabled)!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),Fe.getInstance().requiredApisAvailable()?ga().then(t=>{t&&(rH(),D0(this).then(()=>Uv(this),()=>Uv(this)),this.initialized=!0)}).catch(t=>{yn.info(`Environment doesn't support IndexedDB: ${t}`)}):yn.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){Rt.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return Rt.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){Rt.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return Rt.getInstance().dataCollectionEnabled}}const TH="[DEFAULT]";function SH(n,e){return n=v(n),new si(n,e)}const CH=(n,{options:e})=>{const t=n.getProvider("app").getImmediate(),i=n.getProvider("installations-internal").getImmediate();if(t.name!==TH)throw et.create("FB not default");if(typeof window>"u")throw et.create("no window");PG(window);const r=new EH(t,i);return r._init(e),r};function kH(){ge(new H("performance",CH,"PUBLIC")),Z(Dv,gf),Z(Dv,gf,"esm2017")}kH();class AH{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return SH(this._delegate,e)}}const RH="@firebase/performance-compat",NH="0.2.0";function DH(n){n.INTERNAL.registerComponent(new H("performance-compat",PH,"PUBLIC")),n.registerVersion(RH,NH)}function PH(n){const e=n.getProvider("app-compat").getImmediate(),t=n.getProvider("performance").getImmediate();return new AH(e,t)}DH(Te);const Yh="@firebase/remote-config",Vv="0.4.0";class xH{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const OH="remote-config";const MH={["registration-window"]:"Undefined window object. This SDK only supports usage in a browser environment.",["registration-project-id"]:"Undefined project identifier. Check Firebase app initialization.",["registration-api-key"]:"Undefined API key. Check Firebase app initialization.",["registration-app-id"]:"Undefined app identifier. Check Firebase app initialization.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["storage-delete"]:"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",["fetch-client-network"]:"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-timeout"]:'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',["fetch-throttle"]:'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',["fetch-client-parse"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["indexed-db-unavailable"]:"Indexed DB is not supported by current browser"},_t=new pt("remoteconfig","Remote Config",MH);function LH(n,e){return n instanceof he&&n.code.indexOf(e)!==-1}const FH=!1,UH="",Bv=0,$H=["1","true","t","yes","y","on"];class Xh{constructor(e,t=UH){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return this._source==="static"?FH:$H.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return Bv;let e=Number(this._value);return isNaN(e)&&(e=Bv),e}getSource(){return this._source}}async function M0(n){const e=v(n),[t,i]=await Promise.all([e._storage.getLastSuccessfulFetchResponse(),e._storage.getActiveConfigEtag()]);return!t||!t.config||!t.eTag||t.eTag===i?!1:(await Promise.all([e._storageCache.setActiveConfig(t.config),e._storage.setActiveConfigEtag(t.eTag)]),!0)}function L0(n){const e=v(n);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}async function F0(n){const e=v(n),t=new xH;setTimeout(async()=>{t.abort()},e.settings.fetchTimeoutMillis);try{await e._client.fetch({cacheMaxAgeMillis:e.settings.minimumFetchIntervalMillis,signal:t}),await e._storageCache.setLastFetchStatus("success")}catch(i){const r=LH(i,"fetch-throttle")?"throttle":"failure";throw await e._storageCache.setLastFetchStatus(r),i}}function VH(n){const e=v(n);return KH(e._storageCache.getActiveConfig(),e.defaultConfig).reduce((t,i)=>(t[i]=Ja(n,i),t),{})}function BH(n,e){return Ja(v(n),e).asBoolean()}function qH(n,e){return Ja(v(n),e).asNumber()}function jH(n,e){return Ja(v(n),e).asString()}function Ja(n,e){const t=v(n);t._isInitializationComplete||t._logger.debug(`A value was requested for key "${e}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);const i=t._storageCache.getActiveConfig();return i&&i[e]!==void 0?new Xh("remote",i[e]):t.defaultConfig&&t.defaultConfig[e]!==void 0?new Xh("default",String(t.defaultConfig[e])):(t._logger.debug(`Returning static value for key "${e}". Define a default or remote value if this is unintentional.`),new Xh("static"))}function WH(n,e){const t=v(n);switch(e){case"debug":t._logger.logLevel=$.DEBUG;break;case"silent":t._logger.logLevel=$.SILENT;break;default:t._logger.logLevel=$.ERROR}}function KH(n={},e={}){return Object.keys(Object.assign(Object.assign({},n),e))}class GH{constructor(e,t,i,r){this.client=e,this.storage=t,this.storageCache=i,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const i=Date.now()-t,r=i<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${i}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}async fetch(e){const[t,i]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(i&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return i;e.eTag=i&&i.eTag;const r=await this.client.fetch(e),s=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return r.status===200&&s.push(this.storage.setLastSuccessfulFetchResponse(r)),await Promise.all(s),r}}function HH(n=navigator){return n.languages&&n.languages[0]||n.language}class zH{constructor(e,t,i,r,s,o){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=i,this.projectId=r,this.apiKey=s,this.appId=o}async fetch(e){const[t,i]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),s=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,o={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},a={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:i,app_id:this.appId,language_code:HH()},c={method:"POST",headers:o,body:JSON.stringify(a)},l=fetch(s,c),u=new Promise((w,N)=>{e.signal.addEventListener(()=>{const M=new Error("The operation was aborted.");M.name="AbortError",N(M)})});let h;try{await Promise.race([l,u]),h=await l}catch(w){let N="fetch-client-network";throw(w==null?void 0:w.name)==="AbortError"&&(N="fetch-timeout"),_t.create(N,{originalErrorMessage:w==null?void 0:w.message})}let d=h.status;const f=h.headers.get("ETag")||void 0;let p,_;if(h.status===200){let w;try{w=await h.json()}catch(N){throw _t.create("fetch-client-parse",{originalErrorMessage:N==null?void 0:N.message})}p=w.entries,_=w.state}if(_==="INSTANCE_STATE_UNSPECIFIED"?d=500:_==="NO_CHANGE"?d=304:(_==="NO_TEMPLATE"||_==="EMPTY_CONFIG")&&(p={}),d!==304&&d!==200)throw _t.create("fetch-status",{httpStatus:d});return{status:d,eTag:f,config:p}}}function QH(n,e){return new Promise((t,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(t,r);n.addEventListener(()=>{clearTimeout(s),i(_t.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function YH(n){if(!(n instanceof he)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class XH{constructor(e,t){this.client=e,this.storage=t}async fetch(e){const t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:i}){await QH(e.signal,t);try{const r=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),r}catch(r){if(!YH(r))throw r;const s={throttleEndTimeMillis:Date.now()+xc(i),backoffCount:i+1};return await this.storage.setThrottleMetadata(s),this.attemptFetch(e,s)}}}const JH=60*1e3,ZH=12*60*60*1e3;class e2{constructor(e,t,i,r,s){this.app=e,this._client=t,this._storageCache=i,this._storage=r,this._logger=s,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:JH,minimumFetchIntervalMillis:ZH},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function Ac(n,e){const t=n.target.error||void 0;return _t.create(e,{originalErrorMessage:t&&(t==null?void 0:t.message)})}const Mi="app_namespace_store",t2="firebase_remote_config",n2=1;function i2(){return new Promise((n,e)=>{try{const t=indexedDB.open(t2,n2);t.onerror=i=>{e(Ac(i,"storage-open"))},t.onsuccess=i=>{n(i.target.result)},t.onupgradeneeded=i=>{const r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(Mi,{keyPath:"compositeKey"})}}}catch(t){e(_t.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}})}class r2{constructor(e,t,i,r=i2()){this.appId=e,this.appName=t,this.namespace=i,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){const t=await this.openDbPromise;return new Promise((i,r)=>{const o=t.transaction([Mi],"readonly").objectStore(Mi),a=this.createCompositeKey(e);try{const c=o.get(a);c.onerror=l=>{r(Ac(l,"storage-get"))},c.onsuccess=l=>{const u=l.target.result;i(u?u.value:void 0)}}catch(c){r(_t.create("storage-get",{originalErrorMessage:c==null?void 0:c.message}))}})}async set(e,t){const i=await this.openDbPromise;return new Promise((r,s)=>{const a=i.transaction([Mi],"readwrite").objectStore(Mi),c=this.createCompositeKey(e);try{const l=a.put({compositeKey:c,value:t});l.onerror=u=>{s(Ac(u,"storage-set"))},l.onsuccess=()=>{r()}}catch(l){s(_t.create("storage-set",{originalErrorMessage:l==null?void 0:l.message}))}})}async delete(e){const t=await this.openDbPromise;return new Promise((i,r)=>{const o=t.transaction([Mi],"readwrite").objectStore(Mi),a=this.createCompositeKey(e);try{const c=o.delete(a);c.onerror=l=>{r(Ac(l,"storage-delete"))},c.onsuccess=()=>{i()}}catch(c){r(_t.create("storage-delete",{originalErrorMessage:c==null?void 0:c.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class s2{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),i=this.storage.getActiveConfig(),r=await e;r&&(this.lastFetchStatus=r);const s=await t;s&&(this.lastSuccessfulFetchTimestampMillis=s);const o=await i;o&&(this.activeConfig=o)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}function o2(){ge(new H(OH,n,"PUBLIC").setMultipleInstances(!0)),Z(Yh,Vv),Z(Yh,Vv,"esm2017");function n(e,{instanceIdentifier:t}){const i=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(typeof window>"u")throw _t.create("registration-window");if(!bt())throw _t.create("indexed-db-unavailable");const{projectId:s,apiKey:o,appId:a}=i.options;if(!s)throw _t.create("registration-project-id");if(!o)throw _t.create("registration-api-key");if(!a)throw _t.create("registration-app-id");t=t||"firebase";const c=new r2(a,i.name,t),l=new s2(c),u=new vn(Yh);u.logLevel=$.ERROR;const h=new zH(r,wn,t,s,o,a),d=new XH(h,c),f=new GH(d,c,l,u),p=new e2(i,f,l,c,u);return L0(p),p}}async function a2(n){return n=v(n),await F0(n),M0(n)}async function c2(){if(!bt())return!1;try{return await ga()}catch{return!1}}o2();class l2{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return M0(this._delegate)}ensureInitialized(){return L0(this._delegate)}fetch(){return F0(this._delegate)}fetchAndActivate(){return a2(this._delegate)}getAll(){return VH(this._delegate)}getBoolean(e){return BH(this._delegate,e)}getNumber(e){return qH(this._delegate,e)}getString(e){return jH(this._delegate,e)}getValue(e){return Ja(this._delegate,e)}setLogLevel(e){WH(this._delegate,e)}}const u2="@firebase/remote-config-compat",h2="0.2.0";function d2(n){n.INTERNAL.registerComponent(new H("remoteConfig-compat",f2,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:c2})),n.registerVersion(u2,h2)}function f2(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("remote-config").getImmediate({identifier:e});return new l2(t,i)}d2(Te);var p2="firebase",g2="9.15.0";Te.registerVersion(p2,g2,"app-compat");var m2="firebase",_2="9.15.0";console.warn(`
It looks like you're using the development build of the Firebase JS SDK.
When deploying Firebase apps to production, it is advisable to only import
the individual SDK components you intend to use.

For the module builds, these are available in the following manner
(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):

CommonJS Modules:
const firebase = require('firebase/app');
require('firebase/<PACKAGE>');

ES Modules:
import firebase from 'firebase/app';
import 'firebase/<PACKAGE>';

Typescript:
import firebase from 'firebase/app';
import 'firebase/<PACKAGE>';
`);Te.registerVersion(m2,_2,"compat");const y2={apiKey:"AIzaSyANnJyicyvVy2icgMa-zqjh8yzYBOaeZCc",authDomain:"users-dashboard-bf904.firebaseapp.com",projectId:"users-dashboard-bf904",storageBucket:"users-dashboard-bf904.appspot.com",messagingSenderId:"593782459698",appId:"1:593782459698:web:dd8d5cefb8326c042a1b2b"};Te.initializeApp(y2);let U0=Te.firestore();const v2={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};let w2=document.getElementById("callButton"),I2=document.getElementById("webcamButton"),b2=document.getElementById("webcamVideo"),E2=document.getElementById("remoteVideo"),T2=document.getElementById("answerButton");document.getElementById("hangupButton");let $0=document.getElementById("callInput"),kt=new RTCPeerConnection(v2),_c=null,Jh=null;I2.onclick=async()=>{_c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),Jh=new MediaStream,_c.getTracks().forEach(n=>{kt.addTrack(n,_c)}),kt.ontrack=n=>{n.streams[0].getTracks().forEach(e=>{Jh.addTrack(e)})},b2.srcObject=_c,E2.srcObject=Jh};w2.onclick=async()=>{const n=U0.collection("calls").doc(),e=n.collection("offerCandidates"),t=n.collection("answerCandidates");$0.value=n.id,kt.onicecandidate=async s=>{s.candidate&&(await s.candidate,await e.add(s.candidate.toJSON()))};const i=await kt.createOffer();await kt.setLocalDescription(i);const r={sdp:i.sdp,type:i.type};await n.set({offer:r}),n.onSnapshot(s=>{const o=s.data();if(!kt.currentLocalDescription&&(o!=null&&o.answer)){const a=new RTCSessionDescription(o.answer);kt.setRemoteDescription(a)}}),t.onSnapshot(s=>{s.docChanges().forEach(o=>{if(o.type==="added"){const a=new RTCIceCandidate(o.doc.data());kt.addIceCandidate(a)}})})};T2.onclick=async()=>{const n=$0.value.trim(),e=U0.collection("calls").doc(n),t=e.collection("answerCandidates"),i=e.collection("offerCandidates");kt.onicecandidate=async c=>{c.candidate&&(await c.candidate,await t.add(c.candidate.toJSON()))};const s=(await e.get()).data().offer;await kt.setRemoteDescription(new RTCSessionDescription(s));const o=await kt.createAnswer();await kt.setLocalDescription(o);const a={type:o.type,sdp:o.sdp};await e.update({answer:a}),i.onSnapshot(c=>{c.docChanges().forEach(l=>{if(l.type==="added"){let u=l.doc.data();kt.addIceCandidate(new RTCIceCandidate(u))}})})};
